NATIVE=false;CACHE={"resources/starGrids.js":"exports = [\n\t\t\t\n\t[[0,1,0]],\n\t\n\t[[1,1,1,1,1,1]],\n\n\t[[1,0,1,0,1,0,1,0,1]],\n\n\t[[1,1,1,1,1,1,1,1,1]],\n\t\n\t[[0,0,0,1,0,0,0],\n\t [0,0,1,0,1,0,0],\n\t [0,1,0,0,0,1,0],\n\t [1,0,0,0,0,0,1]],\n\n\t[[0,0,1,0,0],\n\t [0,1,0,1,0],\n\t [1,0,0,0,1]],\n\n\t[[0,0,1,0,0],\n\t [0,1,1,1,0],\n\t [1,1,1,1,1]],\n\n\t[[1,1,1,1,1],\n\t [0,1,1,1,0],\n\t [0,0,1,0,0]],\n\n\t[[1,1,1,1,1],\n\t [0,1,1,1,0],\n\t [0,0,1,0,0]],\n\n\t[[1,0,1,0,1,0,1,0,1],\n\t [0,1,0,1,0,1,0,1,0],\n\t [1,0,1,0,1,0,1,0,1],\n\t [0,1,0,1,0,1,0,1,0]],\n\t\n\t[[1,1,1,1,1,1,1,1,1],\n\t [1,1,1,1,1,1,1,1,1],\n\t [1,1,1,1,1,1,1,1,1],\n\t [1,1,1,1,1,1,1,1,1]],\n\t\n];\n","resources/fonts/fontsheetSizeMap.json":"{}","spritesheets/spritesheetSizeMap.json":"{\"spritesheets/resources-images-numbers0.png\":{\"w\":1024,\"h\":64},\"spritesheets/resources-images-avatarKiwiAce0.png\":{\"w\":1024,\"h\":256},\"spritesheets/resources-images-level4.png\":{\"w\":1024,\"h\":1024},\"spritesheets/resources-images-level2.png\":{\"w\":1024,\"h\":94},\"spritesheets/resources-images-enemies0.png\":{\"w\":256,\"h\":64},\"spritesheets/resources-images0.png\":{\"w\":16,\"h\":64},\"spritesheets/resources-images-level1.png\":{\"w\":1024,\"h\":225},\"spritesheets/resources-images-level0.png\":{\"w\":1024,\"h\":450},\"spritesheets/resources-images-level3.png\":{\"w\":1024,\"h\":30},\"spritesheets/resources-images-menu0.png\":{\"w\":1024,\"h\":576}}","spritesheets/map.json":"{\"resources/starGrids.js\":{},\"resources/audio/background.mp3\":{},\"resources/audio/win.mp3\":{},\"resources/audio/effects/bottle4.mp3\":{},\"resources/audio/effects/lose.mp3\":{},\"resources/audio/effects/bottle5.mp3\":{},\"resources/audio/effects/bottle3.mp3\":{},\"resources/audio/effects/bottle1.mp3\":{},\"resources/audio/effects/bottle2.mp3\":{},\"resources/fonts/fontsheetSizeMap.json\":{},\"resources/images/numbers/char-plus.png\":{\"w\":29,\"marginBottom\":22,\"scale\":1,\"marginLeft\":11,\"marginTop\":17,\"marginRight\":10,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":31,\"y\":2,\"sheetSize\":[1024,64],\"x\":606},\"resources/images/avatarKiwiAce/kiwiAce_jump_0003.png\":{\"w\":52,\"marginBottom\":0,\"scale\":1,\"marginLeft\":20,\"marginTop\":4,\"marginRight\":28,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":84,\"sheetSize\":[1024,256],\"x\":174},\"resources/images/numbers/char-exclamation.png\":{\"w\":15,\"marginBottom\":13,\"scale\":1,\"marginLeft\":19,\"marginTop\":0,\"marginRight\":16,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":57,\"y\":2,\"sheetSize\":[1024,64],\"x\":640},\"resources/images/numbers/char-x.png\":{\"w\":28,\"marginBottom\":22,\"scale\":1,\"marginLeft\":13,\"marginTop\":18,\"marginRight\":9,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":30,\"y\":2,\"sheetSize\":[1024,64],\"x\":660},\"resources/images/level/platform768.png\":{\"w\":768,\"marginBottom\":25,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":203,\"y\":406,\"sheetSize\":[1024,1024],\"x\":2},\"resources/images/avatarKiwiAce/kiwiAce_float_0003.png\":{\"w\":100,\"marginBottom\":12,\"scale\":1,\"marginLeft\":0,\"marginTop\":23,\"marginRight\":0,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":65,\"y\":2,\"sheetSize\":[1024,256],\"x\":340},\"resources/images/numbers/char-question.png\":{\"w\":25,\"marginBottom\":13,\"scale\":1,\"marginLeft\":13,\"marginTop\":0,\"marginRight\":12,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":57,\"y\":2,\"sheetSize\":[1024,64],\"x\":530},\"resources/images/avatarKiwiAce/kiwiAce_jump_0004.png\":{\"w\":60,\"marginBottom\":4,\"scale\":1,\"marginLeft\":18,\"marginTop\":0,\"marginRight\":22,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":2,\"sheetSize\":[1024,256],\"x\":512},\"resources/images/numbers/char-2.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":208},\"resources/images/numbers/char-6.png\":{\"w\":49,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":1,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":424},\"resources/images/avatarKiwiAce/kiwiAce_run_0006.png\":{\"w\":52,\"marginBottom\":0,\"scale\":1,\"marginLeft\":19,\"marginTop\":4,\"marginRight\":29,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":64,\"sheetSize\":[1024,256],\"x\":808},\"resources/images/avatarKiwiAce/kiwiAce_run_0005.png\":{\"w\":60,\"marginBottom\":0,\"scale\":1,\"marginLeft\":17,\"marginTop\":4,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":2,\"sheetSize\":[1024,256],\"x\":576},\"resources/images/numbers/char-9.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":262},\"resources/images/level/waterFast.png\":{\"w\":1024,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":17,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level2.png\",\"h\":94,\"y\":0,\"sheetSize\":[1024,94],\"x\":0},\"resources/images/avatarKiwiAce/kiwiAce_land_0001.png\":{\"w\":71,\"marginBottom\":2,\"scale\":1,\"marginLeft\":21,\"marginTop\":0,\"marginRight\":8,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":98,\"y\":2,\"sheetSize\":[1024,256],\"x\":98},\"resources/images/enemies/bee_flying_0001.png\":{\"w\":45,\"marginBottom\":10,\"scale\":1,\"marginLeft\":1,\"marginTop\":5,\"marginRight\":4,\"group\":\"resources-images-enemies\",\"sheet\":\"spritesheets/resources-images-enemies0.png\",\"h\":35,\"y\":2,\"sheetSize\":[256,64],\"x\":152},\"resources/images/numbers/char-comma.png\":{\"w\":16,\"marginBottom\":8,\"scale\":1,\"marginLeft\":17,\"marginTop\":43,\"marginRight\":17,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":19,\"y\":2,\"sheetSize\":[1024,64],\"x\":692},\"resources/images/star.png\":{\"w\":11,\"marginBottom\":4,\"scale\":1,\"marginLeft\":20,\"marginTop\":3,\"marginRight\":19,\"group\":\"resources-images\",\"sheet\":\"spritesheets/resources-images0.png\",\"h\":43,\"y\":2,\"sheetSize\":[16,64],\"x\":2},\"resources/images/enemies/bee_flying_0005.png\":{\"w\":45,\"marginBottom\":10,\"scale\":1,\"marginLeft\":1,\"marginTop\":6,\"marginRight\":4,\"group\":\"resources-images-enemies\",\"sheet\":\"spritesheets/resources-images-enemies0.png\",\"h\":34,\"y\":2,\"sheetSize\":[256,64],\"x\":202},\"resources/images/avatarKiwiAce/kiwiAce_glider_0002.png\":{\"w\":100,\"marginBottom\":24,\"scale\":1,\"marginLeft\":0,\"marginTop\":20,\"marginRight\":0,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":56,\"y\":2,\"sheetSize\":[1024,256],\"x\":704},\"resources/images/avatarKiwiAce/kiwiAce_blink_0002.png\":{\"w\":40,\"marginBottom\":0,\"scale\":1,\"marginLeft\":30,\"marginTop\":0,\"marginRight\":30,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":62,\"sheetSize\":[1024,256],\"x\":764},\"resources/images/avatarKiwiAce/kiwiAce_run_0001.png\":{\"w\":40,\"marginBottom\":0,\"scale\":1,\"marginLeft\":30,\"marginTop\":0,\"marginRight\":30,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":64,\"sheetSize\":[1024,256],\"x\":864},\"resources/images/numbers/char-8.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":316},\"resources/images/level/cloud1.png\":{\"w\":344,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":7,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":38,\"y\":794,\"sheetSize\":[1024,1024],\"x\":2},\"resources/images/level/platform1024.png\":{\"w\":1005,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":19,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":218,\"y\":2,\"sheetSize\":[1024,1024],\"x\":2},\"resources/images/numbers/char-percent.png\":{\"w\":40,\"marginBottom\":13,\"scale\":1,\"marginLeft\":4,\"marginTop\":0,\"marginRight\":6,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":57,\"y\":2,\"sheetSize\":[1024,64],\"x\":2},\"resources/images/enemies/bee_flying_0002.png\":{\"w\":45,\"marginBottom\":10,\"scale\":1,\"marginLeft\":1,\"marginTop\":1,\"marginRight\":4,\"group\":\"resources-images-enemies\",\"sheet\":\"spritesheets/resources-images-enemies0.png\",\"h\":39,\"y\":2,\"sheetSize\":[256,64],\"x\":2},\"resources/images/numbers/char-0.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":100},\"resources/images/level/platform256.png\":{\"w\":249,\"marginBottom\":3,\"scale\":1,\"marginLeft\":0,\"marginTop\":4,\"marginRight\":7,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":68,\"y\":788,\"sheetSize\":[1024,1024],\"x\":664},\"resources/images/numbers/char-7.png\":{\"w\":49,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":15,\"marginRight\":1,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":35,\"y\":2,\"sheetSize\":[1024,64],\"x\":46},\"resources/images/level/cloud5.png\":{\"w\":386,\"marginBottom\":3,\"scale\":1,\"marginLeft\":0,\"marginTop\":3,\"marginRight\":2,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":47,\"y\":742,\"sheetSize\":[1024,1024],\"x\":2},\"resources/images/avatarKiwiAce/kiwiAce_blink_0001.png\":{\"w\":40,\"marginBottom\":0,\"scale\":1,\"marginLeft\":30,\"marginTop\":0,\"marginRight\":30,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":64,\"sheetSize\":[1024,256],\"x\":864},\"resources/images/avatarKiwiAce/kiwiAce_blink_0004.png\":{\"w\":56,\"marginBottom\":0,\"scale\":1,\"marginLeft\":19,\"marginTop\":4,\"marginRight\":25,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":62,\"sheetSize\":[1024,256],\"x\":704},\"resources/images/avatarKiwiAce/kiwiAce_jump_0001.png\":{\"w\":36,\"marginBottom\":0,\"scale\":1,\"marginLeft\":31,\"marginTop\":0,\"marginRight\":33,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":94,\"sheetSize\":[1024,256],\"x\":2},\"resources/images/avatarKiwiAce/kiwiAce_float_0005.png\":{\"w\":92,\"marginBottom\":13,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":8,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":87,\"y\":2,\"sheetSize\":[1024,256],\"x\":2},\"resources/images/avatarKiwiAce/kiwiAce_glider_0001.png\":{\"w\":100,\"marginBottom\":25,\"scale\":1,\"marginLeft\":0,\"marginTop\":22,\"marginRight\":0,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":53,\"y\":72,\"sheetSize\":[1024,256],\"x\":340},\"resources/images/avatarKiwiAce/kiwiAce_blink_0005.png\":{\"w\":60,\"marginBottom\":0,\"scale\":1,\"marginLeft\":17,\"marginTop\":4,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":2,\"sheetSize\":[1024,256],\"x\":576},\"resources/images/avatarKiwiAce/kiwiAce_run_0002.png\":{\"w\":40,\"marginBottom\":0,\"scale\":1,\"marginLeft\":30,\"marginTop\":0,\"marginRight\":30,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":62,\"sheetSize\":[1024,256],\"x\":764},\"resources/images/avatarKiwiAce/kiwiAce_blink_0003.png\":{\"w\":54,\"marginBottom\":0,\"scale\":1,\"marginLeft\":23,\"marginTop\":0,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":2,\"sheetSize\":[1024,256],\"x\":910},\"resources/images/numbers/char-5.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":154},\"resources/images/enemies/bee_flying_0004.png\":{\"w\":45,\"marginBottom\":10,\"scale\":1,\"marginLeft\":1,\"marginTop\":4,\"marginRight\":4,\"group\":\"resources-images-enemies\",\"sheet\":\"spritesheets/resources-images-enemies0.png\",\"h\":36,\"y\":2,\"sheetSize\":[256,64],\"x\":102},\"resources/images/avatarKiwiAce/kiwiAce_float_0002.png\":{\"w\":90,\"marginBottom\":13,\"scale\":1,\"marginLeft\":4,\"marginTop\":10,\"marginRight\":6,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":77,\"y\":2,\"sheetSize\":[1024,256],\"x\":174},\"resources/images/avatarKiwiAce/kiwiAce_landed_0002.png\":{\"w\":60,\"marginBottom\":0,\"scale\":1,\"marginLeft\":17,\"marginTop\":4,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":2,\"sheetSize\":[1024,256],\"x\":576},\"resources/images/avatarKiwiAce/kiwiAce_roll_0001.png\":{\"w\":63,\"marginBottom\":0,\"scale\":1,\"marginLeft\":12,\"marginTop\":0,\"marginRight\":25,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":2,\"sheetSize\":[1024,256],\"x\":444},\"resources/images/level/cloud3.png\":{\"w\":267,\"marginBottom\":2,\"scale\":1,\"marginLeft\":2,\"marginTop\":2,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":67,\"y\":788,\"sheetSize\":[1024,1024],\"x\":392},\"resources/images/level/cloud2.png\":{\"w\":373,\"marginBottom\":2,\"scale\":1,\"marginLeft\":1,\"marginTop\":0,\"marginRight\":1,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":85,\"y\":614,\"sheetSize\":[1024,1024],\"x\":460},\"resources/images/numbers/char-minus.png\":{\"w\":17,\"marginBottom\":33,\"scale\":1,\"marginLeft\":17,\"marginTop\":23,\"marginRight\":16,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":14,\"y\":2,\"sheetSize\":[1024,64],\"x\":712},\"resources/images/numbers/char-1.png\":{\"w\":41,\"marginBottom\":20,\"scale\":1,\"marginLeft\":5,\"marginTop\":17,\"marginRight\":4,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":33,\"y\":2,\"sheetSize\":[1024,64],\"x\":560},\"resources/images/avatarKiwiAce/kiwiAce_jump_0002.png\":{\"w\":52,\"marginBottom\":0,\"scale\":1,\"marginLeft\":21,\"marginTop\":0,\"marginRight\":27,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":2,\"sheetSize\":[1024,256],\"x\":968},\"resources/images/numbers/char-period.png\":{\"w\":14,\"marginBottom\":13,\"scale\":1,\"marginLeft\":18,\"marginTop\":41,\"marginRight\":18,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":16,\"y\":2,\"sheetSize\":[1024,64],\"x\":734},\"resources/images/numbers/char-4.png\":{\"w\":50,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":0,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":370},\"resources/images/level/platform512.png\":{\"w\":454,\"marginBottom\":0,\"scale\":1,\"marginLeft\":27,\"marginTop\":0,\"marginRight\":31,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":124,\"y\":614,\"sheetSize\":[1024,1024],\"x\":2},\"resources/images/level/fargroundBrush.png\":{\"w\":1024,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level1.png\",\"h\":225,\"y\":0,\"sheetSize\":[1024,225],\"x\":0},\"resources/images/level/backgroundSky.png\":{\"w\":1024,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level0.png\",\"h\":450,\"y\":0,\"sheetSize\":[1024,450],\"x\":0},\"resources/images/avatarKiwiAce/kiwiAce_float_0004.png\":{\"w\":97,\"marginBottom\":22,\"scale\":1,\"marginLeft\":0,\"marginTop\":21,\"marginRight\":3,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":57,\"y\":2,\"sheetSize\":[1024,256],\"x\":808},\"resources/images/enemies/bee_flying_0003.png\":{\"w\":45,\"marginBottom\":10,\"scale\":1,\"marginLeft\":1,\"marginTop\":3,\"marginRight\":4,\"group\":\"resources-images-enemies\",\"sheet\":\"spritesheets/resources-images-enemies0.png\",\"h\":37,\"y\":2,\"sheetSize\":[256,64],\"x\":52},\"resources/images/avatarKiwiAce/kiwiAce_jump_0005.png\":{\"w\":60,\"marginBottom\":4,\"scale\":1,\"marginLeft\":17,\"marginTop\":0,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":2,\"sheetSize\":[1024,256],\"x\":640},\"resources/images/level/waterSlow.png\":{\"w\":1024,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level3.png\",\"h\":30,\"y\":0,\"sheetSize\":[1024,30],\"x\":0},\"resources/images/level/cloud4.png\":{\"w\":345,\"marginBottom\":2,\"scale\":1,\"marginLeft\":2,\"marginTop\":3,\"marginRight\":4,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":80,\"y\":704,\"sheetSize\":[1024,1024],\"x\":460},\"resources/images/avatarKiwiAce/kiwiAce_run_0004.png\":{\"w\":56,\"marginBottom\":0,\"scale\":1,\"marginLeft\":19,\"marginTop\":4,\"marginRight\":25,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":62,\"sheetSize\":[1024,256],\"x\":704},\"resources/images/avatarKiwiAce/kiwiAce_float_0001.png\":{\"w\":67,\"marginBottom\":0,\"scale\":1,\"marginLeft\":18,\"marginTop\":2,\"marginRight\":15,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":98,\"y\":2,\"sheetSize\":[1024,256],\"x\":268},\"resources/images/avatarKiwiAce/kiwiAce_blink_0006.png\":{\"w\":52,\"marginBottom\":0,\"scale\":1,\"marginLeft\":19,\"marginTop\":4,\"marginRight\":29,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":96,\"y\":64,\"sheetSize\":[1024,256],\"x\":808},\"resources/images/avatarKiwiAce/kiwiAce_run_0003.png\":{\"w\":54,\"marginBottom\":0,\"scale\":1,\"marginLeft\":23,\"marginTop\":0,\"marginRight\":23,\"group\":\"resources-images-avatarKiwiAce\",\"sheet\":\"spritesheets/resources-images-avatarKiwiAce0.png\",\"h\":100,\"y\":2,\"sheetSize\":[1024,256],\"x\":910},\"resources/images/numbers/char-3.png\":{\"w\":48,\"marginBottom\":20,\"scale\":1,\"marginLeft\":0,\"marginTop\":16,\"marginRight\":2,\"group\":\"resources-images-numbers\",\"sheet\":\"spritesheets/resources-images-numbers0.png\",\"h\":34,\"y\":2,\"sheetSize\":[1024,64],\"x\":478},\"resources/images/menu/background.png\":{\"w\":1024,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":0,\"marginRight\":0,\"group\":\"resources-images-menu\",\"sheet\":\"spritesheets/resources-images-menu0.png\",\"h\":576,\"y\":0,\"sheetSize\":[1024,576],\"x\":0},\"resources/images/level/midgroundBrush.png\":{\"w\":998,\"marginBottom\":0,\"scale\":1,\"marginLeft\":0,\"marginTop\":5,\"marginRight\":0,\"group\":\"resources-images-level\",\"sheet\":\"spritesheets/resources-images-level4.png\",\"h\":178,\"y\":224,\"sheetSize\":[1024,1024],\"x\":2}}"};
jsio.path.set(["sdk/jsio",".","sdk/gc/api/","sdk/","sdk/timestep/"]),jsio.path.cache={preprocessors:"sdk/jsio",base:"sdk/jsio",util:"sdk/jsio",gc:"sdk/jsio",device:"sdk/timestep/",event:"sdk/timestep/",lib:"sdk/jsio",ui:"sdk/timestep/",std:"sdk/jsio",platforms:"sdk/timestep/",math:"sdk/jsio",timer:"sdk/timestep/",animate:"sdk/timestep/",squill:"sdk/jsio",AudioManager:"sdk/timestep/",net:"sdk/jsio",src:".",resources:".",plugins:"sdk/"},jsio.setCachedSrc("sdk/jsio/base.js",'var SLICE,ErrorParentClass,logger;exports.log=jsio.__env.log,exports.GLOBAL=jsio.__env.global,Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){var t,n,r,i;if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});SLICE=Array.prototype.slice;exports.isArray="function"==typeof Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},exports.bind=function(e,t){var n;if(arguments.length>2){n=SLICE.call(arguments,2);return typeof t=="string"?function(){if(e[t])return e[t].apply(e,n.concat(SLICE.call(arguments,0)));throw logger.error("No method:",t,"for context",e)}:function(){return t.apply(e,n.concat(SLICE.call(arguments,0)))}}return typeof t=="string"?function(){if(e[t])return e[t].apply(e,arguments);throw logger.error("No method:",t,"for context",e)}:function(){return t.apply(e,arguments)}},exports.Class=function(e,t,n){return exports.__class__(function(){return this.init&&this.init.apply(this,arguments)},e,t,n)},exports.__class__=function(e,t,n,r){var s,o,u,a,i=function(){};typeof t!="string"&&(r=n,n=t,t=null),t&&(s=exports.logging.get(t));if(!n)throw Error("parent or prototype not provided");r||(r=n,n=null);if(n)if(exports.isArray(n)){i.prototype={};for(o=0;u=n[o];++o){u==Error&&ErrorParentClass&&(u=ErrorParentClass);for(a in u.prototype)a in i.prototype||(i.prototype[a]=u.prototype[a])}n=n[0]}else n==Error&&ErrorParentClass&&(n=ErrorParentClass),i.prototype=n.prototype;return o=n?function(e,t,r){var i=n.prototype[t];if(!i)throw Error("method "+t+" does not exist");return i.apply(e,r||[])}:null,u=e.prototype=new i,u.constructor=e,u.__parentClass__=n,t&&(u.__class__=t),r.call(u,s||o,s&&o),e};ErrorParentClass=exports.__class__(function(){var e=Error.prototype.constructor.apply(this,arguments),t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},function(){});exports.Class.defaults=exports.merge=function(e){var e,n,r,i,s;for(e=e||{},n=1,r=arguments.length;n<r;++n){i=arguments[n];for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(e[s]=i[s])}return e},exports.delay=function(e,t){var r,i,n=null,s=function(){e.apply(r,i)};return function(){r=this,i=arguments,n&&clearTimeout(n),n=setTimeout(s,t||0)}},exports.logging=function(){var i,e={DEBUG:1,LOG:2,INFO:3,WARN:4,ERROR:5,NONE:10},t={},n=!1,r="";e.setPrefix=function(e){r=e+" "},e.setProduction=function(e){n=!!e},e.get=function(e){return t.hasOwnProperty(e)?t[e]:t[e]=new i(e)},e.set=function(e,n){t[e]=n},e.getAll=function(){return t},e.__create=function(t,n){n.logger=e.get(t)};i=exports.__class__(function(t,n){this._name=t,this._level=n||e.LOG},function(){function t(e,t){return function(){if(!n&&e>=this._level){var i=t+" "+r+this._name,s=this._listener||exports.log;return s&&s.apply(this._listener,[i].concat(SLICE.call(arguments)))}return arguments[0]}}this.setLevel=function(e){this._level=e},this.setListener=function(e){this._listener=e},this.debug=t(e.DEBUG,"DEBUG"),this.log=t(e.LOG,"LOG"),this.info=t(e.INFO,"INFO"),this.warn=t(e.WARN,"WARN"),this.error=t(e.ERROR,"ERROR")});return e}();logger=exports.logging.get("jsiocore")'),jsio.setCachedSrc("sdk/jsio/gc/browser/launchClient.js",'var isSimulator,splash,uri,mute;function startApp(e){jsio("import device"),jsio("import platforms.browser.initialize"),device.init(),isSimulator&&e&&(jsio("import ..debugging.TimestepInspector"),e.addClient(new debugging.TimestepInspector),device.isMobileBrowser&&(e.initLogProxy(),e.initRemoteEval()),function(){var e=jsio.__env,t=bind(e,e.checkSyntax),n=bind(e,e.fetch);e.fetch=function(e){return logging.get("jsiocore").warn("LOADING EXTERNAL FILE:",e),n.apply(this,arguments)},e.checkSyntax=function(e,n){var r=new XMLHttpRequest;r.open("POST","/.syntax",!1),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){var i;if(r.readyState==4)if(r.status==200&&r.responseText){try{i=JSON.parse(r.responseText)[1]}catch(s){i=r.responseText}console.log(i),document.body.innerHTML=\'<pre style=\\\'margin-left: 10px; font: bold 12px Consolas, "Bitstream Vera Sans Mono", Monaco, "Lucida Console", Terminal, monospace; color: #FFF;\\\'><span style="color:#AAF">\'+n+"</span>\\n\\n"+i.map(function(e){return e.err?\'<span style="color:#F55">\'+e.err.replace(/error - parse error.\\s+/i,"")+\'</span>\\n <span style="color:#5F5">\'+e.line+\'</span>:  <span style="color:#EEE">\'+e.code[0]+"</span>\\n"+Array((""+e.line).length+5).join(" ")+e.code[1]:\'<span style="color:#F55">\'+e.code.join("\\n")+"</span>"}).join("\\n")+"</pre>"}else r.status>0&&t(e,n)},r.send("javascript="+encodeURIComponent(e))}}()),jsio("import gc.API"),GC.buildApp("launchUI"),isSimulator&&e&&e.setApp(GC.app)}jsio("import device");isSimulator=device.isSimulator;isSimulator?jsio.__env.debugPath=function(e){return"http://"+window.location.host+"/"+e}:(device.simulatingMobileNative=!0,jsio("import gc.debugging.nativeShim")),window.JSON||jsio("import std.JSON").createGlobal(),window.console||(window.console={},window.console.log=window.console.info=window.console.error=window.console.warn=function(){}),window.localStorage||(window.localStorage={getItem:function(){},setItem:function(){},removeItem:function(){}});splash=document.getElementById("_GCSplash");splash&&!CONFIG.splash.hide&&(CONFIG.splash.hide=function(){setTimeout(function(){splash.style.opacity=0,setTimeout(function(){splash.parentNode.removeChild(splash)},1e3)},2e3)}),jsio("import std.uri");uri=new std.uri(window.location),mute=uri.hash("mute");CONFIG.isMuted=void 0!=mute&&"false"!=mute&&"0"!=mute&&"no"!=mute,startApp()'),jsio.setCachedSrc("sdk/timestep/device.js",'var ua,_devices,devicePixelRatio,urlStr,match;jsio("import event.Emitter as Emitter"),jsio("import util.setProperty");if("undefined"==typeof navigator||!navigator.userAgent)logger.warn("> Timestep was unable to determine your device! Please check that navigator.userAgent is defined."),exports={isUnknown:!0};ua=navigator.userAgent,_devices={};exports.registerDevice=function(e,t){_devices[e]=t},exports.get=function(e){return jsio("import "+(_devices[exports.name]||"platforms.browser")+"."+e,{dontExport:!0,suppressErrors:!0})},exports.importUI=function(e){return jsio("import ui.backend."+(exports.useDOM?"dom":"canvas")+"."+e,{dontExport:!0,suppressErrors:!0})},exports.isMobileNative=exports.isMobile=/TeaLeaf/.test(ua),logger.log(exports.isMobile?"on mobile device":"in web browser"),exports.screen=new Emitter;devicePixelRatio=window.devicePixelRatio||1;exports.devicePixelRatio=devicePixelRatio,exports.screen.devicePixelRatio=devicePixelRatio,exports.screen.width=window.screen.width*devicePixelRatio,exports.screen.height=window.screen.height*devicePixelRatio,exports.hideAddressBar=function(){},util.setProperty(exports,"defaultFontFamily",{cb:function(e){jsio("import ui.resource.Font"),ui.resource.Font.setDefaultFontFamily(e)},value:"Helvetica"}),exports.defaultFontWeight="",exports.events="ontouchstart"in window&&!/BlackBerry/.test(ua)?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},exports.isMobileBrowser=!1,exports.isUIWebView=!1,exports.isSafari=/Safari/.test(ua),jsio("import std.uri"),uri=new std.uri(window.location),exports.isSimulator=!!uri.query("device")||!!uri.hash("device");if(exports.isSimulator){urlStr=window.location.href.toLowerCase();exports.isIOSSimulator=-1!==urlStr.indexOf("ipad")||-1!==urlStr.indexOf("iphone"),exports.isAndroidSimulator=!exports.isIOSSimulator}else exports.isAndroidSimulator=!1,exports.isIOSSimulator=!1;if(exports.isMobile)exports.name="tealeaf",exports.width=navigator.width,exports.height=navigator.height,exports.isAndroid=/Android/.test(ua),exports.isAndroid?exports.isTablet=600<=navigator.width/devicePixelRatio:(exports.isIPad=exports.isTablet=/iPad/.test(ua),exports.isIPhone=/iPhone/.test(ua),exports.isIOS=!0);else{if(/(iPod|iPhone|iPad)/i.test(ua)){exports.name="browser",exports.isMobileBrowser=!0,exports.isIOS=!0;match=ua.match(/iPhone OS ([0-9]+)/);exports.iosVersion=match&&parseInt(match[1]),exports.isUIWebView=!exports.isSafari,exports.screen.defaultOrientation="portrait",exports.screen.browserChrome={portrait:{top:20*devicePixelRatio,bottom:44*devicePixelRatio},landscape:{top:20*devicePixelRatio,bottom:32*devicePixelRatio}}}else/Mobile Safari/.test(ua)||/Android/.test(ua)||/BlackBerry/.test(ua)?(exports.name="browser",exports.isMobileBrowser=!0,exports.isAndroid=!0,exports.screen.width=window.outerWidth,exports.screen.height=window.outerHeight-1,exports.screen.defaultOrientation="portrait",exports.screen.browserChrome={portrait:{top:0,bottom:0},landscape:{top:0,bottom:0}}):(exports.screen.width=window.innerWidth,exports.screen.height=window.innerHeight,exports.name="browser",exports.canResize=!1);exports.width=exports.screen.width,exports.height=exports.screen.height}exports.useDOM=!1,exports.setUseDOM=function(){},exports.getDimensions=function(e){var t=Math.min(exports.width,exports.height),n=Math.max(exports.width,exports.height);return e?{height:t,width:n}:{height:n,width:t}},exports.init=function(){jsio("import ui.init"),exports.get("initialize").init(),exports.screen.width=exports.width,exports.screen.height=exports.height},exports.setBackButtonHandler=function(e){NATIVE&&(NATIVE.onBackButton=e)},exports.setRotationHandler=function(e){NATIVE&&(NATIVE.onRotation=e)},exports.stayAwake=function(e){NATIVE&&NATIVE.stayAwake&&NATIVE.stayAwake(e)},exports.collectGarbage=function(){logger.log("collecting garbage"),NATIVE&&NATIVE.gc&&NATIVE.gc.runGC()},GLOBAL.ACCESSIBILITY=new(Class(Emitter,function(){this.muted=!1,this.mute=function(e){this.muted=e,this.publish("MuteChange")}})),GLOBAL.ONACCESSIBLE&&GLOBAL.ONACCESSIBLE()'),jsio.setCachedSrc("sdk/timestep/event/Emitter.js",'jsio("import lib.PubSub as exports")'),jsio.setCachedSrc("sdk/jsio/lib/PubSub.js",'var ctx=jsio.__env.global,SLICE=Array.prototype.slice,sdk_jsio_lib_PubSub=__class__;exports=sdk_jsio_lib_PubSub(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){},this.publish=function(e){var t,n,r,i,s;if(this._subscribers){t=SLICE.call(arguments,1);if(this._subscribers.__any)for(n=[e].concat(t),r=this._subscribers.__any.slice(0),i=0;s=r[i];++i)s.apply(ctx,n);if(!this._subscribers[e])return this;r=this._subscribers[e].slice(0);for(i=0;s=r[i];++i)s.apply(ctx,t)}return this},this.subscribe=function(e,t,n){var r,i;2==arguments.length?r=t:(r=bind.apply(GLOBAL,SLICE.call(arguments,1)),r._ctx=t,r._method=n);i=this._subscribers||(this._subscribers={});return(i[e]||(i[e]=[])).push(r),this},this.subscribeOnce=function(e,t,n){var r=arguments,i=bind(this,function(){this.unsubscribe(e,i),2==r.length?t.apply(GLOBAL,arguments):bind.apply(GLOBAL,SLICE.call(r,1)).apply(GLOBAL,arguments)});return 3===r.length&&(i._ctx=t,i._method=n),this.subscribe(e,i)},this.unsubscribe=function(e,t,n){var e,r,i;if(!this._subscribers||!this._subscribers[e])return this;for(e=this._subscribers[e],r=0;i=e[r];++r)(i==t||i._ctx==t&&(!n||i._method==n))&&e.splice(r--,1);return this},this.listeners=function(e){return this._subscribers=this._subscribers?this._subscribers:{},this.hasOwnProperty.call(this._subscribers,e)?this._subscribers[e]:this._subscribers[e]=[]},this.addListener=this.on=function(e,t){return this.listeners(e).length+1>this._maxListeners&&0!==this._maxListeners&&"undefined"!=typeof console&&console.warn("Possible EventEmitter memory leak detected. "+this._subscribers[e].length+" listeners added. Use emitter.setMaxListeners() to increase limit."),this.emit("newListener",e,t),this.subscribe(e,this,t)},this.once=function(e,t){return this.subscribeOnce(e,this,t)},this.removeListener=function(e,t){return this.unsubscribe(e,this,t),this},this.removeAllListeners=function(e){var t;if(this._subscribers)for(t in this._subscribers)(null==e||e==t)&&delete this._subscribers[t];return this},this.emit=function(e){return this.publish.apply(this,arguments),0<this.listeners(e).length},this._maxListeners=10,this.setMaxListeners=function(e){this._maxListeners=e},this.hasListeners=function(e){return this._subscribers&&this._subscribers[e]&&this._subscribers[e].length}})'),jsio.setCachedSrc("sdk/jsio/util/setProperty.js",'function createGetter(e,t){return function(){return this[t]}}function createSetter(e,t,n,r){return void 0!==r&&(e[t]=r),"function"==typeof n?function(e){var r;if(this[t]!==e){r=this[t];this[t]=e,n.call(this,t,e,r)}}:"string"==typeof n?function(e){var r;if(this[t]!==e){r=this[t];this[t]=e,this[n](t,e,r)}}:function(e){this[t]=e}}exports=function(e,t,n){!n.get&&!n.set&&!n.cb&&"value"in n?e[t]=n.value:(n.get||(n.get=createGetter(e,"_"+t)),n.set||(n.set=createSetter(e,"_"+t,n.cb,n.value)),"value"in n&&(e["_"+t]=n.value),delete n.value,Object.defineProperty)?Object.defineProperty(e,t,n):e.__defineSetter__?(e.__defineSetter__(t,n.set),e.__defineGetter__(t,n.get)):e[t]=n.value}'),jsio.setCachedSrc("sdk/timestep/ui/resource/Font.js",'var _cache,weights,styles,units,name,fontParser,sizeParser,TO_PT,TO_PX,sdk_timestep_ui_resource_Font,Font;function parseSize(e){e=e.match(sizeParser);if(!e)throw"invalid font size";return{value:parseFloat(e[1]),unit:e[2]}}function toPx(e){return{value:e.value*TO_PX[e.unit],unit:"px"}}function toPt(e){return{value:e.value*TO_PT[e.unit],unit:"pt"}}function parseFont(e){var t;e=e.match(fontParser);if(!e)throw"invalid font string";t={};return t.weight=e[1]||"normal",t.style=e[2]||"normal",t.size={value:parseFloat(e[3]),unit:e[4]},t.names=e[5].split(",").map(function(e){return e.replace(/[\\-_]/g," ").replace(/\\s+/g," ").replace(/[\'"]/g,"").replace(/^\\s+|\\s+$/g,"")}),t.name=t.names[0],t}_cache={},weights="normal|bold|bolder|lighter|[1-9]00",styles="normal|italic|oblique",units="px|pt|pc|in|cm|mm|%",name="([\\\\w\\"\'\\\\- ]+(?:,|$))+",fontParser=RegExp("^ *(?:("+weights+") *)?(?:("+styles+") *)?([\\\\d\\\\.]+)("+units+")("+name+")","i"),sizeParser=RegExp("([\\\\d\\\\.]+)("+units+")","i"),TO_PT={pt:1,px:.75,"in":72,mm:72/25.4,cm:72/2.54},TO_PX={pt:4/3,px:1,"in":96,mm:96/25.4,cm:96/2.54},sdk_timestep_ui_resource_Font=__class__,Font=exports=sdk_timestep_ui_resource_Font(function(){return this.init&&this.init.apply(this,arguments)},function(){var e=null;this.constructor.setDefaultFontFamily=function(t){e=t};var t={name:e,size:20,unit:"px",style:"",weight:""};this.init=function(e){"string"==typeof e?(_cache[e]=this,this._string=e,e=parseFont(e)):e=merge(e,t),"string"==typeof e.size&&(e.size=parseSize(e.size)),this._name=e.name,this._style=e.style,this.size=e.size,this.sizePx=toPx(this.size).value,this.sizePt=toPt(this.size).value,this._weight=e.weight,this._isBold=/bold/i.test(this._weight)},this.getSize=function(){return this.sizePx},this.getName=function(){return this._name},this.getWeight=function(){return this._weight}});exports.parse=function(e){return e in _cache?_cache[e]:new Font(e)}'),jsio.setCachedSrc("sdk/jsio/std/uri.js",'var strictRegex,looseRegex,queryStringRegex,attrs="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),sdk_jsio_std_uri=__class__,URI=exports=sdk_jsio_std_uri(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){if(e instanceof URI)for(var n=0,r;r=attrs[n];++n)this["_"+r]=e["_"+r];else for(r in this._isStrict=t,n=exports.parse(e,t),n)this["_"+r]=n[r]};for(var e=0,t;t=attrs[e];++e)(function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this["get"+t]=function(){return this["_"+e]},this["set"+t]=function(t){return this["_"+e]=t,this}}).call(this,t);this.query=function(e){return exports.parseQuery(this._query)[e]},this.hash=function(e){return exports.parseQuery(this._anchor)[e]},this.addHash=function(e){var t=exports.parseQuery(this._anchor),n;for(n in e)t[n]=e[n];return this._anchor=exports.buildQuery(t),this},this.push=function(e){return e&&(this._path=(this._path+"/"+e).replace(/\\/\\/+/g,"/")),this},this.addQuery=function(e){var t=exports.parseQuery(this._query),n;for(n in e)t[n]=e[n];return this._query=exports.buildQuery(t),this},this.removeQuery=function(e){var t=exports.parseQuery(this._query);if(isArray(e))for(var n=0,r=e.length;n<r;++n)delete t[e[n]];else delete t[e];return this._query=exports.buildQuery(t),this},this.toJSON=function(){return this.toString(!1)},this.toString=function(e){var t=this._protocol?this._protocol+"://":"",n=this._host?this._host+(80==(this._port||80)?"":":"+this._port):"";return e?t+n:t+n+this._path+(this._query?"?"+this._query:"")+(this._anchor?"#"+this._anchor:"")}});exports.relativeTo=function(e,t){var n,e=""+e;if(t&&!/^http(s?):\\/\\//.test(e))n=(new exports(t)).setAnchor("").setQuery("").setFile("").toString("/"==e.charAt(0)),e=exports.resolveRelative(n+e);return new URI(e)},exports.resolveRelative=function(e){for(;e!=(e=e.replace(/(^|\\/)([^\\/]+)\\/\\.\\.\\//g,"/")););return e.replace(/[^.]\\.\\//g,"")},exports.buildQuery=function(e){var n,t=[];for(n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},exports.parseQuery=function(e){var e,t,n,r,i,s;for(e=e.split("&"),t=e.length,n={},r=0;r<t;++r){i=e[r].split("="),s=decodeURIComponent(i[0]);s&&(n[s]=decodeURIComponent(i[1]))}return n};strictRegex=/^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,looseRegex=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,queryStringRegex=/(?:^|&)([^&=]*)=?([^&]*)/g;exports.parse=function(e,t){var n,r,i,s,o;for(n={},r=(t?strictRegex:looseRegex).exec(e),i=0;s=attrs[i];++i)n[s]=r[i]||"";o=n.queryKey={};return n.query.replace(queryStringRegex,function(e,t,n){e&&(o[t]=n)}),n},exports.isSameDomain=function(e,t){var n=exports.parse(e),r=exports.parse(t);return n.port==r.port&&n.host==r.host&&n.protocol==r.protocol}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/doc.js",'var SCALING,defaultScalingMode,Document;jsio("import lib.PubSub"),jsio("import lib.Enum as Enum"),jsio("import std.js as JS"),jsio("from util.browser import $"),jsio("import device");SCALING=Enum("FIXED","RESIZE","MANUAL"),defaultScalingMode=device.isMobileBrowser||device.simulating?SCALING.RESIZE:SCALING.FIXED,Document=__class__,Document=Document(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(){if($){var e=GLOBAL.document;this._el=$({parent:e&&e.body,style:{position:"absolute",overflow:"hidden",width:"100%",height:"100%"}}),device.screen.subscribe("Resize",this,"onResize"),exports.postCreateHook&&exports.postCreateHook(this),this.setScalingMode(defaultScalingMode)}},this.unsubscribeResize=function(){device.screen.unsubscribe("Resize",this,"onResize")},this.setEngine=function(e){e!=this._engine&&(this._engine=e,this._canvas=this._engine.getCanvas(),this.appendChild(this._canvas),this._canvas.getContext&&(e=this._canvas.getContext(window.WebGLRenderingContext?"webgl":"2d"),e.setParentNode&&e.setParentNode(this._el)))},this.getElement=function(){return this._el},this.setScalingMode=function(e,t){this._scalingMode=e;var n=this._el.style;switch(e){case SCALING.FIXED:t=merge(t,{width:device.width,height:device.height}),n.width=t.width+"px",n.height=t.height+"px";break;case SCALING.RESIZE:t=merge(t,{resizeCanvas:!0});case SCALING.MANUAL:n.margin="0px",n.width="100%",n.height="100%"}this._scalingOpts=t,this.onResize(),setTimeout(bind(this,"onResize"),1e3)},this.onResize=function(){var e=this._el,t=this._el.style;e.className=device.screen.orientation,logger.log("resize",device.width,device.height);var n=device.width,r=device.height,i=this._scalingMode,s=this._scalingOpts;i==SCALING.FIXED&&(n=s.width,r=s.height),s.maxWidth&&n>s.maxWidth&&(n=s.maxWidth,i==SCALING.RESIZE&&(i=SCALING.FIXED)),s.maxHeight&&r>s.maxHeight&&(r=s.maxHeight,i==SCALING.RESIZE&&(i=SCALING.FIXED));switch(i){case SCALING.FIXED:e.style.top=Math.round(Math.max(0,(window.innerHeight-r)/2))+"px",e.style.left=Math.round(Math.max(0,(window.innerWidth-n)/2))+"px",t.width=n+"px",t.height=r+"px";break;case SCALING.RESIZE:s.resizeCanvas&&this._canvas&&(this._canvas.width!=n||this._canvas.height!=r)&&(this._canvas.width=n,this._canvas.height=r),t.width=n+"px",t.height=r+"px"}this._setDim(n,r),this._engine&&this._engine.render()},this._setDim=function(e,t){if(this.width!=e||this.height!=t)this.width=e,this.height=t,this.publish("Resize",e,t)},this.setColors=function(e,t){this._el&&(this._el.style.background=t,document.documentElement.style.background=document.body.style.background=e)},this.appendChild=function(e){this._el.appendChild(e)},this.getOffset=function(){return{x:this._el.offsetLeft,y:this._el.offsetTop}}});exports=new Document,exports.SCALING=SCALING,exports.setDocStyle=function(){var e=GLOBAL.document;e&&e.body&&(e={height:"100%",margin:"0px",padding:"0px"},$.style(document.documentElement,e),$.style(document.body,e))},exports.defaultParent=null,exports.postCreateHook=null'),jsio.setCachedSrc("sdk/jsio/lib/Enum.js",'exports=function(){var e,t,n,r;if(1==arguments.length){if("object"==typeof arguments[0]){e=arguments[0];for(t in e)e[t]in e||(e[e[t]]=t);return e}"string"!=typeof arguments[0]&&(n=arguments[0])}if(!n)n=arguments;e={},t=0;for(r=n.length;t<r;++t)n[t]&&(e[n[t]]=t+1),e[t+1]=n[t];return e}'),jsio.setCachedSrc("sdk/jsio/std/js.js",'var SLICE=Array.prototype.slice;exports.vargs=function(e,t){return SLICE.call(e,t||0)},exports.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},exports.shallowCopy=function(e){var t,n;if(exports.isArray(e))return e.slice(0);t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},exports.merge=function(e){var e,n,r,i,s;for(e=e||{},n=1,r=arguments.length;n<r;++n){i=arguments[n];for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(e[s]=i[s])}return e},exports.curry=function(e){var t=SLICE.call(arguments,1),n="string"==typeof e?function(){this[e].apply(ctx,t.concat(SLICE.call(arguments)))}:function(){e.apply(this,t.concat(SLICE.call(arguments)))};return n.curried=!0,n},exports.unbind=function(e){var t=SLICE.call(arguments,1),n="string"==typeof e?function(n){n[e].apply(n,t.concat(SLICE.call(arguments,1)))}:function(n){e.apply(n,t.concat(SLICE.call(arguments,1)))};return n.unbound=!0,n}'),jsio.setCachedSrc("sdk/jsio/util/browser.js",'var isWindow,singleId,$,DOM2,ieGetAlpha;if("browser"==jsio.__env.name){jsio("external .sizzle import Sizzle"),jsio("import math.geom.Rect");isWindow=function(e){return e&&!$.isElement(e)&&$.isElement(e.document)},singleId=/^#([\\w-]+)$/,$=exports.$=function(e,t){switch(typeof e){case"object":return $.isElement(e)?$.remove(e):$.isElement(e.document&&e.document.body)?$.size(e):$.create(e);case"string":return singleId.test(e)?$.id(e.substring(1),t):Sizzle.apply(GLOBAL,arguments)}},DOM2="object"==typeof HTMLElement;$.isElement=DOM2?function(e){return e&&e instanceof HTMLElement}:function(e){return e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},$.id=function(e,t){return"string"==typeof e?(t||window).document.getElementById(e):e},$.apply=function(e,t){var n,r,i;if(t.attrs)for(attr in t.attrs)e.setAttribute(attr,t.attrs[attr]);t.id&&(e.id=t.id),t.style&&$.style(e,t.style),t.src&&(e.src=t.src);if(t["class"]||t.className)e.className=t["class"]||t.className;n=t.parent||t.parentNode;n&&t.first?$.insertBefore(n,e,n.firstChild):t.before?$.insertBefore(t.before.parentNode||n,e,t.before):t.after?$.insertAfter(t.after.parentNode||n,e,t.after):n&&n.appendChild(e),"html"in t&&(e.innerHTML=t.html),"text"in t&&$.setText(e,t.text);if(t.children)for(n=t.children,r=0,i=n.length;r<i;++r)e.appendChild($.isElement(n[r])?n[r]:$(n[r]));return e},$.insertBefore=function(e,t,n){e&&t&&(n&&n.parentNode==e?e.insertBefore(t,n):e.appendChild(t))},$.insertAfter=function(e,t,n){e&&t&&(!n||n.parentNode!=e?$.insertBefore(e,t,e.firstChild):n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t))},$.create=function(e){var t=(e&&e.win||window).document;return!e||"string"==typeof e?t.createElement(e||"div"):$.apply(e.el||t.createElement(e.tag||e.tagName||"div"),e)},$.show=function(e,t){$.id(e).style.display=t||"block"},$.hide=function(e){$.id(e).style.display="none"},$.addClass=function(e,t){var n,r,i,s;if(e){e=$.id(e),"string"==typeof t&&(t=t.split(" "));for(n=" "+e.className+" ",r=0,i=t.length;r<i;++r){s=t[r];-1==n.indexOf(" "+s+" ")&&(n+=s+" ")}return e.className=n.replace(/^\\s+|\\s+$/g,""),$}},$.getTag=function(e,t){return e.getElementsByTagName(t)},$.removeClass=function(e,t){e&&(e=$.id(e),e.className=(" "+e.className+" ").replace(" ","  ").replace(RegExp("( "+t.replace("s+"," | ").replace("-","-")+" )","g")," ").replace(/\\s+/," ").replace(/^\\s+|\\s+$/g,""))};ieGetAlpha=function(e){try{return e.filters.item("alpha")}catch(t){}try{return e.filters.item("progid:DXImageTransform.Microsoft.Alpha")}catch(n){}return null};$.style=function(e,t){var n,r,i;if(e instanceof Array)for(n=0;r=e[n];++n)$.style(r,t);else for(prop in e=$.id(e),n=e.style,t)switch(prop){case"styleFloat":case"cssFloat":case"float":n.styleFloat=n.cssFloat=t[prop];break;case"opacity":n.opacity=t[prop];if(e.filters)try{r=ieGetAlpha();i=1==t[prop]?99.99:100*t[prop];r?r.Opacity=i:n.filter="alpha(opacity="+i+")"}catch(s){}break;case"borderRadius":n.borderRadius=n.MozBorderRadius=t[prop];break;case"boxSizing":n.MsBoxSizing=n.MozBoxSizing=n.WebkitBoxSizing=t[prop];default:n[prop]=t[prop]}},$.onEvent=function(e,t,n){var e,r;"function"!=typeof n&&(n=bind.apply(GLOBAL,Array.prototype.slice.call(arguments,2)));r=n,e=$.id(e);return e.addEventListener?e.addEventListener(t,r,!1):(r=function(e){n(e||window.event)},e.attachEvent("on"+t,r)),bind($,"removeEvent",e,t,r)},$.removeEvent=function(e,t,n){e=$.id(e),e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},$.stopEvent=function(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault())},$.setText=function(e,t){e=$.id(e),t=""+t,"textContent"in e?e.textContent=t:"innerText"in e?e.innerText=t.replace(/\\n/g," "):(e.innerHTML="",e.appendChild(document.createTextNode(t)))},$.setValue=function(e,t){e=$.id(e),"value"in e?e.value=t:"value"in e.firstChild&&(e.firstChild.value=t)},$.remove=function(e){(e=$.id(e))&&e.parentNode&&e.parentNode.removeChild(e)},$.cursorPos=function(e,t){var n=$.pos(t);return n.top=e.clientY-n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop),n.left=e.clientX-n.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft),n},$.pos=function(e){var t;for(t={top:0,left:0};e&&e!=document.body;){t.left+=e.offsetLeft;for(t.top+=e.offsetTop;e.offsetParent!=e.parentNode;)t.top-=e.scrollTop,t.left-=e.scrollLeft,e=e.parentNode;e=e.offsetParent}return t},$.size=function(e){var t;if($.isElement(e))return{width:e.offsetWidth,height:e.offsetHeight};if(e.document){t=e.document.documentElement||e.document.body;return new math.geom.Rect(t.offsetTop,t.offsetLeft,e.innerWidth||t.clientWidth||t.clientWidth,e.innerHeight||t.clientHeight||t.clientHeight)}},$.insertCSSFile=function(e){document.getElementsByTagName("head")[0].appendChild($({tag:"link",attrs:{rel:"stylesheet",type:"text/css",href:e}}))}}'),jsio.setCachedSrc("sdk/jsio/util/sizzle.js",'Sizzle=function(){var n,r,i,s,o,u,a,f,l,h,p,d,v;function e(e,t,n,r,i,s){var i,o,u,a,f;for(i="previousSibling"==e&&!s,o=0,u=r.length;o<u;o++){a=r[o];if(a){i&&1===a.nodeType&&(a.sizcache=n,a.sizset=o);for(a=a[e],f=!1;a;){if(a.sizcache===n){f=r[a.sizset];break}1===a.nodeType&&!s&&(a.sizcache=n,a.sizset=o);if(a.nodeName===t){f=a;break}a=a[e]}r[o]=f}}}function t(e,t,n,r,i,s){var i,u,a,f,l;for(i="previousSibling"==e&&!s,u=0,a=r.length;u<a;u++){f=r[u];if(f){i&&1===f.nodeType&&(f.sizcache=n,f.sizset=u);for(f=f[e],l=!1;f;){if(f.sizcache===n){l=r[f.sizset];break}if(1===f.nodeType)if(s||(f.sizcache=n,f.sizset=u),"string"!=typeof t){if(f===t){l=!0;break}}else if(0<o.filter(t,[f]).length){l=f;break}f=f[e]}r[u]=l}}}n=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|[\'"][^\'"]*[\'"]|[^[\\]\'"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?/g,r=0,i=Object.prototype.toString,s=!1,o=function(e,t,r,s){var r=r||[],f=t=t||document;if(1!==t.nodeType&&9!==t.nodeType)return[];if(!e||"string"!=typeof e)return r;var c=[],h,m,g,b,w=!0,E=d(t);for(n.lastIndex=0;null!==(h=n.exec(e));)if(c.push(h[1]),h[2]){b=RegExp.rightContext;break}if(1<c.length&&a.exec(e))if(2===c.length&&u.relative[c[0]])m=v(c[0]+c[1],t);else for(m=u.relative[c[0]]?[t]:o(c.shift(),t);c.length;)e=c.shift(),u.relative[e]&&(e+=c.shift()),m=v(e,m);else if(!s&&1<c.length&&9===t.nodeType&&!E&&u.match.ID.test(c[0])&&!u.match.ID.test(c[c.length-1])&&(h=o.find(c.shift(),t,E),t=h.expr?o.filter(h.expr,h.set)[0]:h.set[0]),t){h=s?{expr:c.pop(),set:l(s)}:o.find(c.pop(),1!==c.length||"~"!==c[0]&&"+"!==c[0]||!t.parentNode?t:t.parentNode,E),m=h.expr?o.filter(h.expr,h.set):h.set;for(0<c.length?g=l(m):w=!1;c.length;){var S=c.pop();h=S,u.relative[S]?h=c.pop():S="",null==h&&(h=t),u.relative[S](g,h,E)}}else g=[];g||(g=m);if(!g)throw"Syntax error, unrecognized expression: "+(S||e);if("[object Array]"===i.call(g))if(w)if(t&&1===t.nodeType)for(e=0;null!=g[e];e++)g[e]&&(!0===g[e]||1===g[e].nodeType&&p(t,g[e]))&&r.push(m[e]);else for(e=0;null!=g[e];e++)g[e]&&1===g[e].nodeType&&r.push(m[e]);else r.push.apply(r,g);else l(g,r);return b&&(o(b,f,r,s),o.uniqueSort(r)),r};o.uniqueSort=function(e){var t;if(h&&(s=!1,e.sort(h),s))for(t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)},o.matches=function(e,t){return o(e,null,null,t)},o.find=function(e,t,n){var r,i,s,o,a,f;if(!e)return[];for(s=0,o=u.order.length;s<o;s++){a=u.order[s];if(i=u.match[a].exec(e)){f=RegExp.leftContext;if("\\\\"!==f.substr(f.length-1)&&(i[1]=(i[1]||"").replace(/\\\\/g,""),r=u.find[a](i,t,n),null!=r)){e=e.replace(u.match[a],"");break}}}return r||(r=t.getElementsByTagName("*")),{set:r,expr:e}},o.filter=function(e,t,n,r){var i,s,o,a,f,l,c,h,p,v,m,g;for(i=e,s=[],o=t,l=t&&t[0]&&d(t[0]);e&&t.length;){for(c in u.filter)if(null!=(a=u.match[c].exec(e))){h=u.filter[c];f=!1,o==s&&(s=[]);if(u.preFilter[c])if(a=u.preFilter[c](a,o,n,s,r,l)){if(!0===a)continue}else f=p=!0;if(a)for(m=0;null!=(v=o[m]);m++)if(v){p=h(v,a,m,o);g=r^!!p;n&&null!=p?g?f=!0:o[m]=!1:g&&(s.push(v),f=!0)}if(void 0!==p){n||(o=s),e=e.replace(u.match[c],"");if(!f)return[];break}}if(e==i){if(null==f)throw"Syntax error, unrecognized expression: "+e;break}i=e}return o};u=o.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,NAME:/\\[name=[\'"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)[\'"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*([\'"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\(([\'"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(e,t,n){var r="string"==typeof t,i=r&&!/\\W/.test(t),r=r&&!i;i&&!n&&(t=t.toUpperCase());for(var n=0,i=e.length,s;n<i;n++)if(s=e[n]){for(;(s=s.previousSibling)&&1!==s.nodeType;);e[n]=r||s&&s.nodeName===t?s||!1:s===t}r&&o.filter(t,e,!0)},">":function(e,t,n){var r="string"==typeof t;if(r&&!/\\W/.test(t))for(var t=n?t:t.toUpperCase(),n=0,i=e.length;n<i;n++){var s=e[n];s&&(r=s.parentNode,e[n]=r.nodeName===t?r:!1)}else{n=0;for(i=e.length;n<i;n++)(s=e[n])&&(e[n]=r?s.parentNode:s.parentNode===t);r&&o.filter(t,e,!0)}},"":function(n,i,s){var o=r++,u=t;if(!/\\W/.test(i))var a=i=s?i:i.toUpperCase(),u=e;u("parentNode",i,o,n,a,s)},"~":function(n,i,s){var o=r++,u=t;if("string"==typeof i&&!/\\W/.test(i))var a=i=s?i:i.toUpperCase(),u=e;u("previousSibling",i,o,n,a,s)}},find:{ID:function(e,t,n){if("undefined"!=typeof t.getElementById&&!n)return(e=t.getElementById(e[1]))?[e]:[]},NAME:function(e,t){if("undefined"!=typeof t.getElementsByName){for(var n=[],r=t.getElementsByName(e[1]),i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return 0===n.length?null:n}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(/\\\\/g,"")+" ";if(s)return e;for(var s=0,o;null!=(o=t[s]);s++)o&&(i^(o.className&&0<=(" "+o.className+" ").indexOf(e))?n||r.push(o):n&&(t[s]=!1));return!1},ID:function(e){return e[1].replace(/\\\\/g,"")},TAG:function(e,t){for(var n=0;!1===t[n];n++);return t[n]&&d(t[n])?e[1]:e[1].toUpperCase()},CHILD:function(e){if("nth"==e[1]){var t=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec("even"==e[2]&&"2n"||"odd"==e[2]&&"2n+1"||!/\\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}return e[0]=r++,e},ATTR:function(e,t,n,r,i,s){return t=e[1].replace(/\\\\/g,""),!s&&u.attrMap[t]&&(e[1]=u.attrMap[t]),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,r,i,s){if("not"===e[1]){if(!(1<n.exec(e[3]).length||/^\\w/.test(e[3])))return e=o.filter(e[3],t,r,1^s),r||i.push.apply(i,e),!1;e[3]=o(e[3],null,null,t)}else if(u.match.POS.test(e[0])||u.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return!1===e.disabled&&"hidden"!==e.type},disabled:function(e){return!0===e.disabled},checked:function(e){return!0===e.checked},selected:function(e){return e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!o(n[3],e).length},header:function(e){return/h\\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||"BUTTON"===e.nodeName.toUpperCase()},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return 0===t%2},odd:function(e,t){return 1===t%2},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0==t},eq:function(e,t,n){return n[3]-0==t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=u.filters[i];if(s)return s(e,n,t,r);if("contains"===i)return 0<=(e.textContent||e.innerText||"").indexOf(t[3]);if("not"===i){t=t[3],n=0;for(r=t.length;n<r;n++)if(t[n]===e)return!1;return!0}},CHILD:function(e,t){var n=t[1],r=e;switch(n){case"only":case"first":for(;r=r.previousSibling;)if(1===r.nodeType)return!1;if("first"==n)return!0;r=e;case"last":for(;r=r.nextSibling;)if(1===r.nodeType)return!1;return!0;case"nth":var n=t[2],i=t[3];if(1==n&&0==i)return!0;var s=t[0],o=e.parentNode;if(o&&(o.sizcache!==s||!e.nodeIndex)){for(var u=0,r=o.firstChild;r;r=r.nextSibling)1===r.nodeType&&(r.nodeIndex=++u);o.sizcache=s}return r=e.nodeIndex-i,0==n?0==r:0==r%n&&0<=r/n}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||e.nodeName===t},CLASS:function(e,t){return-1<(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)},ATTR:function(e,t){var n=t[1],n=u.attrHandle[n]?u.attrHandle[n](e):null!=e[n]?e[n]:e.getAttribute(n),r=n+"",i=t[2],s=t[4];return null==n?"!="===i:"="===i?r===s:"*="===i?0<=r.indexOf(s):"~="===i?0<=(" "+r+" ").indexOf(s):s?"!="===i?r!=s:"^="===i?0===r.indexOf(s):"$="===i?r.substr(r.length-s.length)===s:"|="===i?r===s||r.substr(0,s.length+1)===s+"-":!1:r&&!1!==n},POS:function(e,t,n,r){var i=u.setFilters[t[2]];if(i)return i(e,n,t,r)}}},a=u.match.POS;for(f in u.match)u.match[f]=RegExp(u.match[f].source+/(?![^\\[]*\\])(?![^\\(]*\\))/.source);l=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(c){l=function(e,t){var r,s,n=t||[];if("[object Array]"===i.call(e))Array.prototype.push.apply(n,e);else if("number"==typeof e.length)for(r=0,s=e.length;r<s;r++)n.push(e[r]);else for(r=0;e[r];r++)n.push(e[r]);return n}}document.documentElement.compareDocumentPosition?h=function(e,t){var n=e.compareDocumentPosition(t)&4?-1:e===t?0:1;return 0===n&&(s=!0),n}:"sourceIndex"in document.documentElement?h=function(e,t){var n=e.sourceIndex-t.sourceIndex;return 0===n&&(s=!0),n}:document.createRange&&(h=function(e,t){var n=e.ownerDocument.createRange(),r=t.ownerDocument.createRange();return n.selectNode(e),n.collapse(!0),r.selectNode(t),r.collapse(!0),n=n.compareBoundaryPoints(Range.START_TO_END,r),0===n&&(s=!0),n}),function(){var n,e=document.createElement("div"),t="script"+(new Date).getTime();e.innerHTML="<a name=\'"+t+"\'/>";n=document.documentElement;n.insertBefore(e,n.firstChild),document.getElementById(t)&&(u.find.ID=function(e,t,n){if("undefined"!=typeof t.getElementById&&!n)return(t=t.getElementById(e[1]))?t.id===e[1]||"undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id").nodeValue===e[1]?[t]:void 0:[]},u.filter.ID=function(e,t){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&n&&n.nodeValue===t}),n.removeChild(e),n=e=null}(),function(){var e=document.createElement("div");e.appendChild(document.createComment("")),0<e.getElementsByTagName("*").length&&(u.find.TAG=function(e,t){var r,i,n=t.getElementsByTagName(e[1]);if("*"===e[1]){for(r=[],i=0;n[i];i++)1===n[i].nodeType&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href=\'#\'></a>",e.firstChild&&"undefined"!=typeof e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(u.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),document.querySelectorAll&&function(){var n,e=o,t=document.createElement("div");t.innerHTML="<p class=\'TEST\'></p>";if(!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){o=function(t,n,r,i){n=n||document;if(!i&&9===n.nodeType&&!d(n))try{return l(n.querySelectorAll(t),r)}catch(s){}return e(t,n,r,i)};for(n in e)o[n]=e[n];t=null}}(),document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var e=document.createElement("div");e.innerHTML="<div class=\'test e\'></div><div class=\'test\'></div>",0!==e.getElementsByClassName("e").length&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length&&(u.order.splice(1,0,"CLASS"),u.find.CLASS=function(e,t,n){if("undefined"!=typeof t.getElementsByClassName&&!n)return t.getElementsByClassName(e[1])},e=null))}();p=document.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)&16}:function(e,t){return e!==t&&(e.contains?e.contains(t):!0)},d=function(e){return 9===e.nodeType&&"HTML"!==e.documentElement.nodeName||!!e.ownerDocument&&"HTML"!==e.ownerDocument.documentElement.nodeName},v=function(e,t){for(var n=[],r="",i,s=t.nodeType?[t]:t;i=u.match.PSEUDO.exec(e);)r+=i[0],e=e.replace(u.match.PSEUDO,"");e=u.relative[e]?e+"*":e,i=0;for(var a=s.length;i<a;i++)o(e,s[i],n);return o.filter(r,n)};return o}()'),jsio.setCachedSrc("sdk/jsio/math/geom/Rect.js",'var sdk_jsio_math_geom_Rect,Rect,SIDES,CORNERS;jsio("import lib.Enum"),jsio("import .Point"),jsio("import .Line"),jsio("import .intersect");sdk_jsio_math_geom_Rect=__class__,Rect=exports=sdk_jsio_math_geom_Rect(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n,r){switch(arguments.length){case 0:this.width=this.height=this.x=this.y=0;break;case 1:this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y;break;case 2:this.x=e.x,this.y=e.y,this.width=t.x,this.height=t.y;break;case 3:this.x=e.x,this.y=e.y,this.width=t,this.height=n;break;case 4:this.x=e,this.y=t,this.width=n,this.height=r}},this.normalize=function(){return 0>this.width&&(this.x-=this.width,this.width=-this.width),0>this.height&&(this.y-=this.height,this.height=-this.height),this},this.intersectRect=function(e){if(intersect.isRectAndRect(this,e)){var t=this.y,n=this.x+this.width,r=this.y+this.height;this.x=Math.max(this.x,e.x),this.y=Math.max(t,e.y),this.width=Math.min(n,e.x+e.width)-this.x,this.height=Math.min(r,e.y+e.height)-this.y}else this.height=this.width=0},this.unionRect=function(e){this.normalize(),e.normalize&&e.normalize();var t=this.x+this.width,n=this.y+this.height,r=e.x+e.width,i=e.y+e.height;this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y,this.width=(t>r?t:r)-this.x,this.height=(n>i?n:i)-this.y},this.getCorner=function(e){switch(e){case CORNERS.TOP_LEFT:return new Point(this.x,this.y);case CORNERS.TOP_RIGHT:return new Point(this.x+this.width,this.y);case CORNERS.BOTTOM_LEFT:return new Point(this.x,this.y+this.height);case CORNERS.BOTTOM_RIGHT:return new Point(this.x+this.width,this.y+this.height)}},this.getSide=function(e){switch(e){case SIDES.TOP:return new Line(this.getCorner(CORNERS.TOP_LEFT),this.getCorner(CORNERS.TOP_RIGHT));case SIDES.RIGHT:return new Line(this.getCorner(CORNERS.TOP_RIGHT),this.getCorner(CORNERS.BOTTOM_RIGHT));case SIDES.BOTTOM:return new Line(this.getCorner(CORNERS.BOTTOM_RIGHT),this.getCorner(CORNERS.BOTTOM_LEFT));case SIDES.LEFT:return new Line(this.getCorner(CORNERS.BOTTOM_LEFT),this.getCorner(CORNERS.TOP_LEFT))}},this.getCenter=function(){return new Point(this.x+this.width/2,this.y+this.height/2)}}),SIDES=Rect.SIDES=lib.Enum("TOP","BOTTOM","LEFT","RIGHT"),CORNERS=Rect.CORNERS=lib.Enum("TOP_LEFT","TOP_RIGHT","BOTTOM_RIGHT","BOTTOM_LEFT")'),jsio.setCachedSrc("sdk/jsio/math/geom/Point.js",'var sdk_jsio_math_geom_Point=__class__,Point=exports=sdk_jsio_math_geom_Point(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){switch(arguments.length){case 0:this.y=this.x=0;break;case 1:this.x=e.x||0,this.y=e.y||0;break;case 2:this.x=e||0,this.y=t||0}},this.rotate=function(e){var t=this.x,n=this.y,r=Math.cos(e),e=Math.sin(e);return this.x=t*r-n*e,this.y=t*e+n*r,this},this.translate=this.add=function(e,t){return"number"==typeof e?(this.x+=e,this.y+=t):(this.x+=e.x,this.y+=e.y),this},this.subtract=function(e,t){return"number"==typeof e?(this.x-=e,this.y-=t):(this.x-=e.x,this.y-=e.y),this},this.scale=function(e,t){return void 0===t&&(t=e),this.x*=e,this.y*=t,this},this.setMagnitude=function(e){var t=this.getAngle();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this},this.normalize=function(){var e=this.getMagnitude();return this.x/=e,this.y/=e,this},this.addMagnitude=function(e){return this.setMagnitude(this.getMagnitude()+e)},this.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.getSquaredMagnitude=function(){return this.x*this.x+this.y*this.y},this.getDirection=this.getAngle=function(){return Math.atan2(this.y,this.x)}});Point.getPolarR=function(){throw"notImplemented"},Point.getPolarTheta=function(e,t){var n=Math.atan2(t,e)+2*Math.PI;return n>2*Math.PI?n%(2*Math.PI):n},Point.add=Point.translate=function(e,t,n,r){switch(arguments.length){case 2:return(new Point(e)).add(t);case 3:return(new Point(e)).add(t,n);case 4:return(new Point(e,t)).add(n,r)}},Point.subtract=function(e,t,n,r){switch(arguments.length){case 2:return(new Point(e)).subtract(t);case 3:return(new Point(e)).subtract(t,n);case 4:return(new Point(e,t)).subtract(n,r)}},Point.scale=function(e,t,n){switch(arguments.length){case 2:return(new Point(e)).scale(t);case 3:return(new Point(e,t)).scale(n)}},Point.setMagnitude=function(e,t,n){switch(arguments.length){case 2:return(new Point(e)).setMagnitude(n);case 3:return(new Point(e,t)).setMagnitude(n)}},Point.addMagnitude=function(e,t,n){switch(arguments.length){case 2:pt=new Point(e);break;case 3:pt=new Point(e,t),t=n}return pt.addMagnitude(t)},Point.getMagnitude=function(e,t){return(new Point(e,t)).getMagnitude()},Point.rotate=function(e,t,n){switch(arguments.length){case 2:return(new Point(e)).rotate(t);case 3:return(new Point(e,t)).rotate(n)}},Point.project=function(e,t){var n=(new Point(t)).normalize();return n.scale(n.x*e.x+n.y*e.y)}'),jsio.setCachedSrc("sdk/jsio/math/geom/Line.js",'var sdk_jsio_math_geom_Line;jsio("import .Point");sdk_jsio_math_geom_Line=__class__;exports=sdk_jsio_math_geom_Line(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n,r){switch(arguments.length){case 0:this.start=new Point,this.end=new Point;break;case 1:this.start=new Point(e.start),this.end=new Point(e.end);break;case 2:this.start=new Point(e),this.end=new Point(t);break;case 3:this.start=new Point(e),this.end=new Point(t,n);break;default:this.start=new Point(e,t),this.end=new Point(n,r)}},this.getMagnitude=this.getLength=function(){var e=this.end.x-this.start.x,t=this.end.y-this.start.y;return Math.sqrt(e*e+t*t)}})'),jsio.setCachedSrc("sdk/jsio/math/geom/intersect.js",'var intersect;jsio("import .Point"),jsio("import .Line"),jsio("import .Rect");intersect=exports;intersect.pointAndRect=intersect.ptAndRect=function(e,t){var n=e.x,r=e.y;return n>=t.x&&n<=t.x+t.width&&r>=t.y&&r<=t.y+t.height},intersect.rectAndPoint=intersect.rectAndPt=function(e,t){return intersect.pointAndRect(t,e)},intersect.pointAndCircle=intersect.ptAndCirc=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r<t.radius*t.radius},intersect.circleAndPoint=intersect.circAndPt=function(e,t){return intersect.pointAndCircle(t,e)},intersect.isRectAndRect=function(e,t){return!(e.y+e.height<t.y||t.y+t.height<e.y||e.x+e.width<t.x||t.x+t.width<e.x)},intersect.circleAndRect=function(e,t){return intersect.pointAndRect(e,t)?!0:intersect.lineAndCircle(t.getSide(1),e)||intersect.lineAndCircle(t.getSide(2),e)||intersect.lineAndCircle(t.getSide(3),e)||intersect.lineAndCircle(t.getSide(4),e)},intersect.rectAndCircle=function(e,t){return intersect.circleAndRect(t,e)},intersect.lineAndCircle=function(e,t){return intersect.pointToLine(t,e).getMagnitude()<t.radius},intersect.circleAndLine=function(e,t){return intersect.lineAndCircle(t,e)},intersect.pointToLine=intersect.ptToLine=function(e,t){var n=t.end.x-t.start.x,r=t.end.y-t.start.y,i=((e.x-t.start.x)*n+(e.y-t.start.y)*r)/(n*n+r*r);n=0>i?new Point(t.start):1<i?new Point(t.end):new Point(t.start.x+i*n,t.start.y+i*r);return new Line(n,e)},intersect.rectAndRect=function(e,t){return jsio("import .Rect"),(intersect.rectAndRect=function(e,t){var n,r,i,s;if(!0===e||!0===t)return new Rect(t);if(intersect.isRectAndRect(e,t)){n=Math.max(e.x,t.x),r=Math.max(e.y,t.y),i=Math.min(e.x+e.width,t.x+t.width),s=Math.min(e.y+e.height,t.y+t.height);return new Rect(n,r,i-n,s-r)}return null})(e,t)}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/Audio.js",'exports=function(e){var e=merge(e,{autoplay:!1,preload:"auto",volume:1,loop:0,src:""}),t=document.createElement("Audio");return t.autoplay=e.autoplay,t.preload=e.preload,t.volume=e.volume,t.loop=e.loop,t.src=e.src,t}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/Canvas.js",'var sdk_timestep_platforms_browser_Canvas;jsio("import .Context2D");sdk_timestep_platforms_browser_Canvas=__class__;exports=sdk_timestep_platforms_browser_Canvas(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){var e=merge(e,{width:300,height:200}),t=new Context2D(e);e=this._el=t.getElement();return e.getContext=function(){return t},e.complete=!0,e}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/Context2D.js",'function setter(e){return function(t){return this[e]=t}}function getter(e){return function(){return this[e]}}jsio("import device"),jsio("import .FontRenderer"),exports=function(e){var n,r,i,s,t=e&&e.el||document.createElement("canvas");t.width=e.width,t.height=e.height;n=t.getContext("2d");n.font="11px "+device.defaultFontFamily,n.getElement=function(){return t},n.reset=function(){},n.clear=function(){this.clearRect(0,0,t.width,t.height)},n.clipRect=function(e,t,r,i){n.beginPath(),n.rect(e,t,r,i),n.clip()},n.swap=function(){},n.execSwap=function(){},n.circle=function(e,t,n){this.beginPath(),this.arc(e,t,n,0,2*Math.PI,!0)};r=null,i=null,s=null;return n.drawPointSprites=function(e,t,n,o){var a,f,c,h,p,u=this.pointSprite;if(u&&u.complete){a=u.width,f=u.height,c=s||(s=document.createElement("canvas"));if(u!=r||this.strokeStyle!=i){r=u,i=this.strokeStyle,c.width=a,c.height=f;h=c.getContext("2d");h.fillStyle=this.strokeStyle,h.fillRect(0,0,a,f),h.globalCompositeOperation="destination-in",h.drawImage(u,0,0)}n-=e,o-=t,u=Math.ceil(Math.sqrt(n*n+o*o)/this.pointSpriteStep),1>u&&(u=1);for(h=this.lineWidth,p=0;p<u;++p)this.drawImage(c,0,0,a,f,e+n*p/u-h/2,t+o*p/u-h/2,h,h)}},n.roundRect=function(e,t,n,r,i){this.beginPath(),this.moveTo(e,t+i),this.lineTo(e,t+r-i),this.quadraticCurveTo(e,t+r,e+i,t+r),this.lineTo(e+n-i,t+r),this.quadraticCurveTo(e+n,t+r,e+n,t+r-i),this.lineTo(e+n,t+i),this.quadraticCurveTo(e+n,t,e+n-i,t),this.lineTo(e+i,t),this.quadraticCurveTo(e,t,e,t+i)},n.loadIdentity=function(){this.setTransform(1,0,0,1,0,0)},n.measureText=FontRenderer.wrapMeasureText(n.measureText),n.fillText=FontRenderer.wrapFillText(n.fillText),n.strokeText=FontRenderer.wrapStrokeText(n.strokeText),n.filters={},n.setFilters=function(e){var t;this.clearFilters();for(t in e)this.filters[t]=e[t]},n.clearFilters=function(){var e;for(e in this.filters)delete this.filters[e]},n}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/FontRenderer.js",'var _customFonts,_customFontInfo,_fontMap,_buffers,_fontBuffer,_origMeasureText;function loadCustomFontImage(e,t){var n=new Image;return n.onload=function(){n.onload=null,e.imagesLoaded++,e.loaded=e.imagesLoaded===e.imagesTotal},n.src="resources/fonts/"+e.filename+t+".png",n}function findVerticalInfo(e){var n,r,u,t=[{start:65,end:90},{start:97,end:122},{start:32,end:255}],i=!1,s=0,o=0;for(u=0;u<t.length;u++){n=t[u];for(j=n.start;j<=n.end;j++)if(r=e[j])s=Math.max(s,r.h),o=Math.max(o,r.h),i=!0;if(i)break}return{baseline:s,bottom:o}}function findHorizontalInfo(e){var n,r,o,u,t=[{start:97,end:122},{start:65,end:90},{start:32,end:255}],i=0,s=0;for(o=0;o<t.length;o++){n=t[o];for(u=n.start;u<=n.end;u++)if(r=e[u])i+=r.w,s++;if(0!==s)break}return{width:i/s}}function loadingCustomFont(e){var t,n,r,i;if(-1!==e.imagesLoaded)return!e.loaded;t=e.settings,n=t.filename;_customFontInfo[n]?(n=_customFontInfo[n],e.dimensions=n.dimensions,e.horizontal=n.horizontal,e.vertical=n.vertical):(r="resources/fonts/"+n,i=CACHE[r+".json"],null==i&&((i=CACHE[r+".js"])?i=i.replace(/^\\s*exports\\s*=\\s*|;\\s*$/g,""):logger.warn("Could not load font",e.name,"from cached path",r)),e.dimensions=JSON.parse(i),e.horizontal=findHorizontalInfo(e.dimensions),e.vertical=findVerticalInfo(e.dimensions),_customFontInfo[n]={dimensions:e.dimensions,horizontal:e.horizontal,vertical:e.vertical}),e.images=[],e.imagesLoaded=0,n=e.images;switch(e.type){case"color":for(r=0;r<t.count;r++)n[r]=[],n[r].push(loadCustomFontImage(e,"_0_"+r)),e.imagesTotal++;break;case"composite":for(r=1;3>r;r++){n[r-1]=[];for(i=0;i<t.count;i++)n[r-1].push(loadCustomFontImage(e,"_"+r+"_"+i)),e.imagesTotal++}}return!0}function getCanvas(){return document.createElement("canvas")}function getBuffers(e,t,n,r){var i,s,o,u,a,t=t.filename+"_"+n+"_"+r,r=[];if(!_buffers[t]){_buffers[t]={buffers:r};for(i=0;i<e.length;i++){s=getCanvas(),o=s.getContext("2d"),u=e[i].width,a=e[i].height;r[i]=s,s.width=u,s.height=a,o.save(),o.fillStyle=n,o.fillRect(0,0,u,a),o.globalCompositeOperation="destination-in",o.drawImage(e[i],0,0),o.restore()}}return _buffers[t].lastUsed=+(new Date),_buffers[t].buffers}function measure(e,t,n){var l,c,r=t.customFont,i=r.dimensions,s=t.scale,o=(r.settings.outline||0)*s,u=(r.settings.tracking||0)*s,a=0,f=!0;if(i)for(l=0,c=n.length,f=!1;l<c&&!f;){character=n.charCodeAt(l);switch(character){case 9:a+=4*r.horizontal.width*s;break;case 32:a+=r.horizontal.width*s;break;default:i[character]?(character=i[character],a+=(character.ow-2)*s):f=!0}a+=u-o,l++}return f?(r=e.font,e.font=t.size.value+t.size.unit+" "+(e.defaultFontFamily||device.defaultFontFamily),t={failed:!0,width:_origMeasureText.apply(e,[n])},e.font=r,t):{failed:!1,width:a+2*s}}function renderCustomFont(e,t,n,r,i,s,o){var s,a,f,l,c,h,u=measure(e,s,r);if(u.failed)return!1;a=s.customFont,f=a.images[o],l=a.dimensions,s=s.scale,c=u.width,u=(a.settings.outline||0)*s,h=(a.settings.tracking||0)*s;switch(e.textBaseline){case"alphabetic":n-=a.vertical.baseline*s;break;case"middle":n-=a.vertical.bottom/2*s;break;case"bottom":n-=a.vertical.bottom*s}switch(e.textAlign){case"center":t-=c/2;break;case"right":t-=c}"composite"===a.type&&(f=getBuffers(f,a,i,o)),o=0;for(c=r.length;o<c;){i=r.charCodeAt(o);switch(i){case 9:t+=4*a.horizontal.width*s+h-u;break;case 32:t+=a.horizontal.width*s+h-u;break;default:i=l[i],e.drawImage(f[i.i],i.x,i.y,i.w,i.h,t,n+(i.oh-1)*s,(i.w-2)*s,(i.h-2)*s),t+=(i.ow-2)*s+h-u}o++}return!0}jsio("import ui.resource.Font as Font"),jsio("import ui.Engine as Engine"),jsio("import .FontBuffer as FontBuffer"),jsio("import device");_customFonts={},_customFontInfo={},_fontMap={},_buffers=[],_fontBuffer=!1;(function(){var t,n,r,e=window.CONFIG;if(e&&e.fonts)for(e=e.fonts,r=e.length;r;)t=e[--r],n={filename:t.filename,settings:t,imagesLoaded:-1,imagesTotal:0,loaded:!1,type:"color"},_customFonts[t.contextName+" color"]=n,loadingCustomFont(n),n={filename:t.filename,settings:t,imagesLoaded:-1,imagesTotal:0,loaded:!1,type:"composite"},_customFonts[t.contextName+" composite"]=n,loadingCustomFont(n)})(),exports.findFontInfo=function(e){var e=Font.parse(e.font),t=e.getName();return t&&_customFonts[t]?(customFont=_customFonts[t],e.customFont=customFont,e.scale=e.getSize()/customFont.settings.size,e):!1},exports.wrapMeasureText=function(e){return _origMeasureText=e,function(t){var n=exports.findFontInfo(this);return n?(n=measure(this,n,t),n.failed?e.apply(this,arguments):n):e.apply(this,arguments)}},exports.wrapFillText=function(e){return function(t,n,r){var s,i=exports.findFontInfo(this);if(!i)return e.apply(this,arguments);if(!loadingCustomFont(i.customFont)&&(isNaN(n)&&(n=0),isNaN(r)&&(r=0),!renderCustomFont(this,n,r,t+"",this.fillStyle,i,0))){s=this.font;this.font=i.size.value+i.size.unit+" "+(this.defaultFontFamily||device.defaultFontFamily),e.apply(this,[t,n,r]),this.font=s}}},exports.wrapStrokeText=function(e){return function(t,n,r){var s,i=exports.findFontInfo(this);if(!i)return e.apply(this,arguments);if(!loadingCustomFont(i.customFont)&&(isNaN(n)&&(n=0),isNaN(r)&&(r=0),!renderCustomFont(this,n,r,t+"",this.strokeStyle,i,1))){s=this.font;this.font=i.size.value+i.size.unit+" "+(this.defaultFontFamily||device.defaultFontFamily),e.apply(this,[t,n,r]),this.font=s}}},exports.getFontBuffer=function(){return _fontBuffer}'),jsio.setCachedSrc("sdk/timestep/ui/Engine.js",'var _timers,__instance,sdk_timestep_ui_Engine,Engine;jsio("import event.Emitter as Emitter"),jsio("import event.input.dispatch as dispatch"),jsio("import timer"),jsio("import ui.backend.ReflowManager as ReflowManager"),jsio("import device");_timers=[];timer.onTick=function(e){var t;for(t=_timers.length;t--;)_timers[t](e)};__instance=null,sdk_timestep_ui_Engine=__class__,Engine=exports=sdk_timestep_ui_Engine(function(){return this.init&&this.init.apply(this,arguments)},Emitter,function(){this.init=function(e){__instance||(jsio("import .StackView"),__instance=this);var t=e&&e.canvas;"string"==typeof t&&GLOBAL.document&&document.getElementById&&(t=document.getElementById(t)),this._opts=e=merge(e,{keyListenerEnabled:!0,width:t&&t.width||device.width,height:t&&t.height||device.height,view:null,dtFixed:0,dtMinimum:0,clearEachFrame:!0,alwaysRepaint:!0,repaintOnEvent:!0,mergeMoveEvents:!1,continuousInputCheck:!device.isMobileBrowser&&!device.isMobile,showFPS:!1}),_timers.push(bind(this,this._tick)),this._doubleBuffered=!0,this._countdown=null,device.useDOM||(this._rootElement=new(device.get("Canvas"))({el:t,width:e.width,height:e.height,offscreen:!1}),this._rootElement.id="timestep_onscreen_canvas",this._ctx=this._rootElement.getContext("2d"),this._ctx.font="11px "+device.defaultFontFamily),this._view=e.view||new StackView,this._view.style.update({width:e.width,height:e.height}),device.useDOM&&(this._rootElement=this._view.getBacking().getElement()),this._view.__root=this,this._events=[],dispatch.KeyListener&&(this._keyListener=new dispatch.KeyListener),this._inputListener=new dispatch.InputListener({rootView:this._view,el:this._rootElement,keyListener:this._keyListener}),this._reflowManager=ReflowManager.get(),this._view.setReflowManager(this._reflowManager),this._tickBuffer=0,this._onTick=[],"browser"==device.name&&(t?(device.width=t.width,device.height=t.height,device.screen.width=t.width,device.screen.height=t.height):(e=device.get("doc"))&&e.setEngine(this)),this.updateOpts(this._opts)},this.updateOpts=function(e){this._opts=merge(e,this._opts),this._keyListener&&this._keyListener.setEnabled(this._opts.keyListenerEnabled);if(this._opts.scaleUI)if(Array.isArray(this._opts.scaleUI)){if(2!=this._opts.scaleUI.length)throw Error("Illegal value for engine option scaleUI: "+this._opts.scaleUI);this.scaleUI(this._opts.scaleUI[0],this._opts.scaleUI[1])}else this.scaleUI(576,1024);this._opts.noReflow&&(this._reflowManager=null,this._view.setReflowManager(null)),this._opts.showFPS?(this._applicationFPS||(jsio("import ui.backend.debug.FPSView as FPSView"),this._applicationFPS=new FPSView({application:this})),this._renderFPS=bind(this._applicationFPS,this._applicationFPS.render),this._tickFPS=bind(this._applicationFPS,this._applicationFPS.tick)):(this._renderFPS=function(){},this._tickFPS=function(){})},this.scaleUI=function(e,t){device.height>device.width?(this._view.baseWidth=e,this._view.baseHeight=device.height*(e/device.width),this._view.scale=device.width/this._view.baseWidth):(this._view.baseWidth=t,this._view.baseHeight=device.height*(t/device.width),this._view.scale=device.height/this._view.baseHeight),this._view.style.scale=this._view.scale},this.supports=function(e){return this._opts[e]},this.getInput=function(){return this._inputListener},this.getKeyListener=function(){return this._keyListener},this.getEvents=function(){return this._events},this.getElement=this.getCanvas=function(){return this._rootElement},this.getViewCtor=function(){return View},this.getView=function(){return this._view},this.setView=function(e){return this._view=e,this},this.getReflowManager=function(){return this._reflowManager},this.show=function(){return this._rootElement.style.display="block",this},this.hide=function(){return this._rootElement.style.display="none",this},this.pause=function(){this.stopLoop(),this._keyListener&&this._keyListener.setEnabled(!1)},this.resume=function(){this.startLoop(),this._keyListener&&this._keyListener.setEnabled(!0)},this.stepFrame=function(e){this.pause(),this._countdown=e||1,this.resume()},this.startLoop=function(e){if(!this._running)return this._running=!0,this.now=0,timer.start(e||this._opts.dtMinimum),this},this.stopLoop=function(){if(this._running)return this._running=!1,timer.stop(),this},this.isRunning=function(){return this._running},this.doOnTick=function(e){1<arguments.length&&(e=bind.apply(this,arguments)),this._onTick.push(e)},this._tick=function(e){null!==this._countdown&&(this._countdown--,-1===this._countdown&&(this.pause(),this._countdown=null));if(this._ctx){var t=this._ctx.getElement(),n=this._view.style;t&&(n.width!=t.width/n.scale||n.height!=t.height/n.scale)&&(n.width=t.width/n.scale,n.height=t.height/n.scale)}for(t=0;n=this._onTick[t];++t)n(e);n=this._inputListener.getEvents(),t=n.length,this._events=n;if(this._opts._mergeMoveEvents)for(var r=!1,t=t-1;0<=t;--t)n[t].type==dispatch.eventTypes.MOVE&&(r?n.splice(t,1):r=!0);for(t=0;r=n[t];++t)r.srcApp=this,dispatch.dispatchEvent(this._view,r);device.useDOM||(0<t?this._opts.repaintOnEvent&&this.needsRepaint():this._opts.continuousInputCheck&&(t=dispatch._evtHistory["input:move"])&&dispatch.dispatchEvent(this._view,new dispatch.InputEvent(t.id,t.type,t.srcPt)));if(this._opts.dtFixed)for(this._tickBuffer+=e;this._tickBuffer>=this._opts.dtFixed;)this._tickBuffer-=this._opts.dtFixed,this.now+=this._opts.dtFixed,this.__tick(this._opts.dtFixed);else this.__tick(e);this._reflowManager&&(this._reflowManager.startReflow(this._ctx),this._reflowManager.setInRender(!0)),t=this._opts.alwaysRepaint||this._needsRepaint,!t&&this._doubleBuffered&&0<this._doubleBufferedState?(--this._doubleBufferedState,this.render(e)):t&&(this._doubleBufferedState=3,this.render(e)),this._needsRepaint=!1,this._reflowManager&&this._reflowManager.setInRender(!1)},this.render=function(e){this._opts.clearEachFrame&&this._ctx&&this._ctx.clear(),this._view.__view.constructor.absScale=1,this._view.__view.wrapRender(this._ctx,{}),this.publish("Render",this._ctx),this._ctx&&(!1,this._ctx.swap())},this.needsRepaint=function(){return this._needsRepaint=!0,this},this.__tick=function(e){this._tickFPS(e),this.publish("Tick",e),this._view.__view.wrapTick(e,this)}});exports.get=function(){return __instance}'),jsio.setCachedSrc("sdk/timestep/event/input/dispatch.js",'jsio("import math.geom.Point as Point"),jsio("import device"),jsio("import lib.Enum"),exports.eventTypes=new lib.Enum("START","MOVE","SELECT","SCROLL","CLEAR"),exports.VERTICAL_AXIS=2,exports.HORIZONTAL_AXIS=1,exports.dispatchEvent=function(e,t){var n,r,i,s,o,u;t.root=e,exports.traceEvt(e,t,t.srcPt);n=t.depth;exports._evtHistory[t.type]=t;for(r=exports._evtCb[t.type]||exports.getEvtCbName(t.type),i=n-1;0<=i;--i){s=t.trace[i],o=t.pt[s.uid];s.publish(r+"Capture",t,o,0==i);if(t.cancelled||s.__input.blockEvents)return}for(u="on"+r,i=0;i<n;++i)if(s=t.trace[i],s.__input.canHandleEvents){o=t.pt[s.uid],s[u]&&s[u](t,o,0==i),s.publish(r,t,o,0==i),s._onEventPropagate(t,o,0==i);if(t.cancelled)break}},exports.traceEvt=function(e,t,n){var r,i,s;n=e.style.localizePoint(new Point(n));if(!e.getInput().containsEvent(t,n))return!1;r=e.getInput().canHandleEvents;r&&(t.depth++,t.trace.unshift(e),t.pt[e.uid]=n);for(i=e.getSubviews(),s=i.length-1;0<=s;--s)if(i[s].style.visible&&exports.traceEvt(i[s],t,n))return!0;if(r)return t.target=e,!0},exports._evtHistory={},exports._activeInputOver={},exports.clearOverState=function(e){var t,n,r;if(e){t=exports._activeInputOver[e];if(t&&(delete exports._activeInputOver[e],t=t.trace))for(n=0;r=t[n];++n)r.__input.onLeave(e)}else for(e in exports._activeInputOver)exports.clearOverState(e)},exports._isDragging=!1,exports.isDragging=function(){return exports._isDragging},exports._evtCb={},exports.getEvtCbName=function(e){var t=exports.eventTypes[e];return exports._evtCb[e]="Input"+t.charAt(0)+t.substring(1).toLowerCase()},exports.InputListener=device.get("Input"),exports.KeyListener=device.get("KeyListener"),jsio("import .InputEvent as exports.InputEvent")'),jsio.setCachedSrc("sdk/timestep/event/input/InputEvent.js",'var sdk_timestep_event_input_InputEvent,InputEvent;jsio("import math.geom.Point as Point"),jsio("import timer");sdk_timestep_event_input_InputEvent=__class__,InputEvent=exports=sdk_timestep_event_input_InputEvent(function(){return this.init&&this.init.apply(this,arguments)},function(){this.cancelled=!1,this.depth=0,this.init=function(e,t,n,r,i,s){this.id=e,this.type=t,this.point=this.pt={},this.srcPoint=this.srcPt=new Point(n,r),this.trace=[],this.root=i||null,this.when=timer.now,this.target=s||null},this.cancel=function(){this.cancelled=!0},this.clone=function(){return new InputEvent(this.id,this.type,this.srcPt.x,this.srcPt.y,this.root,this.target)}})'),jsio.setCachedSrc("sdk/timestep/timer.js",'var Timer,MAX_TICK;jsio("import device");Timer=device.get("Timer"),MAX_TICK=1e4;exports.now=0,exports.frames=0,exports.reset=function(){this._last=null},exports.tick=function(e){try{e>MAX_TICK&&(exports.onLargeTick(e,MAX_TICK),e=1),exports.now+=e,exports.frames++,exports.onTick(e),ok=!0}finally{exports.debug&&!ok&&app.stopLoop()}},exports.onLargeTick=function(e,t){logger.warn("Dropping large tick: "+e+"; Threshold is set at: "+t)},exports.onTick=function(){},exports.debug=!1,exports.start=function(e){this.reset(),this.isRunning=!0,device.get("Timer").start(exports.tick,e)},exports.stop=function(){this.reset(),this.isRunning=!1,device.get("Timer").stop()},exports.getTickProgress=function(){var e=+(new Date);return-(Timer.last||e)+e}'),jsio.setCachedSrc("sdk/timestep/ui/backend/ReflowManager.js",'var _debug,DEBUG=!1,MAX_REFLOW_THRESHOLD=6,_pool=new(Class(function(){this._pool=[],this.recycle=function(e){e.count=0,e.view=null,this._pool.push(e)},this.get=function(e){var t=this._pool.pop()||{};return t.view=e,t.iter=0,t.count=0,t}})),sdk_timestep_ui_backend_ReflowManager=__class__,ReflowManager=exports=sdk_timestep_ui_backend_ReflowManager(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._pending={},this._iter=0},this.setInRender=function(e){this._isInRender=e},this.add=function(e){var t=e.uid,n=this._pending[t]||(this._pending[t]=_pool.get(e));n.needsReflow=!0,n.iter!=this._iter&&(n.count++,n.iter=this._iter),DEBUG&&_debug.log("adding view",t,e.style.width+"x"+e.style.height,e.getTag()),this._isInRender&&!this._isInReflow&&this.startReflow(this._lastCtx)},this._reflow=function(e,t){t.needsReflow=!1;var n=t.view,r=n.style;r.__firstRender||(r.__firstRender=!0,DEBUG&&_debug.log("calling buildView for",n.uid,"("+n.style.width+"x"+n.style.height+")")&&_debug.stepIn(),n.buildView(e),DEBUG&&_debug.stepOut());if(n.hasListeners("Resize")){var i=r.width,s=r.height;if(r.__cachedWidth!=i||r.__cachedHeight!=s)r.__cachedWidth=i,r.__cachedHeight=s,n.publish("Resize")}n.__layout&&n.__layout.reflow(),n.reflow(!1)},this.startReflow=function(e){this._lastCtx=e,this._isInReflow=!0,this._iter=0;var t;DEBUG&&_debug.stepIn();do{++this._iter,t=0;for(var n in this._pending){var r=this._pending[n];if(r.count>MAX_REFLOW_THRESHOLD){logger.warn("reflow loop detected for view",r.view.uid);break}r.needsReflow&&(DEBUG&&_debug.log("starting reflow for view",r.view.uid,"("+r.count+" times)")&&_debug.stepIn(),this._reflow(e,r),DEBUG&&_debug.stepOut(),++t)}DEBUG&&t&&_debug.log("iteration",this._iter,"reflowed",t,"views")}while(t);for(n in this._pending)_pool.recycle(this._pending[n]);this._pending={},this._isInReflow=!1,DEBUG&&_debug.stepOut()}}),_instance=null;exports.get=function(){return _instance||(_instance=new ReflowManager)}'),jsio.setCachedSrc("sdk/timestep/ui/StackView.js",'var sdk_timestep_ui_StackView;jsio("import ui.View as View"),jsio("import animate");sdk_timestep_ui_StackView=__class__;exports=sdk_timestep_ui_StackView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.init=function(t){t=merge(t,{layout:"box"}),e(this,"init",[t]),this.stack=[]},this.getStack=function(){return this.stack},this.getCurrentView=function(){return this.stack.length?this.stack[this.stack.length-1]:null},this.push=function(e,t,n){var r;!this.stack[0]&&!1!==t&&(t=!0);r=this.getCurrentView();return r&&this._hide(r,t),e.style.y=0,e.style.width=this.style.width/e.style.scale,e.style.height=this.style.height/e.style.scale,this.stack.push(e),this._show(e,t,n),e},this._hide=function(e,t,n){e.publish("ViewWillDisappear"),t?(this.removeSubview(e),e.publish("ViewDidDisappear")):(this.getInput().blockEvents=!0,animate(e).then({x:(n?1:-1)*this.style.width}).then(bind(this,function(){this.removeSubview(e),e.publish("ViewDidDisappear"),this.getInput().blockEvents=!1})))},this._show=function(e,t,n){e.publish("ViewWillAppear"),e.style.visible=!0,t?(this.addSubview(e),e.style.x=0,e.publish("ViewDidAppear")):(e.style.x=(n?-1:1)*this.style.width,this.addSubview(e),animate(e).then({x:0}).then(bind(e,"publish","ViewDidAppear")))},this.hasView=function(e){return 0<=this.stack.indexOf(e)},this.remove=function(e){e=this.stack.indexOf(e),0<=e&&this.stack.splice(e,1)},this.pop=function(e,t){var n;if(!this.stack.length)return!1;n=this.stack.pop();return this._hide(n,e,!1===t?!1:!0),this.stack.length&&this._show(this.stack[this.stack.length-1],e,!0),n},this.popAll=function(e){for(;this.stack[1];)this.pop(e)}})'),jsio.setCachedSrc("sdk/timestep/ui/View.js",'var KeyListener,EventScheduler,scheduler,FocusMgr,UID,_BackingCtor,sdk_timestep_ui_View,View,_extensions;jsio("import device"),jsio("import event.Emitter as Emitter"),jsio("import math.geom.Point as Point"),jsio("import math.geom.Rect as Rect"),jsio("import .backend.canvas.ViewBacking"),jsio("import ui.backend.ReflowManager as ReflowManager"),jsio("import event.input.dispatch as dispatch"),jsio("import event.input.InputHandler as InputHandler"),jsio("import animate"),jsio("import util.setProperty"),jsio("import .Engine");KeyListener=device.get("KeyListener"),EventScheduler=__class__,EventScheduler=EventScheduler(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._queue=[]},this.add=function(e){this._queue.push(e);if(!this._running){for(this._running=!0;e=this._queue.shift();)e();this._running=!1}}}),scheduler=new EventScheduler,FocusMgr=new(Class(function(){this.init=function(){this._keyListener=KeyListener&&new KeyListener,this._target=null,this._canChange=!0},this.focus=function(e){this._target!=e&&this._canChange&&(this._target&&this._target.onBlur&&this._target.onBlur(this),(this._target=e)&&e.onFocus&&this._target.onFocus(this))},this.blur=function(e){e.onBlur&&e.onBlur(this),this._target=!1},this.getKeyListener=function(){return this._keyListener},this.get=function(){return this}})),UID=0,_BackingCtor=null,sdk_timestep_ui_View=__class__,View=exports=sdk_timestep_ui_View(function(){return this.init&&this.init.apply(this,arguments)},Emitter,function(){this.init=function(e){e||(e={}),this.uid=++UID,this.__rightSibling=this.__leftSibling=this.__children=this.__parent=null,this.__input=new InputHandler(this,e),this.__view=this.style=new(e.Backing||_BackingCtor)(this,e),this._filter=null,this._dragOffset={},this.__view._view=this;var t=Engine.get();t&&(this._reflowManager=t.getReflowManager()),this.updateOpts(e)},this.updateOpts=function(e){e=e||{};if(this._opts)for(var t in e)this._opts[t]=e[t];else this._opts=e;return e.tag&&(this.tag=e.tag),e.filter&&(this._filter=e.filter),e.infinite&&(this._infinite=e.infinite),this.style.update(e),e.superview&&e.superview.addSubview(this),e.parent&&e.parent.addSubview(this),e},this.getFilters=function(){logger.warn("View.getFilters() is deprecated! Use View.getFilter() instead.");var e={};return this._filter&&(e[this._filter._opts.type]=this._filter),e},this.getFilter=function(){return this._filter},this.addFilter=function(e){logger.warn("View.addFilter() is deprecated! Use View.setFilter() instead."),this.setFilter(e)},this.setFilter=function(e){this._filter=e},this.removeFilter=function(){this._filter=null},util.setProperty(this,"render",{value:void 0,cb:function(){this.__view&&(this.__view.hasJSRender=!0)}}),util.setProperty(this,"tick",{value:void 0,cb:function(){this.__view&&(this.__view.hasJSTick=!0)}}),this.getAnimation=function(e){return animate(this,e)},this.animate=function(e,t,n){return this.getAnimation().then(e,t,n)},this.focus=function(){return FocusMgr.get().focus(this),this},this.blur=function(){return FocusMgr.get().blur(this),this},this.onFocus=function(){this._isFocused=!0},this.onBlur=function(){this._isFocused=!1},this.isDragging=function(){return this.__input.isDragging()},this.startDrag=function(e){this.__input.startDrag(e)},this.getInput=function(){return this.__input},this.isInputOver=function(){return!!this.__input.overCount},this.getInputOverCount=function(){return this._inputOverCount},this.setHandleEvents=this.canHandleEvents=function(e,t){this.__input.canHandleEvents=e,"boolean"==typeof t&&(this.__input.blockEvents=t)},this.setIsHandlingEvents=function(e){this.__input.canHandleEvents=e},this.isHandlingEvents=function(){return this.__input.canHandleEvents},this.needsRepaint=function(){this._needsRepaint=!0},this.needsReflow=function(e){if(this.style.__firstRender||e)this._reflowManager&&this._reflowManager.add(this),this._needsRepaint=!0},this._onEventPropagate=function(e,t,n){if(n){var t=e.id,r;switch(e.type){case dispatch.eventTypes.SELECT:case dispatch.eventTypes.CLEAR:dispatch._evtHistory[dispatch.eventTypes.MOVE]=null,(n=dispatch._activeInputOver[t])&&dispatch.clearOverState(t);break;case dispatch.eventTypes.START:case dispatch.eventTypes.MOVE:var i=e.trace[0],s=null;if((n=dispatch._activeInputOver[t])&&i!=n.trace[0]){var o=n.trace;for(r=0;s=o[r];++r)s.uid in e.pt||s.__input.onLeave(t,i==s)}if(!n||i!=n.trace[0]){o=e.trace;for(r=e.depth-1;0<=r;--r)o[r].__input.onEnter(t,i==s);dispatch._activeInputOver[t]=e}}}},this.localizePoint=function(e){var t=this.getParents(),n=0;for(t.push(this);t[++n];)e=t[n].__view.localizePoint(e);return e},this.setReflowManager=function(e){this._reflowManager=e},this.getSubview=function(e){return this.__view.getSubviews()[e]},this.getSubviews=function(){return this.__view.getSubviews()},this.getSuperview=function(){return this.__view.getSuperview()},this.connectEvent=function(e,t){this.__subs||(this.__subs=[],this.on("ViewAdded",bind(this,"_connectEvents")),this.on("ViewRemoved",bind(this,"_disconnectEvents")),this.__root&&this._connectEvents());var n=Array.prototype.slice.call(arguments,1);this.__subs.push([e,n]),this.__root&&e.on.apply(e,n)},this.disconnectEvent=function(e,t){if(this.__subs)for(var n=Array.prototype.slice.call(arguments,1),r=0,i;i=this.__subs[r];++r){var s;if(s=i[0]==e)e:{s=0;for(var o=n.length;s<o;++s)if(n[s]!=i[1][s]){s=!1;break e}s=!0}s&&(i[0].removeListener.apply(i[0],i[1]),this.__subs.splice(r--,1))}},this._connectEvents=function(){for(var e=0,t;t=this.__subs[e];++e)t[0].on.apply(t[0],t[1])},this._disconnectEvents=function(){for(var e=0,t;t=this.__subs[e];++e)t[0].removeListener.apply(t[0],t[1])},this.addSubview=function(e){if(this.__view.addSubview(e)&&(e.needsRepaint(),this._reflowManager&&e.needsReflow(),this._linkView(e),e.__input.resetOver(),this.publish("SubviewAdded",e),this.__root)){var t=this.__root;scheduler.add(bind(this,function n(r){r.__root=t,r.emit("ViewAdded",e);for(var r=r.getSubviews(),i=0,s;s=r[i];++i)n(s)},e))}return e},this._linkView=function(e){this._unlinkView(e),this.__children&&(this.__children.__leftSibling=e),e.__leftSibling=null,e.__rightSibling=this.__children,this.__children=e,e.__parent=this},this._unlinkView=function(e){e.__parent&&(e.__leftSibling&&(e.__leftSibling.__rightSibling=e.__rightSibling),e.__rightSibling&&(e.__rightSibling.__leftSibling=e.__leftSibling),e.__parent.__children==e&&(e.__parent.__children=e.__rightSibling),e.__leftSibling=null,e.__rightSibling=null,e.__parent=null)},this.removeSubview=function(e){return this.__view.removeSubview(e)&&(this._unlinkView(e),this.publish("SubviewRemoved",e),e.__root&&scheduler.add(bind(this,function t(e){e.__root=null,e.emit("ViewRemoved",this);for(var e=e.getSubviews(),n=0,r;r=e[n];++n)t(r)},e))),e},this.removeFromSuperview=function(){var e=this.__view.getSuperview();e&&e.removeSubview(this)},this.removeAllSubviews=function(){for(var e=this.getSubviews(),t=e.length;t--;)this.removeSubview(e[t])},util.setProperty(this,"_superview",{get:this.getSuperview,set:function(){}}),util.setProperty(this,"_subviews",{get:this.getSubviews,set:function(){}}),this.reflow=function(){},this.getApp=function(){var e=this,t;do t=e.__view.getSuperview();while(t&&(e=t));return e.__root},this.getParents=function(){var e=[this],t;do t=e[0].__view.getSuperview();while(t&&e.unshift(t));return e.pop(),e},this.buildView=function(){},this.containsLocalPoint=function(e){if(this._infinite)return!0;var t=this.style,n=t.width,t=t.height;return 0<n&&0<t?e.x<=n&&e.y<=t&&0<=e.x&&0<=e.y:0<n?e.x<=n&&e.y>=t&&0<=e.x&&0>=e.y:0<t?e.x>=n&&e.y<=t&&0>=e.x&&0<=e.y:e.x>=n&&e.y>=t&&0>=e.x&&0>=e.y},this._boundingShape={},this.getBoundingShape=function(e){if(this._infinite)return!0;var t=this.style,n=t.width,r=t.height;if((!n||!r)&&t.layout){var i=this.getSuperview();i&&(i=i.getBoundingShape(!0),n||(n=i.width,t.layoutWidth&&(n*=parseInt(t.layoutWidth)/100)),!r)&&(r=i.height,t.layoutHeight&&(r*=parseInt(t.layoutHeight)/100))}return e?(this._boundingShape.x=t.x,this._boundingShape.y=t.y,this._boundingShape.width=n*t.scale,this._boundingShape.height=r*t.scale,this._boundingShape):new Rect(t.x,t.y,n*t.scale,r*t.scale)},this.getRelativeRegion=function(e,t){var n=this.getPosition(t||e.src);return new Rect((e.x-n.x)/n.scale,(e.y-n.y)/n.scale,e.width/n.scale,e.height/n.scale)},this.getPosition=function(e){for(var t=new Point,n=this,r=0,i=this.style,s=i.width,i=i.height,o=1;n&&n!=e;){var u=n.style.scale;t.add(-n.style.anchorX,-n.style.anchorY),t.rotate(n.style.r),t.scale(u),t.add(n.style.anchorX+n.style.x+n.style.offsetX,n.style.anchorY+n.style.y+n.style.offsetY),r+=n.style.r,s*=u,i*=u,o*=u,n=n.__view.getSuperview()}return{x:t.x,y:t.y,r:r%(2*Math.PI),width:s,height:i,scale:o,anchorX:this.style.anchorX,anchorY:this.style.anchorY}},this.getBacking=function(){return this.__view},this.show=function(){this.style.visible=!0,this.needsRepaint()},this.hide=function(){this.style.visible=!1,this.needsRepaint()},this.toString=this.getTag=function(){var e="View";return!1,e+this.uid+(this.tag?":"+this.tag:"")}}),_extensions=[];View.addExtension=function(e){e.extend(View.BackingCtor),_extensions.push(e)},View.setDefaultViewBacking=function(e){_BackingCtor=View.BackingCtor=e,_extensions.forEach(function(e){e.extend(_BackingCtor)})},View.setDefaultViewBacking(backend.canvas.ViewBacking)'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/ViewBacking.js",'var _styleKeys,sdk_timestep_ui_backend_canvas_ViewBacking,ViewBacking;jsio("import ..strPad"),jsio("import ..BaseBacking"),jsio("import util.setProperty as setProperty");_styleKeys={},sdk_timestep_ui_backend_canvas_ViewBacking=__class__,ViewBacking=exports=sdk_timestep_ui_backend_canvas_ViewBacking(function(){return this.init&&this.init.apply(this,arguments)},BaseBacking,function(){this.constructor.absScale=1,this.init=function(e){this._view=e,this._subviews=[]},this.getSuperview=function(){return this._superview},this.getSubviews=function(){this._needsSort&&(this._needsSort=!1,this._subviews.sort());for(var e=[],t=this._subviews,n=t.length,r=0;r<n;++r)e[r]=t[r]._view;return e};var e=9e5;this.addSubview=function(t){var n=t.__view,r=n._superview;return r==this._view||this==n?!1:(r&&r.__view.removeSubview(t),t=this._subviews.length,this._subviews[t]=n,n._superview=this._view,n._setAddedAt(++e),t&&n.__sortKey<this._subviews[t-1].__sortKey&&(this._needsSort=!0),!0)},this.removeSubview=function(e){var t=this._subviews.indexOf(e.__view);return-1!=t?(this._subviews.splice(t,1),e.__view._superview=null,!0):!1},this.wrapTick=function(e,t){this._view.tick&&this._view.tick(e,t);for(var n=0,r;r=this._subviews[n];++n)r.wrapTick(e,t)},this.wrapRender=function(e,t){if(this.visible){this.__firstRender||this._view.needsReflow(!0),this._needsSort&&(this._needsSort=!1,this._subviews.sort());var n=this._width,r=this._height;if(!(0>n||0>r)){e.save(),e.translate(this.x+this.anchorX+this.offsetX,this.y+this.anchorY+this.offsetY),this.r&&e.rotate(this.r),1!=this.scale&&(e.scale(this.scale,this.scale),ViewBacking.absScale*=this.scale),1!=this.scaleX&&e.scale(this.scaleX,1),1!=this.scaleY&&e.scale(1,this.scaleY),this.absScale=ViewBacking.absScale,1!=this.opacity&&(e.globalAlpha*=this.opacity),e.translate(-this.anchorX,-this.anchorY),this.clip&&e.clipRect(0,0,n,r);var i={},s=this._view.getFilter();s&&(i[s._opts.type]=s),e.setFilters(i);if(this.flipX||this.flipY)e.translate(this.flipX?n/2:0,this.flipY?r/2:0),e.scale(this.flipX?-1:1,this.flipY?-1:1),e.translate(this.flipX?-n/2:0,this.flipY?-r/2:0);try{this.backgroundColor&&(e.fillStyle=this.backgroundColor,e.fillRect(0,0,n,r));var o=t.viewport;this._view.render&&this._view.render(e,t),this._renderSubviews(e,t),t.viewport=o}finally{e.clearFilters(),e.restore(),ViewBacking.absScale/=this.scale}}}},this._renderSubviews=function(e,t){for(var n=0,r,i=this._subviews;r=i[n++];)r.wrapRender(e,t)},this._onResize=function(){this._view.needsReflow()},this._sortIndex=strPad.initialValue,this._onZIndex=function(e,t){this._sortIndex=strPad.pad(t),this._setSortKey(),this._view.needsRepaint();var n=this._view.getSuperview();n&&(n.__view._needsSort=!0)},this._setAddedAt=function(e){this._addedAt=e,this._setSortKey()},this._setSortKey=function(){this.__sortKey=this._sortIndex+this._addedAt},this._onOffsetX=function(e){this.offsetX=e*this.width/100},this._onOffsetY=function(e){this.offsetY=e*this.height/100},this.toString=function(){return this.__sortKey}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/strPad.js",'var LEN=8,MAX=99999999,MIN=-99999999,PAD="00000000";exports.initialValue=PAD,exports.pad=function(e){return e=~~e,e<MIN&&(e=MIN),e>MAX&&(e=MAX),0>e?(e*=-1,"-"+PAD.substring(0,LEN-(""+e).length)+e):PAD.substring(0,LEN-(""+e).length)+e}'),jsio.setCachedSrc("sdk/timestep/ui/backend/BaseBacking.js",'var sdk_timestep_ui_backend_BaseBacking,BaseBacking;jsio("import util.setProperty as setProperty");sdk_timestep_ui_backend_BaseBacking=__class__,BaseBacking=exports=sdk_timestep_ui_backend_BaseBacking(function(){return this.init&&this.init.apply(this,arguments)},function(){var e=this.constructor.styleKeys={},t={x:{value:0},y:{value:0},offsetX:{value:0},offsetY:{value:0},offsetXPercent:{value:void 0,cb:"_onOffsetX"},offsetYPercent:{value:void 0,cb:"_onOffsetY"},anchorX:{value:0},anchorY:{value:0},centerAnchor:{value:!1},width:{cb:"_onResize"},height:{cb:"_onResize"},r:{value:0},opacity:{value:1},zIndex:{value:0,cb:"_onZIndex"},scale:{value:1},scaleX:{value:1},scaleY:{value:1},flipX:{value:!1},flipY:{value:!1},visible:{value:!0},shadowColor:{value:"black"},clip:{value:!1},backgroundColor:{value:void 0}};this.constructor.addProperty=function(t,n){e[t]=!0,setProperty(this.prototype,t,n)};for(var n in t)this.constructor.addProperty(n,t[n]);this.localizePoint=function(e){return e.x-=this.x+this.anchorX+this.offsetX,e.y-=this.y+this.anchorY+this.offsetY,this.r&&e.rotate(-this.r),e.scale(1/this.scale),e.x+=this.anchorX,e.y+=this.anchorY,e},this.copy=function(){var t={},n;for(n in e)t[n]=this[n];return t},this.update=function(t){for(var n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(this[n]=t[n]);return this}})'),jsio.setCachedSrc("sdk/timestep/event/input/InputHandler.js",'var sdk_timestep_event_input_InputHandler,InputHandler;jsio("import math.geom.Point as Point"),jsio("import event.input.dispatch as dispatch");sdk_timestep_event_input_InputHandler=__class__,InputHandler=exports=sdk_timestep_event_input_InputHandler(function(){return this.init&&this.init.apply(this,arguments)},function(){this.overCount=this.dragCount=this.startCount=0,this.canHandleEvents=!0,this.blockEvents=!1,this.init=function(e,t){this.view=e,"canHandleEvents"in t&&(this.canHandleEvents=t.canHandleEvents),"blockEvents"in t&&(this.blockEvents=t.blockEvents)},this.containsEvent=function(e,t){return!this.blockEvents&&(!this.view._superview||this.view.containsLocalPoint(t))},this.onEnter=function(e,t){var n=this.view,r=this._over||(this._over={});e in r||(r[e]=!0,this.overCount++,n.onInputOver&&n.onInputOver(r,this.overCount,t),n.publish("InputOver",r,this.overCount,t))},this.onLeave=function(e,t){var n=this.view,r=this._over||(this._over={});e in r&&(delete r[e],--this.overCount,n.onInputOut&&n.onInputOut(r,this.overCount,t),n.publish("InputOut",r,this.overCount,t))},this.resetOver=function(){delete this._over,this.overCount=0},this.startDrag=function(e){var e=e||{},t=this.view,n=e.inputStartEvt||e.inputStartEvent||dispatch._evtHistory[dispatch.eventTypes.START],r=n.id,i=this._isDragging||(this._isDragging={});i[r]||(i[r]=!0,++this.dragCount,++this.startCount,r=n.root,t=new dispatch.InputEvent(n.id,"input:drag",n.srcPt.x,n.srcPt.y,r,t),t.didDrag=!1,t.radius=e.radius*e.radius||0,r.subscribe("InputMoveCapture",this,"onDragStart",t),r.subscribe("InputSelectCapture",this,"onDragStop",t))},this.isDragging=function(){return this.dragCount&&dispatch._isDragging},this.onDragStart=function(e,t){var n=t.srcPt.x-e.srcPt.x,r=t.srcPt.y-e.srcPt.y;!(n*n+r*r<=e.radius)&&!e.didDrag&&(e.didDrag=!0,--this.startCount,n=this.view,0==this.startCount&&e.root.unsubscribe("InputMoveCapture",this,"onDragStart"),e.currPt=e.srcPt,e.localPt=n.localizePoint(new Point(e.currPt)),n.onDragStart&&n.onDragStart(e),n.publish("DragStart",e),e.root.subscribe("InputMoveCapture",this,"onDrag",e),this.onDrag(e,t))},this.onDrag=function(e,t){if(e.id==t.id&&(t.srcPt.x!=e.currPt.x||t.srcPt.y!=e.currPt.y)){var n=this.view;e.prevPt=e.currPt,e.currPt=t.srcPt,e.prevLocalPt=e.localPt,e.localPt=n.localizePoint(new Point(e.currPt));var r=Point.subtract(e.localPt,e.prevLocalPt);dispatch._isDragging=!0,n.onDrag&&n.onDrag(e,t,r),n.publish("Drag",e,t,r)}},this.onDragStop=function(e,t){var n=e.id,r=this._isDragging||(this._isDragging={});r[n]&&e.id==t.id&&(delete r[n],--this.dragCount,this.dragCount||(e.root.unsubscribe("InputMoveCapture",this,"onDragStart"),e.root.unsubscribe("InputMoveCapture",this,"onDrag"),e.root.unsubscribe("InputSelectCapture",this,"onDragStop"),dispatch._isDragging=!1),e.didDrag)&&(n=this.view,t.cancel(),n.onDragStop&&n.onDragStop(e,t),n.publish("DragStop",e,t))}})'),jsio.setCachedSrc("sdk/timestep/animate.js",'jsio("import ui.backend.canvas.animate as exports")'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/animate.js",'var anim_uid,Group,groups,TRANSITIONS,Frame,CallbackFrame,WaitFrame,ObjectFrame,ViewStyleFrame,Animator,ViewAnimator;function getTransition(e){return"function"==typeof e?e:TRANSITIONS[e|0]}jsio("import event.Emitter as Emitter"),jsio("import animate.transitions as transitions"),jsio("import timer");anim_uid=0;exports=function(e,t){var t,n,r,i;"undefined"==typeof Engine&&(jsio("import ui.Engine as Engine"),jsio("import ui.View as View"),jsio("import device"));if(device.useDOM&&e instanceof View&&!t)return e.getAnimation();t=t||0,n=groups[t]||(groups[t]=new Group),r=e.__anim_id||(e.__anim_id="__anim_"+ ++anim_uid),i=n.get(r);return i||(i=e instanceof View?new ViewAnimator(e,n):new Animator(e,n),n.add(r,i)),i},exports.getViewAnimator=function(){return ViewAnimator},exports.setViewAnimator=function(e){ViewAnimator=e};Group=__class__,Group=Group(function(){return this.init&&this.init.apply(this,arguments)},Emitter,function(){this.init=function(){this._anims={},this._pending=[]},this.get=function(e){return this._anims[e]},this.add=function(e,t){return this._anims[e]=t,t.id=e,t},this.isActive=function(){for(var e in this._anims)if(this._anims[e].hasFrames())return!0;return!1},this.onAnimationFinish=function(e){delete this._anims[e.id],this.isActive()||this.publish("Finish")}}),groups={0:new Group};exports.getGroup=function(e){return groups[e||0]};TRANSITIONS=[transitions.easeInOut,transitions.linear,transitions.easeIn,transitions.easeOut,transitions.easeInOut,transitions.easeInQuad,transitions.easeOutQuad,transitions.easeInOutQuad,transitions.easeInCubic,transitions.easeOutCubic,transitions.easeInOutCubic,transitions.easeInQuart,transitions.easeOutQuart,transitions.easeInOutQuart,transitions.easeInQuint,transitions.easeOutQuint,transitions.easeInOutQuint,transitions.easeInSine,transitions.easeOutSine,transitions.easeInOutSine,transitions.easeInExpo,transitions.easeOutExpo,transitions.easeInOutExpo,transitions.easeInCirc,transitions.easeOutCirc,transitions.easeInOutCirc,transitions.easeInElastic,transitions.easeOutElastic,transitions.easeInOutElastic,transitions.easeInBack,transitions.easeOutBack,transitions.easeInOutBack,transitions.easeInBounce,transitions.easeOutBounce,transitions.easeInOutBounce];exports.linear=1,exports.easeIn=2,exports.easeOut=3,exports.easeInOut=4,exports.easeInQuad=5,exports.easeOutQuad=6,exports.easeInOutQuad=7,exports.easeInCubic=8,exports.easeOutCubic=9,exports.easeInOutCubic=10,exports.easeInQuart=11,exports.easeOutQuart=12,exports.easeInOutQuart=13,exports.easeInQuint=14,exports.easeOutQuint=15,exports.easeInOutQuint=16,exports.easeInSine=17,exports.easeOutSine=18,exports.easeInOutSine=19,exports.easeInExpo=20,exports.easeOutExpo=21,exports.easeInOutExpo=22,exports.easeInCirc=23,exports.easeOutCirc=24,exports.easeInOutCirc=25,exports.easeInElastic=26,exports.easeOutElastic=27,exports.easeInOutElastic=28,exports.easeInBack=29,exports.easeOutBack=30,exports.easeInOutBack=31,exports.easeInBounce=32,exports.easeOutBounce=33,exports.easeInOutBounce=34;Frame=__class__,Frame=Frame(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this.subject=e.subject,this.target=e.target,this.duration=e.duration||0,this.transition=getTransition(e.transition),this.onTick=e.onTick},this.exec=function(){},this.onInterrupt=function(){}}),CallbackFrame=__class__,CallbackFrame=CallbackFrame(function(){return this.init&&this.init.apply(this,arguments)},Frame,function(){this.exec=function(e,t){this.target.apply(this.subject,arguments)}}),WaitFrame=Frame,ObjectFrame=__class__,ObjectFrame=ObjectFrame(function(){return this.init&&this.init.apply(this,arguments)},Frame,function(){this.exec=function(e,t,n){if(!this.base){this.base={};for(var r in this.target)this.base[r]=this.subject[r]}for(r in this.target)this.subject[r]=(this.target[r]-this.base[r])*e+this.base[r];if(n){t={};for(r in this.target)t[r]=this.subject[r]+" -> "+this.target[r];logger.log(this.duration,e,JSON.stringify(t))}}}),ViewStyleFrame=__class__,ViewStyleFrame=ViewStyleFrame(function(){return this.init&&this.init.apply(this,arguments)},Frame,function(){this._resolvedDeltas=!1,this.init=function(e){this.subject=e.subject,this.target=merge({},e.target),this.duration=0===e.duration?0:e.duration||500,this.transition=getTransition(e&&e.transition),this.onTick=e.onTick},this.resolveDeltas=function(e){var t=this.target;this._resolvedDeltas=!0;for(var n in t){var r=n.substring(1);"d"==n.charAt(0)&&!(n in e)&&r in e&&(t[r]=t[n]+e[r],delete t[n])}},this.exec=function(e,t,n){var r=this._baseStyle||(this._baseStyle=this.subject.style.copy()),t=this.target;this._resolvedDeltas||this.resolveDeltas(this._baseStyle);var r=this._baseStyle,i;for(i in t)i in r&&(this.subject.style[i]=(t[i]-r[i])*e+r[i]);if(n){n={};for(i in t)n[i]=this.subject.style[i]+" -> "+t[i];logger.log(timer.now,this.duration,e,JSON.stringify(n))}},this.onInterrupt=function(){}});exports.Animator=__class__;Animator=exports.Animator=exports.Animator(function(){return this.init&&this.init.apply(this,arguments)},Emitter,function(){this.init=function(e,t){this.subject=e,this._group=t,this.clear(),this._isPaused=!1},this.clear=function(){return this._elapsed=0,this._queue=[],this._unschedule(),this},this.pause=function(){this._isPaused||(this._isPaused=!0,this._unschedule())},this.resume=function(){this._isPaused&&(this._isPaused=!1,this._schedule())},this._schedule=function(){this._isScheduled||(this._isScheduled=!0,Engine.get().subscribe("Tick",this,"onTick"))},this._unschedule=function(){this._isScheduled&&(this._isScheduled=!1,Engine.get().unsubscribe("Tick",this,"onTick"))},this.isPaused=function(){return this._isPaused},this.hasFrames=function(){return!!this._queue[0]},this.wait=function(e){return this.then(new WaitFrame({duration:e}))},this.buildFrame=function(e){return"function"==typeof e.target?new CallbackFrame(e):"object"==typeof e.target?new ObjectFrame(e):new WaitFrame(e)},this.now=function(e,t,n,r){return n=n||(this._queue[0]?exports.easeOut:exports.easeInOut),e=e instanceof Frame?e:this.buildFrame({subject:this.subject,target:e,duration:t,transition:n,onTick:r}),(t=this._queue[0])&&t.onInterrupt(e),this.clear(),this.then(e)},this.then=function(e,t,n,r){return e=e instanceof Frame?e:this.buildFrame({subject:this.subject,target:e,duration:t,transition:n,onTick:r}),this._queue.length||(this._elapsed=0),this._queue.push(e),this._schedule(),this},this.debug=function(){return this._debug=!0,this},this.commit=function(){for(var e=this._elapsed=0,t;t=this._queue[e];++e)this._elapsed+=t.duration;return this.next(),this},this.onTick=function(e){this._isScheduled&&(this._elapsed+=e,this.next(),!this._isScheduled)&&this._group.onAnimationFinish(this)},this.next=function(){var e;if(this._queue[0]){for(;e=this._queue[0];){var t=this._elapsed>=e.duration,n=t?1:this._elapsed/e.duration,r=e.transition(n);t&&(this._elapsed-=e.duration);try{e.exec(r,n,this._debug),e.onTick&&e.onTick.call(e.subject,r,n)}finally{if(t&&e==this._queue[0]&&this._queue.shift(),!t||this._isPaused)return}}this._unschedule()}}}),ViewAnimator=__class__,ViewAnimator=ViewAnimator(function(){return this.init&&this.init.apply(this,arguments)},Animator,function(e){this.buildFrame=function(t){return"object"==typeof t.target?new ViewStyleFrame(t):e(this,"buildFrame",arguments)}})'),jsio.setCachedSrc("sdk/timestep/animate/transitions.js","exports.linear=function(e){return e},exports.easeIn=exports.easeInQuad=function(e){return e*e},exports.easeOut=exports.easeOutQuad=function(e){return e*(2-e)},exports.easeInOutQuad=function(e){return 1>(e*=2)?.5*e*e:-0.5*(--e*(e-2)-1)},exports.easeInCubic=function(e){return e*e*e},exports.easeOutCubic=function(e){return(e-=1)*e*e+1},exports.easeInOut=exports.easeInOutCubic=function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)},exports.easeInQuart=function(e){return e*e*e*e},exports.easeOutQuart=function(e){return-1*((e-=1)*e*e*e-1)},exports.easeInOutQuart=function(e){return 1>(e*=2)?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)},exports.easeInQuint=function(e){return e*e*e*e*e},exports.easeOutQuint=function(e){return(e-=1)*e*e*e*e+1},exports.easeInOutQuint=function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},exports.easeInSine=function(e){return 0==e?0:1==e?1:-1*Math.cos(e*(Math.PI/2))+1},exports.easeOutSine=function(e){return 0==e?0:1==e?1:Math.sin(e*(Math.PI/2))},exports.easeInOutSine=function(e){return 0==e?0:1==e?1:-0.5*(Math.cos(Math.PI*e)-1)},exports.easeInExpo=function(e){return 0==e?0:1==e?1:0==e?0:Math.pow(2,10*(e-1))},exports.easeOutExpo=function(e){return 0==e?0:1==e?1:1==e?1:-Math.pow(2,-10*e)+1},exports.easeInOutExpo=function(e){return 0==e?0:1==e?1:1>(e*=2)?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},exports.easeInCirc=function(e){return 0==e?0:1==e?1:-1*(Math.sqrt(1-e*e)-1)},exports.easeOutCirc=function(e){return 0==e?0:1==e?1:Math.sqrt(1-(e-=1)*e)},exports.easeInOutCirc=function(e){return 0==e?0:1==e?1:1>(e*=2)?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},exports.easeInElastic=function(e){return 0==e?0:1==e?1:-(Math.pow(2,10*(e-=1))*Math.sin((e-.075)*2*Math.PI/.3))},exports.easeOutElastic=function(e){return 0==e?0:1==e?1:Math.pow(2,-10*e)*Math.sin((e-.075)*2*Math.PI/.3)+1},exports.easeInOutElastic=function(e){return 0==e?0:2==(e*=2)?1:1>e?-0.5*Math.pow(2,10*(e-=1))*Math.sin((1*e-.1125)*2*Math.PI/.45):.5*Math.pow(2,-10*(e-=1))*Math.sin((1*e-.1125)*2*Math.PI/.45)+1},exports.easeInBack=function(e){return 0==e?0:1==e?1:e*e*(2.70158*e-1.70158)},exports.easeOutBack=function(e){return 0==e?0:1==e?1:(e-=1)*e*(2.70158*e+1.70158)+1},exports.easeInOutBack=function(e){var t;if(0==e)return 0;if(1==e)return 1;t=1.70158;return 1>(e*=2)?.5*e*e*(((t*=1.525)+1)*e-t):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},exports.easeOutBounce=function(e){return 0==e?0:1==e?1:e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},exports.easeInBounce=function(e){return 1-this.easeOutBounce(1-e)},exports.easeInOutBounce=function(e){return.5>e?.5*this.easeInBounce(2*e):.5*this.easeOutBounce(2*e-1)+.5}"),jsio.setCachedSrc("sdk/timestep/ui/backend/debug/FPSView.js",'var viewModes,Graph,sdk_timestep_ui_backend_debug_FPSView;function strokeRect(e,t,n){e.fillStyle=n,e.fillRect(t.x,t.y,1,t.height),e.fillRect(t.x,t.y,t.width,1),e.fillRect(t.x+t.width-1,t.y,1,t.height),e.fillRect(t.x,t.y+t.height-1,t.width,1)}function fillRect(e,t,n){e.fillStyle=n,e.fillRect(t.x,t.y,t.width,t.height)}jsio("import device"),jsio("import lib.Enum as Enum"),jsio("import math.geom.Rect as Rect"),jsio("import math.geom.intersect as intersect"),jsio("import event.input.dispatch as dispatch");viewModes=new Enum("FPS","DT"),Graph=__class__,Graph=Graph(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){var t=device.get("Canvas");this._width=e.width,this._height=e.height,this._maxValue=e.maxValue,this._backgroundColor=e.backgroundColor,this._colors=e.colors,this._axisColor=e.axisColor,this._canvas=new t({width:e.width,height:e.height}),this._ctx=this._canvas.getContext("2d"),this._ctx.fillStyle=e.backgroundColor,this._ctx.fillRect(0,0,e.width,e.height),this._index=this._offset=0},this.addValues=function(e,t){var n=this._ctx,r=this._width,i=this._height,s,o=this._maxValue,u=(this._offset+this._index)%r,a;n.fillStyle=this._backgroundColor,n.fillRect(u,0,2,i);for(a=e.length;a;)s=e[--a],s>o&&(s=o),s=~~(s/o*i),n.fillStyle=this._colors[a],n.fillRect(u,i-s,2,s);n.fillStyle=this._axisColor,t&&n.fillRect(u,0,1,i),n.fillRect(u,25,2,1),n.fillRect(u,50,2,1),n.fillRect(u,75,2,1),this._index<r?this._index+=2:(this._offset+=2,this._offset>=r&&(this._offset=0))},this.render=function(e,t,n){var r=this._offset,i=this._width,s=this._height;0===r?e.drawImage(this._canvas,0,0,i,s,t,n,i,s):(e.drawImage(this._canvas,r,0,i-r,s,t,n,i-r,s),e.drawImage(this._canvas,0,0,r,s,i-r+t,n,r,s))}}),sdk_timestep_ui_backend_debug_FPSView=__class__;exports=sdk_timestep_ui_backend_debug_FPSView(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._application=e.application,this._time=+(new Date)+1e3,this._frames=0,this._fps=20,this._dt=10,this._minimized=!0,this._rectTop=new Rect(1,1,200,16),this._rectMin=new Rect(0,0,24,15),this._rectMax=new Rect(0,0,202,117),this._rect=this._rectMin,this._rectFPS=new Rect(141,1,30,15),this._rectDT=new Rect(171,1,30,15),this._borderColor="rgb(100,100,150)",this._backgroundColor="#17182E",this._textColor="#FFFFFF",this._viewMode=viewModes.DT,this._graphs={},this._graphs[viewModes.FPS]=new Graph({width:200,height:100,maxValue:60,backgroundColor:this._backgroundColor,colors:["rgba(170,170,252,0.3)","rgb(170,170,252)"],axisColor:"#FFFFFF"}),this._graphs[viewModes.DT]=new Graph({width:200,height:100,maxValue:66,backgroundColor:this._backgroundColor,colors:["rgba(255,0,0,0.5)","rgb(254,255,170)"],axisColor:"#FFFFFF"})},this.tick=function(e){var t=+(new Date);t>this._time?(this._time=t+1e3,this._fps=this._frames,this._frames=1):this._frames++,t=this._application.getEvents(),t.length&&this._handleEvents(t),this._dt=.8*this._dt+.2*e;if(!this._minimized)switch(this._viewMode){case viewModes.DT:this._graphs[viewModes.DT].addValues([this._dt,e],1===this._frames);break;case viewModes.FPS:this._graphs[viewModes.FPS].addValues([this._fps,1e3/e],1===this._frames)}},this._handleEvents=function(e){var t,n,r;for(t=dispatch.eventTypes,n=e.length;n;){r=e[--n];switch(r.type){case t.START:intersect.ptAndRect(r.srcPt,this._rect)&&(this._minimized?this._minimized=!1:intersect.ptAndRect(r.srcPt,this._rectFPS)?this._viewMode=viewModes.FPS:intersect.ptAndRect(r.srcPt,this._rectDT)?this._viewMode=viewModes.DT:this._minimized=!0,this._rect=this._minimized?this._rectMin:this._rectMax)}}},this.render=function(e){var t,n;e.save(),e.textBaseline="top",e.textAlign="center",e.font="12px Verdana";if(this._minimized)fillRect(e,this._rect,this._backgroundColor);else{fillRect(e,this._rectTop,this._backgroundColor),this._graphs[this._viewMode].render(e,1,17),e.fillStyle=this._borderColor,e.fillRect(0,16,this._rect.width,1);t=this._viewMode===viewModes.FPS,n=this._viewMode===viewModes.DT;fillRect(e,this._rectFPS,t?this._borderColor:this._backgroundColor),e.fillStyle=t?this._textColor:this._borderColor,e.fillText("FPS",this._rectFPS.x+this._rectFPS.width/2,0),fillRect(e,this._rectDT,n?this._borderColor:this._backgroundColor),e.fillStyle=n?this._textColor:this._borderColor,e.fillText("DT",this._rectDT.x+this._rectDT.width/2,0)}strokeRect(e,this._rect,this._borderColor),e.fillStyle=this._textColor,e.fillText(this._fps,12,0),e.restore()},this.getFPS=function(){return this._fps}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/FontBuffer.js",'var randomColorElement,randomColor,sdk_timestep_platforms_browser_FontBuffer,FontBuffer;jsio("import device");randomColorElement=function(){var e=Math.floor(255*Math.random()).toString(16);return(1===e.length?"0":"")+e},randomColor=function(){return"#"+randomColorElement()+randomColorElement()+randomColorElement()},sdk_timestep_platforms_browser_FontBuffer=__class__,FontBuffer=exports=sdk_timestep_platforms_browser_FontBuffer(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){var e=[{size:24,count:8},{size:32,count:10},{size:64,count:8}],t,n,r,i=0,s,o;this._canvas=document.createElement("canvas"),this._canvas.width=1024,this._canvas.height=1024,this._ctx=this._canvas.getContext("2d"),this._list=[];for(s=0;s<e.length;s++){n=[],t=e[s];for(o=0;o<t.count;o++)r={previous:null,next:null,x:0,y:i,width:1024,height:0,hash:null,frame:0,refresh:!0,ctx:this._ctx},n.push(r),i+=t.size;this._list.push({size:t.size,lines:n})}this._hashMap={},this._currentFrame=0,this._frameTimeout=3,jsio("import ui.Engine").get().subscribe("Tick",this,this._onTick)},this._onTick=function(){this._currentFrame++;var e=this._currentFrame,t=this._frameTimeout,n=this._list,r,i,s,o,u,a;s=0;for(o=n.length;s<o;s++){r=n[s].lines,u=0;for(a=r.length;u<a;u++)for(i=r[u];i;)null===i.hash?i.next&&null===i.next.hash&&(i.width+=i.next.width,i.next=i.next.next):e>i.frame+t&&(this._ctx.fillStyle=randomColor(),this._ctx.fillRect(i.x,i.y,i.width,i.height),delete this._hashMap[i.hash],i.hash=null),i=i.next}},this.alloc=function(e){var t=e.height,n=e.width+3,e=(e.strokeStyle||"")+"_"+(e.fillStyle||"")+"_"+(e.font||"")+"_"+e.text,r=this._list,i=this._hashMap[e],s,o;if(i)return i.frame=this._currentFrame,i.refresh=!1,i;i=0;for(s=r.length;i<s;i++)if(t<=r[i].size){r=r[i].lines,s=0;for(o=r.length;s<o;s++)for(i=r[s];i;){if(n<=i.width&&null===i.hash)return n!==i.width&&(i.next={previous:i,next:i.next,x:i.x+n,y:i.y,width:i.width-n,hash:null,frame:0,ctx:this._ctx}),i.frame=this._currentFrame,i.hash=e,i.width=n,i.height=t,i.refresh=!0,this._ctx.clearRect(i.x,i.y,n,t),this._hashMap[e]=i;i=i.next}break}return!1},this.getCanvas=function(){return this._canvas}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/dev_error.js",'function render(e,t){var r,i;function n(t){e.fillText(t,r,i),i+=20}e.fillStyle="rgb(0, 0, 255)",e.fillRect(0,0,e.canvas.width,e.canvas.height);r=30,i=40;e.fillStyle="#FFF",e.font=\'bold 12px Monaco,"Bitstream Vera Sans Mono","Lucida Console",Terminal,monospace\',n(t.message),i+=40,t.stack.split("\\n").map(n)}exports.render=function(e){var t,n,r;logger.error("unhandled tick exception"),logger.error(e.stack);for(t=document.getElementsByTagName("canvas"),n=0;r=t[n];++n)render(r.getContext("2d"),e)}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/FlashAPI.js",'var soundManager,sdk_timestep_platforms_browser_FlashAPI,AudioAPI;"use import";jsio("import lib.PubSub"),jsio("import .SoundManager"),jsio("from util.underscore import _");soundManager=new SoundManager;soundManager.url="media/swf",soundManager.flashVersion=9,soundManager.useMovieStar=!0,soundManager.debugMode=!1,soundManager.consoleOnly=!0,soundManager.useHighPerformance=!0,soundManager.useFastPolling=!0;sdk_timestep_platforms_browser_FlashAPI=__class__,AudioAPI=exports=sdk_timestep_platforms_browser_FlashAPI(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(e){this.init=function(t){t=merge(t,{map:{},background:[]}),e(this,"init",[t]),this._map={},_.each(t.background,function(e){t.map[e]={name:e}},this),soundManager.onready(bind(this,function(){logger.log("SoundManager onReady");for(key in t.map)logger.log("SoundManager key: ",key),(this._map[key]=soundManager.createSound({id:key,bufferTime:3,url:"media/audio/"+key+".mp3"})).load();this.publish("Ready")}))},this.canPlay=function(e){return e in this._map},this.setVolume=function(e){this._soundPlaying&&soundManager.setVolume(this._soundPlaying,e),this._backgroundSoundPlaying&&soundManager.setVolume(this._backgroundSoundPlaying,e)},this.setMuted=function(e){(this.muted=e)&&this.setVolume(0)},this.play=function(e,t){this.canPlay(e)&&!this.muted&&(void 0===t&&(t=1),this._soundPlaying=e,this._map[e].setVolume(100*t|0),this._map[e].play())},this.pause=function(){this._map[this._soundPlaying].pause(),this._soundPlaying=null},this.playBackgroundMusic=function(e,t){this.canPlay(e)&&!this.muted&&(void 0===t&&(t=1),this._backgroundSoundPlaying=e,this._map[e].setVolume(100*t|0),this._map[e].play())},this.pauseBackgroundMusic=function(){this._backgroundSoundPlaying&&(this._map[this._backgroundSoundPlaying].pause(),this._backgroundSoundPlaying=null)}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/SoundManager.js",'var SoundManager=exports=function(e,t){function n(e){return function(t){return!this._t||!this._t._a?(this._t&&this._t.sID?i._wD(s+"ignoring "+t.type+": "+this._t.sID):i._wD(s+"ignoring "+t.type),null):e.call(this,t)}}this.flashVersion=8,this.debugMode=!0,this.debugFlash=!1,this.useConsole=!0,this.waitForWindowLoad=this.consoleOnly=!1,this.nullURL="about:blank",this.allowPolling=!0,this.useFastPolling=!1,this.useMovieStar=!0,this.bgColor="#ffffff",this.useHighPerformance=!1,this.flashPollingInterval=null,this.flashLoadTimeout=1e3,this.wmode=null,this.allowScriptAccess="always",this.useFlashBlock=!1,this.useHTML5Audio=!0,this.html5Test=/^(probably|maybe)$/i,this.preferFlash=!0,this.audioFormats={mp3:{type:[\'audio/mpeg; codecs="mp3"\',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a"],type:[\'audio/mp4; codecs="mp4a.40.2"\',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},wav:{type:[\'audio/wav; codecs="1"\',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.defaultOptions={autoLoad:!1,stream:!0,autoPlay:!1,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onstop:null,onfailure:null,onfinish:null,onbeforefinish:null,onbeforefinishtime:5e3,onbeforefinishcomplete:null,onjustbeforefinish:null,onjustbeforefinishtime:200,multiShot:!0,multiShotEvents:!1,position:null,pan:0,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.version=null,this.versionNumber="V2.97a.20110801",this.movieURL=null,this.url=e||null,this.altURL=null,this.enabled=this.swfLoaded=!1,this.o=null,this.movieID="sm2-container",this.id=t||"sm2movie",this.swfCSS={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.didFlashBlock=this.specialWmodeCase=!1,this.filePattern=null,this.filePatterns={flash8:/\\.mp3(\\?.*)?$/i,flash9:/\\.mp3(\\?.*)?$/i},this.baseMimeTypes=/^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i,this.netStreamMimeTypes=/^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i,this.netStreamTypes="aac flv mov mp4 m4v f4v m4a mp4v 3gp 3g2".split(" "),this.netStreamPattern=RegExp("\\\\.("+this.netStreamTypes.join("|")+")(\\\\?.*)?$","i"),this.mimePattern=this.baseMimeTypes,this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.hasHTML5="undefined"!=typeof Audio&&"undefined"!=typeof (new Audio).canPlayType,this.html5={usingFlash:null},this.flash={},this.ignoreFlash=this.html5Only=!1;var r,i=this,s="HTML5::",o,u=navigator.userAgent,a=window,f=a.location.href.toString(),l=this.flashVersion,c=document,h,p,d=[],v=!0,m,g=!1,y=!1,b=!1,w=!1,E=!1,S,x=0,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U=["log","info","warn","error"],z,W,X,V=null,$=null,J,K,Q,G,Y,Z,et,tt,nt=!1,rt=!1,it,st,ot=null,ut,at,ft,lt,ct,ht,pt,dt=Array.prototype.slice,vt=!1,mt,gt,yt,bt,wt,Et=u.match(/(ipad|iphone|ipod)/i),St=u.match(/(mobile|pre\\/|xoom)/i)||Et,xt=u.match(/msie/i),Tt=u.match(/webkit/i),Nt=u.match(/safari/i)&&!u.match(/chrome/i),Ct=u.match(/opera/i),kt=!f.match(/usehtml5audio/i)&&!f.match(/sm2\\-ignorebadua/i)&&Nt&&u.match(/OS X 10_6_([3-7])/i),Lt="undefined"!=typeof console&&"undefined"!=typeof console.log,At="undefined"!=typeof c.hasFocus?c.hasFocus():null,Ot=Nt&&"undefined"==typeof c.hasFocus,Mt=!Ot,_t=/(mp3|mp4|mpa)/i,Dt=c.location?c.location.protocol.match(/http/i):null,Pt=Dt?"":"http:";this.useAltURL=!Dt,this._global_a=null,St&&(i.useHTML5Audio=!0,i.preferFlash=!1,Et&&(vt=i.ignoreFlash=!0)),this.supported=this.ok=function(){return ot?b&&!w:i.useHTML5Audio&&i.hasHTML5},this.getMovie=function(e){return xt?a[e]:Nt?o(e)||c[e]:o(e)},this.createSound=function(e){function t(){return n=Y(n),i.sounds[o.id]=new r(o),i.soundIDs.push(o.id),i.sounds[o.id]}var n=null,s=null,o=null;return!b||!i.ok()?(et("soundManager.createSound(): "+J(b?"notOK":"notReady")),!1):(arguments.length===2&&(e={id:arguments[0],url:arguments[1]}),o=n=N(e),o.id.toString().charAt(0).match(/^[0-9]$/)&&i._wD("soundManager.createSound(): "+J("badID",o.id),2),i._wD("soundManager.createSound(): "+o.id+" ("+o.url+")",1),tt(o.id,!0)?(i._wD("soundManager.createSound(): "+o.id+" exists",1),i.sounds[o.id]):(at(o)?(s=t(),i._wD("Loading sound "+o.id+" via HTML5"),s._setup_html5(o)):(l>8&&i.useMovieStar&&(o.isMovieStar===null&&(o.isMovieStar=o.serverURL||o.type&&o.type.match(i.netStreamPattern)||o.url.match(i.netStreamPattern)?!0:!1),o.isMovieStar&&i._wD("soundManager.createSound(): using MovieStar handling"),o.isMovieStar&&(o.usePeakData&&(S("noPeak"),o.usePeakData=!1),o.loops>1&&S("noNSLoop"))),o=Z(o,"soundManager.createSound(): "),s=t(),l===8?i.o._createSound(o.id,o.onjustbeforefinishtime,o.loops||1,o.usePolicyFile):(i.o._createSound(o.id,o.url,o.onjustbeforefinishtime,o.usePeakData,o.useWaveformData,o.useEQData,o.isMovieStar,o.isMovieStar?o.bufferTime:!1,o.loops||1,o.serverURL,o.duration||null,o.autoPlay,!0,o.autoLoad,o.usePolicyFile),o.serverURL||(s.connected=!0,o.onconnect&&o.onconnect.apply(s))),!o.serverURL&&(o.autoLoad||o.autoPlay)&&s.load(o)),!o.serverURL&&o.autoPlay&&s.play(),s))},this.destroySound=function(e,t){if(!tt(e))return!1;var n=i.sounds[e],r;n._iO={},n.stop(),n.unload();for(r=0;r<i.soundIDs.length;r++)if(i.soundIDs[r]===e){i.soundIDs.splice(r,1);break}return t||n.destruct(!0),delete i.sounds[e],!0},this.load=function(e,t){return tt(e)?i.sounds[e].load(t):!1},this.unload=function(e){return tt(e)?i.sounds[e].unload():!1},this.start=this.play=function(e,t){return!b||!i.ok()?(et("soundManager.play(): "+J(b?"notOK":"notReady")),!1):tt(e)?i.sounds[e].play(t):(t instanceof Object||(t={url:t}),t&&t.url?(i._wD(\'soundManager.play(): attempting to create "\'+e+\'"\',1),t.id=e,i.createSound(t).play()):!1)},this.setPosition=function(e,t){return tt(e)?i.sounds[e].setPosition(t):!1},this.stop=function(e){return tt(e)?(i._wD("soundManager.stop("+e+")",1),i.sounds[e].stop()):!1},this.stopAll=function(){var e;i._wD("soundManager.stopAll()",1);for(e in i.sounds)i.sounds.hasOwnProperty(e)&&i.sounds[e].stop()},this.pause=function(e){return tt(e)?i.sounds[e].pause():!1},this.pauseAll=function(){var e;for(e=i.soundIDs.length;e--;)i.sounds[i.soundIDs[e]].pause()},this.resume=function(e){return tt(e)?i.sounds[e].resume():!1},this.resumeAll=function(){var e;for(e=i.soundIDs.length;e--;)i.sounds[i.soundIDs[e]].resume()},this.togglePause=function(e){return tt(e)?i.sounds[e].togglePause():!1},this.setPan=function(e,t){return tt(e)?i.sounds[e].setPan(t):!1},this.setVolume=function(e,t){return tt(e)?i.sounds[e].setVolume(t):!1},this.mute=function(e){var t=0;typeof e!="string"&&(e=null);if(e)return tt(e)?(i._wD(\'soundManager.mute(): Muting "\'+e+\'"\'),i.sounds[e].mute()):!1;i._wD("soundManager.mute(): Muting all sounds");for(t=i.soundIDs.length;t--;)i.sounds[i.soundIDs[t]].mute();return i.muted=!0},this.muteAll=function(){i.mute()},this.unmute=function(e){typeof e!="string"&&(e=null);if(e)return tt(e)?(i._wD(\'soundManager.unmute(): Unmuting "\'+e+\'"\'),i.sounds[e].unmute()):!1;i._wD("soundManager.unmute(): Unmuting all sounds");for(e=i.soundIDs.length;e--;)i.sounds[i.soundIDs[e]].unmute();return i.muted=!1,!0},this.unmuteAll=function(){i.unmute()},this.toggleMute=function(e){return tt(e)?i.sounds[e].toggleMute():!1},this.getMemoryUse=function(){var e=0;return i.o&&l!==8&&(e=parseInt(i.o._getMemoryUse(),10)),e},this.disable=function(e){var t;typeof e=="undefined"&&(e=!1);if(w)return!1;w=!0,S("shutdown",1);for(t=i.soundIDs.length;t--;)z(i.sounds[i.soundIDs[t]]);return T(e),pt.remove(a,"load",L),!0},this.canPlayMIME=function(e){var t;return i.hasHTML5&&(t=ft({type:e})),!ot||t?t:e?e.match(i.mimePattern)?!0:!1:null},this.canPlayURL=function(e){var t;return i.hasHTML5&&(t=ft({url:e})),!ot||t?t:e?e.match(i.filePattern)?!0:!1:null},this.canPlayLink=function(e){return typeof e.type!="undefined"&&e.type&&i.canPlayMIME(e.type)?!0:i.canPlayURL(e.href)},this.getSoundById=function(e,t){if(!e)throw Error("soundManager.getSoundById(): sID is null/undefined");var n=i.sounds[e];return!n&&!t&&i._wD(\'"\'+e+\'" is an invalid sound ID.\',2),n},this.onready=function(e,t){if(e&&e instanceof Function)return b&&i._wD(J("queue","onready")),t||(t=a),C("onready",e,t),k(),!0;throw J("needFunction","onready")},this.ontimeout=function(e,t){if(e&&e instanceof Function)return b&&i._wD(J("queue","ontimeout")),t||(t=a),C("ontimeout",e,t),k({type:"ontimeout"}),!0;throw J("needFunction","ontimeout")},this._wD=this._writeDebug=function(e,t,n){var r,s;if(!i.debugMode)return!1;typeof n!="undefined"&&n&&(e=e+" | "+(new Date).getTime());if(Lt&&i.useConsole){n=U[t],typeof console[n]!="undefined"?console[n](e):console.log(e);if(i.useConsoleOnly)return!0}try{r=o("soundmanager-debug");if(!r)return!1;s=c.createElement("div"),++x%2===0&&(s.className="sm2-alt"),t=typeof t=="undefined"?0:parseInt(t,10),s.appendChild(c.createTextNode(e)),t&&(t>=2&&(s.style.fontWeight="bold"),t===3&&(s.style.color="#ff3333")),r.insertBefore(s,r.firstChild)}catch(u){}return!0},this._debug=function(){var e,t;S("currentObj",1),e=0;for(t=i.soundIDs.length;e<t;e++)i.sounds[i.soundIDs[e]]._debug()},this.reboot=function(){i._wD("soundManager.reboot()"),i.soundIDs.length&&i._wD("Destroying "+i.soundIDs.length+" SMSound objects...");var e,t;for(e=i.soundIDs.length;e--;)i.sounds[i.soundIDs[e]].destruct();try{xt&&($=i.o.innerHTML),V=i.o.parentNode.removeChild(i.o),i._wD("Flash movie removed.")}catch(n){S("badRemove",2)}$=V=ot=null,i.enabled=B=b=nt=rt=g=y=w=i.swfLoaded=!1,i.soundIDs=i.sounds=[],i.o=null;for(e in d)if(d.hasOwnProperty(e))for(t=d[e].length;t--;)d[e][t].fired=!1;i._wD("soundManager: Rebooting..."),a.setTimeout(i.beginDelayedInit,20)},this.getMoviePercent=function(){return i.o&&typeof i.o.PercentLoaded!="undefined"?i.o.PercentLoaded():null},this.beginDelayedInit=function(){E=!0,H(),setTimeout(function(){return rt?!1:(F(),P(),rt=!0)},20),A()},this.destruct=function(){i._wD("soundManager.destruct()"),i.disable(!0)},bt={abort:n(function(){i._wD(s+"abort: "+this._t.sID)}),canplay:n(function(){if(this._t._html5_canplay)return!0;this._t._html5_canplay=!0,i._wD(s+"canplay: "+this._t.sID+", "+this._t.url),this._t._onbufferchange(0);var e=isNaN(this._t.position)?null:this._t.position/1e3;if(this._t.position&&this.currentTime!==e){i._wD(s+"canplay: setting position to "+e);try{this.currentTime=e}catch(t){i._wD(s+"setting position failed: "+t.message,2)}}}),load:n(function(){this._t.loaded||(this._t._onbufferchange(0),this._t._whileloading(this._t.bytesTotal,this._t.bytesTotal,this._t._get_html5_duration()),this._t._onload(!0))}),emptied:n(function(){i._wD(s+"emptied: "+this._t.sID)}),ended:n(function(){i._wD(s+"ended: "+this._t.sID),this._t._onfinish()}),error:n(function(){i._wD(s+"error: "+this.error.code),this._t._onload(!1)}),loadeddata:n(function(){var e=this._t,t=e.bytesTotal||1;i._wD(s+"loadeddata: "+this._t.sID),!e._loaded&&!Nt&&(e.duration=e._get_html5_duration(),e._whileloading(t,t,e._get_html5_duration()),e._onload(!0))}),loadedmetadata:n(function(){i._wD(s+"loadedmetadata: "+this._t.sID)}),loadstart:n(function(){i._wD(s+"loadstart: "+this._t.sID),this._t._onbufferchange(1)}),play:n(function(){i._wD(s+"play: "+this._t.sID+", "+this._t.url),this._t._onbufferchange(0)}),playing:n(function(){i._wD(s+"playing: "+this._t.sID+", "+this._t.url),this._t._onbufferchange(0)}),progress:n(function(e){if(this._t.loaded)return!1;var t,n,r;r=0;var o=e.type==="progress";n=e.target.buffered;var u=e.loaded||0,a=e.total||1;if(n&&n.length){for(t=n.length;t--;)r=n.end(t)-n.start(t);u=r/e.target.duration;if(o&&n.length>1){r=[],n=n.length;for(t=0;t<n;t++)r.push(e.target.buffered.start(t)+"-"+e.target.buffered.end(t));i._wD(s+"progress: timeRanges: "+r.join(", "))}o&&!isNaN(u)&&i._wD(s+"progress: "+this._t.sID+": "+Math.floor(u*100)+"% loaded")}isNaN(u)||(this._t._onbufferchange(0),this._t._whileloading(u,a,this._t._get_html5_duration()),u&&a&&u===a&&bt.load.call(this,e))}),ratechange:n(function(){i._wD(s+"ratechange: "+this._t.sID)}),suspend:n(function(e){i._wD(s+"suspend: "+this._t.sID),bt.progress.call(this,e)}),stalled:n(function(){i._wD(s+"stalled: "+this._t.sID)}),timeupdate:n(function(){this._t._onTimer()}),waiting:n(function(){i._wD(s+"waiting: "+this._t.sID),this._t._onbufferchange(1)})},r=function(e){var t=this,n,r,o;this.sID=e.id,this.url=e.url,this._iO=this.instanceOptions=this.options=N(e),this.pan=this.options.pan,this.volume=this.options.volume,this._lastURL=null,this.isHTML5=!1,this._a=null,this.id3={},this._debug=function(){if(i.debugMode){var e=null,n=[],r,s;for(e in t.options)t.options[e]!==null&&(t.options[e]instanceof Function?(r=t.options[e].toString(),r=r.replace(/\\s\\s+/g," "),s=r.indexOf("{"),n.push(" "+e+": {"+r.substr(s+1,Math.min(Math.max(r.indexOf("\\n")-1,64),64)).replace(/\\n/g,"")+"... }")):n.push(" "+e+": "+t.options[e]));i._wD("SMSound() merged options: {\\n"+n.join(", \\n")+"\\n}")}},this._debug(),this.load=function(e){var n=null;typeof e!="undefined"?(t._iO=N(e,t.options),t.instanceOptions=t._iO):(e=t.options,t._iO=e,t.instanceOptions=t._iO,t._lastURL&&t._lastURL!==t.url&&(S("manURL"),t._iO.url=t.url,t.url=null)),t._iO.url||(t._iO.url=t.url),i._wD("SMSound.load(): "+t._iO.url,1);if(t._iO.url===t.url&&t.readyState!==0&&t.readyState!==2)return S("onURL",1),t;t._lastURL=t.url,t.loaded=!1,t.readyState=1,t.playState=0;if(at(t._iO))n=t._setup_html5(t._iO),n._called_load?i._wD(s+"ignoring request to load again: "+t.sID):(i._wD(s+"load: "+t.sID),t._html5_canplay=!1,n.load(),n._called_load=!0,t._iO.autoPlay&&t.play());else try{t.isHTML5=!1,t._iO=Z(Y(t._iO)),l===8?i.o._load(t.sID,t._iO.url,t._iO.stream,t._iO.autoPlay,t._iO.whileloading?1:0,t._iO.loops||1,t._iO.usePolicyFile):i.o._load(t.sID,t._iO.url,t._iO.stream?!0:!1,t._iO.autoPlay?!0:!1,t._iO.loops||1,t._iO.autoLoad?!0:!1,t._iO.usePolicyFile)}catch(r){S("smError",2),m("onload",!1),I({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}return t},this.unload=function(){return t.readyState!==0&&(i._wD(\'SMSound.unload(): "\'+t.sID+\'"\'),t.isHTML5?(r(),t._a&&(t._a.pause(),t._a.src="")):l===8?i.o._unload(t.sID,i.nullURL):i.o._unload(t.sID),n()),t},this.destruct=function(e){i._wD(\'SMSound.destruct(): "\'+t.sID+\'"\'),t.isHTML5?(r(),t._a&&(t._a.pause(),t._a.src="",vt||t._remove_html5_events(),t._a._t=null,t._a=null)):(t._iO.onfailure=null,i.o._destroySound(t.sID)),e||i.destroySound(t.sID,!0)},this.start=this.play=function(e,n){var r,n=n===void 0?!0:n;e||(e={}),t._iO=N(e,t._iO),t._iO=N(t._iO,t.options),t.instanceOptions=t._iO;if(t._iO.serverURL&&!t.connected)return t.getAutoPlay()||(i._wD("SMSound.play():  Netstream not connected yet - setting autoPlay"),t.setAutoPlay(!0)),t;at(t._iO)&&(t._setup_html5(t._iO),o());if(t.playState===1&&!t.paused){if(!(r=t._iO.multiShot))return i._wD(\'SMSound.play(): "\'+t.sID+\'" already playing (one-shot)\',1),t;i._wD(\'SMSound.play(): "\'+t.sID+\'" already playing (multi-shot)\',1)}if(t.loaded)i._wD(\'SMSound.play(): "\'+t.sID+\'"\');else if(t.readyState===0)i._wD(\'SMSound.play(): Attempting to load "\'+t.sID+\'"\',1),t.isHTML5||(t._iO.autoPlay=!0),t.load(t._iO);else{if(t.readyState===2)return i._wD(\'SMSound.play(): Could not load "\'+t.sID+\'" - exiting\',2),t;i._wD(\'SMSound.play(): "\'+t.sID+\'" is loading - attempting to play..\',1)}return!t.isHTML5&&l===9&&t.position>0&&t.position===t.duration&&(i._wD(\'SMSound.play(): "\'+t.sID+\'": Sound at end, resetting to position:0\'),t._iO.position=0),t.paused&&t.position&&t.position>0?(i._wD(\'SMSound.play(): "\'+t.sID+\'" is resuming from paused state\',1),t.resume()):(i._wD(\'SMSound.play(): "\'+t.sID+\'" is starting to play\'),t.playState=1,t.paused=!1,(!t.instanceCount||t._iO.multiShotEvents||!t.isHTML5&&l>8&&!t.getAutoPlay())&&t.instanceCount++,t.position=typeof t._iO.position!="undefined"&&!isNaN(t._iO.position)?t._iO.position:0,t.isHTML5||(t._iO=Z(Y(t._iO))),t._iO.onplay&&n&&(t._iO.onplay.apply(t),t._onplay_called=!0),t.setVolume(t._iO.volume,!0),t.setPan(t._iO.pan,!0),t.isHTML5?(o(),r=t._setup_html5(),t.setPosition(t._iO.position),r.play()):i.o._start(t.sID,t._iO.loops||1,l===9?t._iO.position:t._iO.position/1e3)),t},this.stop=function(e){return t.playState===1&&(t._onbufferchange(0),t.resetOnPosition(0),t.isHTML5||(t.playState=0),t.paused=!1,t._iO.onstop&&t._iO.onstop.apply(t),t.isHTML5?t._a&&(t.setPosition(0),t._a.pause(),t.playState=0,t._onTimer(),r(),t.unload()):(i.o._stop(t.sID,e),t._iO.serverURL&&t.unload()),t.instanceCount=0,t._iO={}),t},this.setAutoPlay=function(e){i._wD("sound "+t.sID+" turned autoplay "+(e?"on":"off")),t._iO.autoPlay=e,t.isHTML5||(i.o._setAutoPlay(t.sID,e),e&&!t.instanceCount&&t.readyState===1&&(t.instanceCount++,i._wD("sound "+t.sID+" incremented instance count to "+t.instanceCount)))},this.getAutoPlay=function(){return t._iO.autoPlay},this.setPosition=function(e){e===void 0&&(e=0);var n=t.isHTML5?Math.max(e,0):Math.min(t.duration||t._iO.duration,Math.max(e,0));t.position=n,e=t.position/1e3,t.resetOnPosition(t.position),t._iO.position=n;if(t.isHTML5){if(t._a)if(t._html5_canplay){if(t._a.currentTime!==e){i._wD("setPosition("+e+"): setting position");try{t._a.currentTime=e,(t.playState===0||t.paused)&&t._a.pause()}catch(r){i._wD("setPosition("+e+"): setting position failed: "+r.message,2)}}}else i._wD("setPosition("+e+"): delaying, sound not ready")}else e=l===9?t.position:e,t.readyState&&t.readyState!==2&&i.o._setPosition(t.sID,e,t.paused||!t.playState);return t.isHTML5&&t.paused&&t._onTimer(!0),t},this.pause=function(e){return t.paused||t.playState===0&&t.readyState!==1?t:(i._wD("SMSound.pause()"),t.paused=!0,t.isHTML5?(t._setup_html5().pause(),r()):(e||e===void 0)&&i.o._pause(t.sID),t._iO.onpause&&t._iO.onpause.apply(t),t)},this.resume=function(){return t.paused?(i._wD("SMSound.resume()"),t.paused=!1,t.playState=1,t.isHTML5?(t._setup_html5().play(),o()):(t._iO.isMovieStar&&t.setPosition(t.position),i.o._pause(t.sID)),!t._onplay_called&&t._iO.onplay?(t._iO.onplay.apply(t),t._onplay_called=!0):t._iO.onresume&&t._iO.onresume.apply(t),t):t},this.togglePause=function(){return i._wD("SMSound.togglePause()"),t.playState===0?(t.play({position:l===9&&!t.isHTML5?t.position:t.position/1e3}),t):(t.paused?t.resume():t.pause(),t)},this.setPan=function(e,n){return typeof e=="undefined"&&(e=0),typeof n=="undefined"&&(n=!1),t.isHTML5||i.o._setPan(t.sID,e),t._iO.pan=e,n||(t.pan=e,t.options.pan=e),t},this.setVolume=function(e,n){return typeof e=="undefined"&&(e=100),typeof n=="undefined"&&(n=!1),t.isHTML5?t._a&&(t._a.volume=Math.max(0,Math.min(1,e/100))):i.o._setVolume(t.sID,i.muted&&!t.muted||t.muted?0:e),t._iO.volume=e,n||(t.volume=e,t.options.volume=e),t},this.mute=function(){return t.muted=!0,t.isHTML5?t._a&&(t._a.muted=!0):i.o._setVolume(t.sID,0),t},this.unmute=function(){t.muted=!1;var e=typeof t._iO.volume!="undefined";return t.isHTML5?t._a&&(t._a.muted=!1):i.o._setVolume(t.sID,e?t._iO.volume:t.options.volume),t},this.toggleMute=function(){return t.muted?t.unmute():t.mute()},this.onposition=function(e,n,r){return t._onPositionItems.push({position:e,method:n,scope:typeof r!="undefined"?r:t,fired:!1}),t},this.processOnPosition=function(){var e,n;e=t._onPositionItems.length;if(!e||!t.playState||t._onPositionFired>=e)return!1;for(;e--;)n=t._onPositionItems[e],!n.fired&&t.position>=n.position&&(n.method.apply(n.scope,[n.position]),n.fired=!0,i._onPositionFired++);return!0},this.resetOnPosition=function(e){var n,r;n=t._onPositionItems.length;if(!n)return!1;for(;n--;)r=t._onPositionItems[n],r.fired&&e<=r.position&&(r.fired=!1,i._onPositionFired--);return!0},o=function(){t.isHTML5&&it(t)},r=function(){t.isHTML5&&st(t)},n=function(){t._onPositionItems=[],t._onPositionFired=0,t._hasTimer=null,t._onplay_called=!1,t._a=null,t._html5_canplay=!1,t.bytesLoaded=null,t.bytesTotal=null,t.position=null,t.duration=t._iO&&t._iO.duration?t._iO.duration:null,t.durationEstimate=null,t.failures=0,t.loaded=!1,t.playState=0,t.paused=!1,t.readyState=0,t.muted=!1,t.didBeforeFinish=!1,t.didJustBeforeFinish=!1,t.isBuffering=!1,t.instanceOptions={},t.instanceCount=0,t.peakData={left:0,right:0},t.waveformData={left:[],right:[]},t.eqData=[],t.eqData.left=[],t.eqData.right=[]},n(),this._onTimer=function(e){var n={};if(t._hasTimer||e)return t._a&&(e||(t.playState>0||t.readyState===1)&&!t.paused)?(t.duration=t._get_html5_duration(),t.durationEstimate=t.duration,e=t._a.currentTime?t._a.currentTime*1e3:0,t._whileplaying(e,n,n,n,n),!0):(i._wD(\'_onTimer: Warn for "\'+t.sID+\'": \'+(t._a?"":"Could not find element. ")+(t.playState===0?"playState bad, 0?":"playState = "+t.playState+", OK")),!1)},this._get_html5_duration=function(){var e=t._a?t._a.duration*1e3:t._iO?t._iO.duration:void 0;return e&&!isNaN(e)&&e!==Infinity?e:t._iO?t._iO.duration:null},this._setup_html5=function(e){var e=N(t._iO,e),r=vt?i._global_a:t._a,s=decodeURI(e.url),o=r&&r._t?r._t.instanceOptions:null;if(r){if(r._t&&o.url===e.url&&(!t._lastURL||t._lastURL===o.url))return r;i._wD("setting new URL on existing object: "+s+(t._lastURL?", old URL: "+t._lastURL:"")),vt&&r._t&&r._t.playState&&e.url!==o.url&&r._t.stop(),n(),r.src=e.url,t.url=e.url,t._lastURL=e.url,r._called_load=!1}else i._wD("creating HTML5 Audio() element with URL: "+s),r=new Audio(e.url),r._called_load=!1,vt&&(i._global_a=r);return t.isHTML5=!0,t._a=r,r._t=t,t._add_html5_events(),r.loop=e.loops>1?"loop":"",e.autoLoad||e.autoPlay?(r.autobuffer="auto",r.preload="auto",t.load(),r._called_load=!0):(r.autobuffer=!1,r.preload="none"),r.loop=e.loops>1?"loop":"",r},this._add_html5_events=function(){if(t._a._added_events)return!1;var e;i._wD(s+"adding event listeners: "+t.sID),t._a._added_events=!0;for(e in bt)bt.hasOwnProperty(e)&&t._a&&t._a.addEventListener(e,bt[e],!1);return!0},this._remove_html5_events=function(){var e;i._wD(s+"removing event listeners: "+t.sID),t._a._added_events=!1;for(e in bt)bt.hasOwnProperty(e)&&t._a&&t._a.removeEventListener(e,bt[e],!1)},this._onload=function(e){return e=e?!0:!1,i._wD(\'SMSound._onload(): "\'+t.sID+\'"\'+(e?" loaded.":" failed to load? - "+t.url),e?1:2),!e&&!t.isHTML5&&(i.sandbox.noRemote===!0&&i._wD("SMSound._onload(): "+J("noNet"),1),i.sandbox.noLocal===!0&&i._wD("SMSound._onload(): "+J("noLocal"),1)),t.loaded=e,t.readyState=e?3:2,t._onbufferchange(0),t._iO.onload&&t._iO.onload.apply(t,[e]),!0},this._onbufferchange=function(e){return t.playState===0||e&&t.isBuffering||!e&&!t.isBuffering?!1:(t.isBuffering=e===1,t._iO.onbufferchange&&(i._wD("SMSound._onbufferchange(): "+e),t._iO.onbufferchange.apply(t)),!0)},this._onfailure=function(e,n,r){t.failures++,i._wD(\'SMSound._onfailure(): "\'+t.sID+\'" count \'+t.failures),t._iO.onfailure&&t.failures===1?t._iO.onfailure(t,e,n,r):i._wD("SMSound._onfailure(): ignoring")},this._onbeforefinish=function(){t.didBeforeFinish||(t.didBeforeFinish=!0,t._iO.onbeforefinish&&(i._wD(\'SMSound._onbeforefinish(): "\'+t.sID+\'"\'),t._iO.onbeforefinish.apply(t)))},this._onjustbeforefinish=function(){t.didJustBeforeFinish||(t.didJustBeforeFinish=!0,t._iO.onjustbeforefinish&&(i._wD(\'SMSound._onjustbeforefinish(): "\'+t.sID+\'"\'),t._iO.onjustbeforefinish.apply(t)))},this._onfinish=function(){var e=t._iO.onfinish;t._onbufferchange(0),t.resetOnPosition(0),t._iO.onbeforefinishcomplete&&t._iO.onbeforefinishcomplete.apply(t),t.didBeforeFinish=!1,t.didJustBeforeFinish=!1,t.instanceCount&&(t.instanceCount--,t.instanceCount||(t.playState=0,t.paused=!1,t.instanceCount=0,t.instanceOptions={},t._iO={},r()),(!t.instanceCount||t._iO.multiShotEvents)&&e&&(i._wD(\'SMSound._onfinish(): "\'+t.sID+\'"\'),e.apply(t)))},this._whileloading=function(e,n,r,i){t.bytesLoaded=e,t.bytesTotal=n,t.duration=Math.floor(r),t.bufferLength=i,t._iO.isMovieStar?t.durationEstimate=t.duration:(t.durationEstimate=t._iO.duration?t.duration>t._iO.duration?t.duration:t._iO.duration:parseInt(t.bytesTotal/t.bytesLoaded*t.duration,10),t.durationEstimate===void 0&&(t.durationEstimate=t.duration)),t.readyState!==3&&t._iO.whileloading&&t._iO.whileloading.apply(t)},this._whileplaying=function(e,n,r,s,o){return isNaN(e)||e===null?!1:(t.position=e,t.processOnPosition(),!t.isHTML5&&l>8&&(t._iO.usePeakData&&typeof n!="undefined"&&n&&(t.peakData={left:n.leftPeak,right:n.rightPeak}),t._iO.useWaveformData&&typeof r!="undefined"&&r&&(t.waveformData={left:r.split(","),right:s.split(",")}),t._iO.useEQData&&typeof o!="undefined"&&o&&o.leftEQ&&(e=o.leftEQ.split(","),t.eqData=e,t.eqData.left=e,typeof o.rightEQ!="undefined"&&o.rightEQ&&(t.eqData.right=o.rightEQ.split(",")))),t.playState===1&&(!t.isHTML5&&i.flashVersion===8&&!t.position&&t.isBuffering&&t._onbufferchange(0),t._iO.whileplaying&&t._iO.whileplaying.apply(t),(t.loaded||!t.loaded&&t._iO.isMovieStar)&&t._iO.onbeforefinish&&t._iO.onbeforefinishtime&&!t.didBeforeFinish&&t.duration-t.position<=t._iO.onbeforefinishtime&&t._onbeforefinish()),!0)},this._onid3=function(e,n){i._wD(\'SMSound._onid3(): "\'+this.sID+\'" ID3 data received.\');var r=[],s,o;s=0;for(o=e.length;s<o;s++)r[e[s]]=n[s];t.id3=N(t.id3,r),t._iO.onid3&&t._iO.onid3.apply(t)},this._onconnect=function(e){e=e===1,i._wD(\'SMSound._onconnect(): "\'+t.sID+\'"\'+(e?" connected.":" failed to connect? - "+t.url),e?1:2);if(t.connected=e)t.failures=0,tt(t.sID)&&(t.getAutoPlay()?t.play(void 0,t.getAutoPlay()):t._iO.autoLoad&&t.load()),t._iO.onconnect&&t._iO.onconnect.apply(t,[e])},this._ondataerror=function(e){t.playState>0&&(i._wD("SMSound._ondataerror(): "+e),t._iO.ondataerror&&t._iO.ondataerror.apply(t))}},j=function(){return c.body||c._docElement||c.getElementsByTagName("div")[0]},o=function(e){return c.getElementById(e)},N=function(e,t){var n={},r,s;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);r=typeof t=="undefined"?i.defaultOptions:t;for(s in r)r.hasOwnProperty(s)&&typeof n[s]=="undefined"&&(n[s]=r[s]);return n},pt=function(){function e(e){var e=dt.call(e),t=e.length;return n?(e[1]="on"+e[1],t>3&&e.pop()):t===3&&e.push(!1),e}function t(e,t){var i=e.shift(),s=[r[t]];n?i[s](e[0],e[1]):i[s].apply(i,e)}var n=a.attachEvent,r={add:n?"attachEvent":"addEventListener",remove:n?"detachEvent":"removeEventListener"};return{add:function(){t(e(arguments),"add")},remove:function(){t(e(arguments),"remove")}}}(),at=function(e){return!e.serverURL&&(e.type?ft({type:e.type}):ft({url:e.url})||i.html5Only)},ft=function(e){function t(e){return i.preferFlash&&mt&&!i.ignoreFlash&&typeof i.flash[e]!="undefined"&&i.flash[e]}if(!i.useHTML5Audio||!i.hasHTML5)return!1;var n=e.url||null,e=e.type||null,r=i.audioFormats,s;if(e&&i.html5[e]!=="undefined")return i.html5[e]&&!t(e);if(!lt){lt=[];for(s in r)r.hasOwnProperty(s)&&(lt.push(s),r[s].related&&(lt=lt.concat(r[s].related)));lt=RegExp("\\\\.("+lt.join("|")+")(\\\\?.*)?$","i")}s=n?n.toLowerCase().match(lt):null;if(!s||!s.length){if(!e)return!1;n=e.indexOf(";"),s=(n!==-1?e.substr(0,n):e).substr(6)}else s=s[1];return s&&typeof i.html5[s]!="undefined"?i.html5[s]&&!t(s):(e="audio/"+s,n=i.html5.canPlayType({type:e}),(i.html5[s]=n)&&i.html5[e]&&!t(e))},ht=function(){function e(e){var n,r,s=!1;if(!t||typeof t.canPlayType!="function")return!1;if(e instanceof Array){n=0;for(r=e.length;n<r&&!s;n++)if(i.html5[e[n]]||t.canPlayType(e[n]).match(i.html5Test))s=!0,i.html5[e[n]]=!0,i.flash[e[n]]=!(!i.preferFlash||!mt||!e[n].match(_t));return s}return e=t&&typeof t.canPlayType=="function"?t.canPlayType(e):!1,!!e&&!!e.match(i.html5Test)}if(!i.useHTML5Audio||typeof Audio=="undefined")return!1;var t=typeof Audio!="undefined"?Ct?new Audio(null):new Audio:null,n,r={},s,o;s=i.audioFormats;for(n in s)if(s.hasOwnProperty(n)){r[n]=e(s[n].type),r["audio/"+n]=r[n],i.flash[n]=i.preferFlash&&!i.ignoreFlash&&n.match(_t)?!0:!1;if(s[n]&&s[n].related)for(o=s[n].related.length;o--;)r["audio/"+s[n].related[o]]=r[n],i.html5[s[n].related[o]]=r[n],i.flash[s[n].related[o]]=r[n]}return r.canPlayType=t?e:null,i.html5=N(i.html5,r),!0},D={notReady:"Not loaded yet - wait for soundManager.onload()/onready()",notOK:"Audio support is not available.",domError:"soundManager::createMovie(): appendChild/innerHTML call failed. DOM not ready or other error.",spcWmode:"soundManager::createMovie(): Removing wmode, preventing known SWF loading issue(s)",swf404:"soundManager: Verify that %s is a valid path.",tryDebug:"Try soundManager.debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:"soundManager: Non-HTTP page ("+c.location.protocol+" URL?) Review Flash player security settings for this special case:\\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:"soundManager: Special case: Waiting for focus-related event..",waitImpatient:"soundManager: Getting impatient, still waiting for Flash%s...",waitForever:"soundManager: Waiting indefinitely for Flash (will recover if unblocked)...",needFunction:"soundManager: Function object expected for %s",badID:\'Warning: Sound ID "%s" should be a string, starting with a non-numeric character\',noMS:"MovieStar mode not enabled. Exiting.",currentObj:"--- soundManager._debug(): Current sound objects ---",waitEI:"soundManager::initMovie(): Waiting for ExternalInterface call from Flash..",waitOnload:"soundManager: Waiting for window.onload()",docLoaded:"soundManager: Document already loaded",onload:"soundManager::initComplete(): calling soundManager.onload()",onloadOK:"soundManager.onload() complete",init:"soundManager::init()",didInit:"soundManager::init(): Already called?",flashJS:"soundManager: Attempting to call Flash from JS..",noPolling:"soundManager: Polling (whileloading()/whileplaying() support) is disabled.",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:"Warning: Failed to remove flash movie.",noPeak:"Warning: peakData features unsupported for movieStar formats",shutdown:"soundManager.disable(): Shutting down",queue:"soundManager: Queueing %s handler",smFail:"soundManager: Failed to initialise.",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+i.swfCSS.swfTimedout+" CSS..",fbLoaded:"Flash loaded",fbHandler:"soundManager::flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:"soundManager.load(): current URL already assigned.",badFV:\'soundManager.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.\',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",mfOn:"mobileFlash::enabling on-screen flash repositioning",policy:"Enabling usePolicyFile for data access"},J=function(){var e=dt.call(arguments),t=e.shift(),t=D&&D[t]?D[t]:"",n,r;if(t&&e&&e.length){n=0;for(r=e.length;n<r;n++)t=t.replace("%s",e[n])}return t},Y=function(e){return l===8&&e.loops>1&&e.stream&&(S("as2loop"),e.stream=!1),e},Z=function(e,t){return e&&!e.usePolicyFile&&(e.onid3||e.usePeakData||e.useWaveformData||e.useEQData)&&(i._wD((t||"")+J("policy")),e.usePolicyFile=!0),e},et=function(e){typeof console!="undefined"&&typeof console.warn!="undefined"?console.warn(e):i._wD(e)},h=function(){return!1},z=function(e){for(var t in e)e.hasOwnProperty(t)&&typeof e[t]=="function"&&(e[t]=h)},W=function(e){typeof e=="undefined"&&(e=!1);if(w||e)S("smFail",2),i.disable(e)},X=function(e){var t=null;if(e)if(e.match(/\\.swf(\\?.*)?$/i)){if(t=e.substr(e.toLowerCase().lastIndexOf(".swf?")+4))return e}else e.lastIndexOf("/")!==e.length-1&&(e+="/");return(e&&e.lastIndexOf("/")!==-1?e.substr(0,e.lastIndexOf("/")+1):"./")+i.movieURL},M=function(){l!==8&&l!==9&&(i._wD(J("badFV",l,8)),i.flashVersion=8);var e=i.debugMode||i.debugFlash?"_debug.swf":".swf";i.useHTML5Audio&&!i.html5Only&&i.audioFormats.mp4.required&&i.flashVersion<9&&(i._wD(J("needfl9")),i.flashVersion=9),l=i.flashVersion,i.version=i.versionNumber+(i.html5Only?" (HTML5-only mode)":l===9?" (AS3/Flash 9)":" (AS2/Flash 8)"),l>8&&(i.defaultOptions=N(i.defaultOptions,i.flash9Options),i.features.buffering=!0),l>8&&i.useMovieStar?(i.defaultOptions=N(i.defaultOptions,i.movieStarOptions),i.filePatterns.flash9=RegExp("\\\\.(mp3|"+i.netStreamTypes.join("|")+")(\\\\?.*)?$","i"),i.mimePattern=i.netStreamMimeTypes,i.features.movieStar=!0):(i.useMovieStar=!1,i.features.movieStar=!1),i.filePattern=i.filePatterns[l!==8?"flash9":"flash8"],i.movieURL=(l===8?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",e),i.features.peakData=i.features.waveformData=i.features.eqData=l>8},q=function(e,t){if(!i.o||!i.allowPolling)return!1;i.o._setPolling(e,t)},R=function(){i.debugURLParam.test(f)&&(i.debugMode=!0);if(o(i.debugID))return!1;var e,t,n,r;if(i.debugMode&&!o(i.debugID)&&(!Lt||!i.useConsole||i.useConsole&&Lt&&!i.consoleOnly)){e=c.createElement("div"),e.id=i.debugID+"-toggle",t={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},e.appendChild(c.createTextNode("-")),e.onclick=G,e.title="Toggle SM2 debug console",u.match(/msie 6/i)&&(e.style.position="absolute",e.style.cursor="hand");for(r in t)t.hasOwnProperty(r)&&(e.style[r]=t[r]);t=c.createElement("div"),t.id=i.debugID,t.style.display=i.debugMode?"block":"none";if(i.debugMode&&!o(e.id)){try{n=j(),n.appendChild(e)}catch(s){throw Error(J("domError")+" \\n"+s.toString())}n.appendChild(t)}}},tt=this.getSoundById,S=function(e,t){return e?i._wD(J(e),t):""},f.indexOf("sm2-debug=alert")+1&&i.debugMode&&(i._wD=function(e){window.alert(e)}),G=function(){var e=o(i.debugID),t=o(i.debugID+"-toggle");if(!e)return!1;v?(t.innerHTML="+",e.style.display="none"):(t.innerHTML="-",e.style.display="block"),v=!v},m=function(e,t,n){if(typeof sm2Debugger!="undefined")try{sm2Debugger.handleEvent(e,t,n)}catch(r){}return!0},Q=function(){var e=[];return i.debugMode&&e.push(i.swfCSS.sm2Debug),i.debugFlash&&e.push(i.swfCSS.flashDebug),i.useHighPerformance&&e.push(i.swfCSS.highPerf),e.join(" ")},K=function(){var e=J("fbHandler"),t=i.getMoviePercent(),n=i.swfCSS,r={type:"FLASHBLOCK"};if(i.html5Only)return!1;i.ok()?(i.didFlashBlock&&i._wD(e+": Unblocked"),i.oMC&&(i.oMC.className=[Q(),n.swfDefault,n.swfLoaded+(i.didFlashBlock?" "+n.swfUnblocked:"")].join(" "))):(ot&&(i.oMC.className=Q()+" "+n.swfDefault+" "+(t===null?n.swfTimedout:n.swfError),i._wD(e+": "+J("fbTimeout")+(t?" ("+J("fbLoaded")+")":""))),i.didFlashBlock=!0,k({type:"ontimeout",ignoreInit:!0,error:r}),I(r))},C=function(e,t,n){typeof d[e]=="undefined"&&(d[e]=[]),d[e].push({method:t,scope:n||null,fired:!1})},k=function(e){e||(e={type:"onready"});if(!b&&e&&!e.ignoreInit||e.type==="ontimeout"&&i.ok())return!1;var t={success:e&&e.ignoreInit?i.ok():!w},n=e&&e.type?d[e.type]||[]:[],r=[],s,o=[t],u=ot&&i.useFlashBlock&&!i.ok();e.error&&(o[0].error=e.error),t=0;for(s=n.length;t<s;t++)n[t].fired!==!0&&r.push(n[t]);if(r.length){i._wD("soundManager: Firing "+r.length+" "+e.type+"() item"+(r.length===1?"":"s")),t=0;for(s=r.length;t<s;t++)r[t].scope?r[t].method.apply(r[t].scope,o):r[t].method.apply(this,o),u||(r[t].fired=!0)}return!0},L=function(){a.setTimeout(function(){i.useFlashBlock&&K(),k(),i.onload instanceof Function&&(S("onload",1),i.onload.apply(a),S("onloadOK",1)),i.waitForWindowLoad&&pt.add(a,"load",L)},1)},gt=function(){if(mt!==void 0)return mt;var e=!1,t=navigator,n=t.plugins,r,i=a.ActiveXObject;if(n&&n.length)(t=t.mimeTypes)&&t["application/x-shockwave-flash"]&&t["application/x-shockwave-flash"].enabledPlugin&&t["application/x-shockwave-flash"].enabledPlugin.description&&(e=!0);else if(typeof i!="undefined"){try{r=new i("ShockwaveFlash.ShockwaveFlash")}catch(s){}e=!!r}return mt=e},ut=function(){var e,t;if(u.match(/iphone os (1|2|3_0|3_1)/i))return i.hasHTML5=!1,i.html5Only=!0,i.oMC&&(i.oMC.style.display="none"),!1;if(!i.useHTML5Audio)return!0;if(!i.html5||!i.html5.canPlayType)return i._wD("SoundManager: No HTML5 Audio() support detected."),i.hasHTML5=!1,!0;i.hasHTML5=!0;if(kt){i._wD("soundManager::Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(mt?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1);if(gt())return!0}for(t in i.audioFormats)i.audioFormats.hasOwnProperty(t)&&(i.audioFormats[t].required&&!i.html5.canPlayType(i.audioFormats[t].type)||i.flash[t]||i.flash[i.audioFormats[t].type])&&(e=!0);return i.ignoreFlash&&(e=!1),i.html5Only=i.hasHTML5&&i.useHTML5Audio&&!e,!i.html5Only},it=function(e){e._hasTimer||(e._hasTimer=!0)},st=function(e){e._hasTimer&&(e._hasTimer=!1)},I=function(e){e=typeof e!="undefined"?e:{},i.onerror instanceof Function&&i.onerror.apply(a,[{type:typeof e.type!="undefined"?e.type:null}]),typeof e.fatal!="undefined"&&e.fatal&&i.disable()},yt=function(){if(!kt||!gt())return!1;var e=i.audioFormats,t,n;for(n in e)if(e.hasOwnProperty(n)&&(n==="mp3"||n==="mp4")){i._wD("soundManager: Using flash fallback for "+n+" format"),i.html5[n]=!1;if(e[n]&&e[n].related)for(t=e[n].related.length;t--;)i.html5[e[n].related[t]]=!1}},this._setSandboxType=function(e){var t=i.sandbox;t.type=e,t.description=t.types[typeof t.types[e]!="undefined"?e:"unknown"],i._wD("Flash security sandbox type: "+t.type),t.type==="localWithFile"?(t.noRemote=!0,t.noLocal=!1,S("secNote",2)):t.type==="localWithNetwork"?(t.noRemote=!1,t.noLocal=!0):t.type==="localTrusted"&&(t.noRemote=!1,t.noLocal=!1)},this._externalInterfaceOK=function(e){if(i.swfLoaded)return!1;var t=(new Date).getTime();i._wD("soundManager::externalInterfaceOK()"+(e?" (~"+(t-e)+" ms)":"")),m("swf",!0),m("flashtojs",!0),i.swfLoaded=!0,Ot=!1,kt&&yt(),xt?setTimeout(p,100):p()},F=function(e,t){function n(){i._wD("-- SoundManager 2 "+i.version+(!i.html5Only&&i.useHTML5Audio?i.hasHTML5?" + HTML5 audio":", no HTML5 audio support":"")+(i.html5Only?"":(i.useMovieStar?", MovieStar mode":"")+(i.useHighPerformance?", high performance mode, ":", ")+((i.flashPollingInterval?"custom ("+i.flashPollingInterval+"ms)":i.useFastPolling?"fast":"normal")+" polling")+(i.wmode?", wmode: "+i.wmode:"")+(i.debugFlash?", flash debug mode":"")+(i.useFlashBlock?", flashBlock mode":""))+" --",1)}function r(e,t){return\'<param name="\'+e+\'" value="\'+t+\'" />\'}if(g&&y)return!1;if(i.html5Only)return M(),n(),i.oMC=o(i.movieID),p(),y=g=!0,!1;var s=t||i.url,a=i.altURL||s,f;f=j();var l,h,d=Q(),v,m=null,m=(m=c.getElementsByTagName("html")[0])&&m.dir&&m.dir.match(/rtl/i),e=typeof e=="undefined"?i.id:e;M(),i.url=X(Dt?s:a),t=i.url,i.wmode=!i.wmode&&i.useHighPerformance&&!i.useMovieStar?"transparent":i.wmode,i.wmode!==null&&(u.match(/msie 8/i)||!xt&&!i.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(i.specialWmodeCase=!0,S("spcWmode"),i.wmode=null),f={name:e,id:e,src:t,width:"auto",height:"auto",quality:"high",allowScriptAccess:i.allowScriptAccess,bgcolor:i.bgColor,pluginspage:Pt+"//www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:i.wmode,hasPriority:"true"},i.debugFlash&&(f.FlashVars="debug=1"),i.wmode||delete f.wmode;if(xt)s=c.createElement("div"),h=[\'<object id="\'+e+\'" data="\'+t+\'" type="\'+f.type+\'" title="\'+f.title+\'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="\'+Pt+\'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" width="\'+f.width+\'" height="\'+f.height+\'">\',r("movie",t),r("AllowScriptAccess",i.allowScriptAccess),r("quality",f.quality),i.wmode?r("wmode",i.wmode):"",r("bgcolor",i.bgColor),r("hasPriority","true"),i.debugFlash?r("FlashVars",f.FlashVars):"","</object>"].join("");else{s=c.createElement("embed");for(l in f)f.hasOwnProperty(l)&&s.setAttribute(l,f[l])}R(),d=Q();if(f=j()){i.oMC=o(i.movieID)||c.createElement("div");if(i.oMC.id)v=i.oMC.className,i.oMC.className=(v?v+" ":i.swfCSS.swfDefault)+(d?" "+d:""),i.oMC.appendChild(s),xt&&(l=i.oMC.appendChild(c.createElement("div")),l.className=i.swfCSS.swfBox,l.innerHTML=h),y=!0;else{i.oMC.id=i.movieID,i.oMC.className=i.swfCSS.swfDefault+" "+d,l=d=null,i.useFlashBlock||(i.useHighPerformance?d={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(d={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},m&&(d.left=Math.abs(parseInt(d.left,10))+"px"))),Tt&&(i.oMC.style.zIndex=1e4);if(!i.debugFlash)for(v in d)d.hasOwnProperty(v)&&(i.oMC.style[v]=d[v]);try{xt||i.oMC.appendChild(s),f.appendChild(i.oMC),xt&&(l=i.oMC.appendChild(c.createElement("div")),l.className=i.swfCSS.swfBox,l.innerHTML=h),y=!0}catch(b){throw Error(J("domError")+" \\n"+b.toString())}}}return g=!0,n(),i._wD("soundManager::createMovie(): Trying to load "+t+(!Dt&&i.altURL?" (alternate URL)":""),1),!0},P=function(){return i.html5Only?(F(),!1):i.o?!1:(i.o=i.getMovie(i.id),i.o||(V?(xt?i.oMC.innerHTML=$:i.oMC.appendChild(V),V=null,g=!0):F(i.id,i.url),i.o=i.getMovie(i.id)),i.o&&S("waitEI"),i.oninitmovie instanceof Function&&setTimeout(i.oninitmovie,1),!0)},A=function(){setTimeout(O,1e3)},O=function(){if(nt)return!1;nt=!0,pt.remove(a,"load",A);if(Ot&&!At)return S("waitFocus"),!1;var e;b||(e=i.getMoviePercent(),i._wD(J("waitImpatient",e===100?" (SWF loaded)":e>0?" (SWF "+e+"% loaded)":""))),setTimeout(function(){e=i.getMoviePercent(),b||(i._wD("soundManager: No Flash response within expected time.\\nLikely causes: "+(e===0?"Loading "+i.movieURL+" may have failed (and/or Flash "+l+"+ not present?), ":"")+"Flash blocked or JS-Flash security error."+(i.debugFlash?" "+J("checkSWF"):""),2),!Dt&&e&&(S("localFail",2),i.debugFlash||S("tryDebug",2)),e===0&&i._wD(J("swf404",i.url)),m("flashtojs",!1,": Timed out"+Dt?" (Check flash security or flash blockers)":" (No plugin/missing SWF?)")),!b&&Mt&&(e===null?i.useFlashBlock||i.flashLoadTimeout===0?(i.useFlashBlock&&K(),S("waitForever")):W(!0):i.flashLoadTimeout===0?S("waitForever"):W(!0))},i.flashLoadTimeout)},_=function(){function e(){pt.remove(a,"focus",_),pt.remove(a,"load",_)}return At||!Ot?(e(),!0):(At=Mt=!0,i._wD("soundManager::handleFocus()"),Nt&&Ot&&pt.remove(a,"mousemove",_),nt=!1,e(),!0)},T=function(e){if(b)return!1;if(i.html5Only)return i._wD("-- SoundManager 2: loaded --"),b=!0,L(),m("onload",!0),!0;var t;if(!i.useFlashBlock||!i.flashLoadTimeout||i.getMoviePercent())b=!0,w&&(t={type:!mt&&ot?"NO_FLASH":"INIT_TIMEOUT"});return i._wD("-- SoundManager 2 "+(w?"failed to load":"loaded")+" ("+(w?"security/load error":"OK")+") --",1),w||e?(i.useFlashBlock&&i.oMC&&(i.oMC.className=Q()+" "+(i.getMoviePercent()===null?i.swfCSS.swfTimedout:i.swfCSS.swfError)),k({type:"ontimeout",error:t}),m("onload",!1),I(t),!1):(m("onload",!0),pt.add(a,"unload",h),i.waitForWindowLoad&&!E?(S("waitOnload"),pt.add(a,"load",L),!1):(i.waitForWindowLoad&&E&&S("docLoaded"),L(),!0))},wt=function(){var e,t=[];if(i.useHTML5Audio&&i.hasHTML5){for(e in i.audioFormats)i.audioFormats.hasOwnProperty(e)&&t.push(e+": "+i.html5[e]+(!i.html5[e]&&mt&&i.flash[e]?" (using flash)":i.preferFlash&&i.flash[e]&&mt?" (preferring flash)":i.html5[e]?"":" ("+(i.audioFormats[e].required?"required, ":"")+"and no flash support)"));i._wD("-- SoundManager 2: HTML5 support tests ("+i.html5Test+"): "+t.join(", ")+" --",1)}},p=function(){S("init");if(b)return S("didInit"),!1;if(i.html5Only)return b||(pt.remove(a,"load",i.beginDelayedInit),i.enabled=!0,T()),!0;P();try{S("flashJS"),i.o._externalInterfaceTest(!1),i.allowPolling?q(!0,i.flashPollingInterval||(i.useFastPolling?10:50)):S("noPolling",1),i.debugMode||i.o._disableDebug(),i.enabled=!0,m("jstoflash",!0)}catch(e){return i._wD("js/flash exception: "+e.toString()),m("jstoflash",!1),I({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),W(!0),T(),!1}return T(),pt.remove(a,"load",i.beginDelayedInit),!0},H=function(){if(B)return!1;B=!0,R();var e=f.toLowerCase(),t=null,t=null,n=typeof console!="undefined"&&typeof console.log!="undefined";return e.indexOf("sm2-usehtml5audio=")!==-1&&(t=e.charAt(e.indexOf("sm2-usehtml5audio=")+18)==="1",n&&console.log((t?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),i.useHTML5Audio=t),e.indexOf("sm2-preferflash=")!==-1&&(t=e.charAt(e.indexOf("sm2-preferflash=")+16)==="1",n&&console.log((t?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),i.preferFlash=t),!mt&&i.hasHTML5&&(i._wD("SoundManager: No Flash detected"+(i.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5.")),i.useHTML5Audio=!0,i.preferFlash=!1),ht(),i.html5.usingFlash=ut(),ot=i.html5.usingFlash,wt(),!mt&&ot&&(i._wD("SoundManager: Fatal error: Flash is needed to play some required formats, but is not available."),i.flashLoadTimeout=1),c.removeEventListener&&c.removeEventListener("DOMContentLoaded",H,!1),P(),!0},ct=function(){return c.readyState==="complete"&&(H(),c.detachEvent("onreadystatechange",ct)),!0},gt(),pt.add(a,"focus",_),pt.add(a,"load",_),pt.add(a,"load",A),Nt&&Ot&&pt.add(a,"mousemove",_),c.addEventListener?c.addEventListener("DOMContentLoaded",H,!1):c.attachEvent?c.attachEvent("onreadystatechange",ct):(m("onload",!1),I({type:"NO_DOM2_EVENTS",fatal:!0})),"complete"===c.readyState&&setTimeout(H,100)};'),jsio.setCachedSrc("sdk/jsio/util/underscore.js",'(function(){var b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=r.push,o=r.slice,u=r.concat,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf;i=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){if(e instanceof E)return e;if(!(this instanceof E))return new E(e);this._wrapped=e};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):e._=E,E.VERSION="1.5.2";S=E.each=E.forEach=function(e,t,r){if(e!=null)if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)break}else for(var o=E.keys(e),i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var s,o,i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);s=e.length;if(s!==+s)o=E.keys(e),s=o.length;S(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},E.reject=function(e,t,n){return E.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},E.every=E.all=function(e,t,r){var i;t||(t=E.identity);i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(S(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};x=E.some=E.any=function(e,t,r){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(S(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};E.contains=E.include=function(e,t){return e==null?!1:g&&e.indexOf===g?e.indexOf(t)!=-1:x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2),r=E.isFunction(t);return E.map(e,function(e){return(r?t:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.where=function(e,t,n){return E.isEmpty(t)?n?void 0:[]:E[n?"find":"filter"](e,function(e){var n;for(n in t)if(t[n]!==e[n])return!1;return!0})},E.findWhere=function(e,t){return E.where(e,t,!0)},E.max=function(e,t,n){var r;if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;r={computed:-Infinity,value:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){var r;if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;r={computed:Infinity,value:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t,n=0,r=[];return S(e,function(e){t=E.random(n++),r[n-1]=r[t],r[t]=e}),r},E.sample=function(e,t,n){return arguments.length<2||n?e[E.random(e.length-1)]:E.shuffle(e).slice(0,Math.max(0,t))};T=function(e){return E.isFunction(e)?e:function(t){return t[e]}};E.sortBy=function(e,t,n){var r=T(t);return E.pluck(E.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};N=function(e){return function(t,n,r){var i={},s=n==null?E.identity:T(n);return S(t,function(n,o){var u=s.call(r,n,o,t);e(i,u,n)}),i}};E.groupBy=N(function(e,t,n){(E.has(e,t)?e[t]:e[t]=[]).push(n)}),E.indexBy=N(function(e,t,n){e[t]=n}),E.countBy=N(function(e,t){E.has(e,t)?e[t]++:e[t]=1}),E.sortedIndex=function(e,t,n,r){var t,n,i,s,o;for(n=n==null?E.identity:T(n),t=n.call(r,t),i=0,s=e.length;i<s;){o=i+s>>>1;n.call(r,e[o])<t?i=o+1:s=o}return i},E.toArray=function(e){return e?E.isArray(e)?o.call(e):e.length===+e.length?E.map(e,E.identity):E.values(e):[]},E.size=function(e){return e==null?0:e.length===+e.length?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:o.call(e,0,t)},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},E.rest=E.tail=E.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,E.identity)};C=function(e,t,n){return t&&E.every(e,E.isArray)?u.apply(n,e):(S(e,function(e){E.isArray(e)||E.isArguments(e)?t?s.apply(n,e):C(e,t,n):n.push(e)}),n)};E.flatten=function(e,t){return C(e,t,[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n,r){var n,i,s;E.isFunction(t)&&(r=n,n=t,t=!1);n=n?E.map(e,n,r):e,i=[],s=[];return S(n,function(n,r){if(t?!r||s[s.length-1]!==n:!E.contains(s,n))s.push(n),i.push(e[r])}),i},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=u.apply(r,o.call(arguments,1));return E.filter(e,function(e){return!E.contains(t,e)})},E.zip=function(){var e,t,n;for(e=E.max(E.pluck(arguments,"length").concat(0)),t=Array(e),n=0;n<e;n++)t[n]=E.pluck(arguments,""+n);return t},E.object=function(e,t){var n,r,i;if(e==null)return{};for(n={},r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},E.indexOf=function(e,t,n){var r,i;if(e==null)return-1;r=0,i=e.length;if(n){if(typeof n!="number")return r=E.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(g&&e.indexOf===g)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},E.lastIndexOf=function(e,t,n){var r;if(e==null)return-1;r=n!=null;if(y&&e.lastIndexOf===y)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(n=r?n:e.length;n--;)if(e[n]===t)return n;return-1},E.range=function(e,t,n){var n,r,i,s;arguments.length<=1&&(t=e||0,e=0);for(n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};k=function(){};E.bind=function(e,t){var n,r;if(w&&e.bind===w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return n=o.call(arguments,2),r=function(){var i,s;if(this instanceof r){k.prototype=e.prototype;i=new k;k.prototype=null;s=e.apply(i,n.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(o.call(arguments)))}},E.partial=function(e){var t=o.call(arguments,1);return function(){return e.apply(this,t.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);if(t.length===0)throw Error("bindAll must be passed function names");return S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t,n){var r,i,s,a,o=null,u=0;n||(n={});a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var l,f=new Date;!u&&n.leading===!1&&(u=f);l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},E.debounce=function(e,t,n){var r,i,s,o,u;return function(){var a,f;s=this,i=arguments,o=new Date;a=function(){var f=new Date-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i)))},f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i)),u}},E.once=function(e){var n,t=!1;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},E.wrap=function(e,t){return function(){var n=[e];return s.apply(n,arguments),t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){var t,n;for(t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){var t,n;if(e!==Object(e))throw new TypeError("Invalid object");t=[];for(n in e)E.has(e,n)&&t.push(n);return t},E.values=function(e){var t,n,r,i;for(t=E.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},E.pairs=function(e){var t,n,r,i;for(t=E.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},E.invert=function(e){var t,n,r,i;for(t={},n=E.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},E.functions=E.methods=function(e){var n,t=[];for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){var n;if(t)for(n in t)e[n]=t[n]}),e},E.pick=function(e){var t={},n=u.apply(r,o.call(arguments,1));return S(n,function(n){n in e&&(t[n]=e[n])}),t},E.omit=function(e){var i,t={},n=u.apply(r,o.call(arguments,1));for(i in e)E.contains(n,i)||(t[i]=e[i]);return t},E.defaults=function(e){return S(o.call(arguments,1),function(t){var n;if(t)for(n in t)e[n]===void 0&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e};L=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof E&&(e=e._wrapped),t instanceof E&&(t=t._wrapped);var i=a.call(e);if(i!=a.call(t))return!1;switch(i){case"[object String]":return e==""+t;case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;var s=e.constructor,o=t.constructor;if(s!==o&&(!E.isFunction(s)||!(s instanceof s&&E.isFunction(o)&&o instanceof o)))return!1;n.push(e),r.push(t),s=0,o=!0;if(i=="[object Array]"){s=e.length;if(o=s==t.length)for(;s--;)if(!(o=L(e[s],t[s],n,r)))break}else{for(var u in e)if(E.has(e,u)){s++;if(!(o=E.has(t,u)&&L(e[u],t[u],n,r)))break}if(o){for(u in t)if(E.has(t,u)&&!(s--))break;o=!s}}return n.pop(),r.pop(),o};E.isEqual=function(e,t){return L(e,t,[],[])},E.isEmpty=function(e){var t;if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType===1},E.isArray=i||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},S("Arguments Function String Number Date RegExp".split(" "),function(e){E["is"+e]=function(t){return a.call(t)=="[object "+e+"]"}}),E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),"function"!=typeof /./&&(E.isFunction=function(e){return typeof e=="function"}),E.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},E.isNaN=function(e){return E.isNumber(e)&&e!=+e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return e._=t,this},E.identity=function(e){return e},E.times=function(e,t,n){var r,i;for(r=Array(Math.max(0,e)),i=0;i<e;i++)r[i]=t.call(n,i);return r},E.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#x27;"}};A.unescape=E.invert(A.escape);O={escape:RegExp("["+E.keys(A.escape).join("")+"]","g"),unescape:RegExp("("+E.keys(A.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(e){E[e]=function(t){return t==null?"":(""+t).replace(O[e],function(t){return A[e][t]})}}),E.result=function(e,t){var n;if(e!=null){n=e[t];return E.isFunction(n)?n.call(e):n}},E.mixin=function(e){S(E.functions(e),function(t){var n=E[t]=e[t];E.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),e=n.apply(E,e),this._chain?E(e).chain():e}})};M=0;E.uniqueId=function(e){var t=++M+"";return e?e+t:t},E.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};_=/(.)^/,D={"\'":"\'","\\\\":"\\\\","\\r":"r","\\n":"n","	":"t","\\u2028":"u2028","\\u2029":"u2029"},P=/\\\\|\'|\\r|\\n|\\t|\\u2028|\\u2029/g;E.template=function(e,t,n){var r,n=E.defaults({},n,E.templateSettings),i=RegExp([(n.escape||_).source,(n.interpolate||_).source,(n.evaluate||_).source].join("|")+"|$","g"),s=0,o="__p+=\'";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(P,function(e){return"\\\\"+D[e]}),n&&(o+="\'+\\n((__t=("+n+"))==null?\'\':_.escape(__t))+\\n\'"),r&&(o+="\'+\\n((__t=("+r+"))==null?\'\':__t)+\\n\'"),i&&(o+="\';\\n"+i+"\\n__p+=\'"),s=u+t.length,t}),o+="\';\\n",n.variable||(o="with(obj||{}){\\n"+o+"}\\n"),o="var __t,__p=\'\',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,\'\');};\\n"+o+"return __p;\\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\\n"+o+"}",t)},E.chain=function(e){return E(e).chain()},E.mixin(E),S("pop push reverse shift sort splice unshift".split(" "),function(e){var t=r[e];E.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],this._chain?E(n).chain():n}}),S(["concat","join","slice"],function(e){var t=r[e];E.prototype[e]=function(){var e=t.apply(this._wrapped,arguments);return this._chain?E(e).chain():e}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)'),jsio.setCachedSrc("sdk/timestep/platforms/browser/initialize.js",'jsio("import device"),jsio("from util.browser import $"),device.registerDevice("browser","platforms.browser"),exports.init=function(){var e,t,n,r,i,s;if(device.isMobileBrowser){device.setUseDOM(!0);t=device.screen;if(device.isIOS||device.isAndroid){n=!1;window.addEventListener("focus",function(e){e=e.target.tagName;if("TEXTAREA"==e||"INPUT"==e)n=!0},!0),document.addEventListener("blur",function(){n&&(n=!1)},!0),device.hideAddressBar=function(){!n&&device.isMobileBrowser&&(device.isIOS||device.isAndroid)&&(device.isIOS?(window.scrollTo(0,1),window.scrollTo(0,0)):window.scrollTo(0,-1))},CONFIG.unlockViewport||window.addEventListener("touchstart",bind(device,"hideAddressBar"),!0)}e=function(){var e,n,o;device.isIOS&&device.hideAddressBar();e=window.outerWidth,n=window.outerHeight,o=window.orientation;(r!=e||i!=n||s!=o)&&(r=e,i=n,s=o,t.isPortrait=n>e,t.isLandscape=!t.isPortrait,7<=device.iosVersion&&(90==o||-90==o)?(e=t.width,n=t.height,e<n&&(e=n,n=t.width)):(e=window.innerWidth,n=window.innerHeight),device.width!=e||device.height!=n||device.orientation!=o)&&(device.width=e,device.height=n,device.orientation=o,device.screen.publish("Resize",device.width,device.height,device.orientation))}}else e=function(){var e=window.document,t=window.innerWidth||e.clientWidth||e.clientWidth;e=window.innerHeight||e.clientHeight||e.clientHeight;if(t!=device.width||e!=device.height)device.width=t,device.height=e,device.screen.width=t,device.screen.height=e,t>e?(device.screen.isPortrait=!1,device.screen.isLandscape=!0,device.screen.orientation="landscape"):(device.screen.isPortrait=!0,device.screen.isLandscape=!1,device.screen.orientation="portrait"),device.screen.publish("Resize",t,e)};$.onEvent(window,"resize",e,!1),$.onEvent(window,"orientationchange",e,!1),e()}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/Input.js",'var eventTypes,UID,sdk_timestep_platforms_browser_Input;jsio("import device"),jsio("from util.browser import $"),jsio("import event.input.dispatch as input");eventTypes=input.eventTypes,UID=-1,sdk_timestep_platforms_browser_Input=__class__;exports=sdk_timestep_platforms_browser_Input(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){if(device.simulatingMobileNative||device.simulatingMobileBrowser)this._simulateMobile=!0;this._evtQueue=[],this._rootView=e.rootView,e.el&&(device.isMobileBrowser&&(this._toggleNode=$({parent:document.body})),this.setElement(e.el)),this._isOver=!1,this._keyListener=e.keyListener,device.useDOM&&$.onEvent(document,device.events.start,this,"handleMouse",eventTypes.START),this.enable(),this._hasFocus=!1,document.addEventListener&&(document.addEventListener("focus",bind(this,"onFocusCapture"),!0),document.addEventListener("blur",bind(this,"onBlurCapture"),!0))},this.enable=function(){this._handleMove=$.onEvent(document,device.events.move,this,"handleMouse",eventTypes.MOVE),this._handleSelect=$.onEvent(document,device.events.end,this,"handleMouse",eventTypes.SELECT),this._handleScroll=$.onEvent(window,"DOMMouseScroll",this,"handleMouse",eventTypes.SCROLL),this._handleWheel=$.onEvent(window,"mousewheel",this,"handleMouse",eventTypes.SCROLL)},this.disable=function(){this._handleMove&&(this._handleMove(),this._handleMove=!1),this._handleSelect&&(this._handleSelect(),this._handleSelect=!1),this._handleScroll&&(this._handleScroll(),this._handleScroll=!1),this._handleWheel&&(this._handleWheel(),this._handleWheel=!1)},this.onFocusCapture=function(e){var t=e.target.tagName;if("TEXTAREA"==t||"INPUT"==t)this._hasFocus=e.target,this._keyListener&&this._keyListener.setEnabled(!1)},this.onBlurCapture=function(){this._hasFocus&&(this._hasFocus=null,this._keyListener&&this._keyListener.setEnabled(!0))},this.setElement=function(e){var t,n;this._el=e;if(this._elEvents)for(t=0;n=this._elEvents[t];++t)n();e.ondragstart=function(){return!1},e.onselectstart=function(){return!1},this._elEvents=[],device.useDOM||this._elEvents.push($.onEvent(e,device.events.start,this,"handleMouse",eventTypes.START)),!device.isMobileBrowser&&!device.isNative&&(this._elEvents.push($.onEvent(e,"mouseover",this,"onMouseOver")),this._elEvents.push($.onEvent(e,"mouseout",this,"onMouseOut")))},this.onMouseOver=function(){this._isOver=!0},this.onMouseOut=function(){this._isOver=!1},this.onMouseDown=function(){this._isMouseDown=!0},this.onMouseUp=function(){this._isMouseUp=!0},this.getEvents=function(){return this._evtQueue},this.allowScrollEvents=function(e){this._allowScrollEvents=e},this.handleMouse=function(e,t){var r,i,s,n=t.target;if(!(this._hasFocus&&this._hasFocus==n||n&&n.getAttribute&&n.getAttribute("noCapture"))){r=device.isMobileBrowser;if(device.useDOM||r||this._isDown||!this._el||t.target==this._el){r?($.stopEvent(t),t.returnValue=!1):this._isOver&&(!this._allowScrollEvents||e!=eventTypes.SCROLL)&&(t.stopPropagation&&t.stopPropagation(),e!=eventTypes.START&&($.stopEvent(t),t.returnValue=!1));if(t.touches)for(n=0;i=t.changedTouches[n];++n)this.handleMouse(e,i,!0);else{if("offsetX"in t&&!device.useDOM)i=t.offsetX,s=t.offsetY;else if(this._el.getBoundingClientRect)s=this._el.getBoundingClientRect(),i=t.pageX-s.left,s=t.pageY-s.top;else{for(r=this._el;r;)i+=r.offsetTop,s+=r.offsetLeft,r=r.parentNode;i=t.pageX-i,s=t.pageY-s}r=t.identifier||UID;if(this._simulateMobile)switch(e){case eventTypes.START:this._moveOK=!0;break;case eventTypes.MOVE:if(!this._moveOK)return;break;case eventTypes.SELECT:this._moveOK=!1}e==eventTypes.START?this._isDown=!0:e==eventTypes.SELECT&&(this._isDown=!1,this._toggleNode&&(document.body.removeChild(this._toggleNode),document.body.appendChild(this._toggleNode))),i=new input.InputEvent(r,e,i,s);if(device.useDOM){for(;n&&!n._view;)n=n.parentNode;if(!n)return;i.target=n._view}e==eventTypes.SCROLL&&("wheelDeltaX"in t?(i.scrollDelta=t.wheelDeltaY/120,i.scrollAxis=input.VERTICAL_AXIS,t.wheelDeltaX&&t.wheelDeltaY?(n=i.clone(),n.scrollDelta=t.wheelDeltaX/120,n.scrollAxis=input.HORIZONTAL_AXIS,input.dispatchEvent(this._rootView,n)):t.wheelDeltaX&&(i.scrollDelta=t.wheelDeltaX/120,i.scrollAxis=input.HORIZONTAL_AXIS)):t.detail?(i.scrollDelta=-t.detail,i.scrollAxis="axis"in t?t.axis==t.VERTICAL_AXIS?input.VERTICAL_AXIS:input.HORIZONTAL_AXIS:input.VERTICAL_AXIS):t.wheelDelta&&(i.scrollDelta=(window.opera?1:-1)*t.wheelDelta/120,i.scrollAxis=input.VERTICAL_AXIS)),input.dispatchEvent(this._rootView,i)}}}}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/InputPrompt.js",'var KeyboardTypes={Default:0,NumbersAndPunctuation:2,URL:3,NumberPad:4,PhonePad:5,EmailAddress:7,DecimalPad:8},sdk_timestep_platforms_browser_InputPrompt=__class__;exports=sdk_timestep_platforms_browser_InputPrompt(function(){return this.init&&this.init.apply(this,arguments)},function(){var e={onChange:function(){},title:"",message:"",value:"",prompt:""};this.init=function(t){t=merge(t,e),this.onChange=t.onChange,this.onSubmit=t.onSubmit,this._value=t.value,this._message=t.title||t.message||t.prompt},this.show=function(){var e=window.prompt(this._message,this._value);null!==e?(this._value=e,this.onChange&&this.onChange(e),this.onSubmit&&this.onSubmit(e)):this.onChange&&this.onChange(e)},this.getValue=function(){return this._value},this.setValue=function(e){return this._value=e,this},this.setMessage=function(e){return this._message=e,this},this.setOkButton=function(e){return this._okText=e,this},this.setCancelButton=function(e){return this._cancelText=e,this},this.setKeyboardType=function(){return logger.warn("Setting keyboard type in the browser does nothing"),this},this.requestFocus=function(){return this.show(),this},this.closeEditField=function(){},this.setHint=function(){},this.refresh=function(){}}),exports.showStatusBar=function(){},exports.hideStatusBar=function(){},exports.KeyboardTypes=KeyboardTypes'),jsio.setCachedSrc("sdk/timestep/platforms/browser/KeyListener.js",'var gListenerSingleton,gCancelKeys,sdk_timestep_platforms_browser_KeyListener;jsio("import lib.PubSub as PubSub"),jsio("import lib.Enum"),jsio("import event.input.keys as keyConstants"),jsio("import device"),jsio("import timer"),jsio("from util.browser import $");gListenerSingleton=null,gCancelKeys=lib.Enum(keyConstants.SPACE,keyConstants.LEFT,keyConstants.RIGHT,keyConstants.UP,keyConstants.DOWN),sdk_timestep_platforms_browser_KeyListener=__class__;exports=sdk_timestep_platforms_browser_KeyListener(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){if(gListenerSingleton)return gListenerSingleton;gListenerSingleton=this,this._el=e=e||document,this._events=[],this._shortcuts=[],this._isEnabled=!0,this._keyMap={},$.onEvent(e,"keydown",this,"onKeyDown"),$.onEvent(e,"keypress",this,"onKeyPress"),$.onEvent(e,"keyup",this,"onKeyUp"),$.onEvent(window,"blur",this,"liftAll")},this.setEnabled=function(e){this._isEnabled=e},this.captureShortcut=function(e){this._shortcuts.push(e)},this.getPressed=function(){return this._keyMap},this.onKeyDown=function(e){var t,n,r,i;if(this._isEnabled){t={code:e.keyCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,lifted:!1,dt:timer.getTickProgress()};if(t.ctrl||t.shift||t.alt||t.meta){for(n=!1,r=0;i=this._shortcuts[r];++r)i.compare(t)&&(i.publish("Down",t),n=!0);n&&$.stopEvent(e)}else $.stopEvent(e),e.keyCode in this._keyMap||(this._events.push(t),this._keyMap[e.keyCode]=+(new Date))}},this.liftAll=function(){var t,e=timer.getTickProgress();for(t in this._keyMap)this._events.push({code:t,lifted:!0,dt:e});this._keyMap={}},this.onKeyUp=function(e){var t=timer.getTickProgress();delete this._keyMap[e.keyCode],this._events.push({code:e.keyCode,lifted:!0,dt:t}),$.stopEvent(e)},this.onKeyPress=function(e){this._isEnabled&&e.keyCode in gCancelKeys&&$.stopEvent(e)},this.peekEvents=function(){return this._events},this.popEvents=function(){return this._events.splice(0,this._events.length)}}),merge(exports.prototype,keyConstants),exports.Shortcut=__class__,exports.Shortcut=exports.Shortcut(function(){return this.init&&this.init.apply(this,arguments)},PubSub,function(){this.init=function(e,t,n,r,i){this.ctrl=!!t,this.shift=!!n,this.alt=!!r,this.meta=!!i,this.code=!!e},this.compare=function(e){return this.ctrl==e.ctrl&&this.alt==e.alt&&this.meta==e.meta&&this.shift==e.shift&&this.code==e.code}})'),jsio.setCachedSrc("sdk/timestep/event/input/keys.js","exports={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,BREAK:19,CAPS:20,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,META_LEFT:91,WIN_LEFT:91,META_RIGHT:92,WIN_RIGHT:92,SELECT:93,EQUAL:187,MINUS:189,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MUTE:173,VOL_DOWN:174,VOL_UP:175,FORWARD:176,BACK:177,STOP:178,PLAY_PAUSE:179}"),jsio.setCachedSrc("sdk/timestep/platforms/browser/MobileBrowserAPI.js",'var sdk_timestep_platforms_browser_MobileBrowserAPI,AudioAPI;jsio("import lib.PubSub"),jsio("import device"),jsio("from util.underscore import _");sdk_timestep_platforms_browser_MobileBrowserAPI=__class__,AudioAPI=exports=sdk_timestep_platforms_browser_MobileBrowserAPI(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(e){var t={oneChannelOnly:device.isMobileBrowser,compiledFilename:"compiled"};this.init=function(n){n=merge(n,t),e(this,"init",[n]),this._opts=n,this._map=n.map,this._audios={},this.oneChannelOnly=n.oneChannelOnly,setInterval(bind(this,"_ontimeupdate"),200),this.oneChannelOnly||_.each(n.background,function(e){n.map[e]={name:e}},this),this._load(),this.oneChannelOnly&&(this._boundLoadHandler=bind(this,"_playFirst"),document.body.addEventListener(device.events.start,this._boundLoadHandler,!0)),window.addEventListener("pagehide",bind(this,"pause"),!1)},this._createChannel=function(e,t){var n=new Audio(t);this._audios[e]=n,n.addEventListener("error",bind(this,"_onerror")),n.addEventListener("timeupdate",bind(this,"_ontimeupdate")),n.load()},this.setMuted=function(e){(this.muted=e)&&this.setVolume(0)},this.setVolume=function(e){_.each(this._audios,function(t){t.volume=e})},this.unload=function(){this.pause(),_.each(this._audios,function(e){e.src=""},this)},this._load=function(){this._audios={};var e=this._opts.path.replace(/\\/$/,"");if(this.oneChannelOnly)this._createChannel("AUDIO",e+"/"+this._opts.compiledFilename+".m4a");else for(var t in this._map)this._map.hasOwnProperty(t)&&"SILENCE"!=t&&this._createChannel(t,e+"/"+t+".mp3");logger.info("now loading",this._opts.src),this._publishedReady||(this.publish("Ready"),this._publishedReady=!0)},this._playFirst=function(){document.body.removeEventListener(device.events.start,this._boundLoadHandler,!0),this._audios.AUDIO.play()},this._ontimeupdate=function(){_.each(this._audios,function(e){e.paused&&!e._pausedOnce&&(e.pause(),e._pausedOnce=!0,e._ready=!0),this.oneChannelOnly&&(!this._nowPlaying||e.currentTime>=this._nowPlaying.end)&&this.play("SILENCE")},this)},this._onerror=function(e){var t="",n;for(n in e)t+=e[n]+" ";logger.info("ERROR",t)},this.canPlay=function(e){if(!this._map[e])return!1;var t=null;this.oneChannelOnly&&(t=this._map[e].end,e="AUDIO"),e=this._audios[e];if(!e)return!1;if(e._ready||!t)return!0;try{var n=e.seekable.end();return t<=n}catch(r){return logger.log(r),!1}},this.play=function(e,t){if(!this.muted)if(void 0===t&&(t=1),this.canPlay(e)){var n=this._audios[this.oneChannelOnly?"AUDIO":e];try{n.paused||n.pause();var r=0;this.oneChannelOnly&&null!=this._map[e].start&&(r=this._map[e].start),n.currentTime!=r&&(n.currentTime=r),n.volume=t,n.play(),this._nowPlaying=this._map[e]}catch(i){}}else logger.info("Not ready yet")},this.pause=function(){_.each(this._audios,function(e){e.pause()},this)},this.playBackgroundMusic=function(e,t){if(!this.muted){if(this.oneChannelOnly)return!1;this._backgroundSoundPlaying=e,this.play(e,t)}},this.pauseBackgroundMusic=function(){this._backgroundSoundPlaying&&this._audios[this._backgroundSoundPlaying].pause()}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/StatusBar.js","exports.show=function(){},exports.hide=function(){},exports.getHeight=function(){return 0}"),jsio.setCachedSrc("sdk/timestep/platforms/browser/TextBox.js",'var sdk_timestep_platforms_browser_TextBox;"use import";jsio("from util.browser import $");sdk_timestep_platforms_browser_TextBox=__class__;exports=sdk_timestep_platforms_browser_TextBox(function(){return this.init&&this.init.apply(this,arguments)},function(){var e={padding:0,lineHeight:1.4,border:"none",display:"none",textAlign:"center",verticalAlign:"middle",fontSize:16,fontFamily:null,fontWeight:"",opacity:1,position:"absolute",backgroundColor:"transparent",top:0,left:0};this.init=function(t){var t=merge(t,{color:"black",height:20}),n=merge({},e);t.color&&(n.color=t.color),this._el=$({tag:t.multiLine?"textarea":"input",attrs:{type:"text"},style:n}),$.onEvent(this._el,"blur",this,"onBlur"),$.onEvent(this._el,"focus",this,"onFocus"),$.onEvent(this._el,"change",this,"onChange"),$.onEvent(this._el,"click",this,"onClick")},this.onBlur=this.onFocus=this.onChange=this.onClick=function(){},this.destroy=function(){$.remove(this._el),this._el=null},this.setApp=function(e){if(e!=this._app||!this._el.parentNode)this._app=e,e=e._ctx.canvas,logger.log("setting parent",this._el),e.parentNode.appendChild(this._el)},this.change=function(){},this.click=function(){},this.selectAll=function(){this._el.focus(),this._el.select()},this.show=function(){$.show(this._el)},this.hide=function(){$.hide(this._el)},this.setValue=function(e){return this._el.value=e,this},this.setOpacity=function(e){return this._el.style.opacity=e,this},this.setType=function(e){return this._el.type=e,this},this.setVisible=function(e){return this[e?"show":" hide"]()},this.getX=function(){return parseInt(this._el.style.left)},this.getY=function(){return parseInt(this._el.style.top)},this.getWidth=function(){return this._el.offsetWidth},this.getHeight=function(){return this._el.offsetHeight},this.getValue=function(){return this._el.value},this.getOpacity=function(){return this._el.style.opacity},this.getType=function(){return this._el.type},this.getVisible=function(){return this._el.parentNode&&"block"==this._el.style.display},this.setPosition=function(e){this._el.style.top=e.y+"px",this._el.style.left=e.x+"px"},this.getPosition=function(){return{x:this.getX(),y:this.getY()}},this.setDimensions=function(e){return this._el.style.width=e.width+"px",this._el.style.height=e.height+"px",this},this.getDimensions=function(){return{width:this.getWidth(),height:this.getHeight()}}})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/TextInput.js",'var sdk_timestep_platforms_browser_TextInput,tab,tabLength;"use import";function checkTab(e){var e,i,s,t=e.target,n=t.selectionStart,r=t.selectionEnd;if(9==e.keyCode)if(e.preventDefault(),e.shiftKey)if(n!=r&&-1!=t.value.slice(n,r).indexOf("\\n")){for(i=n;i&&"\\n"!=t.value.charAt(i-1);)--i;e=t.value.slice(0,i),s=t.value.slice(r,t.value.length),i=t.value.slice(i,r).replace(RegExp("(^|\\n)"+tab,"g"),function(e){return r-=tab.length,"\\n"==e.charAt(0)?"\\n":(n-=tab.length,"")});t.value=e.concat(i).concat(s),t.selectionStart=n,t.selectionEnd=r}else{for(i=n;i&&"\\n"!=t.value.charAt(i-1);)--i;t.value.substring(i,i+tab.length)==tab&&(t.value=t.value.slice(0,i).concat(t.value.slice(i+tab.length,t.value.length)),n==r?t.selectionStart=t.selectionEnd=n-(n==i?0:tab.length):(t.selectionStart=n-(n==i?0:tab.length),t.selectionEnd=r-tab.length))}else if(n!=r&&-1!=t.value.slice(n,r).indexOf("\\n")){for(i=n;i&&"\\n"!=t.value.charAt(i-1);)--i;e=t.value.slice(0,i),s=t.value.slice(r,t.value.length),i=t.value.slice(i,r).replace(/\\n/g,function(){return r+=tab.length,"\\n"+tab}),t.value=e.concat(tab).concat(i).concat(s),t.selectionStart=n+tab.length,t.selectionEnd=r+tab.length}else{for(i=n;i&&"\\n"!=t.value.charAt(i-1);)--i;t.value=t.value.slice(0,i).concat(tab).concat(t.value.slice(i,t.value.length)),n==r?t.selectionStart=t.selectionEnd=n+tab.length:(t.selectionStart=n+tab.length,t.selectionEnd=r+tab.length)}else!e.shiftKey&&!e.metaKey&&!e.ctrlKey&&(8==e.keyCode&&t.value.slice(n-tabLength,n)==tab?(e.preventDefault(),t.value=t.value.slice(0,n-tabLength).concat(t.value.slice(n,t.value.length)),t.selectionStart=t.selectionEnd=n-tab.length):46==e.keyCode&&t.value.slice(r,r+tabLength)==tab?(e.preventDefault(),t.value=t.value.slice(0,n).concat(t.value.slice(n+tabLength,t.value.length)),t.selectionStart=t.selectionEnd=n):37==e.keyCode&&t.value.slice(n-tabLength,n)==tab?(e.preventDefault(),t.selectionStart=t.selectionEnd=n-tabLength):39==e.keyCode&&t.value.slice(n,n+tabLength)==tab&&(e.preventDefault(),t.selectionStart=t.selectionEnd=n+tabLength))}jsio("import lib.PubSub"),jsio("from util.browser import $");sdk_timestep_platforms_browser_TextInput=__class__;exports=sdk_timestep_platforms_browser_TextInput(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(e){this._el=$({tag:"input",parent:document.body,style:{position:"absolute",left:"-100px",top:"-100px"},attrs:{type:"text",value:e&&e.value||""}}),this._value=this._el.value,this._selectionEnd=this._selectionStart=0,$.onEvent(this._el,"keydown",this,"checkValue"),$.onEvent(this._el,"keyup",this,"checkValue"),$.onEvent(this._el,"keypress",this,"checkValue"),$.onEvent(this._el,"focus",this,"onFocus"),$.onEvent(this._el,"blur",this,"onBlur")},this.onFocus=function(){this.publish("Focus")},this.onBlur=function(){this.publish("Blur")},this.checkValue=function(e){var n,t=e.target,e=t.selectionStart;t=t.selectionEnd,n=this._el.value;n!=this._value&&(this.publish("ChangeValue",n),this._value=n),e!=this._selectionStart&&(this._selectionStart=e,this.publish("ChangeSelectionStart",e)),t!=this._selectionEnd&&(this._selectionEnd=t,this.publish("ChangeSelectionEnd",t))},this.focus=function(){logger.log("focus"),this._el.focus()},this.blur=function(){this._el.blur()}});tab="    ",tabLength=4;Array.prototype.map.call(document.getElementsByTagName("textarea"),function(e){e.addEventListener("keydown",checkTab,!1)})'),jsio.setCachedSrc("sdk/timestep/platforms/browser/Timer.js",'var _onTick,disableRequestAnimFrame,disablePostMessage,asFastAsPossible,MIN_DT,postMessageCb,fastDriver,mainDriver,cancelDriver,driverId,reqAnim,cancelAnim,prefixes,i;function sendPostMessage(){window.postMessage("timestep.TICK","*")}function sendTimeout(){setTimeout(onFrame,MIN_DT)}function sendTimeoutNow(){setTimeout(onFrame,0)}function onFrame(){var e,t;if(_onTick){e=+(new Date),t=e-(exports.last||e);exports.last=e,_onTick(t),driverId=t>MIN_DT?fastDriver.call(window,onFrame):mainDriver.call(window,onFrame)}}_onTick=null,disableRequestAnimFrame=!1,disablePostMessage=!0,asFastAsPossible=!1,MIN_DT=16;if(window.postMessage){postMessageCb=function(e){"timestep.TICK"==e.data&&onFrame()};window.addEventListener?window.addEventListener("message",postMessageCb,!1):window.attachEvent("onmessage",postMessageCb)}else disablePostMessage=!0,tickNow=sendTimeoutNow;fastDriver=sendTimeoutNow,mainDriver=sendTimeout;if(asFastAsPossible)disablePostMessage?mainDriver=sendTimeoutNow:fastDriver=mainDriver=sendPostMessage;else{reqAnim=window.requestAnimationFrame,cancelAnim=window.cancelAnimationFrame,prefixes=["","webkit","moz","o","ms"];if(!disableRequestAnimFrame)for(i=0;i<prefixes.length&&!reqAnim;++i)reqAnim=window[prefixes[i]+"RequestAnimationFrame"],cancelAnim=window[prefixes[i]+"CancelAnimationFrame"]||window[prefixes[i]+"CancelRequestAnimationFrame"];reqAnim?(fastDriver=mainDriver=reqAnim,cancelDriver=cancelAnim):disablePostMessage||(fastDriver=sendPostMessage)}exports.last=null,exports.start=function(e){_onTick=e,driverId=mainDriver.call(window,onFrame)},exports.stop=function(){_onTick=null,driverId&&(cancelDriver.call(window,driverId),driverId=null)}'),jsio.setCachedSrc("sdk/timestep/platforms/browser/EditText.js",'var __keyboardIsOpen,InputField,_input,_focused,sdk_timestep_platforms_browser_EditText;jsio("from util.browser import $"),jsio("import squill.Widget"),jsio("import device");__keyboardIsOpen=!1,InputField=__class__,InputField=InputField(function(){return this.init&&this.init.apply(this,arguments)},squill.Widget,function(e){this._def={tag:"input",parent:document.body,style:{position:"absolute",background:"transparent",border:"none",outline:"none",zIndex:"990000",left:"0px",top:"0px"}},this.buildWidget=function(){this.initKeyEvents(),this.initFocusEvents()},this.setValue=function(e){this._prevValue=this._el.value=e},this.setCursor=function(e){this._el.selectionStart=this._el.selectionEnd=e},this.setPlaceholder=function(e){this._el.placeholder=e},this.setMaxLength=function(e){this._el.maxlength=e},this.show=function(){e(this,"show",arguments),this._el.focus()},this.onKeyUp=function(e){var t=this._el;_focused&&_focused.onChange(t.value,this._prevValue,t.selectionStart,t.selectionEnd),this._prevValue=t.value,13==e.keyCode&&_focused&&_focused.closeEditField()},this.getValue=function(){return this._el.value},this.onBlur=function(){this.hide();if(__keyboardIsOpen){__keyboardIsOpen=!1;var e=new Event("keyboardClosed");e.height=device.screen.height,window.dispatchEvent(e)}_focused=null},this.setFontColor=function(){this._el.style.color=this._opts.color},this.setHorizontalPadding=function(e,t){this._el.style.paddingLeft=e+"px",this._el.style.paddingRight=t+"px"},this.setFontSize=function(e){this._el.style.fontSize=e+"px"},this.setFontFamily=function(e){this._el.style.fontFamily=e},this.setPosition=function(e,t,n,r){var i=this._el.style;i.top=t-1+"px",i.left=e+"px",i.width=n+"px",i.height=r+"px"}}),_input=new InputField;_input.hide();_focused=null,sdk_timestep_platforms_browser_EditText=__class__;exports=sdk_timestep_platforms_browser_EditText(function(){return this.init&&this.init.apply(this,arguments)},function(){var e={hint:"",inputType:"default",maxLength:-1};this.init=function(t){this._opts=merge(t,e),this._textEditView=t.textEditView,this.onFocusChange=t.onFocusChange||function(){},this.onSubmit=t.onSubmit||function(){}},this.onChange=function(e,t,n){this._value=e,this._opts.onChange&&this._opts.onChange(e,t,n)},this.getValue=function(){return this._value},this.setValue=function(e){this._value=e,this.onChange(e)},this.requestFocus=function(e){_focused!==this&&(null!=_focused&&_focused.removeFocus(e),this.onFocusChange(!0)),_focused=this},this.closeEditField=function(e){console.log("TextEditView editText removeFocus"),null!=_focused&&_focused.removeFocus(e),this._showTextBox(),_input.hide(),__keyboardIsOpen&&(__keyboardIsOpen=!1,e=new Event("keyboardClosed"),e.height=device.screen.height,window.dispatchEvent(e))},this._hideTextBox=function(){this._textEditView._textBox.style.visible=!1},this._showTextBox=function(){this._textEditView._textBox.style.visible=!0},this.refresh=function(e,t,n,r){var t,n,i;this._hideTextBox();t=this._textEditView._textBox,n=this._textEditView.getPosition(),i=n.width/this._textEditView.style.width;_input.setCursor(r),_input.setValue(e),_input.setPlaceholder(this._opts.hint),_input.setMaxLength(this._opts.maxLength),_input.setFontColor(this._opts.color),_input.setHorizontalPadding(this._opts.paddingLeft*i,this._opts.paddingRight*i),_input.setFontSize(t.getOpts().size*i),_input.setFontFamily(t.getOpts().fontFamily),_input.setPosition(n.x,n.y,n.width,n.height),_input.show(),__keyboardIsOpen||(__keyboardIsOpen=!0,e=new Event("keyboardOpened"),e.height=.6*device.screen.height,window.dispatchEvent(e))},this.hasFocus=function(){return this==_focused},this.removeFocus=function(e){this.onFocusChange(!1),e||this.onSubmit(_input.getValue()),_focused==this&&(_focused=null)},this.setHint=function(e){this._opts.hint=e}})'),jsio.setCachedSrc("sdk/jsio/squill/Alpha.js",'var alphaSelect,alphaIndicator,sdk_jsio_squill_Alpha,Alpha;"use import";jsio("from util.browser import $"),jsio("import .Widget"),jsio("import .jscolor.jscolor as jscolor");alphaSelect=!1,sdk_jsio_squill_Alpha=__class__,Alpha=exports=sdk_jsio_squill_Alpha(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="lph",this._type="text",this.init=function(t){t=merge(t,{tag:"input"}),e(this,"init",[t])},this.buildWidget=function(){var e=this._el;e.widget=this,$.onEvent(e,"focus",this,"_onFocus"),$.onEvent(e,"blur",this,"_onBlur"),$.onEvent(e,"change",this,"_onChange"),alphaSelect||(alphaSelect=document.createElement("div"),alphaSelect.style.display="none",alphaSelect.className="colorMenu",document.body.appendChild(alphaSelect),$.onEvent(alphaSelect,"mousedown",this,"_onSelect"),e=document.createElement("canvas"),e.width=20,e.height=100,alphaSelect.appendChild(e),$.style(e,{"float":"left",width:"20px",height:"100px",margin:"8px 0 0 12px",border:"1px solid #000",borderColor:"ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",backgroundColor:"red"}),$.onEvent(e,"mousedown",this,"_onMouseDown"),$.onEvent(e,"mousemove",this,"_onMouseMove"),$.onEvent(e,"mouseup",this,"_onMouseUp"),$.onEvent(e,"mouseout",this,"_onMouseOut"),alphaIndicator=document.createElement("img"),alphaIndicator.src="img/colorpicker/arrow.gif",alphaSelect.appendChild(alphaIndicator),$.style(alphaIndicator,{position:"absolute",left:"4px",top:"2px",border:"0px hidden"}),e=e.getContext("2d"),linearGradient=e.createLinearGradient(0,0,0,100),linearGradient.addColorStop(0,"#FFFFFF"),linearGradient.addColorStop(1,"#000000"),e.fillStyle=linearGradient,e.fillRect(0,0,20,100))},this._showIndicator=function(e){return 0>e&&(e=0),100<e&&(e=100),$.style(alphaIndicator,{position:"absolute",left:"4px",top:2+e+"px",border:"0px hidden"}),e},this._showMouseAlpha=function(e){alphaSelect.target.value=100-this._showIndicator(e.offsetY),alphaSelect.widget.publish("Change",parseInt(alphaSelect.target.value,10))},this._onChange=function(){var e=this._el.value;isNaN(e)||(e=parseInt(e,10),0<=e&&100>=e&&alphaSelect.widget.publish("Change",e))},this._onFocus=function(e){var t=this._el.getBoundingClientRect(),n=t.right+4,r=t.top;r+122>window.innerHeight&&(r=t.bottom-122),n+44>window.innerWidth&&(n=t.left-48),$.style(alphaSelect,{position:"absolute",width:"44px",height:"122px",zIndex:"1000000",left:n+"px",top:r+"px",display:"block"}),alphaSelect.widget=e.target.widget,alphaSelect.target=e.target,this._showIndicator(100-(isNaN(alphaSelect.target.value)?0:parseInt(alphaSelect.target.value,10)))},this._onBlur=function(){alphaSelect.style.display="none"},this._onSelect=function(e){$.stopEvent(e)},this._onMouseDown=function(e){$.stopEvent(e),this._showMouseAlpha(e),this._mouseDown=!0},this._onMouseMove=function(e){this._mouseDown&&this._showMouseAlpha(e),$.stopEvent(e)},this._onMouseOut=function(e){this._mouseDown=!1,$.stopEvent(e)},this._onMouseUp=function(e){this._mouseDown=!1,$.stopEvent(e)},this.setValue=function(e){this._el.value=e},this.getValue=function(){return this._el.value}})'),jsio.setCachedSrc("sdk/jsio/squill/Widget.js",'var uid,WidgetSet,sdk_jsio_squill_Widget,Widget,map,lowerCaseMap;function shallowCopy(e){var n,t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}jsio("from util.browser import $"),jsio("import .Element, .Events, .global"),jsio("import .i18n"),jsio("import .Delegate"),jsio("from .__imports__ import classes as WIDGET_CLASSES");uid=0,WidgetSet=__class__,WidgetSet=WidgetSet(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._target=e,this.events=[]},this.hasWidget=function(e){return!!this._target[e]},this.addWidget=function(e,t){this._target[e]=t},this.addSubscription=function(e,t){this._target.dispatchEvent&&e.subscribe.apply(e,[t,this._target,"dispatchEvent"].concat(Array.prototype.slice.call(arguments,2)))}}),sdk_jsio_squill_Widget=__class__,Widget=exports=sdk_jsio_squill_Widget(function(){return this.init&&this.init.apply(this,arguments)},[Element,Events],function(){function e(e){e=$.id(e),e.parentNode.insertBefore(this._el,e),e.parentNode.removeChild(e)}this._css="widget",this._name="",this.__getDef__=function(){function e(e,t){for(var n in t){if("attrs"==n||"style"==n)e[n]=merge(e[n],t[n]);"className"==n&&e.className?e.className=t.className+" "+e.className:"children"==n?e.children?e.children.unshift(t.children):e.children=[t.children]:e.hasOwnProperty(n)||(e[n]=t[n])}}var t=this.constructor,n={};do t.prototype.hasOwnProperty("_def")&&e(n,t.prototype._def);while(t=t.prototype.__parentClass__);return this.hasOwnProperty("_def")&&e(n,this._def),n},this.init=function(e){e=e||{},this._id=e.id,this._children=[];var t=this._def=this.__getDef__();t.className&&(e.className=e.className?e.className+" "+t.className:t.className),t.attrs&&(e.attrs=merge(e.attrs,t.attrs)),t.style&&(e.style=merge(e.style,t.style)),this._opts=e;for(var n in t)"children"!=n&&!e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(e[n]=t[n]);e.name&&(this._name=e.name),e.delegate&&(this.delegate=e.delegate),e.controller&&(this.controller=e.controller);var r;e.widgetParent&&(r=e.widgetParent),e.parent&&(t=this._parent=e.parent,t instanceof Widget?(r||(r=e.parent),e.parent=t.getContainer()):t.appendChild||delete e.parent),r?r.addWidget(this):(e.parent||e.el)&&this.build(e.el)},this.getId=function(){return this._id||this._el&&this._el.id},this.build=function(e){if(!this._el||this._el!=e){var e=this._opts,t=e.children;t&&delete e.children,this._el=$.create(this._opts),t&&(e.children=t),this.buildContent()}return this},this.getParent=function(){return this._parent},this.getWidgetParent=function(){return this._widgetParent},this.setWidgetParent=function(e){this._widgetParent!=e&&this._widgetParent.addWidget(this)},this.setParent=function(e){if(e=(this._parent=e)&&(e.getContainer&&e.getContainer()||e.appendChild&&e))this._el?e.appendChild(this._el):(this._opts.parent=e,this.build())},this.getChildren=function(){return this._children},this.forEachDescend=function(e,t){for(var n=this._children.length,r=0;r<n;++r){var i=this._children[r];e.call(t,i),i.forEachDescend&&i.forEachDescend(e,t)}},this.getFirstChild=function(){return this._children&&this._children.length?this._children[0]:null},this.dispatchEvent=function(e,t){this.delegate.call(this,e,t)},this.addElement=function(e){this._el.appendChild(e)},this.addWidget=function(e,t,n){this._el||this.build(),t=e.parent||t||this.getContainer()||this._el;if(!(e instanceof Widget)){var r=merge({},e,{parent:t,__result:n});if(r.children){var i=r.children;delete r.children}"type"in r&&!r.type&&logger.warn("Did you forget to provide a type?",r);if(!r.type||"string"==typeof r.type)if(WIDGET_CLASSES[r.type])e=new(jsio("import "+WIDGET_CLASSES[r.type]))(r);else switch(r.type){case"checkbox":jsio("import .CheckBox"),e=new CheckBox(r);break;case"image":e=$(merge({tag:"img"},r));break;case"button":"undefined"==typeof TextButton&&jsio("import .TextButton"),e=new TextButton(r),n&&n.addSubscription(e,"Select",r.id);break;case"select":jsio("import .SelectBox"),e=new SelectBox(r);break;case"widget":e=new exports(r);break;default:e=$(r)}else e=new r.type(r);n&&r.id&&!n.hasWidget(r.id)&&n.addWidget(r.id,e)}e instanceof Widget&&(e.getWidgetParent()!=this&&((r=e.getWidgetParent())&&r.removeWidget(this),e._widgetParent=this,this._children.push(e)),e.getParent()!=t&&e.setParent(t));if(i)if(e.buildChildren)n||(n=new WidgetSet(e)),e.buildChildren(i,n);else for(t=0;r=i[t];++t)this.addWidget(r,e,n);return e},this.removeWidget=function(e){e=this._children.indexOf(e),0<=e&&this._children.splice(e,1)},this.getContainer=function(){return this._el},this.getName=function(){return this._name},this.setName=function(e){this._name=e},this.buildContent=function(){var e=this._opts;null!==global.getWidgetPrefix()&&$.addClass(this._el,global.getWidgetPrefix()+this._css),this.delegate||(this.delegate=new Delegate),e.errorLabel&&(this._errorLabel=$.create({html:e.errorLabel,className:global.getWidgetPrefix()+"textInputErrorLabel",parent:this._el}));var t=this._def;if(t&&t.children){var n=new WidgetSet(this);this.buildChildren(t.children,n)}t=e.__result||new WidgetSet(this),e.children&&this.buildChildren(e.children,t),this.buildWidget(this._el,t)},this.buildChildren=function(e,t){for(var n=this.getContainer()||this._el,r=0,i=e.length;r<i;++r)Array.isArray(e[r])?this.buildChildren(e[r],t):this.addWidget(e[r],n,t)},this.buildWidget=function(){},this.errors=function(){return this.validators.map(function(e){if(0==e.isValid)return e.message})},this.validate=function(){for(var e=!0,t=0,n=this.validators.length;t<n;++t)var r=this.validators[t],e=e&&(r.isValid=r.call(this));return this._isValid=e},this._isValid=!0,this.isValid=function(){return this._isValid},this.validators=[],this.getI18n=function(e,t){var n=e in this._opts?this._opts:i18n.get(t||this._opts.id);return n&&n[e]||""},this.getElement=function(){return this._el||this.build(),this._el},this.onBeforeShow=function(){for(var e=0,t;t=this._children[e];++e)t.onBeforeShow.apply(t,arguments)},this.onShow=function(){this._isShowing=!0;for(var e=0,t;t=this._children[e];++e)t.onShow.apply(t,arguments)},this.onBeforeHide=function(){for(var e=0,t;t=this._children[e];++e)t.onBeforeHide.apply(t,arguments)},this.onHide=function(){this._isShowing=!1;for(var e=0,t;t=this._children[e];++e)t.onHide.apply(t,arguments)},this.isShowing=function(){return this._isShowing},this.show=function(){this.onBeforeShow();var e=this._opts&&this._opts.style,e=e&&"none"!=e.display&&e.display||"block";this._el&&(this._el.style.display=e),this.onShow()},this.hide=function(){this.onBeforeHide(),$.hide(this.getElement()),this.onHide()},this.remove=function(){this.onBeforeHide(),$.remove(this.getElement()),this.onHide()},this.putHere=function(){this._el||this.build();var t="jsioWidgetId"+ ++uid;return global.getTargetDocument().write(\'<div id="\'+t+\'"></div>\'),setTimeout(bind(this,e,t),0),this},this.appendTo=function(e){return e&&(e=$.id(e),this._el||this.build(),e.appendChild(this._el)),this},this.onclick=function(e){return $.onEvent(this._el,"click",e),this}}),map={},lowerCaseMap={};Widget.register=function(e,t){if(t in map)throw Error("A widget with name \'"+t+"\' is already registered");map[t]=e,lowerCaseMap[t.toLowerCase()]=e},Widget.get=function(e){return lowerCaseMap[e.toLowerCase()]},Widget.WidgetSet=WidgetSet'),jsio.setCachedSrc("sdk/jsio/squill/Element.js",'var sdk_jsio_squill_Element,Element;"use import";jsio("import lib.PubSub"),jsio("from util.browser import $");sdk_jsio_squill_Element=__class__,Element=exports=sdk_jsio_squill_Element(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(e){this._opts=JS.merge(e,{win:window,tag:"div"})},this.build=function(){return this._el||(this._opts.el?(this._el=this._opts.el,$.apply(this._el,this._opts)):this._el=$.create(this._opts),this.buildContent()),this},this.getId=function(){return this._el&&this._el.id||this._opts&&this._opts.id},this.buildContent=function(){},this.destroy=function(){},this.getElement=function(){return this._el||this.build()._el},this.appendChild=function(e){return this._el||this.build(),this._el.appendChild(e instanceof Element?e._el:e),this},this.appendTo=function(e){return this._el||this.build(),e instanceof Element?e.appendChild(this):e.appendChild(this._el),this},this.setPos=function(e,t){this._el.style.x=e+"px",this._el.style.y=t+"px"},this.center=function(){var e=$(window);this.setPos(Math.max(0,e.width-this._el.offsetWidth)/2,Math.max(0,e.height-this._el.offsetHeight)/2)},this.remove=function(){$.remove(this._el)}})'),jsio.setCachedSrc("sdk/jsio/squill/Events.js",'var sdk_jsio_squill_Events;"use import";jsio("from util.browser import $"),jsio("import .Drag"),jsio("import lib.PubSub");sdk_jsio_squill_Events=__class__;exports=sdk_jsio_squill_Events(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){var e=Array.prototype.slice,t=/(iPod|iPhone|iPad|Android)/i.test(navigator.userAgent);this.event=function(t,n,r){var r,i,s;this._eventEnabled||(this._eventEnabled={});i=[this,r].concat(e.call(arguments,3)),r=bind.apply(this,i),s=this._eventEnabled;s[n]=!0,$.onEvent(t,n,function(){if(s[n])return r.apply(this,arguments)})},this.isDragging=function(){return this._isDragging||!1},this.initDragEvents=function(e){var t;if(!this.__drag){t=this.__drag=new Drag;t.subscribe("DragStart",this,"onDragStart"),t.subscribe("Drag",this,"onDrag"),t.subscribe("DragStop",this,"onDragStop")}t=bind(this.__drag,"startDrag"),e||(e=this._el),e.addEventListener&&e.addEventListener("touchstart",t,!0),$.onEvent(e,"mousedown",t)},this.initMouseEvents=function(e){return e=e||this._el,t?(this.event(e,"touchstart","_onTouchStart"),this.event(e,"touchend","_onTouchEnd")):(this.event(e,"mouseover","onMouseOver"),this.event(e,"mousemove","onMouseMove"),this.event(e,"mouseout","onMouseOut"),this.event(e,"mousedown","onMouseDown"),this.event(e,"mouseup","onMouseUp"),this.event(e,"click","onClick")),this},this.initFocusEvents=function(e){return e=e||this._el,this.event(e,"focus","onFocus"),this.event(e,"blur","onBlur"),this},this.initKeyEvents=function(e){return e=e||this._el,this.event(e,"keydown","onKeyDown"),this.event(e,"keypress","onKeyPress"),this.event(e,"keyup","onKeyUp"),this},this._onTouchStart=function(e){this.onMouseOver(e),this.onMouseDown(e)},this._onTouchEnd=function(e){this.onMouseUp(e),this.onClick(e),this.onMouseOut(e)},this.onMouseOver=function(e){this._enableMouseEvents||(this._isOver=!0),this.publish("Over",e)},this.onMouseMove=function(e){this._enableMouseEvents||this.publish("Move",e)},this.onMouseOut=function(e){this._isOver=!1,this.publish("Out",e)},this.onMouseDown=function(e){return this._isDown=!0,this.publish("Down",e),!1},this.onMouseUp=function(e){return this._isDown=!1,this.publish("Up",e),!1},this.onClick=function(e){return this.publish("Select",e),!1},this.onFocus=function(e){this._isFocused=!0,this.publish("Focus",e)},this.onBlur=function(e){this._isFocused=!1,this.publish("Blur",e)},this.onKeyUp=function(e){this.publish("KeyUp",e)},this.onKeyPress=function(e){this.publish("KeyPress",e)},this.onKeyDown=function(e){this.publish("KeyDown",e)},this.onDragStart=function(){},this.onDrag=function(){},this.onDragStop=function(){}})'),jsio.setCachedSrc("sdk/jsio/squill/Drag.js",'var gCurrentDrag,gCurrentMouse,_active,sdk_jsio_squill_Drag;function resolveMouse(e){var t,n;if(e.touches)return resolveMouse(e.touches[0]);if("pageX"in e)gCurrentMouse.x=e.pageX,gCurrentMouse.y=e.pageY;else{t=document.documentElement,n=document.body;gCurrentMouse.x=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),gCurrentMouse.y=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}}function gAddItem(e){gRemoveItem(e),gCurrentDrag.push(e),_active=!0}function gRemoveItem(e){var t;for(t=0;t<gCurrentDrag.length;++t)gCurrentDrag[t]==e&&(gCurrentDrag.splice(t,1),--t);gCurrentDrag[0]||(_active=!1)}function onMove(e){var t;if(_active){resolveMouse(e);for(t=0;t<gCurrentDrag.length;++t)gCurrentDrag[t].onMouseMove(e)}}function onUp(e){var t;if(_active)for(t=0;t<gCurrentDrag.length;++t)gCurrentDrag[t].onMouseUp(e)}jsio("import lib.PubSub"),jsio("import math.geom.Point as Point"),jsio("from util.browser import $");gCurrentDrag=[],gCurrentMouse={x:0,y:0},_active=!1;"ontouchstart"in window&&document.addEventListener?(document.addEventListener("touchstart",resolveMouse,!0),document.addEventListener("touchmove",onMove,!0),document.addEventListener("touchend",onUp,!0)):(document.addEventListener("mousedown",resolveMouse,!0),document.addEventListener("mousemove",onMove,!0),document.addEventListener("mouseup",onUp,!0));sdk_jsio_squill_Drag=__class__;exports=sdk_jsio_squill_Drag(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(){this._isActive=!1},this.startDrag=function(e,t){var n=this._evt=new exports.DragEvent;this._evt.data=t,this._evt.params=merge(e,{threshold:5}),n.srcPt=new Point(gCurrentMouse),n.currPt=new Point(gCurrentMouse),gAddItem(this)},this.onMouseMove=function(e){var t=this._evt,n=Point.subtract(gCurrentMouse,t.srcPt);!this._isActive&&n.getMagnitude()>t.params.threshold&&(this._isActive=!0,this.setIframesEnabled(!1),this.publish("DragStart",t)),this._isActive&&($.stopEvent(e),t.prevPt=t.currPt,t.currPt=new Point(gCurrentMouse),this.publish("Drag",t,e,Point.subtract(t.currPt,t.prevPt)))},this.onMouseUp=function(e){gRemoveItem(this);if(this._isActive)return $.stopEvent(e),this._isActive=!1,this.setIframesEnabled(!0),this.publish("DragStop",this._evt,e),!0},this.setIframesEnabled=function(e){$("iframe").forEach(function(t){try{e?t.style.pointerEvents=t.__squill_drag_pointer_events:(t.__squill_drag_pointer_events=getComputedStyle(t).getPropertyValue("pointerEvents"),t.style.pointerEvents="none")}catch(n){}})}}),exports.DragEvent=__class__,exports.DragEvent=exports.DragEvent(function(){return this.init&&this.init.apply(this,arguments)},function(){})'),jsio.setCachedSrc("sdk/jsio/squill/global.js",'var gWidgetPrefix="squill-",gWin=window,gDoc=document;exports.setTargetWindow=function(e){gWin=e,gDoc=e.document},exports.getTargetWindow=function(){return gWin},exports.getTargetDocument=function(){return gDoc},exports.setWidgetPrefix=function(e){gWidgetPrefix=e},exports.getWidgetPrefix=function(){return gWidgetPrefix}'),jsio.setCachedSrc("sdk/jsio/squill/i18n.js","var gLang=null;exports.setLang=function(e){gLang=e},exports.get=function(e){return gLang&&gLang.get(e)},exports.Language=__class__,exports.Language=exports.Language(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._dict=e},this.add=function(e,t){this._dict[e]=t},this.get=function(e){return this._dict[e]}})"),jsio.setCachedSrc("sdk/jsio/squill/Delegate.js","var sdk_jsio_squill_Delegate=__class__,Delegate=exports=sdk_jsio_squill_Delegate(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){e&&e(this)},this.extend=function(e){return e=new Delegate(e),e.parent=this,e},this.call=function(e,t){if(this[t])return this[t].apply(e,Array.prototype.slice.call(arguments,1));this.parent&&this.parent.call(e,t)}});"),jsio.setCachedSrc("sdk/jsio/squill/__imports__.js",'exports.classes={alpha:".Alpha",label:".Label",list:".List",text:".TextInput",textarea:".TextArea",password:".TextInput",scroller:".Scroller",canvas:".Canvas",slider:".Slider",color:".Color",vcenter:".VerticalCenter",treelist:".TreeList",graph:".Graph",select:".SelectBox"},exports.resolve=function(e){var n,t=[];if("browser"==e)for(n in exports.classes)t.push(exports.classes[n]);return t}'),jsio.setCachedSrc("sdk/jsio/squill/CheckBox.js",'var sdk_jsio_squill_CheckBox,CheckBox;"use import";jsio("import .Widget"),jsio("from util.browser import $");sdk_jsio_squill_CheckBox=__class__,CheckBox=exports=sdk_jsio_squill_CheckBox(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(){this._def={tag:"label",children:[{id:"checkbox",tag:"input",attrs:{type:"checkbox"}},{tag:"span",id:"label",text:""}]},this.buildWidget=function(){this.setLabel(this._opts.label||""),this._opts.name&&this.setName(this._opts.name),this._opts.value&&this.setValue(this._opts.value),this.initMouseEvents(this.checkbox),$.onEvent(this.checkbox,"change",this,"_onCheck"),this._opts.__result&&this._opts.__result.addSubscription(this,"Select",this._opts.id)},this._onCheck=function(){this.publish("Check",this.isChecked()),this.emit("change",this.isChecked())},this.setLabel=function(e){$.setText(this.label,e)},this.setName=function(e){this.checkbox.name=e},this.setValue=function(e){this.checkbox.checked=!!e},this.isChecked=function(){return this.checkbox.checked},this.setChecked=function(e){this.checkbox.checked=e},this.getValue=function(){return this.isChecked()?this.checkbox.value:null}})'),jsio.setCachedSrc("sdk/jsio/squill/TextButton.js",'var sdk_jsio_squill_TextButton,TextButton;"use import";jsio("import .Button, .Widget"),jsio("from util.browser import $");sdk_jsio_squill_TextButton=__class__,TextButton=exports=sdk_jsio_squill_TextButton(function(){return this.init&&this.init.apply(this,arguments)},Button,function(){this._type="text-button",this.buildWidget=function(){var e=this._el;$.setText(e,this.getI18n("label")||this.getI18n("text")),this.initMouseEvents(e),this.initKeyEvents(e)},this.setLabel=function(e){this._opts.label=e,this._el&&$.setText(this._el,e)}});Widget.register(TextButton,"TextButton")'),jsio.setCachedSrc("sdk/jsio/squill/Button.js",'var sdk_jsio_squill_Button,Button;"use import";jsio("from util.browser import $"),jsio("import .Widget"),jsio("import .hint as hint");sdk_jsio_squill_Button=__class__,Button=exports=sdk_jsio_squill_Button(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="btn",this._type="button",this.init=function(t){t=merge(t,{tag:"button",isEnabled:!0}),this._isEnabled=t.isEnabled,e(this,"init",[t]),this._hint=t.hint},this.create=function(){this._opts.style=JS.merge(this._opts.style,{whiteSpace:"nowrap",display:"block"}),e(this,"create",arguments)},this.buildWidget=function(){var e=this._el;this.initMouseEvents(e),this.initKeyEvents(e),e.style.userSelect="none",e.style.MozUserSelect="none",e.style.KhtmlUserSelect="none",e.unselectable="on"},this._setHintTimeout=function(e){this._hint&&(this._hintTimeout&&clearTimeout(this._hintTimeout),this._hintTimeout=setTimeout(bind(this,function(){hint.show(e.pageX+12,e.pageY+14,this._hint)}),300))},this.onMouseOver=function(e){this._setHintTimeout(e)},this.onMouseMove=function(e){this._setHintTimeout(e)},this.onMouseOut=function(){hint.hide(),this._hintTimeout&&clearTimeout(this._hintTimeout)},this.onClick=function(t){$.stopEvent(t),this._isEnabled&&(this._opts.onClick&&this._opts.onClick(t,this),e(this,"onClick",arguments))},this.captureOnEnter=function(e){e.subscribe("KeyDown",this,"onKeyDown"),e.subscribe("KeyUp",this,"onKeyUp")},this.onKeyDown=function(e){13==e.keyCode&&($.stopEvent(e),this.onMouseDown())},this.onKeyUp=function(e){13==e.keyCode&&($.stopEvent(e),this.onMouseUp(),this.onClick(e))},this.show=function(){this.onBeforeShow(),this.getElement().style.display="inline-block",this.onShow()},this.setEnabled=function(e){this._isEnabled!=e&&((this._isEnabled=e)?$.removeClass(this._el,"disabled"):$.addClass(this._el,"disabled"))}})'),jsio.setCachedSrc("sdk/jsio/squill/hint.js",'var hint,setHintTimeout;"use import";jsio("from util.browser import $");hint=$({parent:document.body,className:"hint"});exports.show=function(e,t,n){hint.innerHTML=n,hint.style.left=e+"px",hint.style.top=t+"px",hint.style.display="block",console.log(n),e+hint.offsetWidth>=document.width&&(hint.style.left=e-hint.offsetWidth+"px")},exports.hide=function(){hint=hint||$({parent:document.body,className:"graphHint"}),hint.style.display="none"};setHintTimeout=function(e){e.target.hintTimeout&&clearTimeout(e.target.hintTimeout),e.target.hintTimeout=setTimeout(bind(this,function(){exports.show(e.pageX+12,e.pageY+14,e.target.hintText)}),300)};exports.add=function(e,t){e.hintText=t,$.onEvent(e,"mouseover",setHintTimeout),$.onEvent(e,"mousemove",setHintTimeout),$.onEvent(e,"mouseout",function(e){exports.hide(),e.target.hintTimeout&&clearTimeout(e.target.hintTimeout)})}'),jsio.setCachedSrc("sdk/jsio/squill/SelectBox.js",'var sdk_jsio_squill_SelectBox,SelectBox;jsio("import .Widget"),jsio("import squill.models.DataSource as DataSource"),jsio("from util.browser import $");sdk_jsio_squill_SelectBox=__class__,SelectBox=exports=sdk_jsio_squill_SelectBox(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="select",this._def={tag:"label",style:{display:"inline-block"},children:[{id:"_select",tag:"select"}]},this.init=function(t){t=merge(t,{renderer:bind(this,"defaultRenderer")}),this._items={},t.dataSource&&this.setDataSource(t.dataSource),e(this,"init",arguments)},this.buildWidget=function(){this._opts.name&&this.setName(this._opts.name),this._dataSource||this.setDataSource(new DataSource);if(this._opts.items){var e=1;this._dataSource.add(this._opts.items.map(function(t){return"object"!=typeof t?{id:"string"==typeof t?t:e++,value:t}:(t.id||(t.id="value"in t?t.value:"title"in t?t.title:e++),t)}))}"value"in this._opts&&this.setValue(this._opts.value),this.initMouseEvents(this._el),$.onEvent(this._select,"change",this,"_onSelect")},this._onSelect=function(){var e=this._dataSource.get(this.getValue());e&&this.publish("change",e)},this.setDataSource=function(e){this._dataSource&&(this._dataSource.unsubscribe("Update",this),this._dataSource.unsubscribe("Remove",this)),this._dataSource=e,this._dataSource.subscribe("Update",this,"onUpdateItem"),this._dataSource.subscribe("Remove",this,"onRemoveItem"),this._dataSource.forEach(function(e,t){this.onUpdateItem(t,e)},this)},this.defaultRenderer=function(e){var t=this._dataSource.getKey();return e.displayName||e.label||e.title||e.text||e[t]},this.onUpdateItem=function(e,t){var n=this._items[e],r=this._dataSource.getKey();if("string"==typeof t){var i={};i[r]=t,t=i}n||(n=this._items[e]=$.create({tag:"option"}),$.insertBefore(this._select,n)),n.setAttribute("value",t[r]),i=this._opts.renderer,n.innerText="string"==typeof i?t[i]:i(t),n.value=t[r]},this.onRemoveItem=function(e){var t=this._items[e],n=this.getValue();t&&($.remove(t),delete this._items[e]),this.getValue()!=n&&this._onSelect()},this.setName=function(e){this._select.name=e},this.setValue=function(e){this._select.value=e},this.getValue=function(){return this._select.value}})'),jsio.setCachedSrc("sdk/jsio/squill/models/DataSource.js",'var sdk_jsio_squill_models_DataSource,DataSource;"use import";jsio("import lib.Callback"),jsio("import .BasicDataSource as BasicDataSource");sdk_jsio_squill_models_DataSource=__class__,DataSource=exports=sdk_jsio_squill_models_DataSource(function(){return this.init&&this.init.apply(this,arguments)},BasicDataSource,function(e){var t={key:"id"};this.init=function(n){this._opts=n=merge(n,t),e(this,"init",[n]),this._byIndex=[],this._byID={},this._ctor=n.ctor,this._reverse=n.reverse,this.length=0,this.onLoad=new lib.Callback,this.setSorter(n.sorter),this.setPersistence(n.persistence),this._changeDataSave=!1,this._changeData={updated:[],updatedHash:{},removed:[],removedHash:{}}},this.setPersistence=function(e){if(this._persistence=e)this.onLoad.clear(),e.load(this,this.onLoad.chain())},this._saveChanges=function(e,t){this._changeDataSave&&!this._changeData[e+"Hash"][t]&&(this._changeData[e+"Hash"][t]=!0,this._changeData[e].push(t))},this.getFilteredDataSource=function(e){var t=new DataSource(this._opts);return this.forEach(function(n){e(n)&&t.add(n)}),this.subscribe("Update",function(n,r){e(r)?t.add(r):t.remove(r)}),this.subscribe("Remove",function(e,n){t.remove(n)}),t},this.signalUpdate=function(e,t,n){if(void 0!==t[this.key])switch(e){case"UPDATE":this._saveChanges("updated",t[this.key]),this.publish("Update",t[this.key],t);break;case"REMOVE":this._saveChanges("removed",t[this.key]),this.publish("Remove",n,t)}};var n=function(){return this._sortKey};this.updated=this.add=function(e){if(isArray(e)){for(var t=[],r=0,s=e.length;r<s;++r)if(e[r]){var o=this.add(e[r]);o&&t.push(o)}return t}t=e[this.key];if(null!=t){s=null;if(this._byID[t]){for(r=0;o=this._byIndex[r];++r)if(o[this.key]==t){"function"==typeof o.update?(o.update(e),e=o):s=r;break}}else s=this.length++;return null!==s&&(this._ctor&&!(e instanceof this._ctor)&&(e=new this._ctor(e)),this._byIndex[s]=e),this._byID[t]=e,this.signalUpdate("UPDATE",e),this._sorter&&(e._sortKey=this._sorter(e),e.toString=n),e}},this.remove=function(e){"object"==typeof e&&(e=e[this.key]);if(null!=e&&this._byID[e]){this.signalUpdate("REMOVE",this._byID[e],e),delete this._byID[e];for(var t=0,n;n=this._byIndex[t];++t)if(n[this.key]==e)return--this.length,this._byIndex.splice(t,1)[0]}},this.keepOnly=function(e){this.compare(e,function(e,t,n){n||e.remove(t)})},this.clear=function(){var e=this._byIndex;this._byIndex=[],this._byID={};for(var t=this.length=0,n;n=e[t];++t)this.signalUpdate("REMOVE",n,n[this.key])},this.getCount=function(){return this.length},this.setSorter=function(e){if(this._sorter=e)for(var t=0,r;r=this._byIndex[t];++t)r._sortKey=e(r),r.toString=n;return this.sort(),this},this.getIDs=function(){return Object.keys(this._byID)},this.contains=function(e){return!!this._byID[e]},this.getKey=function(){return this.key},this.get=this.getItemForID=function(e){return this._byID[e]||null},this.getItemForIndex=function(e){return this._byIndex[e]},this.sort=function(){this._byIndex.sort(),this._reverse&&this._byIndex.reverse()},this.forEach=this.each=function(e,t){for(var n=0;n<this.length&&!e.call(t,this._byIndex[n],n);++n);},this.toJSON=function(){return{key:this.key,items:this._byIndex}},this.fromJSON=function(e){this.clear(),this.key=e.key,this.add(e.items)},this.toArray=function(){return this._byIndex.slice(0)},this.beginChanges=function(){this._changeDataSave=!0,this._changeData={updated:[],updatedHash:{},removed:[],removedHash:{}}},this.saveChanges=function(){this._changeDataSave=!1;if(this._persistence){var e=this._changeData,t,n;this._persistence.remove(e.removed);if(e.updated.length){var r=[];t=0;for(n=e.updated.length;t<n;t++)r.push(this._byID[e.updated[t]]);this._persistence.update(r)}this._persistence.commit()}},this.load=function(e){this._persistence&&this._persistence.load(this,function(t){t&&logger.log("error loading",JSON.stringify(t)),e&&e(t)})},this.save=function(){this._persistence&&this._persistence.save(this)},this.compare=function(e,t){var n=this.key,r={};if(isArray(e))for(var i=0,s=e.length;i<s;++i)r[e[i][n]]=e[i];else for(var o in e)r[o]=e[o];for(var s=this._byIndex.slice(0),i=0,u;u=s[i];++i)o=u[n],t.call(this,this,u,r[o]),delete r[o];for(o in r)t.call(this,this,null,r[o])},this.filter=function(e){var t=new DataSource({key:this.key}),n,r,i,s,o=this.length;t.key=this.key;for(s=0;s<o;++s){r=this._byIndex[s],i=!0;for(n in e)"string"==typeof r[n]&&-1==r[n].toLowerCase().indexOf(e[n])&&(i=!1);i&&t.add(r)}return t}})'),jsio.setCachedSrc("sdk/jsio/lib/Callback.js",'var sdk_jsio_lib_Callback=__class__;exports=sdk_jsio_lib_Callback(function(){return this.init&&this.init.apply(this,arguments)},function(){this._fired=!1,this._id=0,this._pending=null,this.init=function(){this._run=[]},this.hasFired=this.fired=function(){return this._fired},this.reset=function(){this._args=[],this._fired=!1},this.clear=function(){this.reset(),this._run=[],this._stat=this._pending=null},this.forward=function(e){this.run.apply(this,e)},this.run=function(e,t){var n=t?bind.apply(this,arguments):e;return n&&(this._fired?n.apply(this,this._args):this._run.push(n)),this},this.runOrTimeout=function(e,t,n){var r,i;if(e||t)if(this._fired)e.apply(this,this._args);else{r=bind(this,function(){clearTimeout(i),e.apply(this,this._args)});this.run(r);i=setTimeout(bind(this,function(){for(var e=0,n=this._run.length;e<n;++e)if(this._run[e]==r){this._run.splice(e,1);break}t()}),n)}},this.fire=function(){var e,t,n;if(!this._fired){this._fired=!0;e=this._run;this._args=arguments;for(t=0,n=e.length;t<n;++t)e[t]&&e[t].apply(this,arguments)}},this.chain=function(e){return this._pending||(this._pending={}),void 0===e&&(e=this._id++),this._pending[e]=!0,this.reset(),bind(this,"_deferred",e)},this._deferred=function(e){var t;this._stat||(this._stat={});if(!this._stat.hasOwnProperty(e)){this._stat[e]=Array.prototype.slice.call(arguments,1);t=this._pending;delete t[e];for(e in t)if(t.hasOwnProperty(e))return;this.fire(this._stat)}}})'),jsio.setCachedSrc("sdk/jsio/squill/models/BasicDataSource.js",'var sdk_jsio_squill_models_BasicDataSource,BasicDataSource;"use import";jsio("import lib.PubSub as PubSub");sdk_jsio_squill_models_BasicDataSource=__class__,BasicDataSource=exports=sdk_jsio_squill_models_BasicDataSource(function(){return this.init&&this.init.apply(this,arguments)},PubSub,function(e){this.init=function(t){e(this,"init",arguments),this.key=this._key=t.key,this._channel=t.channel,this._hasRemote=t.hasRemote},this.getKey=function(){return this._key}})'),jsio.setCachedSrc("sdk/jsio/squill/jscolor/jscolor.js",'var jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){jscolor.binding&&jscolor.bind(),jscolor.preloading&&jscolor.preload()},getDir:function(){return jscolor.dir="images/colorpicker/",jscolor.dir},detectDir:function(){for(var e=location.href,t=document.getElementsByTagName("base"),n=0;n<t.length;n+=1)t[n].href&&(e=t[n].href);t=document.getElementsByTagName("script");for(n=0;n<t.length;n+=1)if(t[n].src&&/(^|\\/)jscolor\\.js([?#].*)?$/i.test(t[n].src))return e=(new jscolor.URI(t[n].src)).toAbsolute(e),e.path=e.path.replace(/[^\\/]+$/,""),e.query=null,e.fragment=null,e.toString();return!1},bind:function(e){e.color=new jscolor.color(e,{})},preload:function(){for(var e in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(e)&&jscolor.loadImage(e)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=!0},loadImage:function(e){jscolor.imgLoaded[e]||(jscolor.imgLoaded[e]=new Image,jscolor.imgLoaded[e].src=jscolor.getDir()+e)},fetchElement:function(e){return"string"==typeof e?document.getElementById(e):e},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},fireEvent:function(e,t){if(e)if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}else document.createEventObject?(n=document.createEventObject(),e.fireEvent("on"+t,n)):e["on"+t]&&e["on"+t]()},getElementPos:function(e){var t=e,n=0,r=0;if(t.offsetParent)do n+=t.offsetLeft,r+=t.offsetTop;while(t=t.offsetParent);for(;(e=e.parentNode)&&"BODY"!==e.nodeName.toUpperCase();)n-=e.scrollLeft,r-=e.scrollTop;return[n,r]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,n=0;return e||(e=window.event),"number"==typeof e.offsetX?(t=e.offsetX,n=e.offsetY):"number"==typeof e.layerX&&(t=e.layerX,n=e.layerY),{x:t,y:n}},getViewPos:function(){return"number"==typeof window.pageYOffset?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return"number"==typeof window.innerWidth?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(e){function t(e){for(var t="";e;)if("../"===e.substr(0,3)||"./"===e.substr(0,2))e=e.replace(/^\\.+/,"").substr(1);else if("/./"===e.substr(0,3)||"/."===e)e="/"+e.substr(3);else if("/../"===e.substr(0,4)||"/.."===e)e="/"+e.substr(4),t=t.replace(/\\/?[^\\/]*$/,"");else if("."===e||".."===e)e="";else var n=e.match(/^\\/?[^\\/]*/)[0],e=e.substr(n.length),t=t+n;return t}this.authority=this.scheme=null,this.path="",this.fragment=this.query=null,this.parse=function(e){return e=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\\/\\/)([^\\/?#]*))?([^?#]*)((\\?)([^#]*))?((#)(.*))?/),this.scheme=e[3]?e[2]:null,this.authority=e[5]?e[6]:null,this.path=e[7],this.query=e[9]?e[10]:null,this.fragment=e[12]?e[13]:null,this},this.toString=function(){var e="";return null!==this.scheme&&(e=e+this.scheme+":"),null!==this.authority&&(e=e+"//"+this.authority),null!==this.path&&(e+=this.path),null!==this.query&&(e=e+"?"+this.query),null!==this.fragment&&(e=e+"#"+this.fragment),e},this.toAbsolute=function(e){var e=new jscolor.URI(e),n=new jscolor.URI;return null===e.scheme?!1:(null!==this.scheme&&this.scheme.toLowerCase()===e.scheme.toLowerCase()&&(this.scheme=null),null!==this.scheme?(n.scheme=this.scheme,n.authority=this.authority,n.path=t(this.path),n.query=this.query):(null!==this.authority?(n.authority=this.authority,n.path=t(this.path),n.query=this.query):(""===this.path?(n.path=e.path,n.query=null!==this.query?this.query:e.query):("/"===this.path.substr(0,1)?n.path=t(this.path):(n.path=null!==e.authority&&""===e.path?"/"+this.path:e.path.replace(/[^\\/]+$/,"")+this.path,n.path=t(n.path)),n.query=this.query),n.authority=e.authority),n.scheme=e.scheme),n.fragment=this.fragment,n)},e&&this.parse(e)},color:function(b,f){function a(e,t,n){if(null===e)return[n,n,n];var r=Math.floor(e),i=n*(1-t),e=n*(1-t*(r%2?e-r:1-(e-r)));switch(r){case 6:case 0:return[n,e,i];case 1:return[e,n,i];case 2:return[i,n,e];case 3:return[i,e,n];case 4:return[e,i,n];case 5:return[n,i,e]}}function l(t,n){if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(e.pickerCloseText)};for(var r=0;r<jscolor.images.sld[1];r+=4){var i=document.createElement("div");i.style.height="4px",i.style.fontSize="1px",i.style.lineHeight="0",jscolor.picker.sld.appendChild(i)}jscolor.picker.sldB.appendChild(jscolor.picker.sld),jscolor.picker.box.appendChild(jscolor.picker.sldB),jscolor.picker.box.appendChild(jscolor.picker.sldM),jscolor.picker.padB.appendChild(jscolor.picker.pad),jscolor.picker.box.appendChild(jscolor.picker.padB),jscolor.picker.box.appendChild(jscolor.picker.padM),jscolor.picker.btnS.appendChild(jscolor.picker.btnT),jscolor.picker.btn.appendChild(jscolor.picker.btnS),jscolor.picker.box.appendChild(jscolor.picker.btn),jscolor.picker.boxB.appendChild(jscolor.picker.box)}var u=jscolor.picker;u.box.onmouseup=u.box.onmouseout=function(){b.focus()},u.box.onmousedown=function(){o=!0},u.box.onmousemove=function(e){if(p||q)p&&y(e),q&&z(e),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),s()},u.padM.onmouseup=u.padM.onmouseout=function(){p&&(p=!1,jscolor.fireEvent(h,"change"))},u.padM.onmousedown=function(e){p=!0,y(e),s()},u.sldM.onmouseup=u.sldM.onmouseout=function(){q&&(q=!1,jscolor.fireEvent(h,"change"))},u.sldM.onmousedown=function(e){q=!0,z(e),s()},r=x(e),u.box.style.width=r[0]+"px",u.box.style.height=r[1]+"px",u.boxB.style.position="absolute",u.boxB.style.clear="both",u.boxB.style.left=t+"px",u.boxB.style.top=n+"px",u.boxB.style.zIndex=e.pickerZIndex,u.boxB.className="colorMenu",u.pad.style.width=jscolor.images.pad[0]+"px",u.pad.style.height=jscolor.images.pad[1]+"px",u.padB.style.position="absolute",u.padB.style.left=e.pickerFace+"px",u.padB.style.top=e.pickerFace+"px",u.padB.style.border=e.pickerInset+"px solid",u.padB.style.borderColor=e.pickerInsetColor,u.padM.style.position="absolute",u.padM.style.left="0",u.padM.style.top="0",u.padM.style.width=e.pickerFace+2*e.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px",u.padM.style.height=u.box.style.height,u.padM.style.cursor="crosshair",u.sld.style.overflow="hidden",u.sld.style.width=jscolor.images.sld[0]+"px",u.sld.style.height=jscolor.images.sld[1]+"px",u.sldB.style.display=e.slider?"block":"none",u.sldB.style.position="absolute",u.sldB.style.right=e.pickerFace+"px",u.sldB.style.top=e.pickerFace+"px",u.sldB.style.border=e.pickerInset+"px solid",u.sldB.style.borderColor=e.pickerInsetColor,u.sldM.style.display=e.slider?"block":"none",u.sldM.style.position="absolute",u.sldM.style.right="0",u.sldM.style.top="0",u.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+e.pickerFace+2*e.pickerInset+"px",u.sldM.style.height=u.box.style.height;try{u.sldM.style.cursor="pointer"}catch(a){u.sldM.style.cursor="hand"}u.btn.style.display=e.pickerClosable?"block":"none",u.btn.style.position="absolute",u.btn.style.left=e.pickerFace+"px",u.btn.style.bottom=e.pickerFace+"px",u.btn.style.padding="0 15px",u.btn.style.height="18px",u.btn.style.border=e.pickerInset+"px solid",function(){var t=e.pickerInsetColor.split(/\\s+/);u.btn.style.borderColor=2>t.length?t[0]:t[1]+" "+t[0]+" "+t[0]+" "+t[1]}(),u.btn.style.color=e.pickerButtonColor,u.btn.style.font="12px sans-serif",u.btn.style.textAlign="center";try{u.btn.style.cursor="pointer"}catch(f){u.btn.style.cursor="hand"}u.btn.onmousedown=function(){e.hidePicker()},u.btnS.style.lineHeight=u.btn.style.height;switch(m){case 0:var l="hs.png";break;case 1:l="hv.png"}u.padM.style.backgroundImage="url(\'"+jscolor.getDir()+"cross.gif\')",u.padM.style.backgroundRepeat="no-repeat",u.sldM.style.backgroundImage="url(\'"+jscolor.getDir()+"arrow.gif\')",u.sldM.style.backgroundRepeat="no-repeat",u.pad.style.backgroundImage="url(\'"+jscolor.getDir()+l+"\')",u.pad.style.backgroundRepeat="no-repeat",u.pad.style.backgroundPosition="0 0",A(),B(),jscolor.picker.owner=e,document.getElementsByTagName("body")[0].appendChild(u.boxB)}function x(e){return[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]]}function A(){switch(m){case 0:var t=1;break;case 1:t=2}var n=Math.round(e.hsv[0]/6*(jscolor.images.pad[0]-1)),t=Math.round((1-e.hsv[t])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=e.pickerFace+e.pickerInset+n-Math.floor(jscolor.images.cross[0]/2)+"px "+(e.pickerFace+e.pickerInset+t-Math.floor(jscolor.images.cross[1]/2))+"px",n=jscolor.picker.sld.childNodes;switch(m){case 0:for(var r=a(e.hsv[0],e.hsv[1],1),t=0;t<n.length;t+=1)n[t].style.backgroundColor="rgb("+100*r[0]*(1-t/n.length)+"%,"+100*r[1]*(1-t/n.length)+"%,"+100*r[2]*(1-t/n.length)+"%)";break;case 1:var i,s=[e.hsv[2],0,0],t=Math.floor(e.hsv[0]),o=t%2?e.hsv[0]-t:1-(e.hsv[0]-t);switch(t){case 6:case 0:r=[0,1,2];break;case 1:r=[1,0,2];break;case 2:r=[2,0,1];break;case 3:r=[2,1,0];break;case 4:r=[1,2,0];break;case 5:r=[0,2,1]}for(t=0;t<n.length;t+=1)i=1-1/(n.length-1)*t,s[1]=s[0]*(1-i*o),s[2]=s[0]*(1-i),n[t].style.backgroundColor="rgb("+100*s[r[0]]+"%,"+100*s[r[1]]+"%,"+100*s[r[2]]+"%)"}}function B(){switch(m){case 0:var t=2;break;case 1:t=1}t=Math.round((1-e.hsv[t])*(jscolor.images.sld[1]-1)),jscolor.picker.sldM.style.backgroundPosition="0 "+(e.pickerFace+e.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function t(){return jscolor.picker&&jscolor.picker.owner===e}function C(){h!==b&&e.importColor()}function y(t){var n=jscolor.getRelMousePos(t),t=n.x-e.pickerFace-e.pickerInset,n=n.y-e.pickerFace-e.pickerInset;switch(m){case 0:e.fromHSV(t*(6/(jscolor.images.pad[0]-1)),1-n/(jscolor.images.pad[1]-1),null,u);break;case 1:e.fromHSV(t*(6/(jscolor.images.pad[0]-1)),null,1-n/(jscolor.images.pad[1]-1),u)}}function z(t){t=jscolor.getRelMousePos(t).y-e.pickerFace-e.pickerInset;switch(m){case 0:e.fromHSV(null,null,1-t/(jscolor.images.sld[1]-1),v);break;case 1:e.fromHSV(null,1-t/(jscolor.images.sld[1]-1),null,v)}}function s(){e.onImmediateChange&&("string"==typeof e.onImmediateChange?eval(e.onImmediateChange):e.onImmediateChange(e))}this.adjust=this.required=!0,this.hash=!1,this.slider=this.caps=!0,this.styleElement=this.valueElement=b,this.onImmediateChange=null,this.hsv=[0,0,1],this.rgb=[1,1,1],this.pickerOnfocus=!0,this.pickerMode="HSV",this.pickerPosition="bottom",this.pickerSmartPosition=!0,this.pickerButtonHeight=20,this.pickerClosable=!1,this.pickerCloseText="Close",this.pickerButtonColor="ButtonText",this.pickerFace=10,this.pickerFaceColor="ThreeDFace",this.pickerBorder=1,this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight",this.pickerInset=1,this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",this.pickerZIndex=1e4;for(var n in f)f.hasOwnProperty(n)&&(this[n]=f[n]);this.hidePicker=function(){t()&&(delete jscolor.picker.owner,document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB))},this.showPicker=function(){if(!t()){var e=jscolor.getElementPos(b),n=jscolor.getElementSize(b),r=jscolor.getViewPos(),i=jscolor.getViewSize(),s=x(this),o,u,a;switch(this.pickerPosition.toLowerCase()){case"left":o=1,u=0,a=-1;break;case"right":o=1,u=0,a=1;break;case"top":o=0,u=1,a=-1;break;default:o=0,a=u=1}var f=(n[u]+s[u])/2,e=this.pickerSmartPosition?[-r[o]+e[o]+s[o]>i[o]?-r[o]+e[o]+n[o]/2>i[o]/2&&0<=e[o]+n[o]-s[o]?e[o]+n[o]-s[o]:e[o]:e[o],-r[u]+e[u]+n[u]+s[u]-f+f*a>i[u]?-r[u]+e[u]+n[u]/2>i[u]/2&&0<=e[u]+n[u]-f-f*a?e[u]+n[u]-f-f*a:e[u]+n[u]-f+f*a:0<=e[u]+n[u]-f+f*a?e[u]+n[u]-f+f*a:e[u]+n[u]-f-f*a]:[e[o],e[u]+n[u]-f+f*a];l(e[o],e[u])}},this.importColor=function(){h?this.adjust?!this.required&&/^\\s*$/.test(h.value)?(h.value="",i.style.backgroundColor=i.jscStyle.backgroundColor,i.style.color=i.jscStyle.color,this.exportColor(r|w)):this.fromString(h.value)||this.exportColor():this.fromString(h.value,r)||(i.style.backgroundColor=i.jscStyle.backgroundColor,i.style.color=i.jscStyle.color,this.exportColor(r|w)):this.exportColor()},this.exportColor=function(e){if(!(e&r)&&h){var n=this.toString();this.caps&&(n=n.toUpperCase()),this.hash&&(n="#"+n),h.value=n}!(e&w)&&i&&(i.style.backgroundColor="#"+this.toString(),i.style.color=.5>.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]?"#FFF":"#000"),!(e&v)&&t()&&A(),!(e&u)&&t()&&B()},this.fromHSV=function(e,t,n,r){0>e&&(e=0)||6<e&&(e=6),0>t&&(t=0)||1<t&&(t=1),0>n&&(n=0)||1<n&&(n=1),this.rgb=a(null===e?this.hsv[0]:this.hsv[0]=e,null===t?this.hsv[1]:this.hsv[1]=t,null===n?this.hsv[2]:this.hsv[2]=n),this.exportColor(r)},this.fromRGB=function(e,t,n,r){0>e&&(e=0)||1<e&&(e=1),0>t&&(t=0)||1<t&&(t=1),0>n&&(n=0)||1<n&&(n=1);var e=null===e?this.rgb[0]:this.rgb[0]=e,t=null===t?this.rgb[1]:this.rgb[1]=t,i=null===n?this.rgb[2]:this.rgb[2]=n,s=Math.min(Math.min(e,t),i),n=Math.max(Math.max(e,t),i),o=n-s;0===o?e=[null,0,n]:(e=e===s?3+(i-t)/o:t===s?5+(e-i)/o:1+(t-e)/o,e=[6===e?0:e,o/n,n]),null!==e[0]&&(this.hsv[0]=e[0]),0!==e[2]&&(this.hsv[1]=e[1]),this.hsv[2]=e[2],this.exportColor(r)},this.fromString=function(e,t){var n=e.match(/^\\W*([0-9A-F]{3}([0-9A-F]{3})?)\\W*$/i);return n?(6===n[1].length?this.fromRGB(parseInt(n[1].substr(0,2),16)/255,parseInt(n[1].substr(2,2),16)/255,parseInt(n[1].substr(4,2),16)/255,t):this.fromRGB(parseInt(n[1].charAt(0)+n[1].charAt(0),16)/255,parseInt(n[1].charAt(1)+n[1].charAt(1),16)/255,parseInt(n[1].charAt(2)+n[1].charAt(2),16)/255,t),!0):!1},this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var e=this,m="hvs"===this.pickerMode.toLowerCase()?1:0,o=!1,h=jscolor.fetchElement(this.valueElement),i=jscolor.fetchElement(this.styleElement),p=!1,q=!1,r=1,w=2,v=4,u=8;jscolor.addEvent(b,"focus",function(){e.pickerOnfocus&&e.showPicker()}),jscolor.addEvent(b,"blur",function(){o?o=!1:window.setTimeout(function(){o||(h===b&&e.importColor(),e.pickerOnfocus&&e.hidePicker()),o=!1},0)}),h&&(n=function(){e.fromString(h.value,r),s()},jscolor.addEvent(h,"keyup",n),jscolor.addEvent(h,"input",n),jscolor.addEvent(h,"blur",C),h.setAttribute("autocomplete","off")),i&&(i.jscStyle={backgroundColor:i.style.backgroundColor,color:i.style.color});switch(m){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif"),jscolor.requireImage("arrow.gif"),this.importColor()}};"use import";exports=jscolor'),jsio.setCachedSrc("sdk/jsio/squill/Label.js",'var sdk_jsio_squill_Label;jsio("from util.browser import $"),jsio("import squill.Widget");sdk_jsio_squill_Label=__class__;exports=sdk_jsio_squill_Label(function(){return this.init&&this.init.apply(this,arguments)},squill.Widget,function(){this._css="label",this._def={children:[{id:"_labelSpan",tag:"span"}]},this.buildWidget=function(){this.setLabel(this.getI18n("label"))},this.setLabel=this.setText=function(e){$.setText(this._labelSpan,e)},this.setHTML=function(e){this._labelSpan.innerHTML=e}})'),jsio.setCachedSrc("sdk/jsio/squill/List.js",'var sdk_jsio_squill_List,List;"use import";jsio("import .Widget"),jsio("from util.browser import $"),jsio("import .models.DataSource as DataSource"),jsio("import .Selection");sdk_jsio_squill_List=__class__,List=exports=sdk_jsio_squill_List(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this.init=function(t){t=merge(t,{containSelf:!0,margin:0,isTiled:!1,preserveCells:!1,renderAll:!0,isFixedHeight:!0,absolutePosition:!0,filter:null}),this.needsRender=delay(this.render),t.cellCtor&&this.setCellCtor(t.cellCtor),t.dataSource&&this.setDataSource(t.dataSource),t.sorter&&this.setSorter(t.sorter),this._lastFilter=-1,this._filter=t.filter,this._cellsByID={},this._removed={},this._containSelf=t.containSelf,this._containerTag=t.containerTag,this._applyNodeOrder=t.applyNodeOrder,this._renderOpts={margin:t.margin||0},this.updateFilter=delay(function(){this._lastFilter=-1,this.needsRender()},100),e(this,"init",[t])},this.getContainer=function(){return this._container},this.getDataSource=function(){return this._dataSource},this.setDataSource=function(e){this._dataSource!=e&&(this._dataSource&&(this._dataSource.unsubscribe("Update",this),this._dataSource.unsubscribe("Remove",this),this.clear()),this._dataSource=e,this._dataSource.subscribe("Update",this,"onUpdateItem"),this._dataSource.subscribe("Remove",this,"onRemoveItem"),this.needsRender())},this.onUpdateItem=function(e,t){var n=this._cellsByID[e];n&&n.getData()!=t&&n.setData(t),this.updateFilter()},this.onRemoveItem=function(e){this._removed[e]=!0,this.updateFilter()},this.buildWidget=function(){this._container=$({parent:this._el,className:this._opts.containerClassName,tag:this._containerTag||"div"}),this._containSelf&&!this._applyNodeOrder&&(this._container.style.position="relative"),this._opts.selectable&&this.setSelectable(this._opts.selectable),this.render()},this.setSelectable=function(e){this.selection=(new Selection({parent:this,type:e})).subscribe("Select",this,"_onSelected",!0).subscribe("Deselect",this,"_onSelected",!1),this.selection},this._onSelected=function(e,t,n){void 0!==this._cellsByID[n]&&this._cellsByID[n].updateSelected()},this.setCellCtor=function(e){e!=this._cellCtor&&(this._cellCtor=e,this.clear())},this.clear=function(){for(var e in this._cellsByID)this._cellsByID[e].remove();this._cellsByID={},this._cellDim=this._renderedDataSource=null},this.getCellById=function(e){return this._cellsByID[e]},this.getCells=function(){return this._cellsByID},this.setSorter=function(e){this._sorter=e},this.setFilter=function(e){this._filter=e,this.needsRender()},this.setFixedHeight=function(e){this._opts.isFixedHeight=e},this._applyFilter=function(){for(var e=this._filter,t=this._renderedDataSource=new DataSource({key:this._dataSource.getKey()}),n=this._dataSource,r=0,i=n.length;r<i;++r){var s=n.getItemForIndex(r),o=!0,u;for(u in e)e[u]instanceof RegExp?s[u].match(e[u])||(o=!1):"string"==typeof s[u]&&-1==s[u].toLowerCase().indexOf(e[u])&&(o=!1);o?t.add(s):this._removed[s[t.key]]=!0}},this.onShow=function(){e(this,"onShow",arguments),this.needsRender()},this.render=function(){if(this._dataSource){this._dataSource.sort();if(this._filter!=this._lastFilter||!this._renderedDataSource)this._lastFilter=this._filter,this._applyFilter();this._opts.renderAll?this.renderAllDelayed():this._opts.isFixedHeight?this.renderFixedHeight():this.renderDynamicHeight(),this._removed={}}},this.setCellDim=function(e){this._cellDim=e},this.getCellDim=function(){if(this._cellDim)return this._cellDim;if(this._opts.isFixedHeight){var e=this._dataSource.getItemForIndex(0);if(!e)return!1;var t=e[this._dataSource.getKey()],e=this._cellsByID[t]||(this._cellsByID[t]=this._createCell(e)),e=$.size(e.getElement());if(0==e.width||0==e.height)return null;if(t=this._opts.margin)e.width+=t,e.height+=t;return this._cellDim=e}throw"unimplemented"},this._createCell=function(e){var t=this._dataSource.getKey(),n=new this._cellCtor({parent:this,controller:this,key:t,data:e});return n.getElement().setAttribute("squill-data-id",e[t]),n.render(),n},this._nodeOrder=function(){var e=this._container,t=this._renderedDataSource,n=t.key,r,i,s,o;if(e.childNodes.length){r=document.createElement("div"),e.insertBefore(r,e.childNodes[0]);for(o=0;o<t.length;o++)i=t.getItemForIndex(o),i=this._cellsByID[i[n]],s=i.getElement(),i&&s.parentNode&&e.insertBefore(e.removeChild(s),r);e.removeChild(r)}},this.renderAllDelayed=function(){function e(){for(var r=0,i=+(new Date);10>r++||50>+(new Date)-i;){var s;if(s=t.getItemForIndex(n)){var o=s[t.getKey()],u=this._cellsByID[o];u?u.render():u=this._cellsByID[o]=this._createCell(s),!this._applyNodeOrder&&this.positionCell(u,n),++n,s=!0}else s=!1;if(!s){this._applyNodeOrder&&this._nodeOrder();return}}setTimeout(bind(this,e),100)}var t=this._renderedDataSource;if(t){this.updateRenderOpts();var n=0,r=this._removed,i;for(i in r)if(!t.getItemForID(i)){var s=this._cellsByID[i];s&&(s.remove(),delete this._cellsByID[i])}e.call(this)}},this.setOffsetParent=function(e){this._opts.offsetParent=e},this.setTiled=function(e){this._isTiled=this._opts.isTiled=e},this.updateRenderOpts=function(){var e=this._renderOpts;e.offsetTop=this._containSelf?0:this._container.offsetTop,e.offsetLeft=this._containSelf?0:this._container.offsetLeft;var t=this._offsetParent||this.getOffsetParent();e.top=(t.getAttribute("squill-scroller-top")||t.scrollTop)-e.offsetTop,e.height=t.offsetHeight,e.bottom=e.top+e.height;if(this._opts.isFixedHeight){var n=this.getCellDim();if(!n)return!1;e.cellWidth=n.width,e.cellHeight=n.height}return n=e.numRows=this._renderedDataSource.length,this._opts.isFixedHeight&&(this._opts.isTiled?(e.maxWidth=t.offsetWidth-e.offsetLeft,e.numPerRow=Math.max(1,e.maxWidth/e.cellWidth|0),e.numRows=Math.ceil(n/e.numPerRow),e.start=Math.max(0,(e.top/e.cellHeight|0)*e.numPerRow),e.end=Math.ceil(e.bottom/e.cellHeight)*e.numPerRow):(e.start=Math.max(0,e.top/e.cellHeight|0),e.end=e.bottom/e.cellHeight+1|0)),this._applyNodeOrder||(this._container.style.height=this._opts.absolutePosition?e.numRows*e.cellHeight+"px":"auto"),!0},this.positionCell=function(e,t){if(this._opts.absolutePosition){var n=this._renderOpts,r=e.getElement(),i,s;this._opts.isTiled?(i=t%n.numPerRow,s=t/n.numPerRow|0,r.style.left=i*n.cellWidth+n.offsetLeft+"px",r.style.top=s*n.cellHeight+n.offsetTop+"px"):r.style.top=(t*n.cellHeight||0)+n.offsetTop+"px"}},this.getOffsetParent=function(){return this._opts.offsetParent||(this._containSelf?this._container:this._container.offsetParent)||document.body},this.renderFixedHeight=function(){var e=this.getOffsetParent();if(e){e!=this._offsetParent&&(this._removeScrollEvt&&this._removeScrollEvt(),this._offsetParent=e,this._removeScrollEvt=$.onEvent(e,"scroll",this,"needsRender"));var e=this._renderedDataSource,t=e.getKey(),n=e.length;if(!n||this.updateRenderOpts()){var r=this._cellsByID;this._cellsByID={};if(n)for(var n=this._renderOpts,i=n.start;i<n.end;++i){var s=e.getItemForIndex(i);if(!s)break;var o=s[t],u=r[o];u?(delete r[o],u.render()):u=this._createCell(s),this.positionCell(u,i),this._cellsByID[o]=u}if(this._opts.preserveCells)for(o in r)u=r[o],e.getItemForID(o)?this._cellsByID[o]=u:u.remove();else for(o in r)r[o].remove()}}}})'),jsio.setCachedSrc("sdk/jsio/squill/Selection.js",'var sdk_jsio_squill_Selection;"use import";jsio("import lib.PubSub");sdk_jsio_squill_Selection=__class__;exports=sdk_jsio_squill_Selection(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(e){this._parent=e.parent,this._type=e.type||!1,this._selection=e.selectionStore||new exports.LocalStore,this._maxSelections=e.maxSelections||1,this._currentSelectionCount=0,this._lastSelected=null},this.getType=function(){return this._type},this.isSelected=function(e){return"object"==typeof e&&(e=e[this._parent.getDataSource().key]),this._selection.isSelected(e)},this.toggle=function(e){this._setSelected(e,!this.isSelected(e[this._parent.getDataSource().key]))},this.select=function(e){(this._currentSelectionCount<this._maxSelections||"single"==this._type)&&this._setSelected(e,!0)},this.deselect=function(e){this._setSelected(e,!1)},this.deselectAll=function(){this._selection.deselectAll(),this._currentSelectionCount=0},this.get=function(){return this._selection.get()},this.getSelectionCount=function(){return this._currentSelectionCount},this._setSelected=function(e,t){var n,r;if(e){n=this._parent.getDataSource(),r=n.key;"string"==typeof e&&(e=n.get(e)),n=e[r],this._selection.isSelected(n)!=t&&(t?(this._lastSelected&&"single"==this._type&&(r=this._lastSelected[r],this._selection.deselect(r),this._currentSelectionCount--,this.publish("Deselect",this._lastSelected,r)),this._lastSelected=e,this._selection.select(n),this._currentSelectionCount++):(this._selection.deselect(n),this._currentSelectionCount--),this.publish(t?"Select":"Deselect",e,n))}}}),exports.LocalStore=__class__,exports.LocalStore=exports.LocalStore(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._store={}},this.get=function(){return merge({},this._store)},this.select=function(e){this._store[e]=!0},this.deselect=function(e){delete this._store[e]},this.deselectAll=function(){this._store={}},this.isSelected=function(e){var t;if(void 0!==e)return!!this._store[e];for(t in this._store)return!0;return!1}})'),jsio.setCachedSrc("sdk/jsio/squill/TextInput.js",'var sdk_jsio_squill_TextInput,TextInput;jsio("from util.browser import $"),jsio("import .Widget, .global");sdk_jsio_squill_TextInput=__class__,TextInput=exports=sdk_jsio_squill_TextInput(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._type="text",this._css="textInput",this._class=null===global.getWidgetPrefix()?"":global.getWidgetPrefix()+this._css,this.init=function(t){t=merge(t,{name:"",value:"",type:"text",multiline:!1}),this._def={children:[{tag:t.multiline?"textarea":"input",id:"_input",attrs:{type:t.type,value:t.value,name:t.name},style:merge(t.textStyle,{display:"block",MozBoxSizing:"border-box",WebkitBoxSizing:"border-box",MsBoxSizing:"border-box",boxSizing:"border-box"})}],style:{position:"relative"}},t.prefixLabel&&this._def.children.unshift({id:"_label",text:t.label}),e(this,"init",[t])},this.buildWidget=function(){var e=this._el;"ontouchstart"in this._el&&(this._overlay=$({parent:this._el,attrs:{noCapture:!0},style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:1}}),this._overlay.addEventListener("click",bind(this,function(){$.hide(this._overlay),this._input.focus()}),!0));if(!this._opts.prefixLabel||this._opts.placeholder){var t=this.getI18n("label");null===this._input.getAttribute("placeholder")?this._input.setAttribute("placeholder",this._opts.placeholder||t):this._placeholder=$.create({tag:"button",text:t,className:global.getWidgetPrefix()+"textInputLabel",style:{position:"absolute"},parent:e})}this.initMouseEvents(e),this.initFocusEvents(this._input),this.initKeyEvents(this._input)},this.getInputElement=function(){return this._input},this.setName=function(t){e(this,"setName",arguments),this._input&&(this._input.name=t)},this.setValue=function(e){this._value=this._input.value=e},this.getValue=function(){return this._input.value},this.onKeyDown=function(){e(this,"onKeyDown",arguments),this._placeholder&&$.hide(this._placeholder)},this.onKeyUp=function(){e(this,"onKeyUp",arguments),this.checkLabel(),this.checkValue()},this.onMouseDown=function(t){e(this,"onMouseDown",arguments),t.stopPropagation()},this.onKeyPress=function(t){e(this,"onKeyPress",arguments),13==t.keyCode&&this.publish("EnterPressed"),this.checkValue()},this.onBlur=function(){e(this,"onBlur"),this.checkLabel(),this._overlay&&$.show(this._overlay)},this.checkValue=function(){this._value!=this._input.value&&(this._value=this._input.value,this.publish("change",this._value),this.publish("ValueChange",this._value))},this.checkLabel=function(){this._placeholder&&/^\\s*$/.test(this._input.value)&&$.show(this._placeholder)},this.onClick=function(){e(this,"onClick")}});Widget.register(TextInput,"TextInput")'),jsio.setCachedSrc("sdk/jsio/squill/TextArea.js",'var sdk_jsio_squill_TextArea,TextArea;"use import";jsio("from util.browser import $"),jsio("import .Widget"),jsio("import .TextInput");sdk_jsio_squill_TextArea=__class__,TextArea=exports=sdk_jsio_squill_TextArea(function(){return this.init&&this.init.apply(this,arguments)},TextInput,function(){this._tag="textarea"});Widget.register(TextArea,"TextArea")'),jsio.setCachedSrc("sdk/jsio/squill/Scroller.js",'var sdk_jsio_squill_Scroller;"use import";jsio("import .Drag"),jsio("import .Widget"),jsio("import .transforms"),jsio("from util.browser import $");sdk_jsio_squill_Scroller=__class__;exports=sdk_jsio_squill_Scroller(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="scroller",this.init=function(t){t=merge(t,{momentum:!0}),this._scrollTop=0,this._lastDelta={diff:0,when:0,duration:0},this._hasMomentum=t.momentum,e(this,"init",[t])},this.buildContent=function(){var t=this._el;return $.style(t,{height:"100%"}),this._scrollPane=$({parent:t,className:"squill-scrollPane",minHeight:"100%"}),"ontouchstart"in t?(t.addEventListener("touchstart",bind(this,"onTouchStart"),!0),t.addEventListener("mousedown",this,"start"),this.initDragEvents(),this._el.style.overflow="hidden",transforms.setTop(this._scrollPane,0)):this._el.style.overflow="auto",this._def&&(t=this._def,this._def=null,this.buildChildren(merge({el:this._scrollPane},t))),e(this,"buildContent",arguments)},this.getScrollTop=function(){return this._scrollTop},this.getContainer=this.getScrollPane=function(){return this._scrollPane},this.onTouchStart=function(){this._momentum&&clearInterval(this._momentum)},this.onDragStart=function(){this._height=this._scrollPane.offsetHeight-this._el.offsetHeight,this._lastDelta.when=+(new Date),this._momentum&&clearInterval(this._momentum)},this.onDrag=function(e,t,n){e=+(new Date),t=this._lastDelta,t.diff=n.y,t.duration=t.when&&e-t.when||0,t.when=e,this.scrollTo(this._scrollTop+n.y)},this.scrollTo=function(e,t){var n;this._scrollTop=e,this._scrollTop<-this._height&&(this._scrollTop=-this._height),0<this._scrollTop&&(this._scrollTop=0),this._el.setAttribute("squill-scroller-top",-this._scrollTop);n=bind(this,function(){if(document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("scroll",!0,!1),this._el.dispatchEvent(e)}});t?transforms.move(this._scrollPane,0,this._scrollTop,"0.5s ease-in-out",n):(transforms.move(this._scrollPane,0,this._scrollTop),n())},this.onDragStop=function(e,t){var n,r,i;$.stopEvent(t);if(this._hasMomentum&&0!=this._lastDelta.duration){n=this._lastDelta,r=n.diff/n.duration,i=n.when;this._momentum=setInterval(bind(this,function(){var e=+(new Date);this.scrollTo(this._scrollTop+r*(e-i)),r*=.95,.01>Math.abs(r)&&(clearTimeout(this._momentum),this._momentum=null),i=e}),10)}}})'),jsio.setCachedSrc("sdk/jsio/squill/transforms.js",'var vendor,has3d,hasTransform,translateStart,translateEnd;"use import";jsio("from util.browser import $");vendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",has3d="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,hasTransform=vendor+"Transform"in document.documentElement.style,translateStart="translate"+(has3d?"3d(":"("),translateEnd=has3d?",0)":")";hasTransform?(exports.setLeft=function(e,t){e.style[vendor+"Transform"]=translateStart+t+"px,0"+translateEnd},exports.setTop=function(e,t){e.style[vendor+"Transform"]=translateStart+"0,"+t+"px"+translateEnd}):(exports.setLeft=function(e,t){e.style.left=t+"px"},exports.setTop=function(e,t){e.style.top=t+"px"}),exports.onTransitionEnd=function(e,t){var n=!1,r=function(){if(!n){n=!0;for(var e=0,r;r=i[e];++e)r();t()}},i=[$.onEvent(e,"webkitTransitionEnd",r),$.onEvent(e,"transitionend",r),$.onEvent(e,"oTransitionEnd",r)];},exports.setTransition=function(e,t,n){var r;if(t){r=e.style[vendor+"Transition"];exports.onTransitionEnd(e,function(){e.style[vendor+"Transition"]=r,n&&n()}),e.style[vendor+"Transition"]="-"+vendor+"-transform "+t}else e.style[vendor+"Transition"]="none"},exports.rotate=function(e,t,n,r){hasTransform?(exports.setTransition(e,n,r),e.style[vendor+"Transform"]="rotate("+t+")",r&&!n&&r()):r&&r()},exports.move=function(e,t,n,r,i){hasTransform?(exports.setTransition(e,r,i),e.style[vendor+"Transform"]=translateStart+t+"px,"+n+"px"+translateEnd,i&&!r&&i()):i&&i()},exports.hasTransform=hasTransform'),jsio.setCachedSrc("sdk/jsio/squill/Canvas.js",'var sdk_jsio_squill_Canvas,Canvas;"use import";jsio("from util.browser import $"),jsio("import .Widget");sdk_jsio_squill_Canvas=__class__,Canvas=exports=sdk_jsio_squill_Canvas(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="cnvs",this._type="canvas",this.init=function(t){t=merge(t,{tag:"canvas"}),this._isEnabled=t.isEnabled,e(this,"init",[t])},this.create=function(){e(this,"create",arguments)},this.buildWidget=function(){var e=this._el;e.width=this._opts.width,e.height=this._opts.height,this._opts.color&&(e.style.backgroundColor=this._opts.color),this.initMouseEvents(e),this.initKeyEvents(e)}})'),jsio.setCachedSrc("sdk/jsio/squill/Slider.js",'var sdk_jsio_squill_Slider,Slider;"use import";jsio("from util.browser import $"),jsio("import .Widget");sdk_jsio_squill_Slider=__class__,Slider=exports=sdk_jsio_squill_Slider(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="rng",this._type="range",this.init=function(t){this._width=t.width||100,this._padding=12,this._hover=!1,this._fillColor=t.fillColor||"#000000",this._lineColor=t.lineColor||"#FFFFFF",this._def={children:[{id:t.id+"Canvas",tag:"canvas",attrs:{width:this._width,height:2*this._padding}}]},e(this,"init",[t])},this._render=function(){var e=this._width,t=this._padding,n=this._ctx;n.clearRect(0,0,e,2*t),n.lineCap="round",n.beginPath(),n.arc(t+2,t,2,.5*Math.PI,1.5*Math.PI,!1),n.arc(e-t-2,t,2,1.5*Math.PI,.5*Math.PI,!1),n.closePath(),n.lineWidth=1,n.strokeStyle=this._lineColor,n.stroke(),n.fillStyle=this._fillColor,n.fill(),n.save(),this._hover&&(n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=10,n.shadowColor="#0099FF"),e=~~((e-2*t)*(this.value-this.min)/(this.max-this.min)),n.beginPath(),n.arc(t+e,t,5,0,2*Math.PI,!1),n.closePath(),t=n.createRadialGradient(t-1+e,t-1,0,t+e,t,4),t.addColorStop(0,"#FFFFFF"),t.addColorStop(1,"#707070"),n.fillStyle=t,n.fill(),n.restore()},this.buildWidget=function(){var e=this._el;canvas=e.firstChild,e.slider=this,$.onEvent(canvas,"mouseout",this,"_onMouseOut"),$.onEvent(canvas,"mousedown",this,"_onMouseDown"),$.onEvent(canvas,"mouseup",this,"_onMouseUp"),$.onEvent(canvas,"mousemove",this,"_onMouseMove"),this.min=this._opts.min||0,this.max=this._opts.max||100,this.step=this._opts.step||1,this.value=this._opts.value||0,this._mouseDown=!1,this._checkRange(),this._ctx=canvas.getContext("2d"),this._render()},this.setValue=function(e){this.value=e,this._render()},this._onChange=function(){this.publish("Change",this.value)},this._checkRange=function(){this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max)},this._checkMouse=function(e){var t=e.offsetX,n=e.offsetY,r=this._width,i=this._padding,s=this._hover;this._mouseDown?t>i&&n>i-5&&t<r-i&&n<i+5&&(e=(e.offsetX-i)/(r-2*i)*(this.max-this.min),this.value=e=this.min+Math.round(e/this.step)*this.step,this._checkRange(),this._render(),this._onChange()):(n>i-5&&n<i+5?(v=i+~~((r-2*i)*(this.value-this.min)/(this.max-this.min)),this._hover=t>v-5&&n<v+5):this._hover=!1,this._hover!==s&&this._render())},this._onMouseOut=function(){this._hover=this._mouseDown=!1,this._render()},this._onMouseDown=function(e){this._mouseDown=!0,this._checkMouse(e)},this._onMouseUp=function(){this._mouseDown=!1},this._onMouseMove=function(e){this._checkMouse(e)}})'),jsio.setCachedSrc("sdk/jsio/squill/Color.js",'var sdk_jsio_squill_Color,Color;"use import";jsio("from util.browser import $"),jsio("import .Widget"),jsio("import .jscolor.jscolor as jscolor");sdk_jsio_squill_Color=__class__,Color=exports=sdk_jsio_squill_Color(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="clr",this._type="text",this.init=function(t){t=merge(t,{tag:"input"}),this._isEnabled=t.isEnabled,e(this,"init",[t])},this.buildWidget=function(){var e=this._el;$.addClass(e,"squill-color"),e.min=this._opts.min||0,e.max=this._opts.max||100,e.step=this._opts.step||1,e.value=this._opts.value||0,e.onchange=bind(this,this._onChange),jscolor.bind(e)},this.setValue=function(e){e&&("#"!==e[0]&&(e="#"+e),this._el.style.backgroundColor=e,e=e.substr(1,6)),this._el.value=e},this.getValue=function(){return this._el.value},this._onChange=function(){this.publish("Change",this._el.value)}})'),jsio.setCachedSrc("sdk/jsio/squill/VerticalCenter.js",'var sdk_jsio_squill_VerticalCenter;"use import";jsio("import .Widget"),jsio("from util.browser import $");sdk_jsio_squill_VerticalCenter=__class__;exports=sdk_jsio_squill_VerticalCenter(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(){this._def={tag:"table",style:merge({height:"100%",width:"100%"},def.style),attrs:{cellpadding:0,cellspacing:0},children:[$({tag:"tbody",children:[$({tag:"tr",children:[$({id:"contentPane",tag:"td",attrs:{valign:"middle"},style:{verticalAlign:"middle"}})]})]})]},this.addElement=function(){this.contentPane.appendChild(el)}})'),jsio.setCachedSrc("sdk/jsio/squill/TreeList.js",'var elementIDPrefix,sdk_jsio_squill_TreeList,TreeList;"use import";jsio("from util.browser import $"),jsio("import .Widget");elementIDPrefix=0,sdk_jsio_squill_TreeList=__class__,TreeList=exports=sdk_jsio_squill_TreeList(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){var t={key:"id",label:"title",wrapperId:"browser",contentId:"contentWrapper"};this.init=function(n){n=n||{},n=merge(n,t),this._initClasses(n),this._key=n.key,this._label=n.label,this._wrapperId=n.wrapperId,this._contentId=n.contentId,this._leaveWidth=n.leaveWidth||600,elementIDPrefix++,this._elementIDPrefix="menuItem"+elementIDPrefix+"_",n.dataSource?this.setDataSource(n.dataSource):this._dataSource=null,this._def={id:this._wrapperId,className:"browser",children:[{id:this._contentId,className:"contentWrapper",children:[]}]},this._root=null,this._itemByKey={},e(this,"init",arguments)},this._initClasses=function(e){this._classNames={nodeWrapper:e.nodeWrapper||"browserNodeWrapper",nodeWrapperHidden:e.nodeWrapperHidden||"browserNodeWrapperHidden",node:e.node||"browserNode",nodeChildren:e.nodeChildren||"children",nodeActive:e.nodeActive||"active",nodeActiveChild:e.nodeActiveChild||"browserNodeActiveChild"}},this._clearItem=function(e){var t,n,r,i;if(e.children)for(n=e.children;n.length;)this._clearItem(n.pop());if(e.parent){t=e.parent,n=t.children,r=0;for(i=n.length;r<i;r++)if(n[r]===e){n.splice(r,1);break}!n.length&&t.group&&($.remove(t.group.parentNode),$.remove(t.group),delete t.group)}$.remove(e.node),e.group&&$.remove(e.group)},this._createMenuId=function(e){var t=this._menuId;return e&&this._menuId++,this._elementIDPrefix+t},this._createGroup=function(e){var t=this._createMenuId(!0),e=$({parent:$({parent:$.id(this._contentId),id:t,className:e?this._classNames.nodeWrapper:this._classNames.nodeWrapperHidden}),className:this._classNames.node});return e.menuId=t,e},this._createItem=function(e,t){var n=this._createMenuId(!0);e.node=$({parent:t,id:n,tag:"a",text:e[this._label]}),$.onEvent(n,"click",this,"onClick",e)},this.buildWidget=function(){this._menuId=0,this._menuById=[],this._menuStack=[],this._menuActiveItem=!1,null!==this._dataSource&&this._dataSource.each(bind(this,this.onCreateItem))},this._removeFromStack=function(e){for(var t=this._menuStack,n=null;t.length&&t[t.length-1].depth>=e;)n=t.pop(),$.removeClass(n.node.id,this._classNames.nodeActive),$.removeClass(n.node.id,this._classNames.nodeActiveChild),n.group&&($.addClass(n.group.menuId,this._classNames.nodeWrapperHidden),$.removeClass(n.group.menuId,this._classNames.nodeWrapper));return n},this.applyNodeStyle=function(e){e.children&&e.children.length?$.addClass(e.node,this._classNames.nodeChildren):$.removeClass(e.node,this._classNames.nodeChildren),e===this._menuActiveItem?$.addClass(e.node,this._classNames.nodeActive):$.removeClass(e.node,this._classNames.nodeActive),void 0!==e.removeCustomClass&&e.removeCustomClass&&$.removeClass(e.node,e.removeCustomClass),void 0!==e.customClass&&e.customClass&&($.removeClass(e.node,e.customClass),$.addClass(e.node,e.customClass))},this._addToStack=function(e){this._menuStack.push(e),this.applyNodeStyle(e);if(e.children&&e.children.length){if(!e.group){var t,n,r;e.children.sort(),e.group=this._createGroup(!0),n=0;for(r=e.children.length;n<r;n++)t=e.children[n],this._createItem(t,e.group),this.publish("DisplayItem",t.data,t),this.applyNodeStyle(t)}$.addClass(e.group.menuId,this._classNames.nodeWrapper),$.removeClass(e.group.menuId,this._classNames.nodeWrapperHidden)}},this.onClick=function(e){var t=this._menuStack,n=null;this.publish("SelectItem",e.data,e),this._menuActiveItem&&(n=this._menuActiveItem,this._menuActiveItem=null,this.applyNodeStyle(n),n=null),t.length&&e.depth<=t[t.length-1].depth&&(n=this._removeFromStack(e.depth)),n!==e&&this._addToStack(e),this._menuActiveItem=e,this.applyNodeStyle(e),t.length&&(e=t.length,t[t.length-1].children&&t[t.length-1].children.length&&e++,$.id(this._contentId).style.width=200*e+this._leaveWidth+"px")},this.onUpdateItem=function(e,t){var n={title:e[this._label],toString:function(){return this.title}},r,i,s,o,u;if(this._itemByKey[t])this._itemByKey[t].node&&(this._itemByKey[t].node.innerHTML=e[this._label]);else{if(null===e.parent||-1===e.parent)null===this._root&&(this._rootGroup=this._createGroup(!0),this._createItem(n,this._rootGroup),this._root=n,n.data=e,n.depth=0,n.parent=null,this.publish("DisplayItem",n.data,n),this.applyNodeStyle(n));else{if(r=this._itemByKey[e.parent[this._key]])if(r.children||(r.children=[]),i=r.children,!this._menuActiveItem||this._menuActiveItem!==r&&this._menuActiveItem.parent!==r)i.push(n);else{o=0;for(u=i.length;o<u;o++)i[o].node&&($.remove(i[o].node),i[o].node=null);i.push(n),i.sort(),r.group||(r.group=this._createGroup(!0),$.id(this._contentId).style.width=200*(this._menuStack.length+1)+500+"px"),o=0;for(u=i.length;o<u;o++)s=i[o],this._createItem(s,r.group),this.publish("DisplayItem",s.data,s),this.applyNodeStyle(s)}n.depth=r.depth+1,n.parent=r}n.data=e,this._itemByKey[t]=n}},this.onCreateItem=function(e){this.onUpdateItem(e,e[this._key])},this.onRemoveItem=function(e,t){var n=this._itemByKey[t],r;n&&(n=1>=n.parent.children.length,r=e[this._dataSource.parentKey],this._removeFromStack(this._itemByKey[t].depth-1),this._clearItem(this._itemByKey[t]),this._menuActiveItem=!1,delete this._itemByKey[t],this.publish("UnSelectItem"),n&&r&&(n=this._itemByKey[r[this._dataSource.key]],this.publish("DisplayItem",n.data,n),this.applyNodeStyle(n)))},this.showItem=function(e){var t=this.getTreeNode(e);this.publish("DisplayItem",e,t),this.applyNodeStyle(t)},this.setDataSource=function(e){this._dataSource=e,this._dataSource.subscribe("Update",this,this.onUpdateItem),this._dataSource.subscribe("Remove",this,this.onRemoveItem)},this.getPathString=function(e){var t="",n=this._menuStack,r,i,e=e||" ";r=0;for(i=n.length;r<i;r++)""!==t&&(t+=e),t+=n[r].data[this._label];return t},this.getTreeNode=function(e){return this._itemByKey[e[this._dataSource.key]]}})'),jsio.setCachedSrc("sdk/jsio/squill/Graph.js",'var sdk_jsio_squill_Graph,Graph;"use import";jsio("from util.browser import $"),jsio("import .Widget"),jsio("import .hint as hint");sdk_jsio_squill_Graph=__class__,Graph=exports=sdk_jsio_squill_Graph(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(e){this._css="cnvs",this._type="canvas",this.init=function(t){params=merge(t,{tag:"canvas"}),e(this,"init",arguments),this.setSettings(t.settings||{}),this._width=t.width||400,this._height=t.height||400,this._rectangles=[],this._data=!1,$.onEvent(this._el,"mousemove",this,this._onMouseMove),$.onEvent(this._el,"mouseout",this,this._onMouseOut)},this._onMouseMove=function(e){for(var t=this._rectangles,n,r=!1,i=t.length;i;)if(n=t[--i],e.offsetX>=n.x1&&e.offsetY>=n.y1&&e.offsetX<=n.x2&&e.offsetY<=n.y2){r=!0;break}r?hint.show(e.pageX+15,e.pageY+15,n.label):hint.hide()},this._onMouseOut=function(){hint.hide()},this.buildWidget=function(){var e=this._el;this.initMouseEvents(e),this.initKeyEvents(e)},this._renderBackground=function(e){var t=this._el,n=t.width,t=t.height;this._currentWidth=n,this._currentHeight=t,this._settings.fillColor?(e.fillStyle=this._settings.fillColor,e.fillRect(0,0,n,t)):e.clearRect(0,0,n,t)},this._calculateSegments=function(e,t){var n=this._settings,r=0,i=0,s,o=t.length,u,a;for(s=0;s<o;s++){item=t[s],i=Math.max(e.measureText(item.title).width,i),i>n.maxLabelSize&&(i=n.maxLabelSize),u=0;for(a=item.points.length;u<a;u++)r=Math.max(item.points[u],r)}n=[.5,.25,.2,.125,.1],s=0;for(o=1;10<r/(n[s]*o);)s++,s>=n.length&&(s=0,o*=10);return r=Math.ceil(r/(n[s]*o)),{steps:r,step:n[s],max:r*n[s]*o,maxLabel:i+4,factor:o}},this._trimLabel=function(e,t,n){if(t.measureText(n).width>e.maxLabel){for(;t.measureText(n+"...").width>e.maxLabel;)n=n.substr(0,n.length-1);n+="..."}return n},this._renderHorizontalAxis=function(e,t,n){var r=this._settings,i=r.valueSpace,s=r.mainPadding,o=this._currentWidth-2*s-i,u=this._currentHeight-2*s-e.maxLabel,a=o/n.length,f,l,c,h;t.strokeStyle=r.barBackground;for(c=0;2>c;c++)l=i+s+.5+c*o,t.beginPath(),t.moveTo(l,s),t.lineTo(l,s+u),t.stroke();t.textAlign="right",t.textBaseline="top",c=0;for(h=n.length;c<h;c++)l=i+s+c*a,t.save(),t.rotate(-0.5*Math.PI),f=this._trimLabel(e,t,n[c].title),t.fillStyle=this._settings.textColor,t.fillText(f,-(s+u+4),l),t.restore(),0===(c&1)&&(t.fillStyle=r.barBackground,t.fillRect(l,s,a,u));t.strokeStyle=this._settings.lineColor,t.fillStyle="#000000",n=0,c=u;for(h=0;0<=c;)f=(h*e.step).toString(10),l=f.indexOf("."),-1!==l&&(l=f.length-l-1,l>n&&(n=l)),c=Math.ceil(c-u/e.steps),h++;c=u;for(h=0;0<=c;){l=s+i,f=s+~~c+.5,t.beginPath(),t.moveTo(l,f),t.lineTo(l+o,f),t.stroke(),f=(h*e.step).toString(10);if(n&&-1===f.indexOf(".")){f+=".";for(l=0;l<n;l++)f+="0"}t.fillStyle=this._settings.textColor,t.fillText(f,i+s-2,s+c-8),c=Math.ceil(c-u/e.steps),h++}t.textAlign="left",f=r.mainLabel+" x"+e.factor,c=s,h=s+u/2+(t.measureText(f).width+r.itemSize)/2,t.save(),t.rotate(-0.5*Math.PI),t.fillStyle=this._settings.textColor,t.fillText(f,-h-r.itemSize,c),t.restore(),h-=t.measureText(f).width,t.beginPath(),t.moveTo(c+7.5,h),t.lineTo(c+7.5,h+26),t.stroke(),t.beginPath(),t.moveTo(c+3.5,h+5.5),t.lineTo(c+7.5,h),t.lineTo(c+11.5,h+5.5),t.stroke()},this._renderVerticalBars=function(e,t,n){var r=this._settings,i=r.valueSpace,s=r.mainPadding,o=this._currentHeight-2*s-e.maxLabel,u=(this._currentWidth-2*s-i)/n.length,a=u-2*r.barPadding,f,l,c,h,p,d,v,m;t.globalAlpha=.9,p=0;for(d=n.length;p<d;p++){h=n[p],f=h.points,m=f.length,f=~~(a/m);for(v=0;v<m;v++)l=h.points[v]/e.max*o,c=i+s+p*u+r.barPadding,barY=s+o-l,t.fillStyle=r.dataColors[v%r.dataColors.length],t.fillRect(c+v*f,barY,f-1,l)}t.globalAlpha=1},this._renderVerticalPoints=function(e,t,n){var r=this._settings,i=-1!==r.types.indexOf("points"),s=-1!==r.types.indexOf("lines"),o=-1!==r.types.indexOf("area"),u=r.valueSpace,a=r.mainPadding,f=this._currentHeight-2*a-e.maxLabel,l=(this._currentWidth-2*a-u)/n.length,c=l-2*r.barPadding,h,p,d,v=[],m,g,y,b,w;pointYLast=null,y=0;for(b=n.length;y<b;y++){g=n[y],d=g.points,m=null!==pointYLast,null===pointYLast&&(pointYLast=[]),h=~~(u+a+y*l+r.barPadding+c/2),w=0;for(d=d.length;w<d;w++)p=~~(a+f-g.points[w]/e.max*f),v[w]||(v[w]=[]),v[w].push({x:h,y:p}),t.strokeStyle=r.dataColors[w%r.dataColors.length],i&&t.strokeRect(h-4.5,p-4.5,10,10),m&&s&&(t.beginPath(),t.moveTo(pointXLast,pointYLast[w]),t.lineTo(h,p),t.stroke()),pointYLast[w]=p;pointXLast=h}if(o){t.globalAlpha=.05,y=0;for(b=v.length;y<b;y++){t.beginPath(),t.lineTo(v[y][0].x,a+f),w=0;for(d=v[y].length;w<d;w++)e=v[y][w],t.lineTo(e.x,e.y);t.lineTo(v[y][d-1].x,a+f),t.closePath(),t.fillStyle=r.dataColors[y%r.dataColors.length],t.fill()}t.globalAlpha=1}},this._renderVerticalAxis=function(e,t,n){var r=this._settings,i=r.mainPadding,s=this._currentWidth-2*i-e.maxLabel,o=this._currentHeight-2*i-r.valueSpace,u=o/n.length,a,f,l,c;t.strokeStyle=r.barBackground;for(l=0;2>l;l++)f=i+.5+l*o,t.beginPath(),t.moveTo(i+e.maxLabel,f),t.lineTo(i+e.maxLabel+s,f),t.stroke();t.textAlign="right",t.textBaseline="top",l=0;for(c=n.length;l<c;l++)f=i+l*u,a=this._trimLabel(e,t,n[l].title),t.fillStyle=this._settings.textColor,t.fillText(a,i+e.maxLabel-4,f+4),this._rectangles.push({x1:i+e.maxLabel-4-t.measureText(a).width,y1:f+4,x2:i+e.maxLabel-4,y2:f+20,label:n[l].title}),0===(l&1)&&(t.fillStyle=r.barBackground,t.fillRect(i+e.maxLabel,f,s,u));t.textAlign="center",t.strokeStyle=this._settings.lineColor,t.fillStyle="#000000";for(c=l=n=0;l<=s;)a=(c*e.step).toString(10),f=a.indexOf("."),-1!==f&&(f=a.length-f-1,f>n&&(n=f)),l=Math.floor(l+s/e.steps),c++;for(c=l=0;l<=s;){a=i+e.maxLabel+~~l+.5,f=i,t.beginPath(),t.moveTo(a,f),t.lineTo(a,f+o),t.stroke(),a=(c*e.step).toString(10);if(n&&-1===a.indexOf(".")){a+=".";for(f=0;f<n;f++)a+="0"}t.fillStyle=this._settings.textColor,t.fillText(a,i+e.maxLabel+l,i+o+2),l=Math.floor(l+s/e.steps),c++}t.textAlign="left",a=r.mainLabel+" x"+e.factor,l=i+s/2-(t.measureText(a).width+r.itemSize)/2+e.maxLabel,c=i+o+18,t.fillStyle=this._settings.textColor,t.fillText(a,l,c),l+=t.measureText(a).width,t.beginPath(),t.moveTo(l+4,c+7.5),t.lineTo(l+r.itemSize,c+7.5),t.stroke(),t.beginPath(),t.moveTo(l+r.itemSize-4,c+3.5),t.lineTo(l+r.itemSize,c+7.5),t.lineTo(l+r.itemSize-4,c+11.5),t.stroke()},this._renderHorizontalBars=function(e,t,n){var r=this._settings,i=r.mainPadding,s=this._currentWidth-2*i-e.maxLabel,o=(this._currentHeight-2*i-r.valueSpace)/n.length,u,a=o-2*r.barPadding,f,l,c,h,p,d,v,m;t.globalAlpha=.9,p=0;for(d=n.length;p<d;p++){h=n[p],u=h.points,m=u.length,f=~~(a/m);for(v=0;v<m;v++)u=~~(h.points[v]/e.max*s),l=e.maxLabel+i,c=~~i+p*o+r.barPadding,t.fillStyle=r.dataColors[v%r.dataColors.length],t.fillRect(l,c+v*f,u,f-1)}t.globalAlpha=1},this._renderHorizontalPoints=function(e,t,n){var r=this._settings,i=-1!==r.types.indexOf("points"),s=-1!==r.types.indexOf("lines"),o=-1!==r.types.indexOf("area"),u=r.mainPadding,a=this._currentWidth-2*u-e.maxLabel,f=(this._currentHeight-2*u-r.valueSpace)/n.length,l=f-2*r.barPadding,c,h,p,d=[],v,m,g,y,b;pointXLast=null,g=0;for(y=n.length;g<y;g++){m=n[g],p=m.points,v=null!==pointXLast,null===pointXLast&&(pointXLast=[]),h=~~(u+g*f+r.barPadding+l/2),b=0;for(p=p.length;b<p;b++)c=~~(u+m.points[b]/e.max*a+e.maxLabel),d[b]||(d[b]=[]),d[b].push({x:c,y:h}),t.strokeStyle=r.dataColors[b%r.dataColors.length],i&&t.strokeRect(c-4.5,h-4.5,10,10),v&&s&&(t.beginPath(),t.moveTo(pointXLast[b],pointYLast),t.lineTo(c,h),t.stroke()),pointXLast[b]=c;pointYLast=h}if(o){t.globalAlpha=.05,g=0;for(y=d.length;g<y;g++){t.beginPath(),t.moveTo(u+e.maxLabel,d[g][0].y),b=0;for(p=d[g].length;b<p;b++)n=d[g][b],t.lineTo(n.x,n.y);t.lineTo(u+e.maxLabel,d[g][p-1].y),t.closePath(),t.fillStyle=r.dataColors[g%r.dataColors.length],t.fill()}t.globalAlpha=1}},this.setData=function(e){var t=this._el,n=t.getContext("2d"),r=this._settings,i=r.types,s=function(){},o=function(){},u=function(){};switch(r.orientation){case"horizontal":t.width=this._width,t.height=e.length*r.itemSize+this._settings.valueSpace,s=bind(this,this._renderVerticalAxis),o=bind(this,this._renderHorizontalBars),u=bind(this,this._renderHorizontalPoints);break;case"vertical":t.width=e.length*r.itemSize+this._settings.valueSpace,t.height=this._height,s=bind(this,this._renderHorizontalAxis),o=bind(this,this._renderVerticalBars),u=bind(this,this._renderVerticalPoints)}n.font=r.font,this._renderBackground(n),e.length&&(t=this._calculateSegments(n,e),s(t,n,e),(-1!==i.indexOf("points")||-1!==i.indexOf("area")||-1!==i.indexOf("lines"))&&u(t,n,e),-1!==i.indexOf("bars")&&o(t,n,e)),this._data=e},this.setSettings=function(e){e.mainLabel=e.mainLabel||"",e.textColor=e.textColor||"#000000",e.fillColor=void 0===e.fillColor?"#FFFFFF":e.fillColor,e.lineColor=e.lineColor||"#000000",e.orientation=e.oriantation||"horizontal",e.types=e.types||"bars,lines,area,points",e.barPadding=e.barPadding||2,e.barBackground=e.barBackground||"#F8F8F8",e.mainPadding=e.mainPadding||10,e.valueSpace=e.valueSpace||40,e.dataColors=e.dataColors||["#DD0000","#00DD00","#0000DD"],e.font=e.font||"13px Verdana",e.maxLabelSize=e.maxLabelSize||200,e.itemSize=e.itemSize||50,this._settings=e},this.update=function(){this._data&&this.setData(this._data)}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/dom/animate.js",'jsio("import ui.backend.canvas.animate as canvasAnimate"),exports=function(e){return"_node"in e?e.getAnimation():canvasAnimate(e)},exports.linear=canvasAnimate.linear,exports.easeIn=canvasAnimate.easeIn,exports.easeInOut=canvasAnimate.easeInOut,exports.easeOut=canvasAnimate.easeOut'),jsio.setCachedSrc("sdk/timestep/ui/backend/dom/ImageView.js",'var sdk_timestep_ui_backend_dom_ImageView;jsio("import ui.View as View"),jsio("import ui.resource.Image as Image");sdk_timestep_ui_backend_dom_ImageView=__class__;exports=sdk_timestep_ui_backend_dom_ImageView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.init=function(t){var n;t=merge(t,{image:null,autoSize:!1}),e(this,"init",[t]);n=this.__view._node.style;n.webkitBackgroundClip=n.backgroundClip="content-box",t.image&&this.setImage(t.image,t)},this.updateOpts=function(t){return t=e(this,"updateOpts",arguments),"autoSize"in t&&(this._autoSize=!!t.autoSize),t.image?this.setImage(t.image):this.needsReflow(),t},this.autoSize=function(){this._img&&(this.style.width=this._img.getWidth(),this.style.height=this._img.getHeight(),this.style.fixedAspectRatio&&this.style.updateAspectRatio())},this._imgCache={},this.getImage=function(){return this._img},this.setImage=function(e,t){var n;if("string"==typeof e){n=e;(e=this._imgCache[n])||(this._imgCache[n]=e=new Image({url:n}))}e!=this._img&&(this._img&&this._img.unsubscribe("changeBounds",this),(this._img=e)?(e.subscribe("changeBounds",this,"updateImage"),(this._autoSize=t&&"autoSize"in t?t.autoSize:this._autoSize)&&(0<e.getWidth()&&0<e.getHeight()?this.autoSize():e.doOnLoad(this,"autoSize")),e.doOnLoad(this,"updateImage")):this.updateImage())},this.reflow=function(){this.updateImage()},this._getBackgroundNode=function(e){var t;this._bgNodes||(this._bgNodes={});t=this._bgNodes[e];return t||(this._bgNodes[e]=t=document.createElement("div"),t.style.cssText="-webkit-background-clip:content-box;background-clip:content-box;z-index:-1;position:absolute;top:0;left:0;bottom:0;right:0;background-image:"+e+";",this.__view._node.appendChild(t)),t!=this._currentBgNode&&(this._currentBgNode&&(this._currentBgNode.style.visibility="hidden"),this._currentBgNode=t,t.style.visibility="visible"),t},this._canvasRender=function(e){var t=this._img.getSource();e.drawImage(t,0,0,t.width,t.height,0,0,this.style.width,this.style.height)},this.updateImage=function(){var n,r,i,s,o,e=this._img,t=this._opts["dom:multipleImageNodes"];if(e&&e.getSource()instanceof HTMLCanvasElement)this.render=this._canvasRender,this.needsRepaint();else if(!e||!e.isReady())t&&this._currentBgNode?this._currentBgNode.style.visibility="hidden":this.__view._node.style.backgroundImage="none";else{n=\'url("\'+e.getSource().src+\'")\',r=e.getSourceWidth(),i=e.getSourceHeight(),s=this.style.width/e.getWidth(),o=this.style.height/e.getHeight();t?t=this._getBackgroundNode(n).style:(t=this.__view._node.style,this._cacheImageURL!=n&&(this._cacheImageURL=n,t.backgroundImage=n)),e=e.getBounds(),t.padding=o*e.marginTop+"px "+s*e.marginRight+"px "+o*e.marginBottom+"px "+s*e.marginLeft+"px",t.backgroundPositionX=s*(-e.x+e.marginLeft)+"px",t.backgroundPositionY=o*(-e.y+e.marginTop)+"px",t.backgroundSize=r*s+"px "+i*o+"px"}},this.getOrigWidth=this.getOrigW=function(){return this._img.getOrigW()},this.getOrigHeight=this.getOrigH=function(){return this._img.getOrigH()},this.doOnLoad=function(){return 1==arguments.length?this._img.doOnLoad(this,arguments[0]):this._img.doOnLoad.apply(this._img,arguments),this}})'),jsio.setCachedSrc("sdk/timestep/ui/resource/Image.js",'var ImageCache,ImageMap,sdk_timestep_ui_resource_Image;function imageOnLoad(e,t,n){e&&!this.width?3>=n?setTimeout(bind(this,imageOnLoad,e,t,(n||0)+1),0):this.__cb.fire(!1):this.__cb.fire(!e)}jsio("import event.Callback as Callback"),jsio("import math.geom.Rect as Rect"),jsio("import lib.PubSub"),jsio("import device"),jsio("import ui.resource.loader as resourceLoader");ImageCache={},ImageMap=!GLOBAL.CONFIG.disableNativeViews&&GLOBAL.NATIVE&&GLOBAL.NATIVE.timestep&&GLOBAL.NATIVE.timestep.ImageMap;ImageMap||(ImageMap=__class__,ImageMap=ImageMap(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n,r,i,s,o,u,a,f){this.url=f,this.x=t,this.y=n,this.width=r,this.height=i,this.marginTop=s,this.marginRight=o,this.marginBottom=u,this.marginLeft=a}}));sdk_timestep_ui_resource_Image=__class__;exports=sdk_timestep_ui_resource_Image(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){var e,t,n,r;this.init=function(e){e||(e={}),this._cb=new Callback,this._map=new ImageMap(this,0,0,-1,-1,0,0,0,0,e.url||""),this._originalURL=e.url,resourceLoader._updateImageMap(this._map,e.url,e.sourceX,e.sourceY,e.sourceW,e.sourceH),this._scale=e.scale,this._setSrcImg(e.srcImage,this._map.url,e.forceReload)},this._setSrcImg=function(e,t,n){var r;this._cb.reset(),!e&&t&&!n&&ImageCache[t]&&(e=ImageCache[t]);if(!e&&!n&&Image.get){r=Image.get(t);typeof r=="object"?e=r:r&&(t=r)}n&&(e&&e.destroy&&e.destroy(),t&&NATIVE&&NATIVE.gl&&NATIVE.gl.deleteTexture&&NATIVE.gl.deleteTexture(t)),e||(e=new Image),this._srcImg=e,e instanceof HTMLCanvasElement?this._onLoad(!1):(e.__cb||(e.__cb=new Callback,e.addEventListener("load",bind(e,imageOnLoad,!0),!1),e.addEventListener("error",bind(e,imageOnLoad,!1),!1),t&&(ImageCache[t]=e),!e.src&&t&&(e.src=this._map.url=t)),e.__cb.run(this,"_onLoad"))},this.setSource=this.setSrcImg=function(e){this._setSrcImg(e)},this.reload=function(e){var t;if(this._srcImg){e&&e.chain&&(e=e.chain());if(this._srcImg.reload){t=bind(this,function(){this._srcImg.removeEventListener("reload",t,!1),e&&e()});this._srcImg.addEventListener("reload",t,!1),this._srcImg.reload()}else e&&(this._cb.fired()?setTimeout(e,0):this._cb.run(e))}},this.setURL=function(e,t){resourceLoader._updateImageMap(this._map,e),this._setSrcImg(null,this._map.url,t)},this.getURL=function(){return this._map.url},this.getOriginalURL=function(){return this._originalURL},this.getSourceWidth=this.getOrigWidth=this.getOrigW=function(){return this._srcImg.width},this.getSourceHeight=this.getOrigHeight=this.getOrigH=function(){return this._srcImg.height},this.setSourceWidth=this.setSourceW=function(e){this._map.width=e},this.setSourceHeight=this.setSourceH=function(e){this._map.height=e},this.setSourceY=this.setSourceY=function(e){this._map.y=e},this.setSourceX=this.setSourceX=function(e){this._map.x=e},this.setMarginTop=function(e){this._map.marginTop=e},this.setMarginRight=function(e){this._map.marginRight=e},this.setMarginBottom=function(e){this._map.marginBottom=e},this.setMarginLeft=function(e){this._map.marginLeft=e},this.getURL=function(){return this._map.url},this.getSourceWidth=this.getOrigWidth=this.getOrigW=function(){return this._srcImg.width},this.getSourceHeight=this.getOrigHeight=this.getOrigH=function(){return this._srcImg.height},this.setSourceWidth=this.setSourceW=function(e){this._map.width=e},this.setSourceHeight=this.setSourceH=function(e){this._map.height=e},this.setSourceY=this.setSourceY=function(e){this._map.y=e},this.setSourceX=this.setSourceX=function(e){this._map.x=e},this.setMarginTop=function(e){this._map.marginTop=e},this.setMarginRight=function(e){this._map.marginRight=e},this.setMarginBottom=function(e){this._map.marginBottom=e},this.setMarginLeft=function(e){this._map.marginLeft=e},this.getSource=function(){return this._srcImg},this.getWidth=function(){return(this._map.width==-1?0:this._map.width+this._map.marginLeft+this._map.marginRight)/this._map.scale},this.getHeight=function(){return(this._map.height==-1?0:this._map.height+this._map.marginTop+this._map.marginBottom)/this._map.scale},this.getMap=this.getBounds=function(){return this._map},this.setBounds=function(e,t,n,r,i,s,o,u){var a=this._map;a.x=e,a.y=t,a.width=n,a.height=r,a.marginTop=i||0,a.marginRight=s||0,a.marginBottom=o||0,a.marginLeft=u||0,this.emit("changeBounds")},this.setBounds=this.setMap,this.doOnLoad=function(){return this._cb.forward(arguments),this},this._onLoad=function(e){e?(logger.error("Image failed to load:",this._map.url),this._isError=!0,this._cb.fire({NoImage:!0})):(this._srcImg.width==0&&logger.warn("Image has no width",this._url),e=this._map,!this._scale||e.width==-1&&e.height==-1?(e.width==-1&&(e.width=this._srcImg.width),e.height==-1&&(e.height=this._srcImg.height)):(e.width==-1&&(e.width=this._srcImg.width*e.height/this._srcImg.height),e.height==-1&&(e.height=this._srcImg.height*e.width/this._srcImg.width),this._srcImg.width=e.width,this._srcImg.height=e.height),this._map.url=this._srcImg.src,this._cb.fire(null,this))},this.isError=function(){return this._isError},this.isLoaded=this.isReady=function(){return!this._isError&&this._cb.fired()};e=GLOBAL.NATIVE&&!device.simulatingMobileNative,t=Array.prototype.slice;if(!e)n=new(device.get("Canvas")),r=n.getContext("2d");this.render=function(i,s,u,a,f){var l,c,p,d,v,m,g,y,b,w,E;if(this._cb.fired())try{l=arguments,c=this._map;if(!i.filters||!i.filters.Multiply&&!i.filters.NegativeMask&&!i.filters.PositiveMask)if(l.length==9)i.drawImage(this._srcImg,l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8]);else if(s instanceof Rect)if(u instanceof Rect){l=s,v=u;p=v.width/(c.marginLeft+c.width+c.marginRight),d=v.height/(c.marginTop+c.height+c.marginBottom),i.drawImage(this._srcImg,l.x,l.y,l.width,l.height,v.x,v.y,v.width,v.height)}else v=s,p=v.width/(c.marginLeft+c.width+c.marginRight),d=v.height/(c.marginTop+c.height+c.marginBottom),i.drawImage(this._srcImg,c.x,c.y,c.width,c.height,v.x+p*c.marginLeft,v.y+d*c.marginTop,p*c.width,d*c.height);else p=a/(c.marginLeft+c.width+c.marginRight),d=f/(c.marginTop+c.height+c.marginBottom),p!=Infinity&&d!=Infinity&&i.drawImage(this._srcImg,c.x,c.y,c.width,c.height,(s||0)+p*c.marginLeft,(u||0)+d*c.marginTop,p*c.width,d*c.height);m=arguments,g=this;p=function(e,o,l){n.width=a,n.height=f,r.globalCompositeOperation="source-over",g.render.apply(g,[r].concat(t.call(m,1))),r.globalCompositeOperation=o,r.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",r.fillRect(s||0,u||0,a||c.width,f||c.height),e=i.globalCompositeOperation,i.globalCompositeOperation=l,i.drawImage(n,s||0,u||0,a||c.width,f||c.height),i.globalCompositeOperation=e},/WebKit/.exec(navigator.appVersion);if(!e&&i.filters){if(i.filters.LinearAdd){y=i.filters.LinearAdd.get();p(y,"source-in","lighter")}i.filters.Tint&&(y=i.filters.Tint.get(),p({r:y.r,g:y.g,b:y.b,a:y.a},"source-in","source-over"));if(i.filters.Multiply){y=i.filters.Multiply.get(),b=this.getImageData(),w=b.data;for(p=0;p<w.length;p+=4)w[p]=w[p]*(y.r/255),w[p+1]=w[p+1]*(y.g/255),w[p+2]=w[p+2]*(y.b/255);n.width=b.width,n.height=b.height,r.putImageData(b,0,0),i.drawImage(n,s||0,u||0,a||c.width,f||c.height)}if(i.filters.NegativeMask){y=i.filters.NegativeMask.get(),n.width=a,n.height=f,r.globalCompositeOperation="source-over",y.imgObject.render.apply(y.imgObject,[r].concat(t.call(m,1))),r.globalCompositeOperation="source-in",g.render.apply(g,[r].concat(t.call(m,1)));E=i.globalCompositeOperation;i.globalCompositeOperation="source-over",i.drawImage(n,s||0,u||0,a||c.width,f||c.height),i.globalCompositeOperation=E}i.filters.PositiveMask&&(y=i.filters.PositiveMask.get(),n.width=a,n.height=f,r.globalCompositeOperation="source-over",y.imgObject.render.apply(y.imgObject,[r].concat(t.call(m,1))),r.globalCompositeOperation="source-out",g.render.apply(g,[r].concat(t.call(m,1))),E=i.globalCompositeOperation,i.globalCompositeOperation="source-over",i.drawImage(n,s||0,u||0,a||c.width,f||c.height),i.globalCompositeOperation=E)}}catch(S){}},this.getImageData=function(){var e,t;if(!GLOBAL.document||!document.createElement)throw"Not supported";if(!this._map.width||!this._map.height)throw"Not loaded";e=document.createElement("canvas");e.width=this._map.width,e.height=this._map.height;t=e.getContext("2d");return this.render(t,0,0,this._map.width,this._map.height),t.getImageData(0,0,e.width,e.height)},this.setImageData=function(){},this.destroy=function(){this._srcImg.destroy&&this._srcImg.destroy()}}),exports.__clearCache__=function(){ImageCache={}}'),jsio.setCachedSrc("sdk/timestep/event/Callback.js",'jsio("import lib.Callback as exports")'),jsio.setCachedSrc("sdk/timestep/ui/resource/loader.js",'var _cache,MIME,Loader;jsio("import lib.Callback");_cache={},MIME={".png":"image",".jpg":"image",".bmp":"image",".css":"css",".html":"html",".mp3":"audio",".ogg":"audio",".mp4":"audio",".3gp":"audio",".m4a":"audio",".aac":"audio",".flac":"audio",".mkv":"audio",".wav":"audio"},Loader=__class__,Loader=Loader(function(){return this.init&&this.init.apply(this,arguments)},function(){this._map={},this.getMap=function(){return this._map},this.setMap=function(e){var t={},n=navigator.language&&navigator.language.split("-")[0].toLowerCase()||"en",r="resources-"+n,n="resources-"+n.split("_")[0],i;for(i in e){var s=i.indexOf(r),o=i.indexOf(n);0==s?(s="resources"+i.substring(r.length),t[s]=e[i]):0==o?(s="resources"+i.substring(n.length),t[s]=e[i]):t[i]=e[i]}this._map=t},this.get=function(e){return"resources/images/"+e},this.preload=function(e,t,n){"function"==typeof t&&(n=t,t=void 0);if(isArray(e)){var r=new lib.Callback;return e.forEach(function(e){e&&this.preload(e,t,r.chain())},this),n&&r.run(n),r}var e=e.replace(/^\\//,""),i={},s=this._map,o;for(o in s)0==o.indexOf(e)&&(i[s[o]&&s[o].sheet||o]=!0);return i=Object.keys(i),0==i.length&&logger.log("WARNING: No files to preload from path:",e,"-- A gamedev needs to update the code with the real resource paths."),e=this._loadGroup(merge({resources:i},t)),n&&e.run(n),e};var e=null;this.getSound=function(t){return e||(jsio("import AudioManager"),e=new AudioManager),GLOBAL.NATIVE&&GLOBAL.NATIVE.sound&&GLOBAL.NATIVE.sound.preloadSound?NATIVE.sound.preloadSound(t):(e.addSound(t),{complete:!0})},this.getImagePaths=function(e){var e=e.replace(/^\\//,""),t=[],n=this._map,r;for(r in n)0==r.indexOf(e)&&t.push(r);return t},this.getImage=function(e,t){var n=new Image;if(Image.get){var r=Image.get(e);if(r instanceof Image)return r}return r?(n.src=r,Image.set(e,n)):(t||logger.warn(e,"may not be properly cached!"),n.src=e),n},this._updateImageMap=function(e,t,n,r,i,s){var n=n||0,r=r||0,i=void 0==i?-1:i,s=void 0==s?-1:s,o=this._map[t];if(!!o&&!!o.sheet)return t=o.scale||1,e.x=o.x-o.marginLeft,e.y=o.y-o.marginTop,e.width=o.w+o.marginLeft+o.marginRight,e.height=o.h+o.marginTop+o.marginBottom,e.x+=n*t,e.y+=r*t,0<i&&(e.width=i*t),0<s&&(e.height=s*t),e.marginLeft=Math.max(0,o.x-e.x),e.marginTop=Math.max(0,o.y-e.y),e.marginRight=Math.max(0,e.x+e.width-(o.x+o.w)),e.marginBottom=Math.max(0,e.y+e.height-(o.y+o.h)),e.x+=e.marginLeft,e.y+=e.marginTop,e.width-=e.marginLeft+e.marginRight,e.height-=e.marginTop+e.marginBottom,e.scale=t,e.url=o.sheet,e;e.x=n,e.y=r,e.width=i,e.height=s,e.scale=1,e.url=t},this._getRaw=function(e,t,n,r){if(!n&&_cache[t])return _cache[t];n=null;switch(e){case"audio":n=this.getSound(t);break;case"image":n=this.getImage(t,r);break;default:logger.error("unknown type for preloader",e)}return _cache[t]=n},this._loadGroup=function(e,t){for(var n=e.timeout,r=new lib.Callback,i=e.resources||[],s=i.length||0,o=[],u=0;u<s;++u){var a=i[u].substring(i[u].lastIndexOf(".")).split("|")[0];"image"==MIME[a]?(o.push({type:"image",resource:i[u]}),GLOBAL.NATIVE&&NATIVE.gl&&NATIVE.gl.touchTexture(i[u])):"audio"==MIME[a]&&o.push({type:"audio",resource:i[u]})}if(!o.length)return t&&r.run(t),r.fire(),r;var f=0,l=o.length,c=Math.min(l,e.parallel||5),h=0,p=bind(this,function(){var e=f++,n=o[e],i;if(n){i=this._getRaw(n.type,n.resource,!1,!0);var s=function(e){h>=l||(i.onreload=i.onload=i.onerror=function(){},++h,h>=l?(t&&t(n,e,!0,h,l),d&&clearTimeout(d),r.fire()):(t&&t(n,e,!1,h,l),setTimeout(p,0)))};if(i.reload&&i.complete){var u=i.onreload,a=i.onerror;i.onreload=function(){u&&u(),s(!1)},i.onerror=function(){a&&a(),s(!0)},i.reload()}else i.complete?s(!0===i.failed):(u=i.onload,a=i.onerror,i.onload=function(){u&&u(),i.failed=!1,s(!1)},i.onerror=function(){a&&a(),i.failed=!0,s(!0)})}}),d=null;return setTimeout(function(){for(var e=0;e<c;++e)p();n&&(d=setTimeout(function(){r.fire(),h=l},n))},0),r}});exports=new Loader'),jsio.setCachedSrc("sdk/timestep/AudioManager.js",'jsio("import device"),jsio("import event.Emitter as Emitter"),GLOBAL.ACCESSIBILITY=new(Class(Emitter,function(){this.muted=!1,this.mute=function(e){this.muted=e,this.publish("MuteChange")}})),GLOBAL.ONACCESSIBLE&&GLOBAL.ONACCESSIBLE(),exports=jsio("import ui.backend.sound.HTML5API")'),jsio.setCachedSrc("sdk/timestep/ui/backend/sound/HTML5API.js",'var RawAudio,MultiSound,sdk_timestep_ui_backend_sound_HTML5API;jsio("import event.Emitter as Emitter"),jsio("import util.path"),jsio("import device");RawAudio=__class__,RawAudio=RawAudio(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){var e=new Audio,t=RawAudio.prototype,n;for(n in t)!e[n]&&t.hasOwnProperty(n)&&(e[n]=RawAudio.prototype[n]);var r;return e.oldPlay=e.play,e.play=function(){4==e.readyState?e.oldPlay():r=setTimeout(e.play,32)},e.oldPause=e.pause,e.pause=function(){r&&(clearTimeout(r),r=void 0),e.oldPause()},GLOBAL.ACCESSIBILITY.subscribe("MuteChange",this,function(){e.muted=GLOBAL.ACCESSIBILITY.muted}),e.muted=GLOBAL.ACCESSIBILITY.muted,e},this.stop=function(){try{if(this.paused||this.pause(),(!("NETWORK_LOADING"in this)||this.networkState!=this.NETWORK_LOADING||this.networkState!=this.NETWORK_NO_SOURCE)&&!isNaN(this.duration))this.currentTime=0}catch(e){}}}),MultiSound=__class__,MultiSound=MultiSound(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n){this._soundManager=e,this._name=t;for(var n="string"==typeof n?{sources:[n]}:n||{},t=n.sources||[t],r=this._sources=[],i=e.getPath(),s=e.getExt(),o=RegExp(s+"$","i"),u=void 0!==n.loop?n.loop:n.background,a=void 0!==n.volume?n.volume:1,f=bind(this,"isPaused"),l=function(e){this.removeEventListener(arguments.callee),f()&&this.pause()},c=0,h;h=t[c];++c){h=util.path.join(i,n.path,h),o.test(h)||(h+=s);var p=new RawAudio;p.loop=u,p.volume=a,p.isBackgroundMusic=n.background,p.src=h,p.preload=4!=p.readyState||e._preload&&!n.background?"auto":"none",p.addEventListener&&p.addEventListener("playing",l),r.push(p),p.isBackgroundMusic&&window.NATIVE&&NATIVE.sound.registerMusic(h,p)}this.loop=u,this.isBackgroundMusic=n.background},this.setVolume=function(e){for(var t=0,n;n=this._sources[t];++t)n.volume=e},this.stop=function(){for(var e=0,t;t=this._sources[e];++e)t.stop()},this.pause=function(){this._isPaused=!0;for(var e=0,t;t=this._sources[e];++e)t.pause()},this.isPaused=function(){return this._isPaused},this.isPlaying=function(){var e=!1;if(this._lastSrc){var t=this._lastSrc.currentTime,n=this._lastSrc.duration;if(isNaN(n)||t<n)e=!this.isPaused()}return e},this.getDuration=function(){return this._lastSrc&&this._lastSrc.duration||0},this.getTime=function(){return this._lastSrc?this._lastSrc.currentTime:0},this.setTime=function(e){this._lastSrc&&this.isBackgroundMusic&&void 0!=e&&(this._lastSrc.duration?this._lastSrc.currentTime=e:setTimeout(bind(this,"setTime",e+.01),10))},this.play=function(e){e=e||{},this._isPaused?this._isPaused=!1:this.stop();var t=this._getRandom();t.loop=e.loop||this.loop,t.play(),t.muted&&(t.muted=!1,t.muted=!0),this._lastSrc=t,this.setTime(e.time),e.duration&&setTimeout(bind(this,function(){this.pause()}),1e3*e.duration)},this._getRandom=function(){return this._sources[Math.random()*this._sources.length|0]}}),sdk_timestep_ui_backend_sound_HTML5API=__class__;exports=sdk_timestep_ui_backend_sound_HTML5API(function(){return this.init&&this.init.apply(this,arguments)},Emitter,function(e){this.init=function(t){var n;t=t||{},e(this,"init",[t]),this.setPath(t.path),this._map=t.files||t.map,this._preload=t.preload,this._sounds={},this._areEffectsMuted=this._isMusicMuted=!1,this._currentMusic=null,t.persist&&this.persistState(t.persist),t=new Audio,this._ext=t.canPlayType("audio/mpeg")?".mp3":t.canPlayType("audio/ogg")?".ogg":"",this._ext||(this._ext=".mp3",logger.log("warning: could not determine sound support type"));for(n in this._map)this.addSound(n,this._map[n])},this.getExt=function(){return this._ext},this.getPath=function(e){return e?this._sounds[e].path:this._path},this.setPath=function(e){e&&(e=e.replace(/\\/$/,"")),this._path=e||""},this.addSound=function(e,t){this._sounds[e]=new MultiSound(this,e,t)},this.persistState=function(e){this._key=e;if(e=localStorage.getItem(this._key))try{e=JSON.parse(e)}catch(t){}e&&(logger.log("restoring audio api state"),this.setMusicMuted(e.isMusicMuted),this.setEffectsMuted(e.areEffectsMuted))},this._persist=function(){this._key&&localStorage.setItem(this._key,JSON.stringify({isMusicMuted:this._isMusicMuted,areEffectsMuted:this._areEffectsMuted}))},this.getMuted=function(){return this._isMusicMuted&&this._areEffectsMuted},this.getMusicMuted=function(){return this._isMusicMuted},this.getEffectsMuted=function(){return this._areEffectsMuted},this.setMuted=function(e){this.setMusicMuted(e),this.setEffectsMuted(e)},this.setMusicMuted=function(e){this._isMusicMuted=e,this._persist(),this._currentMusic&&(e?this._currentMusic.pause():this._currentMusic.play())},this.setEffectsMuted=function(e){var t;if(e!=this._areEffectsMuted&&(this._areEffectsMuted=e,this._persist(),e))for(t in this._sounds)e=this._sounds[t],e.isBackgroundMusic||e.stop()},this.setVolume=function(e,t){var n=this._sounds[e];return n?(n.setVolume(t),!0):!1},this.getVolume=function(e){return(e=this._sounds[e])?Math.round(10*e._sources[0].volume)/10:null},this.setTime=function(e,t){var n=this._sounds[e];if(!n)return logger.log("warning: no sound of that name"),!1;n.setTime(t)},this.getTime=function(e){return e=this._sounds[e],e?e.getTime():(logger.log("warning: no sound of that name"),!1)},this.getDuration=function(e){return e=this._sounds[e],e?e.getDuration():(logger.log("warning: no sound of that name"),!1)},this.play=function(e,t){var n=this._sounds[e],t=t||{};return n?(n.isBackgroundMusic?(this._currentMusic&&this._currentMusic.stop(),this._currentMusic=n,this._isMusicMuted||n.play(t)):this._areEffectsMuted||n.play(t),!0):(logger.log("warning: no sound of that name"),!1)},this.pause=function(e){return e=this._sounds[e],e?(this._currentMusic==e&&(this._currentMusic=null),e.pause(),!0):!1},this.stop=function(e){return e=this._sounds[e],e?(this._currentMusic==e&&(this._currentMusic=null),e.stop(),!0):!1},this.isPaused=function(e){return e=this._sounds[e],e?e.isPaused():(logger.log("warning: no sound of that name"),!1)},this.isPlaying=function(e){return e=this._sounds[e],e?e.isPlaying():(logger.log("warning: no sound of that name"),!1)},this.playBackgroundMusic=this.play,this.pauseBackgroundMusic=function(){this._currentMusic&&this._currentMusic.pause()}})'),jsio.setCachedSrc("sdk/jsio/util/path.js",'var util=jsio.__jsio.__util;exports.join=util.buildPath,exports.resolveRelativePath=util.resolveRelativePath,exports.splitPath=util.splitPath,exports.makeRelativePath=util.makeRelativePath,exports.splitExt=function(e){var e=exports.splitPath(e),t=e.filename.lastIndexOf(".");return-1==t?(e.basename=e.filename,e.ext=""):(e.basename=e.filename.substring(0,t),e.ext=e.filename.substring(t)),e}'),jsio.setCachedSrc("sdk/timestep/ui/backend/dom/StackView.js",'var sdk_timestep_ui_backend_dom_StackView;jsio("import ui.View");sdk_timestep_ui_backend_dom_StackView=__class__;exports=sdk_timestep_ui_backend_dom_StackView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.init=function(){e(this,"init",arguments),this.stack=[]},this.getCurrentView=function(){return this.stack.length?this.stack[this.stack.length-1]:null},this.push=function(e,t){var n;!this.stack[0]&&!1!==t&&(t=!0);n=this.getCurrentView();return n&&this._hide(n,t),e.style.width=this.style.width,e.style.height=this.style.height,this.stack.push(e),this._show(e,t),e},this._hide=function(e,t,n){e.publish("ViewWillDisappear"),t?(this.removeSubview(e),e.publish("ViewDidDisappear")):(t=new View({parent:e,zIndex:1e5}),e.then({x:(n?1:-1)*e.style.width}).then(bind(this,"removeSubview",e)).then(bind(e,"publish","ViewDidDisappear")).then(bind(t,"removeFromSuperview")))},this._show=function(e,t,n){e.publish("ViewWillAppear"),e.style.visible=!0,t?(this.addSubview(e),e.style.x=0,e.publish("ViewDidAppear")):(e.style.x=(n?-1:1)*this.style.width,this.addSubview(e),e.then({x:0}).then(bind(e,"publish","ViewDidAppear")))},this.pop=function(e){var t;if(!this.stack.length)return!1;t=this.stack.pop();return this._hide(t,e,!0),this.stack.length&&this._show(this.stack[this.stack.length-1],e,!0),t},this.popAll=function(e){for(;this.stack[1];)this.pop(e)}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/dom/TextView.js",'var sdk_timestep_ui_backend_dom_TextView;jsio("import ui.View as View"),jsio("import device");sdk_timestep_ui_backend_dom_TextView=__class__;exports=sdk_timestep_ui_backend_dom_TextView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){var t;this._displayStyle="table";t={wrap:!1,autoSize:!1,autoFontSize:!0,verticalPadding:0,horizontalPadding:0,lineHeight:1.2,color:"#000000",fontFamily:device.defaultFontFamily,fontWeight:"",size:128,lineWidth:2,strokeColor:null,shadowColor:null,verticalAlign:"middle",horizontalAlign:"center",backgroundColor:null};this.init=function(n){var r=this._textNode=document.createElement("div");r.className="view text",e(this,"init",[merge(n,t)]),this.__view.getElement().appendChild(r)},this.updateOpts=function(t){var t=e(this,"updateOpts",arguments),n=this.__view.getElement().style;t.horizontalPadding&&(isArray(t.horizontalPadding)?(n.paddingLeft=t.horizontalPadding[0]+"px",n.paddingRight=t.horizontalPadding[0]+"px"):(n.paddingLeft=t.horizontalPadding+"px",n.paddingRight=t.horizontalPadding+"px")),t.verticalPadding&&(isArray(t.verticalPadding)?(n.paddingTop=t.verticalPadding[0]+"px",n.paddingBottom=t.verticalPadding[0]+"px"):(n.paddingTop=t.verticalPadding+"px",n.paddingBottom=t.verticalPadding+"px")),t.color&&(n.color=t.color),t.size&&(this._fontSize=t.size),t.fontFamily&&(n.fontFamily=t.fontFamily),t.horizontalAlign&&(n.textAlign=t.horizontalAlign),t.verticalAlign&&(this._verticalAlign=t.verticalAlign),t.fontWeight&&(n.fontWeight=t.fontWeight),t.shadowColor&&(n.textShadow=t.shadowColor+" 2px 2px 1px"),t.lineHeight&&(n.lineHeight=t.lineHeight*t.size+"px"),t.strokeColor&&this._updateStroke(),t.wrap||(n.whiteSpace="nowrap"),this.setText(t.text||"")},this.getText=function(){return this._text},this.reflow=function(){var n,r,i,e=this._opts,t=this._textNode;if(t){if(e.autoSize){n=t.scrollHeight;if(!this.style.height||this.style.height<n)this.style.height=n}if(e.autoFontSize){n=r=this._fontSize;if(!e.wrap){i=t.scrollWidth-this.style.width;1<i&&(r-=n/=2,t.style.fontSize=r+"px")}i=t.scrollHeight-this.style.height,1<i&&(r-=n/2,t.style.fontSize=r+"px"),this._computedFontSize=r,t.style.lineHeight=e.lineHeight*r+"px"}this._computeVerticalAlign(),this._strokeNode&&(this._strokeNode.style.width=this._fillNode.offsetWidth+"px")}},this.setText=function(e){if("function"==typeof e)return e(this);e=void 0!=e?e.toString():"",this._text!=e&&(this._text=e,this._strokeNode?(this._fillNode.innerText=e,this._strokeNode.innerText=e):this._textNode.innerText=e,this._textNode.style.fontSize=this._fontSize+"px",this.needsReflow())},this._computeVerticalAlign=function(){var e=this._opts,t=this._computedFontSize||this._fontSize,n=Math.round(this._textNode.offsetHeight/(e.lineHeight*t)),r=this.style.padding,i=r.top;"middle"==e.verticalAlign&&(i+=(this.style.height-r.top-r.bottom-(1<n?e.lineHeight*n:1)*t)/2),this._textNode.style.marginTop=i+"px"},this._updateStroke=function(){var e=this._opts;e.strokeColor&&e.strokeWidth?(this._strokeNode||(this._textNode.innerHTML=\'<span style="position:relative"><span></span><span style="position:absolute;left:0;top:1px;right:0px;z-index:-1"></span></span>\',this._fillNode=this._textNode.childNodes[0].childNodes[0],this._strokeNode=this._textNode.childNodes[0].childNodes[1]),this._strokeNode.style.webkitTextStroke=1*e.strokeWidth+"px "+e.strokeColor,this.needsReflow()):this._strokeNode&&(this._fillNode=this._strokeNode=null,this.setText(this._text))}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/dom/ViewBacking.js",'var Canvas,AVOID_CSS_ANIM,TRANSFORM_PREFIX,SUPPORTS_TRANSLATE3D,sdk_timestep_ui_backend_dom_ViewBacking,ViewBacking;function CHECK_TRANSLATE3D(){var t,r,e=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(r in n)void 0!==e.style[r]&&(e.style[r]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(n[r]),TRANSFORM_PREFIX=r);return document.body.removeChild(e),void 0!==t&&0<t.length&&"none"!==t}jsio("import device"),jsio("import event.Callback as Callback"),jsio("import animate"),jsio("import event.input.InputEvent as InputEvent"),jsio("import math.geom.Point as Point"),jsio("from util.browser import $"),jsio("import ..BaseBacking");Canvas=device.get("Canvas"),AVOID_CSS_ANIM=device.isAndroid,TRANSFORM_PREFIX="transform",SUPPORTS_TRANSLATE3D=!1,sdk_timestep_ui_backend_dom_ViewBacking=__class__,ViewBacking=exports=sdk_timestep_ui_backend_dom_ViewBacking(function(){return this.init&&this.init.apply(this,arguments)},BaseBacking,function(){var e={};"x y r width height visible anchorX anchorY offsetX offsetY opacity scale zIndex scrollLeft scrollTop flipX flipY".split(" ").forEach(function(t){e[t]=!0,this.__defineGetter__(t,function(){return t in this._computed?this._computed[t]:parseInt(this._node.style[t])}),this.__defineSetter__(t,function(e){var n={};return n[t]=e,this._setProps(n),e})},this),this.init=function(e,t){this._view=e,this._subviews=[],this._noCanvas=t["dom:noCanvas"];var n=this._node=document.createElement(t["dom:elementType"]||"div");n._view=e,n.addEventListener("webkitTransitionEnd",bind(this,"_transitionEnd"),!1),n.className="view",t["dom:className"]&&(n.className+=" "+t["dom:className"]);var r="fontSize:1px;position:absolute;top:0px;left:0px;-webkit-transform-origin:0px 0px;";device.isAndroid||(r+="-webkit-backface-visibility:hidden;");var i=n.style;i.cssText=r,this.position(0,0);var r=t["dom:styles"],s;for(s in r)i[s]=r[s];this._computed={x:0,y:0,r:0,width:void 0,height:void 0,anchorX:0,anchorY:0,offsetX:0,offsetY:0,opacity:1,visible:!0,zIndex:0,scale:1},this._view.getAnimation=function(){return this.__view},this._animating=!1,this._animationQueue=[],this._animationCallback=null,!1},this.getElement=function(){return this._node};var t=9e5;this.addSubview=function(e){var n=e.__view,r=n._node,i=r.parentNode&&r.parentNode._view;return i==this._view?!1:(i&&i.__view.removeSubview(e),e=this._subviews.length,this._subviews[e]=n,this._node.appendChild(r),n._setAddedAt(++t),e&&n.__sortKey<this._subviews[e-1].__sortKey&&(this._needsSort=!0),!0)},this.removeSubview=function(e){var t=this._subviews.indexOf(e.__view);return-1!=t?(this._subviews.splice(t,1),this._node.removeChild(e.__view._node),!0):!1},this.getSuperview=function(){var e=this._node.parentNode;return e==document.body||!e?null:e._view},this.getSubviews=function(){this._needsSort&&(this._needsSort=!1,this._subviews.sort());for(var e=[],t=this._subviews.length,n=0;n<t;++n)e[n]=this._subviews[n]._view;return e},this.wrapTick=function(e,t){this._view.tick&&this._view.tick(e,t);for(var n=0,r;r=this._subviews[n];++n)r.wrapTick(e,t)},this.wrapRender=function(e,t){if(this.visible){this.__firstRender||this._view.needsReflow(!0),this._needsSort&&(this._needsSort=!1,this._subviews.sort());var n=this._computed.width,r=this._computed.height;if(!(0>n||0>r))try{var i=this._view.render;i&&!i.isFake&&this._render(i,n,r,t),this._renderSubviews(e,t)}catch(s){logger.error(this,s.message,s.stack)}}},this._render=function(e,t,n,r){if(this._noCanvas)e.call(this._view,null,r);else{this._canvas||(this._canvas=new Canvas,this._node.insertBefore(this._canvas,this._node.firstChild),this.ctx=this._canvas.getContext("2d"));var i=this._view._needsRepaint;if((t|0)!=this._canvas.width||(n|0)!=this._canvas.height)i=!0,this._canvas.width=t,this._canvas.height=n;i&&(this._view._needsRepaint=!1,this._canvas.style.display="none",this.ctx.clear(),this.ctx.save(),e.call(this._view,this.ctx,r),this.ctx.restore(),this._canvas.style.display="block")}},this._renderSubviews=function(e,t){for(var n=0,r,i=this._subviews;r=i[n++];)r.wrapRender(e,t)},this.localizePoint=function(e){var t=this._computed;return e.x-=t.x+t.anchorX+t.offsetX,e.y-=t.y+t.anchorY+t.offsetY,t.r&&e.rotate(-t.r),e.scale(1/t.scale),e.x+=t.anchorX,e.y+=t.anchorY,e},this.copy=function(){return merge({},this._computed)},this.update=function(e){this._setProps(e)},this.position=function(e,t){var n=this._node.style;if(SUPPORTS_TRANSLATE3D){var r="translate3d("+e+"px,"+t+"px,0)";n[TRANSFORM_PREFIX]=""!=n[TRANSFORM_PREFIX]&&n[TRANSFORM_PREFIX]!=r?n[TRANSFORM_PREFIX]+r:r}else n.left=e+"px",n.top=t+"px"},this._updateOrigin=function(){this._node.style.webkitTransformOrigin=(this._computed.anchorX||0)+"px "+(this._computed.anchorY||0)+"px"},this._setProps=function(t,n){var r=!1,i=this._node.style,s=0,o=!1,u={},a;for(a in t){var f=t[a];if("dx"==a||"dy"==a)a=a.substr(1),f=this._computed[a]+f;switch(a){case"anchorX":case"anchorY":this._computed[a]=f,this._updateOrigin();break;case"clip":this._computed.clip=f,i.overflow=f?"hidden":"visible";break;case"zIndex":this._computed.zIndex!=f&&(this._computed.zIndex=f,i.zIndex=f,this._onZIndex(f));break;case"offsetX":case"offsetY":case"x":case"y":case"r":case"scale":this._computed[a]!=f&&(u[a]=this._computed[a],this._computed[a]=f,r=!0);break;default:this._computed[a]!=f&&(++s,this._computed[a]=f,"width"==a||"height"==a?(i[a]=f+"px",o=!0):"visible"==a?i.display=f?this._displayStyle||"block":"none":"opacity"==a?i[a]=f:(i[a]=f,e[a]||(this[a]=f)))}}if(r){++s;var c=this._computed,r=(this._center?-c.width/2|0:0)+c.x+c.offsetX;a=(this._center?-c.height/2|0:0)+c.y+c.offsetY;if(AVOID_CSS_ANIM){var h={scale:u.scale||c.scale,r:u.r||c.r};if(!n||h.scale==c.scale&&h.r==c.r){if(h.scale!=c.scale||h.r!=c.r)i.WebkitTransform="scale("+(c.flipX?-1*c.scale:c.scale)+","+(c.flipY?-1*c.scale:c.scale)+") rotate("+c.r+"rad)"}else animate(h).now({scale:c.scale,r:c.r},n.duration,n.easing,bind(this,function(){i.WebkitTransform="scale("+(c.flipX?-1*h.scale:h.scale)+","+(c.flipY?-1*h.scale:h.scale)+") rotate("+h.r+"rad)"})).then(bind(this,function(){i.WebkitTransform="scale("+(c.flipX?-1*h.scale:h.scale)+","+(c.flipY?-1*h.scale:h.scale)+") rotate("+c.r+"rad)"}));this.position(r,a)}else{u=new WebKitCSSMatrix,u=u.translate(r,a),u=u.rotate(180*c.r/3.14159),u=u.scale(c.scale);if(c.flipX||c.flipY)u=u.translate(c.flipX?-c.width:0,c.flipY?c.height/2:0),u=u.scale(c.flipX?-1:1,c.flipY?-1:1),u=u.translate(c.flipX?c.width:0,c.flipY?-c.height/2:0);u=u.rotate(0,360,0),i.WebkitTransform=u}}return o&&this._view.needsReflow(),s},this._sortIndex="00000000",this._onZIndex=function(e){e=~~e,-99999999>e&&(e=this._zIndex=-99999999),99999999<e&&(e=this._zIndex=99999999),0>e?(e*=-1,this._sortIndex="-"+"00000000".substring(0,8-(""+e).length)+e):this._sortIndex="00000000".substring(0,8-(""+e).length)+e,this._setSortKey()},this._setAddedAt=function(e){this._addedAt=e,this._setSortKey()},this._setSortKey=function(){this.__sortKey=this._sortIndex+this._addedAt},this.toString=function(){return this.__sortKey},this._transitionEnd=function(e){$.stopEvent(e),this.transitionCallback.fired()||(this.transitionCallback.fire(),this.transitionCallback.reset(),e?e.cancelBubble=!0:this._transitionEndTimeout&&(this._transitionEndTimeout=null),this._node.style.webkitTransition="none",this._animating=!1,this._animationCallback&&(e=this._animationCallback,this._animationCallback=null,e()),this._processAnimation())},this._processAnimation=function(e){if(0!=this._animationQueue.length&&!this._isPaused)if(e&&(clearTimeout(this._queuedTimeout),this._queuedTimeout=null),!this._queuedTimeout)if(e)switch(e=this._animationQueue.shift(),e.type){case"animate":var t=this._node.style;t.webkitTransitionProperty=AVOID_CSS_ANIM?"left, top, opacity, width, height":"-webkit-transform, opacity, width, height",t.webkitTransitionDuration=(e.duration|0)+"ms",t.webkitTransitionTimingFunction="string"==typeof e.easing?e.easing:e.easing==animate.easeIn?"ease-in":e.easing==animate.easeOut?"ease-out":e.easing==animate.easeInOut?"ease-in-out":e.easing==animate.linear?"linear":"ease",this._setProps(e.props,e);case"wait":this._animating=!0,this._animationCallback=e.callback||null,this.transitionCallback=new Callback,this.transitionCallback.runOrTimeout(function(){},bind(this,function(e){this._transitionEnd(e)}),e.duration);break;case"callback":e.callback(),this._animating||this._processAnimation()}else this._queuedTimeout||(this._queuedTimeout=setTimeout(bind(this,function(){this._queuedTimeout=!1,this._processAnimation(!0)}),0))},this.getQueue=function(){return[]},this.getAnimation=function(){return this},this.animate=function(){return arguments[0]?this.next.apply(this,arguments):this},this.clear=function(){return this.transitionCallback&&this.transitionCallback.fire(),this._transitionEndTimeout&&clearTimeout(this._transitionEndTimeout),this._animationQueue=[],this._animationCallback=null,this._animating=!1,this},this.commit=function(){this._node.style.webkitTransition="none";var e=this._animationQueue;this._animationQueue=[];for(var t=e.length,n=0;n<t;++n){var r=e[n];switch(r.type){case"animate":this._setProps(r.props);break;case"callback":r.callback()}}return this},this.pause=function(){this._isPaused=!0},this.resume=function(){this._isPaused=!1,this._processAnimation()},this.animate=function(e,t,n,r){return this.then(e,t,n,r)},this.now=function(e,t,n,r){return this.clear(),this.then(e,t,n,r)},this.then=function(e,t,n,r){return 1==arguments.length&&"function"==typeof e?this.callback(e):(this._animationQueue.push({type:"animate",props:e,duration:t||600,callback:r&&bind(this,r),easing:n}),1==this._animationQueue.length&&!this._animating&&this._processAnimation(),this)},this.callback=function(e){return this._animationQueue.push({type:"callback",duration:0,callback:e&&bind(this,e)}),1==this._animationQueue.length&&!this._animating&&this._processAnimation(),this},this.wait=function(e,t){return this._animationQueue.push({type:"wait",duration:e,callback:t}),1==this._animationQueue.length&&!this._animating&&this._processAnimation(),this},this.fadeIn=function(e,t){this.show();if(1!=this._node.style.opacity)return this.then({opacity:1},e,null,t),this;t&&t()},this.fadeOut=function(e,t){if(0!=this._node.style.opacity)return this.then({opacity:0},e,null,bind(this,function(){this.hide(),t&&t()})),this;this.hide(),t&&t()}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/ImageView.js",'var imageCache,sdk_timestep_ui_backend_canvas_ImageView,ImageView;jsio("import util.path"),jsio("import std.uri as URI"),jsio("import ui.View as View"),jsio("import ui.resource.Image as Image");imageCache={},sdk_timestep_ui_backend_canvas_ImageView=__class__,ImageView=exports=sdk_timestep_ui_backend_canvas_ImageView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.getImage=function(){return this._img},this.getImageFromCache=function(e,t){var n;return t||(n=imageCache[e]),n||(imageCache[e]=n=new Image({url:e,forceReload:!!t})),n},this.updateOpts=function(t){return t=e(this,"updateOpts",arguments),"autoSize"in t&&(this._autoSize=!!t.autoSize),t.image?this.setImage(t.image):this.needsReflow(),t},this.setImage=function(e,t){var n=t&&t.forceReload;"string"==typeof e&&(e=this.getImageFromCache(e,n));if(this._img=e)(this._autoSize=t&&"autoSize"in t?t.autoSize:this._autoSize)&&(0<this._img.getWidth()&&0<this._img.getHeight()?this.autoSize():this._img.doOnLoad(this,"autoSize")),this._img.doOnLoad(this,"needsRepaint")},this.doOnLoad=function(){return 1==arguments.length?this._img.doOnLoad(this,arguments[0]):this._img.doOnLoad.apply(this._img,arguments),this},this.autoSize=function(){this._img&&(this.style.width=this._img.getWidth(),this.style.height=this._img.getHeight(),this.style.fixedAspectRatio&&this.style.enforceAspectRatio(this.style.width,this.style.height))},this.getOrigWidth=this.getOrigW=function(){return this._img.getOrigW()},this.getOrigHeight=this.getOrigH=function(){return this._img.getOrigH()},this.render=function(e){if(this._img){var t=this.style;this._img.render(e,0,0,t.width,t.height)}};var t=window.location.toString(),n=window.location.hostname;this.getTag=function(){var e;if(this._img){var r=this._img.getOriginalURL();if(this._cachedTag&&r==this._cachedTag.url)e=this._cachedTag.tag;else{e=URI.relativeTo(r,t);var i=e.getHost();e=util.path.splitExt(e.getFile()).basename+(i&&i!=n?":"+i:""),this._cachedTag={url:r,tag:e}}}return(e||"")+":ImageView"+this.uid}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/TextView.js",'var messageFont,textViewID,sdk_timestep_ui_backend_canvas_TextView,TextView;jsio("import ui.View as View"),jsio("import ui.resource.Image as Image"),jsio("import ui.layout.Padding as Padding"),jsio("import device"),jsio("import .util.FragmentBuffer as FragmentBuffer"),jsio("import .TextFlow"),jsio("import ...legacySettings as legacySettings");messageFont=!0,textViewID=1,sdk_timestep_ui_backend_canvas_TextView=__class__,TextView=exports=sdk_timestep_ui_backend_canvas_TextView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){var t={multiline:{replacement:"wrap"},textAlign:{replacement:"horizontalAlign"},lineWidth:{replacement:"strokeWidth"},strokeStyle:{replacement:"strokeColor"},outlineColor:{replacement:"strokeColor"}},n={wrap:!1,autoSize:!1,autoFontSize:!0,padding:new Padding(0),lineHeight:1.2,color:"#000000",fontFamily:device.defaultFontFamily,fontWeight:device.defaultFontWeight,size:128,strokeWidth:2,shadowWidth:2,strokeColor:null,shadowColor:null,verticalAlign:"middle",horizontalAlign:"center",buffer:!1,backgroundColor:null},r={width:!0,height:!0,wrap:!0,autoSize:!0,autoFontSize:!0,padding:!0,lineHeight:!0,color:!1,fontFamily:!0,fontWeight:!0,size:!0,strokeWidth:!0,shadowWidth:!0,strokeColor:!1,shadowColor:!1,verticalAlign:!0,horizontalAlign:!0,backgroundColor:!1,text:!0},i=Object.keys(r),s=Object.keys({color:!0,fontFamily:!0,fontWeight:!0,size:!0,strokeWidth:!0,shadowWidth:!0,strokeColor:!1,shadowColor:!1,backgroundColor:!0,text:!0}),o=["width","height","size"],u=new FragmentBuffer;u.onGetHash=function(e){return e.textView.getHash()},this.init=function(t){this._opts={},this._optsLast={},this.updateCache(),this._textFlow=new TextFlow({target:this}),this._textFlow.subscribe("ChangeWidth",this,"onChangeWidth"),this._textFlow.subscribe("ChangeHeight",this,"onChangeHeight"),this._textFlow.subscribe("ChangeSize",this,"onChangeSize"),e(this,"init",[merge(t,n)]),this._id=textViewID++},this.onChangeWidth=function(e){this.updateOpts({width:e},!0)},this.onChangeHeight=function(e){this.updateOpts({height:e},!0)},this.onChangeSize=function(e,t){this.updateOpts({size:e},!0),t&&(t.font=this._opts.fontWeight+" "+this._opts.size+"px "+this._opts.fontFamily)},this._restoreOpts=function(){for(var e=this._optsLast,t,n=o.length;n;)t=o[--n],t in e&&(this._opts[t]=e[t])},this._checkOpts=function(e){var t=this._optsLast,s,o=i.length;if(this._cacheUpdate=this._cacheUpdate||!Object.keys(this._opts).length)this._hash=!1;for(;o;)s=i[--o],s in e&&r[s]&&t[s]!==e[s]&&(this._cacheUpdate=!0),t[s]=s in e?e[s]:s in this._opts?this._opts[s]:n[s]},this._checkDeprecatedOpts=function(e){e.allowVerticalSizing=!legacySettings.disableVerticalAutoSize;for(var n in t)if(n in e){var r=t[n];!1,e[r.replacement]=e[n]}if(n=e.font){!1;for(;n.length&&" "===n[0];)n=n.substr(1-n.length);r=n.indexOf(" "),-1!==r&&(e.size=parseInt(n.substr(0,r).replace(/[pxtem\\s]/gi,""),10),e.fontFamily=n.substr(r+1-n.length))}},this.updateCache=function(){this._cacheUpdate=!0,this._hash=!1},this.updateOpts=function(t,n){if(t.emoticonData)for(var r in t.emoticonData.data){var i=t.emoticonData.data[r];i.image||(i.image=new Image({url:i.url}))}this._opts.buffer&&u.releaseBin(this.getHash()),this.updateCache(),this._checkDeprecatedOpts(t),"padding"in t&&(this.style.padding=new Padding(t.padding));if(!n){if(this._restoreOpts(),this._checkOpts(t),!this._cacheUpdate){e(this,"updateOpts",arguments);return}t.hash=!1}return t=e(this,"updateOpts",arguments),"text"in t&&this.setText(t.text),!n&&this._textFlow.setOpts(this._opts),t},this._updateCtx=function(e){var t=this._opts;e.textAlign="left",e.textBaseline="top",e.fillStyle=t.color,e.font=t.fontWeight+" "+t.size+"px "+t.fontFamily,e.lineWidth=this.getStrokeWidth()},this._renderToCtx=function(e,t,n){var r=this._opts,i=this._textFlow.getWords(),s=r.autoFontSize?this._textFlow.getAvailableWidth():1e6,o,u,a=r.color,f=r.strokeColor,l=r.shadowColor,c=this.getStrokeWidth()/2,h,p,d=i.length;legacySettings.textViewColor&&this.color&&(a=this.color),this._updateCtx(e),f&&(e.strokeStyle=f);for(;d;){o=i[--d],u=o.word,h=t+o.x,p=n+o.y;var v="("==u[0]&&r.emoticonData&&r.emoticonData.data[u];v?v.image&&v.image.render(e,h+c,p+c,r.size,r.size):(f&&e.strokeText(u,h+c,p+c,s),l&&(v=this._opts.shadowWidth||0,e.fillStyle=l,e.fillText(u,h+c+v,p+c+v,s)),e.fillStyle=a,e.fillText(u,h+c,p+c,s))}this._opts.debug&&(e.strokeStyle="black",e.strokeRect(h,p,o.width,this.style.height-2*p),e.strokeStyle="red",e.strokeRect(0,0,this.style.width,this.style.height))},this._renderBuffer=function(e){var t=u.getContext(),n=this._textFlow.getOffsetRect(),r=n.width,i=n.height,s=this._textFlow.getWords();r&&i&&(this._opts.lineCount=s[s.length-1].line,n.text=this._opts.text,n.textView=this,s=u.getPositionForText(n),null!=s?(this._cacheUpdate&&(t.clearRect(s.x,s.y,s.width,s.height),this._renderToCtx(t,s.x-n.x,s.y-n.y)),e.drawImage(u.getCanvas(),s.x,s.y,r,i,n.x,n.y,r,i)):this._opts.buffer=!1)},this.computeSize=function(e){if(this._cacheUpdate){this._updateCtx(e);var t=this._opts;this._textFlow.reflow(e,1+(t.autoFontSize?4:0)+(t.autoSize?2:0)+(t.wrap?1:0))}},this.render=function(e){this.computeSize(e);if(this._textFlow.getWords().length)if(this._opts.buffer)this._renderBuffer(e);else{var t=-this.getStrokeWidth()/2;this._renderToCtx(e,t,t)}this._cacheUpdate=!1},this.clearBuffers=function(){u.clearBuffer()},this.getFontBuffer=function(){return u},this.setText=function(e){var e=void 0!=e?e.toString():"",t=this._opts.emoticonData;if(t)for(var n in t.map)var r=RegExp(n.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g,"\\\\$&"),"g"),e=e.replace(r,t.map[n]);this._opts.text!==e&&(this._opts.buffer&&u.releaseBin(this.getHash()),this._restoreOpts(),this._opts.text=e,this.updateCache(),this.needsRepaint())},this.getStrokeWidth=function(){return this._opts.strokeColor?this._opts.strokeWidth:0},this.getText=function(){return this._opts.text},this.getTag=function(){return"TextView"+this.uid+":"+(this.tag||(this._opts.text||"").substring(0,20))},this.getOpts=function(){return this._opts},this.getHash=function(){if(!this._hash){this._hash="";for(var e=this._opts,t=s.length;t;)this._hash+=e[s[--t]]}return this._hash},this.reflow=function(){this._restoreOpts(),this._cacheUpdate=!0}});exports.clearBuffers=TextView.prototype.clearBuffers,exports.getFontBuffer=TextView.prototype.getFontBuffer'),jsio.setCachedSrc("sdk/timestep/ui/layout/Padding.js",'Padding=__class__,exports=Padding=Padding(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=this.update=function(e){if(e instanceof Padding)this.top=e.top,this.right=e.right,this.bottom=e.bottom,this.left=e.left;else{"string"==typeof e&&(e=e.split(/\\s+/).map(function(e){return parseFloat(e)}));if(!e||!e.length)e=[e||0];switch(e.length){case 1:this.left=this.right=this.top=this.bottom=e[0];break;case 2:this.top=this.bottom=e[0],this.left=this.right=e[1];break;case 3:this.top=e[0],this.left=this.right=e[1],this.bottom=e[2];break;case 4:this.top=e[0],this.right=e[1],this.bottom=e[2],this.left=e[3]}}},this.getVertical=function(){return this.top+this.bottom},this.getHorizontal=function(){return this.left+this.right},this.toString=function(){return[this.top,this.right,this.bottom,this.left].join(" ")}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/util/FragmentBuffer.js",'var sdk_timestep_ui_backend_canvas_util_FragmentBuffer,FragmentBuffer;jsio("import device"),jsio("import .FragmentBin"),jsio("import .SortedLinkedList as SortedList");sdk_timestep_ui_backend_canvas_util_FragmentBuffer=__class__,FragmentBuffer=exports=sdk_timestep_ui_backend_canvas_util_FragmentBuffer(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this.opts=merge(e,{}),this._cache={},this._decriptions=[],window.addEventListener("pageshow",bind(this,"clearBuffer"),!1)};var e=function(e,t){return e.size()>t.size()};this._build=function(){this._canvas=new(device.get("Canvas"))({width:1024,height:1024}),this._ctx=this.getCanvas().getContext("2d",bind(this,function(){logger.log("{fragment-buffer} Reacting to lost canvas by clearing text buffer"),this._canvas=null,this.clearBuffer()})),this._ctx.clearRect(0,0,1024,1024),this._ctx.textAlign="left",this._ctx.textBaseline="middle",this._ctx.globalCompositeOperation="source-over",this._binList=new SortedList(e),this._binList.insert(new FragmentBin({x:0,y:0,width:1024,height:1024}))},this.getCanvas=function(){return this._canvas||this._build(),this._canvas},this.getContext=function(){return this._ctx||this._build(),this._ctx},this.onGetHash=function(){throw Error("onGetHash should be implemented.")},this._insertText=function(e){for(var t=Math.ceil(e.width)+1,n=Math.ceil(e.height)+1,r=this._binList.iterator(),e=null,i=!1;r.hasNext()&&!i;)e=r.next(),!e.filled&&e.width>=t&&e.height>=n?i=!0:e=null;if(e){newBins=e.split(t,n);for(t=0;t<newBins.length;t++)this._binList.insert(newBins[t])}else logger.log("buffer full, further TextViews will not be cached");return e},this.getPositionForText=function(e){var t=this.onGetHash(e),n=Math.ceil(e.width)+1;return!this._cache[t]&&0<n&&(this._cache[t]=this._insertText(e,!1),this._decriptions.push(e)),this._cache[t]},this.releaseBin=function(){},this.clearBuffer=function(){this._cache={},this._binList=new SortedList(e),this._binList.insert(new FragmentBin({x:0,y:0,width:1024,height:1024}));for(this._ctx&&this._ctx.clearRect(0,0,1024,1024);this._decriptions.length;)this._decriptions.pop().textView.updateCache()}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/util/FragmentBin.js",'var sdk_timestep_ui_backend_canvas_util_FragmentBin=__class__,FragmentBin=exports=sdk_timestep_ui_backend_canvas_util_FragmentBin(function(){return this.init&&this.init.apply(this,arguments)},"TextBin",function(){this.init=function(e){this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y},this.size=function(){return this.width*this.height},this.split=function(e,t){var n=[this];if(10<this.width&&10<this.height){if(10<this.height-t){var r=new FragmentBin({x:this.x,y:this.y+t,width:this.width,height:this.height-t});n.push(r)}10<this.width-e&&(r=new FragmentBin({x:this.x+e,y:this.y,width:this.width-e,height:t}),n.push(r))}return this.width=e,this.height=t,this.filled=!0,n}});'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/util/SortedLinkedList.js",'var Item,sdk_timestep_ui_backend_canvas_util_SortedLinkedList,Iterator=__class__;Iterator=Iterator(function(){return this.init&&this.init.apply(this,arguments)},"Iterator",function(){this.init=this.update=function(e){this._list=e||this._list,this._current=e.head,this._count=0},this.next=function(){var e=this._current.data;return this._current=this._current.next,this._count++,e},this.current=function(){return this._current.data},this.insertBefore=function(e){this._current.insertBefore(e),this._list.count++},this.insertAfter=function(e){this._current.insertAfter(e),this._list.count++},this.remove=function(){this._current.prev.remove(),this._current.prev==this._current&&(this._list.head=null),this._list.count--},this.hasNext=function(){return this._count<this._list.count},this.atHead=function(){return this._current==this._list.head}}),Item=__class__,Item=Item(function(){return this.init&&this.init.apply(this,arguments)},"Item",function(){this.init=function(e,t,n){this.data=e,this.prev=t||this,this.next=n||this},this.insertBefore=function(e){e=new Item(e,this.prev,this),this.prev=this.prev.next=e},this.insertAfter=function(e){e=new Item(e,this,this.next),this.next=this.next.prev=e},this.remove=function(){this.prev.next=this.next,this.next.prev=this.prev}}),sdk_timestep_ui_backend_canvas_util_SortedLinkedList=__class__;exports=sdk_timestep_ui_backend_canvas_util_SortedLinkedList(function(){return this.init&&this.init.apply(this,arguments)},"SortedLinkedList",function(){this.init=function(e){this.head=null,this._comparator=e,this.count=0},this.append=function(e){this._head.insertAfter(e),this.count++},this.insert=function(e){var t,n,r;if(this.head){for(t=this.iterator(),n=t.current(),r=!1;t.hasNext()&&!r;)r=!this._comparator(e,n),r||(t.next(),n=t.current());t.insertBefore(e),r&&t.atHead()&&(this.head=this.head.prev)}else this.head=new Item(e),this.count++},this.iterator=function(){return new Iterator(this)}})'),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/TextFlow.js",'var textFlowMode,sdk_timestep_ui_backend_canvas_TextFlow,TextFlow;jsio("import lib.Enum as Enum"),jsio("import lib.PubSub as PubSub");textFlowMode=Enum("NONE","WRAP","AUTOSIZE","AUTOSIZE_WRAP","AUTOFONTSIZE","AUTOFONTSIZE_WRAP","AUTOFONTSIZE_AUTOSIZE","AUTOFONTSIZE_WRAP_AUTOSIZE"),sdk_timestep_ui_backend_canvas_TextFlow=__class__,TextFlow=exports=sdk_timestep_ui_backend_canvas_TextFlow(function(){return this.init&&this.init.apply(this,arguments)},PubSub,function(e){this.init=function(t){e(this,"init",arguments),this._target=t.target,this._lineWidth=0,this._line=[],this._lines=[],this._words=[],this._heightFound=this._maxHeight=this._maxWidth=this._maxWordWidth=0,this._offsetRect={x:0,y:0,width:0,height:0}},this.measureText=function(e,t){var n=this._opts;return"("==t[0]&&n.emoticonData&&n.emoticonData.data[t]?n.size:e.measureText(t).width},this._lineSplit=function(e){var t=this._opts,n=t.wrapCharacter?0:e.measureText(" ").width,r=t.text||"",i=t.wrapCharacter?r.replace(/\\t/g," ").match(/\\S[\\u3002\\uff0c]?|[\\n]/g)||[]:t.wrap||"justify"===t.horizontalAlign?r.replace(/\\t/g," ").match(/\\S+|[\\n]| +(?= )/g)||[]:r.split("\\n"),s,o=[];for(c in i){s=i[c];for(var u=-1,a=0,f=0;f<s.length;f++){var l=s[f];"("==l?u=f:")"==l&&-1<u&&(0<u-a&&o.push(s.substring(a,u)),o.push(s.substring(u,f+1)),a=f+1,u=-1)}a<s.length&&o.push(s.substring(a))}i=o,o=0,l=i.length,this._line=[],this._maxWordWidth=this._lineWidth=0,s=this.getAvailableWidth();if((t.hardWrap||exports.hardWrap)&&i.length&&this.measureText(e,r)>s){for(var i=[],t="",c=0;c<r.length;)l=r[c++],e.measureText(t+l).width>=s?(i.push(t),t=l):t+=l;""!==t&&i.push(t),l=i.length}for(;o<l;)s={word:i[o],width:this.measureText(e,i[o]),line:1},this._line.push(s),this._lineWidth+=s.width+n,this._maxWordWidth=Math.max(this._maxWordWidth,s.width),o++;this._lineWidth-=n},this._measureWords=function(e){var t=this._opts.wrapCharacter?0:e.measureText(" ").width,n=0,r=this._line.length;for(this._maxWordWidth=this._lineWidth=0;n<r;)word=this._line[n],word.line=1,word.width=this.measureText(e,word.word),this._lineWidth+=word.width+t,this._maxWordWidth=Math.max(this._maxWordWidth,word.width),n++;this._lineWidth-=t},this._wrap=function(e,t){var n=this._opts.wrapCharacter?0:e.measureText(" ").width,r,i=0,s=[],o=[];this._lines=s;var u=this._maxWidth=0,a=this._line.length;if("justify"===this._opts.horizontalAlign){for(;u<a;)r=this._line[u++],i+=r.width+n,"\\n"===r.word?(s.push(o),o=[],i=0):i>t?(o.length&&s.push(o),o=[r],i=r.width+n):o.push(r);o.length&&s.push(o)}else{for(;u<a;)if(r=this._line[u++],"\\n"===r.word)s.push(o),i=0;else{var f=!o.length,l=!f&&!this._opts.wrapCharacter?n:0;if(i+r.width+l>t)if(r.width>t){r=r.word;for(var c="",h=0,p=r.length;h<p;++h)f&&!c||this.measureText(e,c+r[h])+l+i<=t?c+=r[h]:(i=this.measureText(e,c),o.push({word:c,width:i,line:s.length}),s.push(o),o=[],l=i=0,f=!0,c=r[h]);c&&(i=this.measureText(e,c),o.push({word:c,width:i,line:s.length}))}else!f&&s.push(o),o=[r],i=r.width;else o.push(r),i+=r.width+l}0<o.length&&s.push(o)}},this._getLineSize=function(e){var t=this._opts;return(1>=e?1:t.lineHeight)*t.size},this._wordFlow=function(e){var e=this._opts.wrapCharacter?0:e.measureText(" ").width,t=this._lines;this._words=[];for(var n=this._maxHeight=this._maxWidth=0,r=t.length,i=this._getLineSize(r),s=0;n<r;){for(var o=t[n++],u=0,a=o.length,f=0;u<a;){var l=o[u++];l.x=f,l.y=s,l.line=n,this._words.push(l),f+=l.width+e}s+=i,f-=e,this._maxWidth=Math.max(this._maxWidth,f),this._maxHeight=Math.max(this._maxHeight,s)}},this._checkWidth=function(e,t){if(""===this._opts.text)return!1;var n=this._opts;if(t>this.getAvailableWidth()){var r=n.size*this._target.style.width/t|0;return n.size!==r&&this.publish("ChangeSize",r,e),!0}return!1},this._checkHeight=function(e,t,n,r){if(""!==this._opts.text&&!(2>Math.abs(n-t))){var i=Math.max(t+n>>1,1);this.publish("ChangeSize",i,e),r();if(1!==i){var s=this._opts;this._lines.length*this._getLineSize(this._lines.length)>this.getAvailableHeight()?this._checkHeight(e,t,i,r):(this._heightFound=s.size,this._checkHeight(e,i,n,r))}}},this._horizontalAlign=function(e){var t=this._words;if(t.length){var n=e=this._opts.wrapCharacter?0:e.measureText(" ").width,r=t[t.length-1].line,i=this.getPaddingLeft(),s={left:-1,center:2,right:1,justify:3}[this._opts.horizontalAlign]||-1,o=this.getAvailableWidth();3===s&&(e=0);for(var u=0,a=t.length;u<a;){for(var f=u,l=t[u].line,c=0;u<a&&l===t[u].line;)c+=t[u].width+e,u++;if(-1===s)for(;f<u;)t[f++].x+=i;else if(3===s){l=l<r?(o-c)/(u-f-1):n;for(c=i;f<u;)t[f].x=c,c+=t[f].width+l,f++}else for(l=(o-c+e)/s+i;f<u;)t[f++].x+=l}}},this._verticalAlign=function(){var e=this._lines.length,t=this._opts.verticalAlign,n=this._words,r=this.getAvailableHeight(),i=n.length;if(i){if("top"==t)e=this.getPaddingTop();else var t="middle"==t?2:1,s=this._getLineSize(e),e=(r-e*s)/t+this.getPaddingTop();for(;i;)n[--i].y+=e;this._offsetRect.y+=e}},this.reflow=function(e,t){var n=this._opts,r=this.getAvailableWidth(),i=this.getAvailableHeight();this._lineSplit(e);switch(t){case textFlowMode.NONE:this._lines=[this._line],this._wordFlow(e);break;case textFlowMode.WRAP:this._wrap(e,r),this._wordFlow(e);break;case textFlowMode.AUTOSIZE:case textFlowMode.AUTOFONTSIZE_AUTOSIZE:this._lines=[this._line],this._wordFlow(e),(this._opts.fitWidth||r<this._maxWidth)&&this.publish("ChangeWidth",this._maxWidth+this.getHorizontalPadding()),(this._opts.fitHeight||i<this._maxHeight)&&this.publish("ChangeHeight",this._maxHeight+this.getVerticalPadding());break;case textFlowMode.AUTOSIZE_WRAP:this._wrap(e,r),this._wordFlow(e),(this._opts.fitWidth||r<this._maxWidth)&&this.publish("ChangeWidth",this._maxWidth+this.getHorizontalPadding()),(this._opts.fitHeight||i<this._maxHeight)&&this.publish("ChangeHeight",this._maxHeight+this.getVerticalPadding());break;case textFlowMode.AUTOFONTSIZE:this._checkWidth(e,this._lineWidth)&&this._lineSplit(e),this._lines=[this._line];if(n.allowVerticalSizing&&n.size>i){var s=bind(this,function(){this._measureWords(e),this._wordFlow(e)});this._checkHeight(e,1,n.size,s),this.publish("ChangeSize",this._heightFound,e),s()}else this._wordFlow(e);break;case textFlowMode.AUTOFONTSIZE_WRAP:this._wrap(e,r),this._wordFlow(e);var o=this._lines.length,s=this._getLineSize(o);n.allowVerticalSizing&&o*s>i&&(s=bind(this,function(){this._measureWords(e),this._wrap(e,r),this._wordFlow(e)}),this._checkHeight(e,1,n.size,s),this.publish("ChangeSize",this._heightFound,e),s());break;case textFlowMode.AUTOFONTSIZE_WRAP_AUTOSIZE:this._wrap(e,r),this._wordFlow(e),i<this._maxHeight&&this.publish("ChangeHeight",this._maxHeight+this.getVerticalPadding())}i=this._words,o=i[i.length-1];if(i.length){var u=this._target.getStrokeWidth(),s=Math.ceil(n.size*n.lineHeight+u);this._offsetRect.x=this.getPaddingLeft(),this._offsetRect.y=this.getPaddingTop(),this._offsetRect.width=r,this._offsetRect.height=o.line*s,this._horizontalAlign(e),this._verticalAlign(),1===o.line&&(this._offsetRect.x=i[0].x,this._offsetRect.width=o.x+o.width-i[0].x),this._offsetRect.width+=u}},this.setOpts=function(e){this._opts=e},this.getWords=function(){return this._words},this.getHorizontalPadding=function(){var e=this._target.style.padding;return e.left+e.right},this.getPaddingLeft=function(){return this._target.style.padding.left},this.getAvailableWidth=function(){return this._target.style.width-this.getHorizontalPadding()},this.getVerticalPadding=function(){var e=this._target.style.padding;return e.top+e.bottom},this.getPaddingTop=function(){return this._target.style.padding.top},this.getAvailableHeight=function(){return this._target.style.height-this.getVerticalPadding()},this.getOffsetRect=function(){return this._offsetRect}})'),jsio.setCachedSrc("sdk/timestep/ui/legacySettings.js","exports={disableVerticalAutoSize:!1,textViewColor:!1}"),jsio.setCachedSrc("sdk/timestep/ui/backend/canvas/ViewDebugger.js",'var sdk_timestep_ui_backend_canvas_ViewDebugger;jsio("import std.js as JS");sdk_timestep_ui_backend_canvas_ViewDebugger=__class__;exports=sdk_timestep_ui_backend_canvas_ViewDebugger(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){this._target=e,this._opts=t=JS.merge(t,{trackClicks:!1,outline:!1,flash:!1}),this.outline=t.outline,this.trackClicks=t.trackClicks,this.flash=t.flash,this._nextFlash=this._flashState=0},this.preRender=function(e){var t;this._time||(this._time=+(new Date));t=this._time;this._time=+(new Date),this._dt=this._time-t,t=this._target.style,this.outline&&(e.save(),e.globalAlpha=.2,e.strokeStyle="black",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height),e.restore())},this.postRender=function(e){var n,r,t=this._target;if(this.trackClicks)for(n=t._clicks.length-1;0<=n;--n){r=t._clicks[n];e.setFillStyle("rgba(0, 0, 0, "+r.o+")"),r.o-=.4*this._dt/1e3,0<r.o?(e.circle(r.x,r.y,15),e.fill()):t._clicks.splice(n,1)}if(this.flash){switch(this._flashState){case 0:e.setFillStyle("rgba(0, 0, 0, 0.5)");break;case 1:e.setFillStyle("rgba(0, 0, 0, 0)");break;case 2:e.setFillStyle("rgba(255, 255, 255, 0.5)");break;case 3:e.setFillStyle("rgba(0, 0, 0, 0)")}n=+(new Date),n>this._nextFlash&&(this._flashState=(this._flashState+1)%4,this._nextFlash=n+300),e.fillRect(0,0,t.style.width,t.style.height)}}})'),jsio.setCachedSrc("sdk/timestep/ui/init.js",'jsio("import .View"),jsio("import .layout.BackingExtension"),jsio("import .Engine")'),jsio.setCachedSrc("sdk/timestep/ui/layout/BackingExtension.js",'var layoutProps,key;jsio("import ..View"),jsio("import ..backend.strPad as strPad"),jsio("import ..backend.BaseBacking"),jsio("import .BoxLayout"),jsio("import .LinearLayout"),jsio("import .Padding"),jsio("import util.setProperty");layoutProps={layout:{value:!1,cb:"_onSetLayout"},inLayout:{value:!0,cb:"_onInLayout"},order:{value:0,cb:"_onOrder"},direction:{value:"down",cb:"_onLayoutChange"},flex:{value:0,cb:"_onLayoutChange"},halign:{value:"start"},halignSelf:{value:void 0},valign:{value:"start"},valignSelf:{value:void 0},centerX:{value:!1},centerY:{value:!1},top:{value:void 0,cb:"_onLayoutChange"},right:{value:void 0,cb:"_onLayoutChange"},bottom:{value:void 0,cb:"_onLayoutChange"},left:{value:void 0,cb:"_onLayoutChange"},justifyContent:{value:"start",cb:"_onLayoutChange"},sizeContainerToFit:{value:!1,cb:"_onLayoutChange"},minWidth:{value:void 0,cb:"_onLayoutChange"},minHeight:{value:void 0,cb:"_onLayoutChange"},maxWidth:{value:void 0,cb:"_onLayoutChange"},maxHeight:{value:void 0,cb:"_onLayoutChange"},layoutWidth:{value:void 0,cb:"_onLayoutChange"},layoutHeight:{value:void 0,cb:"_onLayoutChange"},fixedAspectRatio:{value:!1,cb:"_onFixedAspectRatio"},aspectRatio:{value:null,cb:"_onLayoutChange"},margin:{value:null,cb:"_onMarginChange"}};for(key in layoutProps)backend.BaseBacking.addProperty(key,layoutProps[key]);util.setProperty(backend.BaseBacking.prototype,"padding",{get:function(){return this._padding||(this._padding=new Padding)},set:function(e){this._padding?this._padding.update(e):this._padding=new Padding(e),this._onLayoutChange()}}),View.addExtension({extend:function(e){e=e.prototype,e._sortOrder=strPad.initialValue,e._onOrder=function(e,t){this._sortOrder=strPad.pad(t),this._onLayoutChange()},e._onMarginChange=function(e,t){this._cachedMargin?this._cachedMargin.update(t):this._cachedMargin=new Padding(t),this.top=this._cachedMargin.top,this.bottom=this._cachedMargin.bottom,this.left=this._cachedMargin.left,this.right=this._cachedMargin.right,this._onLayoutChange()},e._onFixedAspectRatio=function(e,t){t&&this.updateAspectRatio()},e.updateAspectRatio=function(e,t){this.aspectRatio=(e||this.width)/(t||this.height)},e.enforceAspectRatio=function(e,t,n){var e,t,r,i;e&&t&&this.updateAspectRatio(e,t);r=this._view.getSuperview(),i=this._view._opts,e=e||i.width,t=t||i.height;i.width?(e=i.width,t=i.width/this.aspectRatio):i.height?(t=i.height,e=i.height*this.aspectRatio):r&&(this.layoutWidth&&r.style.width?(e=r.style.width*parseFloat(this.layoutWidth)/100,t=e/this.aspectRatio):this.layoutHeight&&r.style.height?(t=r.style.height*parseFloat(this.layoutHeight)/100,e=t*this.aspectRatio):this.flex&&"horizontal"==r.style.direction&&this.width?(e=this.width,t=e/this.aspectRatio):this.flex&&"vertical"==r.style.direction&&this.height?(t=this.height,e=t*this.aspectRatio):n||setTimeout(bind(this,"enforceAspectRatio",e,t,!0),0)),this.width=e,this.height=t},e._onSetLayout=function(e,t){switch(t){case"linear":this._view.__layout=new LinearLayout({view:this._view});break;case"box":this._view.__layout=new BoxLayout({view:this._view})}},e._onInLayout=function(e,t){var n=this._superview&&this._superview.__layout;n&&(t?n.add(this._view):(n.remove(this._view),this._view.needsReflow()))},e._onLayoutChange=function(){var e=this.getSuperview();e&&e.__layout&&e.needsReflow(),this._view.needsReflow()}}})'),jsio.setCachedSrc("sdk/timestep/ui/layout/BoxLayout.js",'var sdk_timestep_ui_layout_BoxLayout=__class__,BoxLayout=exports=sdk_timestep_ui_layout_BoxLayout(function(){return this.init&&this.init.apply(this,arguments)},function(){var e=this.constructor;this.reflowsChildren=!1,this.init=function(t){this._view=t.view,e.initParentListener(t.view)},this.reflow=function(t){var n=this._view,r=n.getSuperview(),i=n.style;r&&(t||!i.inLayout||!r.style.layout||r.__layout&&!r.__layout.reflowsChildren)&&(e.reflowX(n,r.style.width),e.reflowY(n,r.style.height))},e.addParentListener=function(e){e.style.__removeSuperviewResize&&e.style.__removeSuperviewResize();var t=bind(e,"needsReflow"),n=e.getSuperview();n&&n.on("Resize",t),e.style.__removeSuperviewResize=bind(e.style,function(){this.__removeSuperviewResize=null,n&&n.removeListener("Resize",t)})},e.initParentListener=function(e){e.__root&&this.addParentListener(e),e.on("ViewAdded",bind(this,"addParentListener",e)),e.on("ViewRemoved",bind(e.style,function(){this.__removeSuperviewResize&&this.__removeSuperviewResize()}))},e.reflowX=function(e,t,n){if(t){var r=e.style,t=t-(n&&n.getHorizontal()||0),i=0;if("wrapContent"==r.layoutWidth)for(var e=e.getSubviews(),s=0,o;o=e[s];++s)o=o.style.x+o.style.width*o.style.scale,o>i&&(i=o);else i=e.getSuperview(),i=void 0!=r.right&&void 0!=r.left?t/r.scale-(r.left||0)-(r.right||0):r.layoutWidth&&"%"==r.layoutWidth.charAt(r.layoutWidth.length-1)?t/r.scale*(parseFloat(r.layoutWidth)/100):e._opts.width?e._opts.width:r.aspectRatio?(e._opts.height||r.height)*r.aspectRatio:"horizontal"==i.style.direction&&"number"==typeof r.flex?t*r.flex/i._flexSum:e._opts.autoSize?r.width:t/r.scale||r.width;r.centerX&&(r.x=(t-r.scale*i)/2+(n&&n.left||0)),void 0==r.left&&void 0!=r.right&&(r.x=t-r.scale*i-r.right-(n&&n.right||0)),void 0!=r.left&&(r.x=r.left+(n&&n.left||0)),r.width=i,r.centerAnchor&&(r.anchorX=i/2)}},e.reflowY=function(e,t,n){if(t){var r=e.style,t=t-(n&&n.getVertical()||0),i=0;if("wrapContent"==r.layoutHeight)for(var e=e.getSubviews(),s=0,o;o=e[s];++s)o=o.style.y+o.style.height*o.style.scale,o>i&&(i=o);else i=e.getSuperview(),i=void 0!=r.top&&void 0!=r.bottom?t/r.scale-(r.top||0)-(r.bottom||0):r.layoutHeight&&"%"==r.layoutHeight.charAt(r.layoutHeight.length-1)?t/r.scale*(parseFloat(r.layoutHeight)/100):e._opts.height?e._opts.height:r.aspectRatio?(e._opts.width||r.width)/r.aspectRatio:"vertical"==i.style.direction&&"number"==typeof r.flex?t*r.flex/i._flexSum:e._opts.autoSize?r.height:t/r.scale||r.height;r.centerY&&(r.y=(t-r.scale*i)/2+(n&&n.top||0)),void 0==r.top&&void 0!=r.bottom&&(r.y=t-r.scale*i-r.bottom-(n&&n.bottom||0)),void 0!=r.top&&(r.y=r.top+(n&&n.top||0)),r.height=i,r.centerAnchor&&(r.anchorY=i/2)}}});'),jsio.setCachedSrc("sdk/timestep/ui/layout/LinearLayout.js",'var DEBUG,sdk_timestep_ui_layout_LinearLayout;jsio("import ui.layout.Padding as Padding"),jsio("import .BoxLayout");DEBUG=!1,sdk_timestep_ui_layout_LinearLayout=__class__;exports=sdk_timestep_ui_layout_LinearLayout(function(){return this.init&&this.init.apply(this,arguments)},BoxLayout,function(e){function t(){return this.view.style._sortOrder+this.index}this.reflowsChildren=!0,this.init=function(e){var e,t,n;this._view=e.view,this._view.subscribe("SubviewAdded",this,"_onSubviewAdded"),this._view.subscribe("SubviewRemoved",this,"_onSubviewRemoved"),this.setDirection(e.isVertical?"vertical":"horizontal"),this._views=[];for(e=this._view.getSubviews(),t=0;n=e[t];++t)n.style.inLayout&&this._views.push(this._initLayoutView(n));this._forwardEvents(),this._debug=DEBUG},this._onSubviewRemoved=function(e){e.style.inLayout&&this.remove(e)},this._onSubviewAdded=function(e){e.style.inLayout&&this.add(e)},this.debug=function(){return this._debug=!0,this},this.setDirection=function(e){return this._direction=e,this._propPos=(e="vertical"==e)?"y":"x",this._propPosOpp=e?"x":"y",this._propDim=e?"height":"width",this._minPropDim=e?"minHeight":"minWidth",this._maxPropDim=e?"maxHeight":"maxWidth",this._propDimOpp=e?"width":"height",this._propSideA=e?"top":"left",this._propSideB=e?"bottom":"right",this._flexProp=e?"vflex":"hflex",this._view.needsReflow(),this},this.getDirection=function(){return this._direction},this._events=["ViewWillAppear","ViewDidAppear","ViewWillDisappear","ViewDidDisappear"],this._forwardEvents=function(){var e,t;for(e=0;t=this._events[e];++e)this._view.subscribe(t,this,"_forwardSignal",t)},this._events=["ViewWillAppear","ViewDidAppear","ViewWillDisappear","ViewDidDisappear"],this._forwardSignal=function(){var e,t;for(e=0;t=this._views[e];++e)t.view.publish.apply(t.view,arguments)},this._initLayoutView=function(e){return e.style.inLayout=!0,this._debug&&logger.log(this._view.uid,"adding view",e.uid,this._propDim,e.style[this._propDim]),this._view.connectEvent(e,"Resize",bind(this,"reflow")),{view:e,index:0,toString:t}},this.getSize=function(){return this._size},this.getViewIndex=function(e){var t,n;for(t=0;n=this._views[t];++t)if(n.view==e)return t;return-1},this.addSubviews=function(e){var t,n,r;this._debug&&logger.log(this._view.uid,"adding",e.length,"views");if(isArray(e)){for(t=0,n=e.length;t<n;++t){r=e[t];r&&this._views.push(this._initLayoutView(r))}this._view.needsReflow()}else this.insertBefore(e);return this},this.getSubviews=function(){return this._views.map(function(e){return e.view})},this.remove=function(e){var t=this.getViewIndex(e);-1!=t&&(this._views.splice(t,1),this._view.disconnectEvent(e,"Resize"),this._view.needsReflow())},this.add=this.insertBefore=function(e,t){var n,r,i;if(-1==this.getViewIndex(e)){n=this._initLayoutView(e),r=!1;if(t){i=this.getViewIndex(t);-1!=i&&(this._views.splice(i,0,n),r=!0)}r||this._views.push(n),this._view.needsReflow()}},this.insertAfter=function(e,t){var n,r,i;if(-1==this.getViewIndex(e)){n=this._initLayoutView(e),r=!1;if(t){i=this.getViewIndex(t);-1!=i&&(this._views.splice(i+1,0,n),r=!0)}r||this._views.unshift(n),this._view.needsReflow()}},this.reflow=function(){var t,n,r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b;e(this,"reflow",arguments);for(t=0,n=0;r=this._views[n];++n)r.view.style.visible&&(r.index=r.view.style.__sortKey,++t);if(t){this._views.sort();if(DEBUG)i=this._view.uid;o=this._view.style;o.direction!=this._direction&&this.setDirection(o.direction);u=this._view.getPosition().scale,a="vertical"==this._direction,f=this._propDim,l=this._minPropDim,c=this._propSideA,h=this._propSideB,p=o.padding,d=p&&(a?p.getVertical():p.getHorizontal())||0,v=o[f],m=this._views;this._debug&&logger.log("reflow() view",i+":",m.length,"subview(s)");g=0,y=0;p&&(a?p.getHorizontal():p.getVertical());for(n=0;r=m[n];++n){b=r.view.style;b.visible&&(r.margins=(b[c]||0)+(b[h]||0),a&&b.layoutHeight&&"%"==b.layoutHeight.charAt(b.layoutHeight.length-1)?g+=v*parseFloat(b.layoutHeight)/100:!a&&b.layoutWidth&&"%"==b.layoutWidth.charAt(b.layoutWidth.length-1)?g+=v*parseFloat(b.layoutWidth)/100:b.flex?(y+=b.flex,r.baseSize=b[l]||0,g+=r.baseSize):g+=(b[f]||0)*b.scale+r.margins,p)&&(b.x=p.left,b.y=p.top)}this._view._flexSum=y;for(n=0;r=m[n];++n)BoxLayout.reflowX(r.view,o.width,p),BoxLayout.reflowY(r.view,o.height,p);if((!y||void 0!=v)&&(n=v-d,!(0>n))){h=o.justifyContent,l=(y||"start"!=h?n:g)+d,g=n-g,!y&&"wrapContent"==o[a?"layoutHeight":"layoutWidth"]&&(this._debug&&logger.log("  view",i,"(sizing to fit)",f,"=",l+"px","("+d+"px padding)"),o[f]=l);for(n=d=o=0;r=m[n];++n)b=r.view.style,b.visible&&b.flex&&(d=r.baseSize+g*(b.flex/y)/b.scale+d,a=Math.round(d/u)*u,d-=a,r.dim=a-r.margins,r.dim>b[this._maxPropDim]&&(r.dim=b[this._maxPropDim]),o+=a);n=g-o,p=p&&p[c]||0,u=0;if(0<n)switch(h){case"end":p+=n;break;case"center":p+=n/2;break;case"space":u=n/(t-1)||0;break;case"space-outside":u=n/(t+1)||0,p+=u}t=this._propPos;for(n=0;r=m[n];++n)b=r.view.style,b.visible&&(b[t]=p+(b[c]||0),this._debug&&logger.log("  view",i,"layout subview",r.view.uid,t,"=",b[t]),b.flex&&(b[f]=r.dim,b.aspectRatio&&b.enforceAspectRatio(),this._debug&&logger.log("  view",i,"layout subview",r.view.uid,f,"=",b[f])),p+=u+(b[f]||0)*b.scale+r.margins);this._size!=l&&(this._size=l,this._view.publish("LayoutResize",l))}}}})'),jsio.setCachedSrc("sdk/jsio/gc/debugging/nativeShim.js",'var testContactList,_withContacts,_withPhoneNumber;jsio("import lib.PubSub"),jsio("import lib.Callback");testContactList=[];exports.backButton=new lib.PubSub,exports.dialogs={showDialog:function(){logger.log("Showing a dialog!")},showAppRater:function(){logger.log("Showing rate dialog!")}};_withContacts=new lib.Callback;_withContacts.fire(),exports.contacts=merge(new lib.PubSub,{getContactList:function(){return testContactList},withContacts:function(){_withContacts.forward(arguments)},sendAutomatedSMS:function(e,t,n){logger.log("Send Automated SMS:",e,t),n&&n()},sendSMS:function(e,t,n){logger.log("Send SMS:",e,t),n&&n()},getPicture:function(){return null},getPictures:function(){return null},getPictureBase64:function(){return null}});_withPhoneNumber=new lib.Callback;_withPhoneNumber.fire(null),_withPhoneNumber=new lib.Callback,_withPhoneNumber.fire(null),exports.profile={fullName:"",getPicture:function(){return null},getPictureBase64:function(){return null},withPhoneNumber:function(){_withPhoneNumber.forward(arguments)}},exports.sound={playSound:function(){logger.log("NATIVE shim: play a sound")},loadSound:function(){logger.log("NATIVE shim: load a sound")},pauseSound:function(){logger.log("NATIVE shim: pause a sound")},stopSound:function(){logger.log("NATIVE shim: stop a sound")},setVolume:function(){logger.log("NATIVE shim: set the volume of a sound")},loadBackgroundMusic:function(){logger.log("NATIVE shim: load background music")},playBackgroundMusic:function(){logger.log("NATIVE shim: play background music")},registerMusic:function(){logger.log("NATIVE shim: register background music")}},exports.events={registerHandler:function(e){logger.log("NATIVE shim: register an event handler for the "+e+" event")}},exports.plugins={sendEvent:function(e,t){logger.log("NATIVE shim: send a "+t+" event to the "+e+" plugin")}},exports.alerts=new lib.PubSub,merge(exports.alerts,{onNotificationLoad:function(){},showNotification:function(){return-1},showRecurringNotification:function(){return logger.log("Setting up a recurring notification!"),-1}}),exports.social=new lib.PubSub,GLOBAL.NATIVE||(GLOBAL.NATIVE=exports)'),jsio.setCachedSrc("sdk/jsio/std/JSON.js",'exports.createGlobal=function(){"undefined"==typeof JSON&&(JSON={}),"function"!=typeof JSON.stringify&&(JSON.stringify=exports.stringify),"function"!=typeof JSON.parse&&(JSON.parse=exports.parse)},function(){var p,o,e,l,q,k;function n(e){return o.lastIndex=0,o.test(e)?\'"\'+e.replace(o,function(e){var t=q[e];return"string"==typeof t?t:"\\\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+\'"\':\'"\'+e+\'"\'}function m(t,r){var o,u,a,f,c,i=e,s=r[t];s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof k&&(s=k.call(r,t,s));switch(typeof s){case"string":return n(s);case"number":return isFinite(s)?""+s:"null";case"boolean":return""+s;case"object":if(null===s)return"null";if(s.constructor===Date)return exports.stringifyDate(s);e+=l;o=[];if(s.constructor===Array){for(u=s.length,a=0;a<u;a+=1)o[a]=m(a,s)||"null";f=0===o.length?"[]":e?"[\\n"+e+o.join(",\\n"+e)+"\\n"+i+"]":"["+o.join(",")+"]";return e=i,f}if(k&&"object"==typeof k){u=k.length;for(a=0;a<u;a+=1){c=k[a];"string"==typeof c&&(f=m(c,s))&&o.push(n(c)+(e?": ":":")+f)}}else for(c in s)Object.hasOwnProperty.call(s,c)&&(f=m(c,s))&&o.push(n(c)+(e?": ":":")+f);return f=0===o.length?"{}":e?"{\\n"+e+o.join(",\\n"+e)+"\\n"+i+"}":"{"+o.join(",")+"}",e=i,f}}p=/[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,o=/[\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,q={"\\b":"\\\\b","	":"\\\\t","\\n":"\\\\n","\\f":"\\\\f","\\r":"\\\\r",\'"\':\'\\\\"\',"\\\\":"\\\\\\\\"};exports.stringify=function(t,n,r){var i;l=e="";if("number"==typeof r)for(i=0;i<r;i+=1)l+=" ";else"string"==typeof r&&(l=r);if(!(k=n)||"function"==typeof n||"object"==typeof n&&"number"==typeof n.length)return m("",{"":t});throw Error("JSON stringify: invalid replacer")},exports.stringifyDate=function(e){var t=e.getUTCFullYear(),n=e.getUTCMonth()+1,r=e.getUTCDate(),i=e.getUTCHours(),s=e.getUTCMinutes(),o=e.getUTCSeconds(),e=e.getUTCMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>s&&(s="0"+s),10>o&&(o="0"+o),10>e?e="00"+e:100>e&&(e="0"+e),\'"\'+t+"-"+n+"-"+r+"T"+i+":"+s+":"+o+"."+e+\'Z"\'},exports.parse=function(a,e){var c,b;p.lastIndex=0,p.test(a)&&(a=a.replace(p,function(e){return"\\\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\\],:{}\\s]*$/.test(a.replace(/\\\\(?:["\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\\\\n\\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,"]").replace(/(?:^|:|,)(?:\\s*\\[)+/g,""))){c=eval("("+a+")");if(e){b=function(t,n){var r,i,s=t[n];if(s&&"object"==typeof s)for(r in s)Object.hasOwnProperty.call(s,r)&&(i=b(s,r),void 0!==i?s[r]=i:delete s[r]);return e.call(t,n,s)};return b({"":c},"")}return c}throw new SyntaxError("JSON.parse")}}()'),jsio.setCachedSrc("sdk/jsio/preprocessors/import.js","var importExpr;function replace(e,t,n,r){return/\\/\\//.test(t)?e:t+'jsio(\"'+n+'\")'+r}importExpr=/^(\\s*)(import\\s+[^=+*\"'\\r\\n;\\/]+|from\\s+[^=+\"'\\r\\n;\\/]+)(;|\\/|$)/gm;exports=function(e,t){t.src=t.src.replace(importExpr,replace)}"),jsio.setCachedSrc("sdk/jsio/preprocessors/cls.js",'var classExport,class2Export;function replacer(e,t,n){return/\\/\\//.test(e)?e:n+"=__class__;"+(t||"")+n+"="+n+"(function "+n.replace(/[\\.]/g,"_")+"(){return this.init&&this.init.apply(this,arguments)},"}classExport=/^(.*?)exports\\s*=\\s*Class\\s*\\(/gm,class2Export=/^(.*?[ \\t]+)?([a-zA-Z0-9\\.$]+)\\s*=\\s*Class\\s*\\(/gm;exports=function(e,t){var n=t.path.replace(/(^[.\\/]+|\\.([^.]+?)$)/g,"").replace(/[\\:\\\\\\/\\-\\. ]/g,"_");t.src=t.src.replace(classExport,"var "+n+"=__class__;$1exports="+n+"(function "+n+"(){return this.init&&this.init.apply(this,arguments)},").replace(class2Export,replacer)}'),jsio.setCachedSrc("sdk/jsio/gc/browser/simulateDevice.js",'jsio("import lib.Enum"),exports.simulate=function(e){var t,n,r;if(e.userAgent){t=window.navigator,n=window.navigator={};for(r in t)n[r]=t[r];n.userAgent=e.userAgent}window.devicePixelRatio=e.devicePixelRatio||1,jsio("import device"),e.name.toLowerCase(),device.simulating=e,device.simulatingMobileNative="native-android"==e.target||"native-ios"==e.target,device.simulatingMobileBrowser="browser-desktop"==e.target||"browser-mobile"==e.target,device.simulatingMobileBrowser&&(device.isMobileBrowser=!0,device.setUseDOM(!0)),device.simulatingMobileNative&&device.setUseDOM(!1)}'),jsio.setCachedSrc("sdk/jsio/gc/debugging/connect.js",""),jsio.setCachedSrc("sdk/jsio/net.js",'jsio("import net.env"),jsio("import std.JSON as JSON"),JSON.createGlobal(),exports.listen=function(e,t,n){if(!t)throw logger.error("No transport provided for net.listen");return e=new("string"==typeof t?net.env.getListener(t):t)(e,n),e.listen(),e},exports.connect=function(e,t,n){return e=new("string"==typeof t?net.env.getConnector(t):t)(e,n),e.connect(),e},exports.quickServer=function(e){return jsio("import net.interfaces"),new net.interfaces.Server(e)}'),jsio.setCachedSrc("sdk/jsio/net/env/browser/csp.js",'var Transport;jsio("import net.interfaces"),jsio("from net.csp.client import CometSession"),jsio("import std.utf8 as utf8"),exports.Connector=__class__,exports.Connector=exports.Connector(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Connector,function(){this.connect=function(){var e;this._state=net.interfaces.STATE.CONNECTING;e=new CometSession;e.onconnect=bind(this,"cometSessionOnConnect",e),e.ondisconnect=bind(this,"onDisconnect"),logger.debug("opening the connection"),this._opts.encoding||(this._opts.encoding="plain"),e.connect(this._opts.url,this._opts)},this.cometSessionOnConnect=function(e){logger.debug("conn has opened"),this.onConnect(new Transport(e))}});Transport=__class__,Transport=Transport(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Transport,function(){this.init=function(e){this._conn=e},this.makeConnection=function(e){this._conn.onread=bind(e,"dataReceived")},this.write=function(e){this._conn.write(e)},this.loseConnection=function(){this._conn.close()}})'),jsio.setCachedSrc("sdk/jsio/net/interfaces.js",'var ctx;jsio("import net"),jsio("import lib.Enum as Enum");ctx=jsio.__env.global;exports.Protocol=__class__,exports.Protocol=exports.Protocol(function(){return this.init&&this.init.apply(this,arguments)},function(){this.connectionMade=function(){},this.dataReceived=function(){},this.connectionLost=function(){},this._connectionMade=function(){this._isConnected=!0,this.connectionMade.apply(this,arguments)},this._connectionLost=function(){this._isConnected=!0,this.connectionLost.apply(this,arguments)},this._isConnected=!1,this.isConnected=function(){return!!this._isConnected}}),exports.Client=__class__,exports.Client=exports.Client(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._protocol=e},this.connect=function(e,t){this._remote=new this._protocol,this._remote._client=this,net.connect(this._remote,e,t)}}),exports.Server=__class__,exports.Server=exports.Server(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._protocolClass=e},this.buildProtocol=function(){return new this._protocolClass},this.listen=function(e,t){return net.listen(this,e,t)}}),exports.Transport=__class__,exports.Transport=exports.Transport(function(){return this.init&&this.init.apply(this,arguments)},function(){this._encoding="plain",this.write=function(){throw Error("Not implemented")},this.getPeer=function(){throw Error("Not implemented")},this.setEncoding=function(e){this._encoding=e},this.getEncoding=function(){return this._encoding}}),exports.Listener=__class__,exports.Listener=exports.Listener(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){this._server=e,this._opts=t||{}},this.onConnect=function(e){var t=this._server.buildProtocol();t.transport=e,t.server=this._server,e.protocol=t,e.makeConnection(t),t._connectionMade()},this.listen=function(){throw Error("Abstract class")},this.stop=function(){}}),exports.STATE=Enum("INITIAL","DISCONNECTED","CONNECTING","CONNECTED"),exports.Connector=__class__,exports.Connector=exports.Connector(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){this._protocol=e,this._opts=t,this._state=exports.STATE.INITIAL},this.getState=function(){return this._state},this.onConnect=function(e){this._state=exports.STATE.CONNECTED,e.makeConnection(this._protocol),this._protocol.transport=e;try{this._protocol._connectionMade()}catch(t){throw logger.error(t)}},this.onDisconnect=function(e){var t=this._state==exports.STATE.CONNECTED;this._state=exports.STATE.DISCONNECTED;try{this._protocol._connectionLost(e,t)}catch(n){throw logger.error(n)}},this.getProtocol=function(){return this._protocol}})'),jsio.setCachedSrc("sdk/jsio/net/csp/client.js",'var READYSTATE;jsio("import std.base64 as base64"),jsio("import std.utf8 as utf8"),jsio("import std.uri as uri"),jsio("import net.errors as errors"),jsio("import .transports"),jsio("import lib.Enum as Enum");READYSTATE=exports.READYSTATE=Enum({INITIAL:0,CONNECTING:1,CONNECTED:2,DISCONNECTING:3,DISCONNECTED:4});exports.CometSession=__class__,exports.CometSession=exports.CometSession(function(){return this.init&&this.init.apply(this,arguments)},function(){var e=0;this.init=function(){this._id=++e,this._url=null,this.readyState=READYSTATE.INITIAL,this._options=this._transport=this._sessionKey=null,this._writeBuffer=this._utf8ReadBuffer="",this._handshakeLater=this._lastSentId=this._lastEventId=this._packetsInFlight=null,this._handshakeBackoff=50,this._timeoutTimer=this._handshakeTimeoutTimer=this._handshakeRetryTimer=null,this._cometBackoff=this._writeBackoff=50,this._nullReceived=this._nullSent=this._nullInFlight=this._nullInBuffer=!1},this.setEncoding=function(e){var t;if(e!=this._options.encoding){if("utf8"!=e&&"plain"!=e)throw new errors.InvalidEncodingError;if("plain"==e&&this._buffer){t=this._utf8ReadBuffer;this._utf8ReadBuffer="",this._doOnRead(t)}this._options.encoding=e}},this.connect=function(e,t){this._url=e.replace(/\\/$/,""),this._options=t||{},this._options.encoding=this._options.encoding||"utf8",this.setEncoding(this._options.encoding),this._options.connectTimeout=this._options.connectTimeout||1e4,this._transport=new(transports.chooseTransport(e,this._options)),this._transport.handshakeFailure=bind(this,this._handshakeFailure),this._transport.handshakeSuccess=bind(this,this._handshakeSuccess),this._transport.cometFailure=bind(this,this._cometFailure),this._transport.cometSuccess=bind(this,this._cometSuccess),this._transport.sendFailure=bind(this,this._writeFailure),this._transport.sendSuccess=bind(this,this._writeSuccess),this.readyState=READYSTATE.CONNECTING,this._transport.handshake(this._url,this._options),this._handshakeTimeoutTimer=setTimeout(bind(this,this._handshakeTimeout),this._options.connectTimeout)},this.write=function(e,t){if(this.readyState!=READYSTATE.CONNECTED)throw new errors.ReadyStateError;t=t||this._options.encoding||"utf8","utf8"==t&&(e=utf8.encode(e)),this._writeBuffer+=e,this._doWrite()},this._protocolError=function(e){logger.debug("_protocolError",e),this.readyState=READYSTATE.DISCONNECTED,this._doWrite(!0),this._doOnDisconnect(new errors.ServerProtocolError(e))},this._receivedNullPacket=function(){logger.debug("_receivedNullPacket"),this._receivedNull=!0,!this._nullInFlight&&!this._nullInBuffer&&!this._nullSent?(this.readyState=READYSTATE.DISCONNECTING,this._doWrite(!0)):this.readyState=READYSTATE.DISCONNECTED,this._doOnDisconnect(new errors.ConnectionClosedCleanly)},this._sentNullPacket=function(){logger.debug("_sentNullPacket"),(this._nullSent=!0)&&this._nullReceived&&(this.readyState=READYSTATE.DISCONNECTED)},this.close=function(e){logger.debug("close called",e,"readyState",this.readyState);switch(this.readyState){case READYSTATE.CONNECTING:clearTimeout(this._handshakeRetryTimer),clearTimeout(this._handshakeTimeoutTimer),this.readyState=READYSTATE.DISCONNECTED,this._doOnDisconnect(e);break;case READYSTATE.CONNECTED:this.readyState=READYSTATE.DISCONNECTING,this._doWrite(!0),clearTimeout(this._timeoutTimer);break;case READYSTATE.DISCONNECTED:throw new errors.ReadyStateError("Session is already disconnected")}this._opened=!1,this.readyState=READYSTATE.DISCONNECTED,this._doOnDisconnect(e),this._sessionKey=null},this._handshakeTimeout=function(){logger.debug("handshake timeout"),this._handshakeTimeoutTimer=null,clearTimeout(this._handshakeRetryTimer),this.readyState==READYSTATE.CONNECTING&&(this.readyState=READYSTATE.DISCONNECTED),this._doOnDisconnect(new errors.ServerUnreachable)},this._handshakeSuccess=function(e){logger.debug("handshake success",e),this.readyState!=READYSTATE.CONNECTING?logger.debug("received handshake success in invalid readyState:",this.readyState):(clearTimeout(this._handshakeTimeoutTimer),this._handshakeTimeoutTimer=null,this._sessionKey=e.response.session,this._opened=!0,this.readyState=READYSTATE.CONNECTED,this._doOnConnect(),this._doConnectComet())},this._handshakeFailure=function(e){logger.debug("handshake failure",e);if(this.readyState==READYSTATE.CONNECTING){if(404==e.status)return clearTimeout(this._handshakeTimeoutTimer),this._doOnDisconnect(new errors.ServerUnreachable);logger.debug("trying again in ",this._handshakeBackoff),this._handshakeRetryTimer=setTimeout(bind(this,function(){this._handshakeRetryTimer=null,this._transport.handshake(this._url,this._options)}),this._handshakeBackoff),this._handshakeBackoff*=2}},this._writeSuccess=function(){if(this.readyState==READYSTATE.CONNECTED||this.readyState==READYSTATE.DISCONNECTING){if(this._nullInFlight)return this._sentNullPacket();this._resetTimeoutTimer(),this.writeBackoff=50,this._packetsInFlight=null,(this._writeBuffer||this._nullInBuffer)&&this._doWrite(this._nullInBuffer)}},this._writeFailure=function(){this.readyState!=READYSTATE.CONNECTED&&this.READYSTATE!=READYSTATE.DISCONNECTING||(this._writeTimer=setTimeout(bind(this,function(){this._writeTimer=null,this.__doWrite(this._nullInBuffer)}),this._writeBackoff),this._writeBackoff*=2)},this._doWrite=function(e){this._packetsInFlight?e&&(this._nullInBuffer=!0):this.__doWrite(e)},this.__doWrite=function(e){logger.debug("_writeBuffer:",this._writeBuffer),!this._packetsInFlight&&this._writeBuffer&&(this._packetsInFlight=[this._transport.encodePacket(++this._lastSentId,this._writeBuffer,this._options)],this._writeBuffer=""),e&&!this._writeBuffer&&(this._packetsInFlight||(this._packetsInFlight=[]),this._packetsInFlight.push([++this._lastSentId,0,null]),this._nullInFlight=!0),this._packetsInFlight?(logger.debug("sending packets:",JSON.stringify(this._packetsInFlight)),this._transport.send(this._url,this._sessionKey,this._lastEventId||0,JSON.stringify(this._packetsInFlight),this._options)):logger.debug("no packets to send")},this._doConnectComet=function(){logger.debug("_doConnectComet"),this._transport.comet(this._url,this._sessionKey,this._lastEventId||0,this._options)},this._cometFailure=function(e){if(this.readyState==READYSTATE.CONNECTED){if(404==e.status&&"Session not found"==e.response)return this.close(new errors.ExpiredSession(e));this._cometTimer=setTimeout(bind(this,"_doConnectComet"),this._cometBackoff),this._cometBackoff*=2}},this._cometSuccess=function(e){var e,t,n,r,i,s;if(this.readyState==READYSTATE.CONNECTED||this.readyState==READYSTATE.DISCONNECTING){logger.debug("comet Success:",e),this._cometBackoff=50,this._resetTimeoutTimer();for(t=e.response,n=0;(r=t[n])||n<t.length;n++){logger.debug("process packet:",r);if(null===r)return this.close(new errors.ServerProtocolError(e));logger.debug("process packet",r);i=r[0],s=r[1],e=r[2];if(!("number"==typeof this._lastEventId&&i<=this._lastEventId)){if("number"==typeof this._lastEventId&&i!=this._lastEventId+1)return this._protocolError("Ack id too high");this._lastEventId=i;if(null==e)return this._receivedNullPacket();if(1==s)try{logger.debug("before base64 decode:",e),e=base64.decode(e),logger.debug("after base64 decode:",e)}catch(o){return this._protocolError("Unable to decode base64 payload")}"utf8"==this._options.encoding&&(this._utf8ReadBuffer+=e,logger.debug("before utf8 decode, _utf8ReadBuffer:",this._utf8ReadBuffer),r=utf8.decode(this._utf8ReadBuffer),e=r[0],this._utf8ReadBuffer=this._utf8ReadBuffer.slice(r[1]),logger.debug("after utf8 decode, _utf8ReadBuffer:",this._utf8ReadBuffer,"data:",e)),logger.debug("dispatching data:",e),this._doOnRead(e)}}this.readyState!=READYSTATE.CONNECTED&&this.readyState!=READYSTATE.DISCONNECTING||this._doConnectComet()}},this._doOnRead=function(e){"function"==typeof this.onread?(logger.debug("call onread function",e),this.onread(e)):logger.debug("skipping onread callback (function missing)")},this._doOnDisconnect=function(e){"function"==typeof this.ondisconnect?(logger.debug("call ondisconnect function",e),this.ondisconnect(e)):logger.debug("skipping ondisconnect callback (function missing)")},this._doOnConnect=function(){if("function"==typeof this.onconnect){logger.debug("call onconnect function");try{this.onconnect()}catch(e){logger.debug("onconnect caused errror",e),setTimeout(function(){throw e},0)}}else logger.debug("skipping onconnect callback (function missing)")},this._resetTimeoutTimer=function(){clearTimeout(this._timeoutTimer),this._timeoutTimer=setTimeout(bind(this,function(){logger.debug("connection timeout expired"),this.close(new errors.ConnectionTimeout)}),this._getTimeoutInterval())},this._getTimeoutInterval=function(){return 45e3}})'),jsio.setCachedSrc("sdk/jsio/std/base64.js",'var alphabet,trailingPad,padChar,decodeMap,i,len,alphabet_inverse,assertOrBadInput;for(alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",trailingPad="=",padChar=alphabet.charAt(alphabet.length-1),decodeMap={},i=0,len=alphabet.length;i<len;i++)decodeMap[alphabet.charAt(i)]=i;alphabet_inverse=RegExp("[^"+alphabet.replace("-","\\\\-")+"]");exports.Base64CodecError=__class__,exports.Base64CodecError=exports.Base64CodecError(function(){return this.init&&this.init.apply(this,arguments)},Error,function(){this.name="Base64CodecError",this.init=function(e){this.message=e}});assertOrBadInput=function(e,t){if(!e)throw new exports.Base64CodecError(t)};exports.encode=function(e,t){var e,n,r,i,s,o,u;assertOrBadInput(!/[^\\x00-\\xFF]/.test(e),"Input contains out-of-range characters.");for(n=e.length%3,r="\\0\\0\\0".slice(n||3),e=e+r,i=[],s=0,o=e.length;s<o;s+=3){u=(e.charCodeAt(s)<<16)+(e.charCodeAt(s+1)<<8)+e.charCodeAt(s+2);i.push(alphabet.charAt(u>>18&63),alphabet.charAt(u>>12&63),alphabet.charAt(u>>6&63),alphabet.charAt(u&63))}return i.length-=r.length,r=i.join(""),t||(1==n?r+="==":2==n&&(r+="=")),r},exports.decode=function(e){var e,t,n,r,i;logger.debug("decode",e);for(e=e.replace(/\\s/g,""),t=e.length;e.charAt(--t)===trailingPad;);e=e.slice(0,t+1),assertOrBadInput(!alphabet_inverse.test(e),"Input contains out-of-range characters.");for(n=4-(e.length%4||4),r=Array(n+1).join(padChar),e=e+r,r=[],i=t+n+1,t=0;t<i;t+=4)newchars=(decodeMap[e.charAt(t)]<<18)+(decodeMap[e.charAt(t+1)]<<12)+(decodeMap[e.charAt(t+2)]<<6)+decodeMap[e.charAt(t+3)],r.push(newchars>>16&255,newchars>>8&255,newchars&255);i=r.length-=n;if(65536<i){e=[];for(n=t=0;t<i;)e[n++]=String.fromCharCode.apply(String,r.slice(t,t+65536)),t+=65536;e=e.join("")}else e=String.fromCharCode.apply(String,r);return logger.debug("decoded",e),e}'),jsio.setCachedSrc("sdk/jsio/std/utf8.js",'var UnicodeCodecError;exports.UnicodeCodecError=function(e){this.message=e};UnicodeCodecError=exports.UnicodeCodecError;UnicodeCodecError.prototype.toString=function(){return"UnicodeCodecError"+(this.message?": "+this.message:"")},exports.encode=function(e){try{return unescape(encodeURIComponent(e))}catch(t){throw new UnicodeCodecError("invalid input string")}},exports.decode=function(e){var t,n,r;if(/[^\\x00-\\xFF]/.test(e))throw new UnicodeCodecError("invalid utf-8 bytes");t=n=e.length;if(128<=e.charCodeAt(t-1)){for(r=1;3>=r;r++)if(192<=e.charCodeAt(t-r)){n=t-r;break}try{decodeURIComponent(escape(e.slice(n))),n=t}catch(i){}}try{return[decodeURIComponent(escape(e.slice(0,n))),n]}catch(s){throw new UnicodeCodecError("invalid utf-8 bytes")}}'),jsio.setCachedSrc("sdk/jsio/net/errors.js",'var makeErrorClass=function(e){var t=function(e){"string"==typeof e?this.message=e:this.data=e};return t.prototype={type:e,toString:function(){return e+(this.message?": "+this.message:"")}},t};exports.ReadyStateError=makeErrorClass("ReadyStateError"),exports.InvalidEncodingError=makeErrorClass("InvalidEncodingError"),exports.ExpiredSession=makeErrorClass("ExpiredSession"),exports.ServerUnreachable=makeErrorClass("ServerUnreachable",100),exports.ConnectionTimeout=makeErrorClass("ConnectionTimeout",101),exports.ServerProtocolError=makeErrorClass("ServerProtocolError",200),exports.ServerClosedConnection=makeErrorClass("ServerClosedConnection",301),exports.ConnectionClosedCleanly=makeErrorClass("ConnectionClosedCleanly",300)'),jsio.setCachedSrc("sdk/jsio/net/csp/transports.js",'var xhrSupportsBinary,transports,PARAMS,baseTransport,EMPTY_FUNCTION,SLICE;function isLocalFile(e){return/^file:\\/\\//.test(e)}function isWindowDomain(e){return uri.isSameDomain(e,window.location.href)}function checkXHRBinarySupport(e){xhrSupportsBinary=!!e.sendAsBinary}function canUseXHR(e){var t;if(isLocalFile(e))return!1;t=new exports.XHR;if(!t)return!1;checkXHRBinarySupport(t);if(isWindowDomain(e)||window.XMLHttpRequest&&(t.__proto__==XMLHttpRequest.prototype||t instanceof window.XMLHttpRequest)&&void 0!==t.withCredentials||window.XDomainRequest&&t instanceof window.XDomainRequest)return!0}jsio("import std.uri as uri"),jsio("import std.base64 as base64"),jsio("from util.browserdetect import BrowserDetect"),function(){var e;exports.getDoc=function(){if(e)return e;try{if(e=window.ActiveXObject&&new ActiveXObject("htmlfile"))e.open().write("<html></html>"),e.close(),window.attachEvent("onunload",function(){try{e.body.innerHTML=""}catch(t){}e=null})}catch(t){}return e||(e=document),e},exports.XHR=function(){var e=window;return exports.getDoc(),new(exports.XHR=e.XMLHttpRequest?e.XMLHttpRequest:function(){return e.ActiveXObject&&new e.ActiveXObject("Msxml2.XMLHTTP")||null})},exports.createXHR=function(){return new exports.XHR}}();xhrSupportsBinary=void 0,transports=exports.transports={};exports.chooseTransport=function(e,t){switch(t.preferredTransport){case"jsonp":return transports.jsonp;default:return canUseXHR(e)?transports.xhr:transports.jsonp}};PARAMS={xhrstream:{is:"1",bs:"\\n"},xhrpoll:{du:"0"},xhrlongpoll:{},sselongpoll:{bp:"data: ",bs:"\\r\\n",se:"1"},ssestream:{bp:"data: ",bs:"\\r\\n",se:"1",is:"1"}};exports.Transport=__class__,exports.Transport=exports.Transport(function(){return this.init&&this.init.apply(this,arguments)},function(){this.handshake=function(){throw Error("handshake Not Implemented")},this.comet=function(){throw Error("comet Not Implemented")},this.send=function(){throw Error("send Not Implemented")},this.encodePacket=function(){throw Error("encodePacket Not Implemented")},this.abort=function(){throw Error("abort Not Implemented")}});baseTransport=__class__,baseTransport=baseTransport(function(){return this.init&&this.init.apply(this,arguments)},exports.Transport,function(){this.init=function(){this._aborted=!1,this._handshakeArgs={ct:"application/javascript"},this._handshakeData="{}"},this.handshake=function(e,t){logger.debug("handshake:",e,t),this._makeRequest("send",e+"/handshake",this._handshakeArgs,this._handshakeData,this.handshakeSuccess,this.handshakeFailure)},this.comet=function(e,t,n,r){logger.debug("comet:",e,t,n,r),this._makeRequest("comet",e+"/comet",{s:t,a:n},null,this.cometSuccess,this.cometFailure)},this.send=function(e,t,n,r){this._makeRequest("send",e+"/send",{s:t,a:n},r,this.sendSuccess,this.sendFailure)}});transports.xhr=__class__,transports.xhr=transports.xhr(function(){return this.init&&this.init.apply(this,arguments)},baseTransport,function(a){function b(a,b,c,i){var f;try{f={status:a.status}}catch(g){i({response:"Could not access status"})}try{if(4!=a.readyState)return;f.response=eval(a.responseText);if(200!=f.status){logger.debug("XHR failed with status ",a.status),i(f);return}logger.debug("XHR data received")}catch(d){logger.debug("Error in XHR::onReadyStateChange",d),i(f),this._abortXHR(b),logger.debug("done handling XHR error");return}c(f)}this.init=function(){a(this,"init"),this._xhr={send:new exports.XHR,comet:new exports.XHR}},this.abort=function(){var e;this._aborted=!0;for(e in this._xhr)this._xhr.hasOwnProperty(e)&&this._abortXHR(e)},this._abortXHR=function(e){var t;logger.debug("aborting XHR");t=this._xhr[e];try{"onload"in t?t.onload=t.onerror=t.ontimeout=null:"onreadystatechange"in t&&(t.onreadystatechange=null),t.abort&&t.abort()}catch(n){logger.debug("error aborting xhr",n)}this._xhr[e]=new exports.XHR},this.encodePacket=function(e,t){return xhrSupportsBinary?[e,0,t]:[e,1,base64.encode(t)]},this._makeRequest=function(e,t,n,r,i,s){var o;if(!this._aborted){o=this._xhr[e];o.open("POST",t+"?"+uri.buildQuery(n)),o.setRequestHeader("Content-Type","text/plain"),"onload"in o?(o.onload=bind(this,b,o,e,i,s),o.onerror=o.ontimeout=s):"onreadystatechange"in o&&(o.onreadystatechange=bind(this,b,o,e,i,s)),setTimeout(function(){o[xhrSupportsBinary?"sendAsBinary":"send"](r||null)},0)}}});EMPTY_FUNCTION=function(){},SLICE=Array.prototype.slice;transports.jsonp=__class__,transports.jsonp=transports.jsonp(function(){return this.init&&this.init.apply(this,arguments)},baseTransport,function(a){var c,i,f,g;function b(e,t){logger.debug("successful: ",e.url,t),e.completed=!0,logger.debug("calling the cb"),e.cb.call(GLOBAL,{status:200,response:t}),logger.debug("cb called")}function j(e,t){t&&"loaded"!=t.readyState||(t.onreadystatechange=function(){},h.call(this,e))}function h(e,t){var n;i(this._ifr[e.type]);if(!e.completed){n={status:t?200:404,response:t||"Unable to load resouce"};logger.debug("error making request:",e.url,n),logger.debug("calling eb"),e.eb.call(GLOBAL,n)}}c=function(){var a=exports.getDoc();if(!a.body)return!1;var b=a.createElement("iframe");with(b.style)display="block",width=height=border=margin=padding="0",overflow=visibility="hidden",position="absolute",top=left="-999px";return b.cbId=0,a.body.appendChild(b),b.src="about:blank",b},i=function(e){var t=e.contentWindow,n=t.document;logger.debug("removing script tags");for(var r=n.getElementsByTagName("script"),i=r.length-1;0<=i;--i)n.body.removeChild(r[i]);logger.debug("deleting iframe callbacks"),t["cb"+e.cbId]=t["eb"+e.cbId]=EMPTY_FUNCTION},f=function(e){setTimeout(function(){e&&e.parentNode&&e.parentNode.removeChild(e)},6e4)};this.init=function(){a(this,"init"),this._onReady=[],this._isReady=!1,this._createIframes()},this._createIframes=function(){var e,t,n;this._ifr={send:c(),comet:c()};if(!1===this._ifr.send)return setTimeout(bind(this,"_createIframes"),100);this._isReady=!0;e=this._onReady;this._onReady=[];for(t=0;n=e[t];++t)this._makeRequest.apply(this,n)},this.encodePacket=function(e,t){return[e,1,base64.encode(t)]},this.abort=function(){var e,t;this._aborted=!0;for(e in this._ifr)if(this._ifr.hasOwnProperty(e)){t=this._ifr[e];i(t),f(t)}},this._makeRequest=function(e,t,n,r,i,s){var o;if(!this._isReady)return this._onReady.push(arguments);o=++this._ifr[e].cbId,o={type:e,id:o,cb:i,eb:s,cbName:"cb"+o,ebName:"eb"+o,completed:!1};n.d=r,n.n=Math.random();switch(e){case"send":n.rs=";",n.rp=o.cbName;break;case"comet":n.bs=";",n.bp=o.cbName}o.url=t+"?"+uri.buildQuery(n),setTimeout(bind(this,"_request",o),0)},this._request=function(e){var t=this._ifr[e.type].contentWindow,n=t.document,r=n.body;if(!r)return setTimeout(bind(this,"_request",e),100);t[e.ebName]=bind(this,h,e),t[e.cbName]=bind(this,b,e);if(BrowserDetect.isWebKit)n.open(),n.write(\'<script src="\'+e.url+\'"></script><script>\'+ebName+"(false)</script>"),n.close();else if(t=n.createElement("script"),t.src=e.url,null===t.onreadystatechange&&(t.onreadystatechange=bind(this,j,e,t)),r.appendChild(t),!BrowserDetect.isIE)t=n.createElement("script"),t.innerHTML=e.ebName+"(false)",r.appendChild(t);g()};g=BrowserDetect.isFirefox||BrowserDetect.isOpera?function(){var e=document.body;e&&(g.iframe||(g.iframe=document.createElement("iframe")),e.insertBefore(g.iframe,e.firstChild),e.removeChild(g.iframe))}:function(){}})'),jsio.setCachedSrc("sdk/jsio/util/browserdetect.js",'exports.BrowserDetect=new function(){var n,r;function e(e){var t,r,i,s;for(t=0;r=e[t];t++){i=r.string,s=r.prop;r.identity=r.identity||r.subString,n=r.versionSearch||r.identity;if(i){if(-1!=i.indexOf(r.subString))return r.identity}else if(s)return r.identity}}function t(e){var t=e.indexOf(n);if(-1!=t)return parseFloat(e.substring(t+n.length+1))}r=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux"}];this.browser=e([{string:navigator.userAgent,subString:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox"},{string:navigator.vendor,subString:"Camino"},{string:navigator.userAgent,subString:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"IE",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}])||"unknown",this.version=t(navigator.userAgent)||t(navigator.appVersion)||"unknown",this.OS=e(r)||"unknown",this.isWebKit=/ AppleWebKit\\//.test(navigator.userAgent),this["is"+this.browser]=this.version}'),jsio.setCachedSrc("sdk/jsio/net/env/browser/postmessage.js",'jsio("import net.interfaces"),jsio("from util.browser import $"),jsio("import std.uuid"),exports.Listener=__class__,exports.Listener=exports.Listener(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Listener,function(e){var t;this.init=function(){e(this,"init",arguments),this._clients={},this._opts.clientUrl||(this._opts.clientUrl=jsio.__dir+"/networkConsole.html"),this._port=""+(this._opts.port||"")},this.listen=function(){$.onEvent(window,"message",bind(this,"_onMessage"))},this.getButton=function(e,t){var n=$({tagName:"button",text:t||"launch client",className:"clientButton"});return $.onEvent(n,"click",bind(this,"openWindow",e||this._opts.clientUrl)),n};t=1;this.openWindow=function(e){var i,n={menubar:"no",location:"no",toolbar:"no",width:550,height:350,scrollbars:"yes",status:"yes",resizable:"yes"},r=[];for(i in n)r.push(i+"="+n[i]);window.open(e,"W"+t++,r.join(",")).focus()},this._onMessage=function(e){var t,r;if("string"==typeof e.data&&this._port==e.data.substring(0,this._port.length)){t=e.data.substring(this._port.length);try{t=JSON.parse(t)}catch(n){logger.warn("invalid packet",e.data);return}switch(t.type){case"open":r=this._clients[t.uid]=new exports.Transport(e.source,this._port,t.uid);e.source.postMessage(this._port+JSON.stringify({type:"open",uid:t.uid}),"*"),this.onConnect(r);break;case"data":(r=this._clients[t.uid])&&r.onData(t.payload);break;case"close":(r=this._clients[t.uid])&&r.onClose(),e.source.postMessage(this._port+JSON.stringify({type:"close",uid:t.uid}),"*"),delete this._clients[t.uid]}}}}),exports.Connector=__class__,exports.Connector=exports.Connector(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Connector,function(){this.connect=function(){this._port=""+(this._opts.port||""),this._win=this._opts.win||window.opener||window.parent,$.onEvent(window,"message",bind(this,"_onMessage")),this._uid=std.uuid.uuid(),this._win.postMessage(this._port+JSON.stringify({type:"open",uid:this._uid}),"*")},this._onMessage=function(e){var t;if("string"==typeof e.data&&this._port==e.data.substring(0,this._port.length)){t=e.data.substring(this._port.length);try{t=JSON.parse(t)}catch(n){logger.warn("invalid packet",e.data);return}switch(t.type){case"open":this._transport=new exports.Transport(e.source,this._port,this._uid),this.onConnect(this._transport);break;case"close":if(t.uid!=this._uid)break;this._transport.onClose();break;case"data":if(t.uid!=this._uid)break;this._transport.onData(t.payload)}}}}),exports.Transport=__class__,exports.Transport=exports.Transport(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Transport,function(){this.init=function(e,t,n){if(!n)debugger;this._win=e,this._port=t,this._uid=n},this.makeConnection=function(e){this._protocol=e},this.write=function(e){"utf8"==this.encoding?this._win.postMessage(this._port+JSON.stringify({type:"data",uid:this._uid,payload:utf8.encode(e)}),"*"):this._win.postMessage(this._port+JSON.stringify({type:"data",uid:this._uid,payload:e}),"*")},this.loseConnection=function(){this._win.postMessage(this._port+JSON.stringify({type:"close",uid:this._uid,code:301}),"*")},this.onData=function(){this._protocol.dataReceived.apply(this._protocol,arguments)},this.onClose=function(){this._protocol._connectionLost.apply(this._protocol,arguments)}})'),jsio.setCachedSrc("sdk/jsio/std/uuid.js",'var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");exports.uuid=function(e,t){var s,o,n=CHARS,r=[],i=Math.random,t=t||n.length;if(e)for(s=0;s<e;s++)r[s]=n[0|i()*t];else{r[8]=r[13]=r[18]=r[23]="-",r[14]="4";for(s=0;36>s;s++)r[s]||(o=0|16*i(),r[s]=n[19==s?o&3|8:o&15])}return r.join("")}'),jsio.setCachedSrc("sdk/jsio/net/env.js",'function getObj(e,t,n){try{jsio("from .env."+(n||jsio.__env.name)+"."+t+" import "+e+" as result")}catch(r){throw logger.error("Invalid transport (",t,") or environment (",n,")")}return result}exports.getListener=bind(this,getObj,"Listener"),exports.getConnector=bind(this,getObj,"Connector")'),jsio.setCachedSrc("sdk/jsio/net/protocols/Cuppa.js",'var Error,RPCRequest,ReceivedRequest,ReceivedEvent,sdk_jsio_net_protocols_Cuppa;"use import";jsio("import lib.Callback"),jsio("import lib.PubSub"),jsio("from net.protocols.rtjp import RTJPProtocol");Error=__class__,Error=Error(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n,r,i){this.id=t,this.msg=n,this.details=r,this.requestId=i}}),RPCRequest=__class__,RPCRequest=RPCRequest(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t){this.protocol=e,this.id=t,this._onError=new lib.Callback,this._onSuccess=new lib.Callback},this.onError=function(){this._onError.forward(arguments)},this.onSuccess=function(){this._onSuccess.forward(arguments)},this.bindLater=function(e){var t=[].slice(arguments,1);return this._onError.forward([e,e.fail].concat(t)),this._onSuccess.forward([e,e.succed].concat(t)),e}}),ReceivedRequest=__class__,ReceivedRequest=ReceivedRequest(function(){return this.init&&this.init.apply(this,arguments)},function(){this.type="request",this.init=function(e,t,n,r,i){this.protocol=e,this.id=t,this.name=n,this.responded=!1,this.args=r,this.target=i},this.error=function(e,t){if(this.responded)throw Error("already responded");this._timer&&(clearTimeout(this._timer),this._timer=null),args={id:this.id,msg:e+""},void 0!==t&&(args.details=t),this.responded=!0,this.protocol.sendFrame("ERROR",args)},this.respond=function(e){if(this.responded)throw Error("already responded");this._timer&&(clearTimeout(this._timer),this._timer=null),this.responded=!0,this.protocol.sendFrame("RESPONSE",{id:this.id,args:void 0==e?{}:e})},this.timeoutAfter=function(e,t){this.responded||(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(bind(this,"_timeout",t),e))},this._timeout=function(e){this.responded||this.error(e)}}),ReceivedEvent=__class__,ReceivedEvent=ReceivedEvent(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e,t,n,r,i){this.id=t,this.name=n,this.args=r,this.target=i}}),sdk_jsio_net_protocols_Cuppa=__class__;exports=sdk_jsio_net_protocols_Cuppa(function(){return this.init&&this.init.apply(this,arguments)},RTJPProtocol,function(e){this.init=function(){e(this,"init",arguments),this._onConnect=new lib.Callback,this._onDisconnect=new lib.Callback,this._requests={},this.onEvent=new lib.PubSub,this.onRequest=new lib.PubSub},this.disconnect=function(){this.transport.loseConnection()},this.onConnect=function(){this._onConnect.forward(arguments)},this.onDisconnect=function(){this._onDisconnect.forward(arguments)},this.reset=function(){this._onConnect.reset(),this._onDisconnect.reset()},this.connectionMade=function(){this._isConnected=!0,this._onConnect.fire()},this.connectionLost=function(e){var t,n;for(t in this._requests){n=this._requests[t];delete this._requests[t],n._onError.fire(e)}this._isConnected=!1,this._onDisconnect.fire(e)},this.sendRequest=function(e,t,n,r){var i;4<arguments.length&&(r=bind.apply(GLOBAL,Array.prototype.slice.call(arguments,3)));i={name:e,args:t};return n&&(i.target=n),i=this.sendFrame("RPC",i),i=this._requests[i]=new RPCRequest(this,i),r&&(i.onSuccess(GLOBAL,r,!1),i.onError(GLOBAL,r)),i},this.sendEvent=function(e,t,n){this.sendFrame("EVENT",{name:e,args:t,target:n||null})},this.frameReceived=function(e,t,n){var e,t,r,i,s;logger.debug("RECEIVED",e,t,n);switch(t.toUpperCase()){case"RESPONSE":r=this._requests[n.id];if(!r)break;delete this._requests[n.id],r._onSuccess.fire(n.args);break;case"ERROR":t=n.msg||"unknown",i=n.id,r=this._requests[i],e=Error(this,e,t,n.details,i);if(!r)return this.errorReceived&&this.errorReceived(e);delete this._requests[i],r._onError.fire(e);break;case"RPC":case"EVENT":if(!n.name)return self.sendFrame("ERROR",{id:n.id||e,msg:\'missing "name"\'});r=n.args||{},i=n.target||null,s="RPC"==t.toUpperCase(),t=s?this.onRequest:this.onEvent,r=new(s?ReceivedRequest:ReceivedEvent)(this,n.id||e,n.name,r,i);t.publish(r.name,r)}}})'),jsio.setCachedSrc("sdk/jsio/net/protocols/rtjp.js",'jsio("import net.interfaces"),jsio("from net.protocols.delimited import DelimitedProtocol"),exports.RTJPProtocol=__class__,exports.RTJPProtocol=exports.RTJPProtocol(function(){return this.init&&this.init.apply(this,arguments)},DelimitedProtocol,function(e){this.init=function(){e(this,"init",["\\r\\n"]),this.frameId=0},this.connectionMade=function(){this._client&&this._client.connectionMade&&this._client.connectionMade(),logger.debug("connectionMade")},this.frameReceived=function(){},this.sendFrame=function(e,t){return t||(t={}),logger.debug("sendFrame",e,JSON.stringify(t)),this.sendLine(JSON.stringify([++this.frameId,e,t])),this.frameId},this.lineReceived=function(e){var t;try{t=JSON.parse(e);if(3!=t.length){logger.error("Invalid frame length");return}if("number"!=typeof t[0]){logger.error("Invalid frame id");return}if("string"!=typeof t[1]){logger.error("Invalid frame name");return}logger.debug("frameReceived:",t[0],t[1],JSON.stringify(t[2]))}catch(n){logger.error(n)}t&&this.frameReceived(t[0],t[1],t[2])},this.connectionLost=function(){logger.debug("conn lost")}})'),jsio.setCachedSrc("sdk/jsio/net/protocols/delimited.js",'jsio("import net.interfaces"),exports.DelimitedProtocol=__class__,exports.DelimitedProtocol=exports.DelimitedProtocol(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Protocol,function(){this.init=function(e){e||(e="\\r\\n"),this.delimiter=e,this.buffer=""},this.connectionMade=function(){logger.debug("connectionMade")},this.dataReceived=function(e){var t;if(e){logger.debug("dataReceived:("+e.length+")",e),logger.debug("last 2:",JSON.stringify(e.slice(e.length-2)));for(this.buffer+=e;-1!=(e=this.buffer.indexOf(this.delimiter));){t=this.buffer.slice(0,e);this.buffer=this.buffer.slice(e+this.delimiter.length),this.lineReceived(t)}}},this.lineReceived=function(e){logger.debug("Not implemented, lineReceived:",e)},this.sendLine=function(e){logger.debug("WRITE:",JSON.stringify(e+this.delimiter)),this.transport.write(e+this.delimiter)},this.connectionLost=function(){logger.debug("connectionLost")}})'),jsio.setCachedSrc("sdk/jsio/gc/debugging/_DEBUG.js",""),jsio.setCachedSrc("sdk/timestep/ui/ImageView.js",'jsio("import device"),exports=device.importUI("ImageView")'),jsio.setCachedSrc("sdk/timestep/ui/ImageScaleView.js",'var sdk_timestep_ui_ImageScaleView;jsio("import ui.View"),jsio("import ui.resource.Image as Image");sdk_timestep_ui_ImageScaleView=__class__;exports=sdk_timestep_ui_ImageScaleView(function(){return this.init&&this.init.apply(this,arguments)},ui.View,function(e){var n,r,i;function t(e){var t,n,r,s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E;if(this._img){t=Math.max,n=Math.min,r=this.style,s=r.width,o=r.height,a=this._renderCacheKey,f=this._renderCache||(this._renderCache={x:0,y:0,w:0,h:0});if(a.width!=s||a.height!=o){a.width=s,a.height=o;a=this._img.getBounds(),l=a.marginLeft,c=a.marginRight,h=a.marginTop,p=a.marginBottom,d=a.width,v=a.height,m=d+l+c,g=v+h+p,y=1,y=m/g,b=s/o,w="cover"==this._scaleMethod,y=(w?b>y:b<y)?s/m:o/g,b=d*y,E=v*y,m=m*y,g=g*y;f.x="left"==this._align?l*y:"right"==this._align?s-(d+c)*y:(s-b)/2,f.y="top"==this._verticalAlign?h*y:"bottom"==this._verticalAlign?o-(v+p)*y:(o-E)/2,f.w=b,f.h=E,f.sx=a.x,f.sy=a.y,f.sw=d,f.sh=v,w&&(g>o?"bottom"==this._verticalAlign?(f.y=t(0,o-p*y-E),f.h=n(E,o-p*y),f.sy+=t(0,v-f.h/y),f.sh=f.h/y):"top"==this._verticalAlign?(f.y=h*y,f.h=n(E,o-f.y),f.sh=f.h/y):(f.y=t(0,(o-E)/2),f.h=n(E,o),f.sh=f.h/y,f.sy=t(f.sy,f.sy+(v-f.sh)/2)):m>s&&("right"==this._align?(f.x=t(0,s-c*y-b),f.w=n(b,s-c*y),f.sx+=t(0,d-f.w/y),f.sw=f.w/y):"left"==this._align?(f.x=l*y,f.w=n(b,s-f.x),f.sw=f.w/y):(f.x=t(0,(s-b)/2),f.w=n(b,s),f.sw=f.w/y,f.sx=t(f.sx,f.sx+(d-f.sw)/2))))}this._img.render(e,f.sx,f.sy,f.sw,f.sh,f.x,f.y,f.w,f.h),this.debug&&(e.strokeStyle=i[0],e.strokeRect(0,0,r.width,r.height))}}n={image:null,autoSize:!1,scaleMethod:"stretch",renderCenter:!0};this.init=function(t){e(this,"init",[merge(t,n)])},this.getScaleMethod=function(){return this._scaleMethod},this.updateSlices=function(e){var t,n;this._renderCacheKey={},this._sliceCache=[];for(t=0;9>t;++t){n=[this._img.getSource(),0,0,0,0,0,0,0,0];n.render=!1,this._sliceCache.push(n)}e.destSlices=e.destSlices||e.sourceSlices,this._sourceSlices=e.sourceSlices,this._destSlices=e.destSlices,this._imgScale=e.imgScale||1;if(!e.sourceSlices||!e.sourceSlices.horizontal&&!e.sourceSlices.vertical)throw Error("slice views require sourceSlices.horizontal and/or sourceSlices.vertical");"2slice"===e.scaleMethod&&(e.sourceSlices.horizontal&&e.destSlices.horizontal&&(e.destSlices.horizontal.left?(e.sourceSlices.horizontal.center=e.sourceSlices.horizontal.right,e.sourceSlices.horizontal.right=0):e.destSlices.horizontal.right&&(e.sourceSlices.horizontal.center=e.sourceSlices.horizontal.left,e.sourceSlices.horizontal.left=0)),e.sourceSlices.vertical&&e.destSlices.vertical)&&(e.destSlices.vertical.top?(e.sourceSlices.vertical.middle=e.sourceSlices.vertical.bottom,e.sourceSlices.vertical.bottom=0):e.destSlices.vertical.bottom&&(e.sourceSlices.vertical.middle=e.sourceSlices.vertical.bottom,e.sourceSlices.vertical.bottom=0)),e.sourceSlices.horizontal?(n=e.sourceSlices.horizontal,t=[n.left||0,n.center||0,n.right||0],void 0==n.center&&this._img&&(n=this._img.getWidth(),t[1]=n?n-t[0]-t[2]:0),this._sourceSlicesHor=t,this._destSlicesHor=[(this._destSlices.horizontal.left||0)*this._imgScale,0,(this._destSlices.horizontal.right||0)*this._imgScale]):(this._sourceSlicesHor=[0,100,0],this._destSlicesHor=[0,100,0]),e.sourceSlices.vertical?(n=e.sourceSlices.vertical,t=[n.top||0,n.middle||0,n.bottom||0],void 0==n.middle&&this._img&&(e=this._img.getHeight(),t[1]=e?e-t[0]-t[2]:0),this._sourceSlicesVer=t,this._destSlicesVer=[(this._destSlices.vertical.top||0)*this._imgScale,0,(this._destSlices.vertical.bottom||0)*this._imgScale]):(this._sourceSlicesVer=[0,100,0],this._destSlicesVer=[0,100,0])},this.updateOpts=function(t){var n,i;t=merge(e(this,"updateOpts",arguments),this._opts);if(t.scaleMethod&&this._scaleMethod!=t.scaleMethod){n=t.scaleMethod;/slice$/.test(n)&&(n="slice"),this.render=r[n],this._renderCacheKey={},this._scaleMethod=t.scaleMethod,this._isSlice="slice"==this._scaleMethod.slice(1)}"debug"in t&&(this.debug=!!t.debug),this._isSlice&&this._img&&this.updateSlices(t),t.image&&this.setImage(t.image,t),t.verticalAlign&&(this._renderCacheKey={},this._verticalAlign=t.verticalAlign);if(t.align||t.horizontalAlign)this._align=t.align||t.horizontalAlign;"rows"in t&&(this.rows=t.rows),"columns"in t&&(this.columns=t.columns);n=this.rows,i=this.columns;if("tile"==this._scaleMethod&&(!n&&!i||n&&i))throw Error("tile views must define either rows or columns");return t},this._computeSlices=function(e,t,n){var t,o,u,a,f,l,c,h,p,d,v,m,g,y,b,r=this._img.getBounds(),i=r.width,s=r.height;if(!(0>=i||0>=s)){this._img.getSource();o=this._sourceSlicesHor,u=this._sourceSlicesVer,a=[],f=[];o&&(s=this.style.fixedAspectRatio?t/s:1,a[0]=this._destSlicesHor[0]*s,a[2]=this._destSlicesHor[2]*s,a[1]=e-a[0]-a[2],0>a[1]&&(a[0]=a[0]*e/(a[0]+a[2])|0,a[1]=0,a[2]=e-a[0])),u&&(s=this.style.fixedAspectRatio?e/i:1,f[0]=this._destSlicesVer[0]*s,f[2]=this._destSlicesVer[2]*s,f[1]=t-f[0]-f[2],0>f[1]&&(f[0]=f[0]*t/(f[0]+f[2])|0,f[1]=0,f[2]=t-f[0])),e=r.marginLeft,(t=o[0]+r.marginLeft)&&a[0]&&(e*=a[0]/t),t=r.marginRight,(i=o[2]+r.marginRight)&&a[2]&&(t*=a[2]/i),s=r.marginTop,(i=u[0]+r.marginTop)&&f[0]&&(s*=f[0]/i);i=r.marginBottom,l=u[2]+r.marginBottom;l&&f[2]&&(i*=f[2]/l),a[0]?a[0]-=e:a[1]-=e,f[0]?f[0]-=s:f[1]-=s,a[2]?a[2]-=t:a[1]-=t,f[2]?f[2]-=i:f[1]-=i;for(i=0,t=r.y,l=0;3>l;l++){y=0,i=f[l]+i;c=Math.round(n*i)/n,i-=c,p=u[l],m=c,c=r.x,d=e;for(g=0;3>g;g++){y=a[g]+y,v=Math.round(n*y)/n,y-=v,h=o[g];b=this._sliceCache[3*l+g];0<h&&0<p&&0<v&&0<m?(b[1]=c,b[2]=t,b[3]=h,b[4]=p,b[5]=d,b[6]=s,b[7]=v,b[8]=m,b.render=!0):b.render=!1,c+=h,d+=v}t+=p,s+=m}}},this.getImage=function(){return this._img},this.setImage=function(e,t){var t,n,r,i,s,o,u,a;this._renderCacheKey={};n=!1,t=merge(t,this._opts);if("string"==typeof e){if(o=GCResources.getMap()[e])i=o.w+o.marginLeft+o.marginRight,s=o.h+o.marginTop+o.marginBottom}else e instanceof Image&&e.isLoaded()&&(o=e.getBounds(),i=o.width+o.marginLeft+o.marginRight,s=o.height+o.marginTop+o.marginBottom);if(!o&&("string"==typeof e&&(e=new Image({url:e})),e)){e.isError()||e.doOnLoad(this,"setImage",e,t);return}t.autoSize&&"stretch"==this._scaleMethod&&(!t.width&&!t.layoutWidth||!t.height&&!t.layoutHeight)&&(n=!0,this.style.fixedAspectRatio?this.style.enforceAspectRatio(i,s):(this.style.width=i,this.style.height=s));if(this._opts.image=this._img="string"==typeof e?new Image({url:e}):e){if(this._isSlice){this.updateSlices({scaleMethod:this._opts.scaleMethod,sourceSlices:this._opts.sourceSlices,destSlices:this._opts.destSlices});u=this._sourceSlicesHor,a=this._sourceSlicesVer;u&&(r=u[0]+u[1]+u[2],r=i/r,u[0]=u[0]*r-o.marginLeft,u[1]*=r,u[2]=u[2]*r-o.marginRight),a&&(r=a[0]+a[1]+a[2],s/=r,a[0]=a[0]*s-o.marginTop,a[1]*=s,a[2]=a[2]*s-o.marginBottom),[0,2].forEach(function(e){u&&u[e]<0&&(u[1]=u[1]+u[e],u[e]=0),a&&a[e]<0&&(a[1]=a[1]+a[e],a[e]=0)})}t&&t.autoSize&&!n&&this._img.doOnLoad(this,"autoSize"),this._img.doOnLoad(this,"needsRepaint")}},this.doOnLoad=function(){return 1==arguments.length?this._img.doOnLoad(this,arguments[0]):this._img.doOnLoad.apply(this._img,arguments),this},this.autoSize=function(){this._img&&this._img.isLoaded()&&(this.style.width=this._img.getWidth()||this._opts.width,this.style.height=this._img.getHeight()||this._opts.height)},this.getOrigWidth=this.getOrigW=function(){return this._img.getOrigW()},this.getOrigHeight=this.getOrigH=function(){return this._img.getOrigH()};r={none:function(e){this._img&&this._img.render(e,0,0)},stretch:function(e){var t=this.style,n=t.width,t=t.height;this._img&&this._img.render(e,0,0,n,t)},contain:t,cover:t,tile:function(e){if(this._img){var t=this.style,n=t.width,t=t.height,r=this._img.getBounds(),s=r.width,o=r.height,a=r=0;if(this.rows)for(var f=t/this.rows,l=s*(f/o),s=0;s<this.rows;s++){for(;r<n;)this._img.render(e,r,a,l,f),this.debug&&(e.strokeStyle=i[s%3],e.strokeRect(r+.5,a+.5,l-1,f-1)),r+=l;a+=f,r=0}else if(this.columns){l=n/this.columns,f=o*(l/s);for(s=0;s<this.columns;s++){for(;a<t;)this._img.render(e,r,a,l,f),this.debug&&(e.strokeStyle=i[s%3],e.strokeRect(r+.5,a+.5,l-1,f-1)),a+=f;r+=l,a=0}}}},slice:function(e){if(this._img){var t=this.style,n=t.width,r=t.height,t=t.scale,i=this._renderCacheKey;if(i.width!=n||i.height!=r||i.absScale!=t)i.width=n,i.height=r,i.absScale=t,this._computeSlices(n,r,t);for(n=0;9>n;n++)this._drawSlice(e,this._sliceCache[n],n)}}};this._drawSlice=function(e,t,n){t.render&&(this._opts.renderCenter||4!=n)&&(e.drawImage.apply(e,t),this.debug&&(e.strokeStyle=i[n%3],e.strokeRect(t[5]+.5,t[6]+.5,t[7]-1,t[8]-1)))};i=["#FF0000","#00FF00","#0000FF"];this.getTag=function(){return"ImageScaleView"+this.uid+":"+(this._img&&this._img._map.url.substring(0,16))}})'),jsio.setCachedSrc("sdk/timestep/ui/TextView.js",'jsio("import device"),exports=device.importUI("TextView")'),jsio.setCachedSrc("sdk/timestep/ui/ScrollView.js",'var _reflowMgr,DEBUG,USE_CLIPPING,_debug,sdk_timestep_ui_ScrollView;jsio("import animate"),jsio("import device"),jsio("import event.input.dispatch as input"),jsio("import event.input.InputEvent as InputEvent"),jsio("import math.geom.Rect as Rect"),jsio("import math.geom.Point as Point"),jsio("import math.geom.Circle as Circle"),jsio("import math.geom.intersect as intersect"),jsio("import ui.View as View"),jsio("import ui.backend.ReflowManager as ReflowManager");_reflowMgr=ReflowManager.get(),DEBUG=!0,USE_CLIPPING=!1;if(DEBUG)_debug={bounds:[]};sdk_timestep_ui_ScrollView=__class__;exports=sdk_timestep_ui_ScrollView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){var r,i;function t(e){var t,n,r,i,s,o,u,a,f,l,c;if(e.r){t=e.width,n=e.height,r=Math.cos(e.r),i=Math.sin(e.r),s=e.x,o=e.y,u=t,a=0,f=s+u*r-a*i,l=o+u*i+a*r,a=a+n,n=s+u*r-a*i,c=o+u*i+a*r,u=u-t,t=s+u*r-a*i,r=o+u*i+a*r;e.x=Math.min(s,f,n,t),e.y=Math.min(o,l,c,r),e.width=Math.max(s,f,n,t)-e.x,e.height=Math.max(o,l,c,r)-e.y,e.r=0}}function n(e,n){var r=e.src.getPosition(n.src);r.x=(n.x-r.x)/r.scale,r.y=(n.y-r.y)/r.scale,r.width=n.width/r.scale,r.height=n.height/r.scale,r.r=-r.r,t(r),e.intersectRect(r)}this.tag="ScrollView",USE_CLIPPING&&(this.BackingCtor=__class__,this.BackingCtor=this.BackingCtor(function(){return this.init&&this.init.apply(this,arguments)},View.prototype.BackingCtor,function(){function e(r,i,s,o){var u,f,c,h,p;if(i.visible){i.__firstRender||_reflowMgr.add(i._view),i._needsSort&&(i._needsSort=!1,i._subviews.sort()),s.save(),s.translate(i.x+i.anchorX,i.y+i.anchorY),i.r&&s.rotate(i.r),1!=i.scale&&s.scale(i.scale,i.scale),1!=i.opacity&&(s.globalAlpha*=i.opacity),s.translate(-i.anchorX,-i.anchorY),i.clip&&s.clipRect(0,0,i.width,i.height);try{i.backgroundColor&&(s.fillStyle=i.backgroundColor,s.fillRect(0,0,i.width,i.height)),i._view.render&&i._view.render(s,o);for(u=o.viewport,f=i._subviews,c=0;h=f[c++];)if(h==r)e(r,h.__view,s,o),o.viewport=u;else{p=h.getPosition(u.src);t(p),n.isRectAndRect(p,u)&&e(r,h.__view,s,o),DEBUG&&_debug.bounds.push(p)}}catch(d){logger.error(i._view,d.message,d.stack)}finally{s.restore()}}}this.wrapRender=function(t,n){var r,i;e(this._view._contentView,this,t,n);if(DEBUG){r=n.viewport;t.save(),t.translate(this.x+this.anchorX,this.y+this.anchorY),this.r&&t.rotate(this.r),1!=this.scale&&t.scale(this.scale,this.scale),t.translate(-this.anchorX,-this.anchorY),t.fillStyle="rgba(255, 0, 0, 0.2)",t.fillRect(r.x,r.y,r.width,r.height),t.translate(-r.x,-r.y),t.fillStyle="rgba(255, 255, 255, 0.2)";for(r=0;i=_debug.bounds[r];++r)t.fillRect(i.x,i.y,i.width,i.height);_debug.bounds=[],t.restore()}}}));r={offsetX:0,offsetY:0,scrollY:!0,scrollX:!0,clip:!0,bounce:!0,bounceRadius:50,drag:!0,inertia:!0,dragRadius:10,snapPixels:void 0,useLayoutBounds:!1,layout:"box"};this.init=function(t){t=merge(t,r),t["dom:noCanvas"]=!0,this._acceleration=15,this._animState={lastDelta:0,offset:0},this._snapPixels=1,this._contentView=new View({x:t.offsetX,y:t.offsetY,infinite:!0,tag:"ContentView",layout:"box",layoutWidth:"100%",layoutHeight:"100%"}),this._bounceRadius=t.bounceRadius,this._scrollBounds={minX:-Number.MAX_VALUE,minY:-Number.MAX_VALUE,maxX:Number.MAX_VALUE,maxY:Number.MAX_VALUE},this._viewport=new Rect,this._viewport.src=this._contentView,e(this,"init",[t]),e(this,"addSubview",[this._contentView])},this.updateOpts=function(t){return e(this,"updateOpts",arguments),"useLayoutBounds"in t&&(t.useLayoutBounds?(this.subscribe("LayoutResize",this,"_updateLayoutBounds"),this._updateLayoutBounds()):this.unsubscribe("LayoutResize",this,"_updateLayoutBounds")),"scrollBounds"in t&&this.setScrollBounds(t.scrollBounds),"bounceRadius"in t&&(this._bounceRadius=t.bounceRadius),t},this._updateLayoutBounds=function(){var e;if(this.style.layout&&this._opts.useLayoutBounds){e=this._scrollBounds;e.minX=e.minY=e.maxX=e.maxY=0,this._contentView.getSubviews().forEach(function(t){e.minX=Math.min(e.minX,t.style.x),e.minY=Math.min(e.minY,t.style.y),e.maxX=Math.max(e.maxX,t.style.x+t.style.width),e.maxY=Math.max(e.maxY,t.style.y+t.style.height)})}},this.buildView=function(){this._snapPixels=this._opts.snapPixels||1/this.getPosition().scale},this.addSubview=function(e){this._contentView.addSubview(e),this._updateLayoutBounds()},this.removeSubview=function(e){this._contentView.removeSubview(e),this._updateLayoutBounds()},this.removeAllSubviews=function(){this._contentView.removeAllSubviews()},this.addFixedView=function(t){return e(this,"addSubview",[t])},this.removeFixedView=function(t){return e(this,"removeSubview",[t])};i=Math.PI/2;this.getStyleBounds=function(){var e=this._scrollBounds,t=-e.maxY,n=-e.minY<t?t:-e.minY,r=-e.maxX;e=-e.minX<r?r:-e.minX;return{minY:Math.min(t+this.style.height,n),maxY:n,minX:Math.min(r+this.style.width,e),maxX:e}},this.getOffset=function(){return new Point(this._contentView.style)},this.getOffsetX=function(){return this._contentView.style.x},this.getOffsetY=function(){return this._contentView.style.y},this.setOffset=function(e,t){var e,o,n=this._contentView.style,r={x:0,y:0},s=this.getStyleBounds();if(typeof e=="number"){if(!this._isBouncing)if(this._canBounce){if(e<s.minX){o=(s.minX-e)/this._bounceRadius,e=s.minX-Math.atan(o)*this._bounceRadius/i;this._bounceRadius-(s.minX-e)<1&&this._endBounce()}e>s.maxX&&(o=(e-s.maxX)/this._bounceRadius,e=s.maxX+Math.atan(o)*this._bounceRadius/i,this._bounceRadius-e<1&&this._endBounce())}else e<s.minX&&(e=s.minX),e>s.maxX&&(e=s.maxX);e!=n.x&&(r.x=e-n.x,n.x=(e/this._snapPixels|0)*this._snapPixels)}typeof t=="number"&&(this._isBouncing||(this._canBounce?(t<s.minY&&(o=(s.minY-t)/this._bounceRadius,t=s.minY-Math.atan(o)*this._bounceRadius/i,this._bounceRadius-(s.minY-t)<1&&this._endBounce()),t>s.maxY&&(o=(t-s.maxY)/this._bounceRadius,t=s.maxY+Math.atan(o)*this._bounceRadius/i,this._bounceRadius-t<1&&this._endBounce())):(t<s.minY&&(t=s.minY),t>s.maxY&&(t=s.maxY))),t!=n.y&&(r.y=t-n.y,n.y=(t/this._snapPixels|0)*this._snapPixels)),this.publish("Scrolled",r)},this.isScrolling=function(){return this.isDragging()||this._anim&&this._anim.hasFrames()},this.stopScrolling=function(){this._anim&&this._anim.now({},1)},this.onInputStart=function(e){this._opts.drag&&(this._opts.scrollX||this._opts.scrollY)&&(this.startDrag({radius:this._opts.dragRadius*this._snapPixels}),this._anim&&this._anim.hasFrames()&&this._anim.clear(),e.cancel())},this.onDragStart=function(e){input.clearOverState(e.id),this._contentView.getInput().blockEvents=!0,this._startBounce(),this._animState.offset=this.getOffset(),this._anim=animate(this._animState).clear()},this.scrollData=[],this.onDrag=function(e,t,n){e=this._animState,e.dt=n.t,e.lastDelta=n,this.scrollData.push(n),this._opts.scrollY||(n.y=0),this._opts.scrollX||(n.x=0),this.setOffset(e.offset.x=e.offset.x+n.x,e.offset.y=e.offset.y+n.y),t.cancel()},this.onDragStop=function(){var e,t,n,r,i,s;this._contentView.getInput().blockEvents=!1;if(this._opts.inertia){e=new Point(0,0);for(t in this.scrollData)e.x=e.x*.5+this.scrollData[t].x*.5,e.y=e.y*.5+this.scrollData[t].y*.5;this.scrollData=[];n=(new Point(e)).scale(.7),r=this._animState.offset;t=n.getMagnitude(),e=-t/-0.45,t=.5*-(t*t)/-0.45;i=n.normalize(),n.x=i.x*t,n.y=i.y*t,r=this._animState.offset,t=n.getMagnitude(),i=this.getStyleBounds();s=(new Point(r)).add(n);s.y<i.minY-this._bounceRadius&&(t=r.y<i.minY?0:n.getMagnitude()),s.y>i.maxY+this._bounceRadius&&(t=r.y>i.maxY?0:n.getMagnitude()),s.x<i.minX-this._bounceRadius&&(t=r.x<i.minX?0:n.getMagnitude()),s.x>i.maxX+this._bounceRadius&&(t=r.x>i.maxX?0:n.getMagnitude()),t?this._anim.now(bind(this,function(e){this.setOffset(r.x+n.x*e,r.y+n.y*e)}),e*8,animate.easeOut).then(bind(this,function(){this._endBounce(r)})):this._endBounce(r)}},this._startBounce=function(){this._isBouncing=!1,this._opts.inertia&&this._opts.bounce&&(this._canBounce=!0)},this._endBounce=function(){var e=this.getOffset(),t=this.getStyleBounds(),n=0,r=0,i=e.y,s=e.x;e.y<t.minY?i=t.minY:e.y>t.maxY&&(i=t.maxY),e.x<t.minX?s=t.minX:e.x>t.maxX&&(s=t.maxX),r=i-e.y,n=s-e.x;if(r!==0||n!==0)this._isBouncing=!0,this._anim.now(bind(this,function(t){this.setOffset(e.x+n*t,e.y+r*t)}),500,animate.easeInOut).then(bind(this,function(){this._isBouncing=this._canBounce=!1,this.scrollTo(void 0,void 0,0)}))},this.setScrollBounds=function(e){e&&("minX"in e&&(this._scrollBounds.minX=e.minX||0),"minY"in e&&(this._scrollBounds.minY=e.minY||0),"maxX"in e&&(this._scrollBounds.maxX=e.maxX||0),"maxY"in e&&(this._scrollBounds.maxY=e.maxY||0),this._canBounce||this.scrollTo(void 0,void 0,0))},this.getScrollBounds=function(){return this._scrollBounds},this.addOffset=function(e,t){this.setOffset(e!=void 0&&e!=null&&this._contentView.style.x+e,t!=void 0&&t!=null&&this._contentView.style.y+t)},this.getContentView=function(){return this._contentView},this.getFullWidth=function(){return this._contentView.style.width},this.getFullHeight=function(){return this._contentView.style.height},this.render=function(e,t){var r=this.style,i=this._contentView.style,s=this._viewport,o=s.x,u=s.y,a=s.width,f=s.height;return s.x=-i.x,s.y=-i.y,s.width=r.width*r.scale|0,s.height=r.height*r.scale|0,t.viewport&&n(s,t.viewport),t.viewport=s,s.x!=o||s.y!=u||s.width!=a||s.height!=f},this.onInputScroll=function(e){this._opts.scrollY&&e.scrollAxis==input.VERTICAL_AXIS?this.addOffset(void 0,e.scrollDelta*40):this._opts.scrollX&&this.addOffset(e.scrollDelta*40),e.cancel()},this.scrollTo=function(e,t,n,r){var o,i=this.getStyleBounds(),s=this._contentView.style,e=e==null?s.x:-e,t=t==null?s.y:-t;e=e<i.minX?i.minX:e,e=e>i.maxX?i.maxX:e,t=t<i.minY?i.minY:t,t=t>i.maxY?i.maxY:t;if(typeof n=="number")i=n;else{if(n.duration)i=n.duration;else if(n.speed)i=e-s.x,o=t-s.y,i=Math.sqrt(i*i+o*o)/n.speed*1e3;else i=500;n.maxDuration&&(i=Math.min(i,n.maxDuration))}i?(e=animate(this._contentView).now({x:e,y:t},i,animate.easeOut),r&&e.then(r)):(s.x=e,s.y=t,r&&r())}})'),jsio.setCachedSrc("sdk/jsio/math/geom/Circle.js",'var sdk_jsio_math_geom_Circle;jsio("import .Point");sdk_jsio_math_geom_Circle=__class__;exports=sdk_jsio_math_geom_Circle(function(){return this.init&&this.init.apply(this,arguments)},Point,function(e){this.init=function(e,t,n){switch(arguments.length){case 0:this.radius=this.y=this.x=0;break;case 1:case 2:this.x=e.x||0,this.y=e.y||0,this.radius=e.radius||0;break;case 3:this.x=e,this.y=t,this.radius=n}},this.scale=function(t){return e(this,"scale",arguments),this.radius*=t,this}})'),jsio.setCachedSrc("sdk/jsio/gc/debugging/logProxy.js",""),jsio.setCachedSrc("sdk/jsio/gc/debugging/remoteEval.js",""),jsio.setCachedSrc("sdk/jsio/gc/debugging/TimestepInspector.js",""),jsio.setCachedSrc("sdk/jsio/gc/debugging/OverlayRenderer.js",""),jsio.setCachedSrc("sdk/jsio/gc/API.js",'var sdk_jsio_gc_API;jsio("import lib.PubSub"),jsio("import lib.Callback"),jsio("import std.uri as URI"),jsio("import ui.Engine"),jsio("import ui.View"),jsio("import ui.StackView"),jsio("import device"),device.simulatingMobileNative&&jsio("import .debugging.nativeShim"),GLOBAL.CONFIG||(GLOBAL.CONFIG={}),GLOBAL.DEBUG||(GLOBAL.DEBUG=!1),GLOBAL.CONFIG.isMuted&&(jsio("import AudioManager"),GLOBAL.ACCESSIBILITY.mute(!0));sdk_jsio_gc_API=__class__;exports=sdk_jsio_gc_API(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){var t,e=navigator.userAgent;(this.isNative=/TeaLeaf/.test(e))?(this.isIOS=/iPhone OS/.test(e),this.isAndroid=/Android/.test(e)):/(iPod|iPhone|iPad)/i.test(e)?(this.isIOS=this.isMobileBrowser=!0,this.isUIWebView=!/Safari/.test(e)):/Android/.test(e)?this.isAndroid=this.isMobileBrowser=!0:(this.isDesktop=!0,this.isFacebook=GLOBAL.CONFIG.isFacebookApp),this.init=function(){GLOBAL.ADDON_SOCIAL&&ADDON_SOCIAL&&(jsio("import GCSocial.GCSocial",{suppressErrors:!0}),this.social=GCSocial.GCSocial,GLOBAL.gcsocial=this.social,this.social.init({appID:GLOBAL.CONFIG.appID,shortName:GLOBAL.CONFIG.shortName,inviteURLTemplate:GLOBAL.CONFIG.inviteURLTemplate,endpoint:GLOBAL.CONFIG.servicesURL}),this.track=gcsocial.tracker),window.addEventListener("pageshow",bind(this,"_onShow"),!1),window.addEventListener("pagehide",bind(this,"_onHide"),!1),this.isOnline=navigator.onLine,window.addEventListener("online",bind(this,function(){this.isOnline||(this.isOnline=!0,this.publish("OnlineStateChanged",!0))}),!1),window.addEventListener("offline",bind(this,function(){this.isOnline&&(this.isOnline=!1,this.publish("OnlineStateChanged",!1))}),!1),CONFIG.version&&logger.log("Version",CONFIG.version)},GLOBAL.GC=new this.constructor,jsio("import .PluginManager"),this.plugins=new PluginManager,GC.Application=ui.StackView,jsio("import .UI"),GC.ui=new UI;try{GLOBAL.CACHE&&(t=JSON.parse(GLOBAL.CACHE["spritesheets/map.json"]))}catch(n){logger.warn("spritesheet map failed to parse",n)}jsio("import ui.resource.loader"),GC.resources=ui.resource.loader,GC.resources.setMap(t),GC.env=="browser"&&setTimeout(bind(this,"_onShow"),0),this._onHide=function(){this.app&&this.app.onPause&&this.app.onPause(),this.publish("Hide"),this.publish("AfterHide"),this.tracker&&this.tracker.endSession()},this._onShow=function(){this.app&&this.app.onResume&&this.app.onResume(),this.publish("Show"),this.publish("AfterShow")},this.buildApp=function(){return jsio("import src.Application as Application"),Application.prototype.__root=!0,this.app=new Application,this.buildEngine(merge({view:this.app},this.app._settings)),this.app},this.buildEngine=function(e){var t,n,r,i,s;e||(e={}),e.entry||(e.entry="launchUI");t=e.view;if(!t)throw"a timestep.Engine must be created with a root view";if(!(t instanceof ui.View))throw"src/Application.js must export a Class that inherits from ui.View";t.subscribe("onLoadError",this,"_onAppLoadError");typeof t[e.entry]=="function"&&(n=bind(t,e.entry)),t.view=t,t.engine=new ui.Engine(e),t.engine.show(),t.engine.startLoop(),t.initUI&&t.initUI(),e=(t._settings||{}).preload,t=CONFIG.splash&&CONFIG.splash.autoHide!==!1;if(e&&e.length){for(r=new lib.Callback,i=0;s=e[i];++i)GC.resources.preload(s,r.chain());t&&r.run(GC,"hidePreloader",null),n&&r.run(n)}else t&&GC.hidePreloader(),n&&n()},this._onAppLoadError=function(e){var t;logger.error("encountered error when creating src Application: ",JSON.stringify(e));t=CONFIG.splash;t&&t.onAppLoadError&&t.onAppLoadError(e)},this.hidePreloader=function(e){var t=CONFIG.splash;t&&t.hide&&!t.hidden?(t.hide(e),t.hidden=!0):e&&e()}})'),jsio.setCachedSrc("sdk/jsio/gc/PluginManager.js","var sdk_jsio_gc_PluginManager=__class__;exports=sdk_jsio_gc_PluginManager(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._plugins={}},this.register=function(e,t){this._plugins[e]=t},this.getPlugin=function(e){return this._plugins[e]}})"),jsio.setCachedSrc("sdk/jsio/gc/UI.js",'var config,uiExports,sdk_jsio_gc_UI,cache,key,getter;function AsyncImageLoader(e,t){var n=new ui.resource.Image({url:e});n.doOnLoad(function(){t(n)})}function getCanvasCtor(){return jsio("import device"),device.get("Canvas")}jsio("from util.browser import $"),jsio("import std.uri"),jsio("import std.js as JS"),jsio("import lib.Iterator"),jsio("import lib.Callback"),jsio("import device"),jsio("import ui.widget.Spinner as Spinner");config=window.CONFIG;logger.log("ITS ",GLOBAL.HTMLCanvasElement);uiExports={GCView:function(){return jsio("import ui.View"),ui.View},GCImage:function(){return jsio("import ui.resource.Image"),ui.resource.Image},GCImageView:function(){return jsio("import ui.ImageView"),ui.ImageView},GCCanvas:getCanvasCtor,GCSprite:function(){return jsio("import ui.SpriteView"),ui.SpriteView},GCResources:function(){return jsio("import ui.resource.loader"),ui.resource.loader}},sdk_jsio_gc_UI=__class__;exports=sdk_jsio_gc_UI(function(){return this.init&&this.init.apply(this,arguments)},function(){var e;this.cssFile=function(e,t){var n=CACHE[e];n&&($({tag:"style",text:n,parent:document.getElementsByTagName("head")[0]}),setTimeout(t,0))},this._spinnerCounter=0,jsio("import device");this._scale=e=navigator.displayMetrics?navigator.displayMetrics.densityDpi/160:!CONFIG.scaleDPR&&device.isMobileBrowser?1:window.devicePixelRatio||1,this.setTargetDensity=function(t){switch(t){case"high":this._scale=.5*e;break;case"medium":this._scale=.75*e;break;default:this._scale=e}logger.log("scale:",this._scale)},this.getScale=function(){return this._scale},this.getIntValue=function(e){return Math.round(e*this._scale)/this._scale},this.showSpinner=function(){var e,t;if(this._spinnerCounter)++this._spinnerCounter;else{e=GC.app.view;if(e)if(++this._spinnerCounter,this._spinner)e.addSubview(this._spinner);else{t=50*device.screen.devicePixelRatio;this._spinner=new Spinner({width:t,height:t,x:e.style.width/2-t/2,y:e.style.height/2-t/2,parent:e})}}},this.hideSpinner=function(){--this._spinnerCounter,0>=this._spinnerCounter&&(this._spinnerCounter=0,this._spinner&&this._spinner.removeFromSuperview())}});cache={};for(key in uiExports){getter=bind(GLOBAL,function(e){return cache[e]||(cache[e]=uiExports[e]())},key);GLOBAL.__defineGetter__?GLOBAL.__defineGetter__(key,getter):Object.defineProperty&&Object.defineProperty(GLOBAL,key,{get:getter})}'),jsio.setCachedSrc("sdk/jsio/lib/Iterator.js",'var sdk_jsio_lib_Iterator;"use import";jsio("import std.js as JS");sdk_jsio_lib_Iterator=__class__;exports=sdk_jsio_lib_Iterator(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){var t,n;this._src=e,this._calls=this._i=0;if(JS.isArray(e))this._isArray=!0;else if(Object.keys)this._keys=Object.keys(e);else{t=this._keys=[];for(n in e)e.hasOwnProperty(n)&&t.push(n)}},this.nextKey=function(){return this._keys[this._i++]},this.next=function(){var e;if(this._isArray)return this._src[this._i++]||exports.END_OF_LOOP;e=this._keys[this._i++];return e?this._src[e]:exports.END_OF_LOOP},this.loop=function(e){var t;1<arguments.length&&(e=bind.apply(this,arguments));if(this._isArray)for(;t=this.next();)e(t);else for(;t=this.nextKey();)e(this._src[t],t)},this.asyncLoop=function(e){1<arguments.length&&(e=bind.apply(this,arguments)),this._next=bind(this,"_onReturn",e),this._calls++,this._asyncLoop(e)},this._asyncLoop=function(e){for(this._inLoop=!0;this._calls;)--this._calls,e(this.next(),this._next);this._inLoop=!1},this._onReturn=function(e){this._calls++,this._inLoop||this._asyncLoop(e)}}),exports.END_OF_LOOP=Error("jsio.Iterator.END_OF_LOOP")'),jsio.setCachedSrc("sdk/timestep/ui/widget/Spinner.js",'var sdk_timestep_ui_widget_Spinner;jsio("import ui.View as View");sdk_timestep_ui_widget_Spinner=__class__;exports=sdk_timestep_ui_widget_Spinner(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){var t={cycles:.5,radius:10,spokes:20,thickness:2,trail:10,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.5)",layout:"box"};this.tag="Spinner",this._t=0,this.init=function(n){this._opts=merge(n,t),this._step=2*Math.PI/this._opts.spokes,e(this,"init",[this._opts])},this.tick=function(e){var e,t;this._t+=e;e=this._t/1e3%(1/this._opts.cycles)*Math.PI,t=this._r;this._r=e-e%this._step,t!=e&&this.needsRepaint()},this.render=function(e){var t,n,r,i,s,o,u,a;e.fillStyle=this._opts.backgroundColor;t=this.style.width,n=this.style.height,r=this._opts.radius,i=this._opts.trail,s=this._opts.thickness;for(u=0;u<r;++u)o=u+1,o=Math.round(r-Math.sqrt(2*o*r-o*o)),e.fillRect(o,u,t-2*o,1);u=n-r,e.fillRect(0,r,t,u-r);for(a=0;a<r;++a)o=r-a,o=Math.round(r-Math.sqrt(2*o*r-o*o)),e.fillRect(o,u+a,t-2*o,1);e.fillStyle=this._opts.color,e.translate(t/2,n/2),t/=2,e.rotate(this._r);for(a=0;a<this._opts.spokes;++a)e.rotate(this._step),e.globalAlpha=Math.max(.1,(a-i)/i),e.fillRect(10,-s/2,t-15,s)}})'),jsio.setCachedSrc("sdk/timestep/ui/SpriteView.js",'var sdk_timestep_ui_SpriteView,SpriteView,Group;jsio("import device"),jsio("import ui.ImageView as ImageView"),jsio("import ui.resource.Image as Image"),jsio("import ui.resource.loader");sdk_timestep_ui_SpriteView=__class__,SpriteView=exports=sdk_timestep_ui_SpriteView(function(){return this.init&&this.init.apply(this,arguments)},"SpriteView",ImageView,function(e,t){this.defaults={url:null,groupID:"default",frameRate:15,delay:0,emitFrameEvents:!1,autoStart:!1,loop:!0};var n={};this.tick=null,this.init=function(e){this._opts=e=merge(e,this.defaults),e.visible=!1,!1,t(this,"init",[e]),this.onScreen=!0,this.resetAllAnimations(e)},this.resetAllAnimations=function(e){this.stopAnimation(),this._opts=e=merge(e,this.defaults);var t=SpriteView.allAnimations[e.url];this.groupID=e.groupID,this.frameRate=e.frameRate,n[this.groupID]||(n[this.groupID]=new Group),this._animations={};if(e.sheetData){var t=e.sheetData.width||e.width,r=e.sheetData.height||e.height,i;for(i in e.sheetData.anims)this._opts.defaultAnimation||(this._opts.defaultAnimation=i),this.loadFromSheet(i,e.sheetData.url,t,r,e.sheetData.offsetX||t,e.sheetData.offsetY||r,e.sheetData.startX||0,e.sheetData.startY||0,e.sheetData.anims[i])}else for(i in t)this._opts.defaultAnimation||(this._opts.defaultAnimation=i),this.addAnimation(i,t[i]);e.autoSize&&this._opts.defaultAnimation&&(i=this._animations[this._opts.defaultAnimation].frames,i[0]&&(this.style.width=i[0].getWidth(),this.style.height=i[0].getHeight())),e.autoStart&&this.startAnimation(this._opts.defaultAnimation,e)},this.loadFromSheet=function(e,t,n,r,i,s,o,u,a){for(var f=[],l=0;l<a.length;l++)f.push(new Image({url:t,sourceW:n,sourceH:r,sourceX:o+a[l][0]*i,sourceY:u+a[l][1]*s}));this._animations[e]={frames:f}},this.addAnimation=function(e,t){isArray(t)||(t=SpriteView.allAnimations[t][e]);for(var n=[],r=0,i;i=t[r];r++)device.useDOM?n.push(i.url):n.push(this.getImageFromCache(i.url));this._animations[e]={frames:n}},this.getFrame=function(e,t){return this._animations[e].frames[t]},this.getFrameCount=function(e){return this._animations[e].frames.length},this.getGroup=function(e){return n[e||this.groupID]},this.startAnimation=function(e,t){t=t||{},!0===t.randomFrame&&null==t.frame&&(t.frame=Math.random()*this._animations[e].frames.length|0),!0===t.loop&&(t.iterations=Infinity),this._iterationsLeft=t.iterations||1,this._callback=t.callback||null,this._currentAnimationName=e,this._currentFrame=t.frame||0,this._delay=this._dt=0;if(!this._animations[e])throw Error("Animation "+e+" does not exist: "+this._opts.url+".");this.isPlaying||(this.tick=this._tickSprite,n[this.groupID].add(this),this.isPlaying=this.running=!0,this.style.visible=!0),this._tickSprite(0)},this.stopAnimation=function(){this.isPlaying&&(this.style.visible=!1,this.tick=null,this.isPaused=this._isPaused=this.isPlaying=this.running=!1,n[this.groupID].remove(this.uid))},this.resetAnimation=function(){this._opts.loop?this.startAnimation(this._opts.defaultAnimation):this.stopAnimation()},this.setFramerate=function(e){this.frameRate=e||1e-5},this.pause=function(){this.isPaused=this._isPaused=!0},this.resume=function(){this.isPaused=this._isPaused=!1},this._tickSprite=function(e){if(!this.isPaused)if(e+=this._dt,this._delay)this._delay-=e,0>this._delay&&(this._delay=0);else{var t=this._animations[this._currentAnimationName],n=1e3/this.frameRate,r=e/n|0,i=this._currentFrame;this._dt=e-r*n,this._currentFrame=(this._currentFrame+r)%t.frames.length,0>this._currentFrame&&(this._currentFrame+=t.frames.length);if(this.onScreen&&(0!==r||0===e))if(this.setImage(this._animations[this._currentAnimationName].frames[this._currentFrame]),this._opts.emitFrameEvents)for(e=0;e<r;e++)this.publish(this._currentAnimationName+"_"+(i+e)%t.frames.length);(i+r)/t.frames.length|0&&(this._delay=this._opts.delay,0>=--this._iterationsLeft&&(t=this._callback,this._callback=null,this.resetAnimation(),t&&t()))}}});SpriteView.allAnimations={},SpriteView.getGroup=SpriteView.prototype.getGroup,function(){var r,i,s,o,e=ui.resource.loader.getMap(),t=SpriteView.allAnimations,n=Object.keys(e);n.sort();for(r in n){i=n[r],s=/((?:.*)\\/.*?)[-_ ](.*?)[-_ ](\\d+)/.exec(i);if(s){o=s[1],s=s[2],o=t[o]||(t[o]={}),o=o[s]||(o[s]=[]),s=e[i];s.url=i,o.push(s)}}}();Group=__class__,Group=Group(function(){return this.init&&this.init.apply(this,arguments)},jsio.__filename,function(){this.init=function(){this.sprites={}},this.add=function(e){this.sprites[e.uid]=e},this.remove=function(e){delete this.sprites[e]},this.pause=function(){this._forEachSprite("pause")},this.resume=function(){this._forEachSprite("resume")},this.stopAnimation=function(){this._forEachSprite("stopAnimation")},this.resetAnimation=function(){this._forEachSprite("resetAnimation")},this._forEachSprite=function(e){for(var t in this.sprites)this.sprites[t][e]()}})'),jsio.setCachedSrc("./src/Application.js",'var src_Application;jsio("import device"),jsio("import ui.View"),jsio("import ui.View as View"),jsio("import ui.StackView as StackView"),jsio("import src.views.screens.MainMenuView as MainMenuView"),jsio("import src.views.screens.GameView as GameView"),jsio("import src.platformer.util as util"),jsio("import ui.ImageView as ImageView"),jsio("import src.platformer.ParallaxView as ParallaxView"),jsio("import plugins.googleanalytics.googleAnalytics as googleAnalytics");src_Application=__class__;exports=src_Application(function(){return this.init&&this.init.apply(this,arguments)},GC.Application,function(){this._settings={alwaysRepaint:!0,logsEnabled:!1,showFPS:!1,preload:["resources/images/menu"]},this.initUI=function(){var e,t;util.scaleRootView(this,1024,683);e=new MainMenuView;gameview=new GameView,this.view.style.backgroundColor="#000000";t=new StackView({superview:this.view,x:0,y:0,width:1024,height:576,clip:!0,backgroundColor:"#f19e54"});new ImageView({superview:t,image:"resources/images/menu/background.png",width:1024,height:576,x:0,y:0}),e.width=1024,e.height=576,t.push(e),e.on("titlescreen:start",function(){googleAnalytics.track("game start screen","Game Start"),t.push(gameview),gameview.emit("game:start")}),device.setBackButtonHandler(function(){return console.log("someone hit the back button!"),!1})},this.launchUI=function(){}})'),jsio.setCachedSrc("./src/views/screens/MainMenuView.js",'var src_views_screens_MainMenuView;jsio("import ui.View as View"),jsio("import ui.View"),jsio("import ui.ImageView as ImageView"),jsio("import device");src_views_screens_MainMenuView=__class__;exports=src_views_screens_MainMenuView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.init=function(t){e(this,"init",[t]),this.junkee(),this.addStartButton()},this.junkee=function(){this.background=new ImageView({superview:this,x:100,y:100,width:50,height:50,image:"resources/images/enemies/bee_flying_0001.png"})},this.addStartButton=function(){this.startbutton=new ui.View({superview:this,x:0,y:0,width:1024,height:576}),this.startbutton.on("InputSelect",bind(this,function(){this.emit("titlescreen:start"),console.log("click")}))}})'),jsio.setCachedSrc("./src/views/screens/GameView.js",'var src_views_screens_GameView,EnemyBeeView;jsio("import ui.View"),jsio("import ui.View as View"),jsio("import ui.ImageView"),jsio("import ui.SpriteView"),jsio("import ui.ImageScaleView"),jsio("import ui.resource.loader as loader"),jsio("import math.geom.Rect as Rect"),jsio("import math.geom.Point as Point"),jsio("import animate"),jsio("import AudioManager"),jsio("import src.platformer.ParallaxView as ParallaxView"),jsio("import src.platformer.GestureView as GestureView"),jsio("import src.platformer.Physics as Physics"),jsio("import src.platformer.ScoreView as ScoreView"),jsio("import src.platformer.util as util"),jsio("import resources.starGrids as starGrids");src_views_screens_GameView=__class__;exports=src_views_screens_GameView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){var t=__class__;const n=1200,r=n/3,i=500,s=700,o=400,u=15,a=.3,f=1,l=1;this.init=function(t){e(this,"init",[t]),this.on("game:start",function(){console.log("falta poco"),this.resetState(),this.setupParallaxView(),this.setupInput(),this.setupPlayer(),this.setupUILayer(),this.loadSound(),this.startGame(),Physics.start(),this.loaded=!0})},this.setupParallaxView=function(){this.parallaxView=new ParallaxView({superview:this,width:this.style.width,height:this.style.height}),this.parallaxView.addBackgroundView(new ui.ImageScaleView({scaleMethod:"cover",image:"resources/images/level/backgroundSky.png"})),this.parallaxView.addLayer({distance:20,populate:function(e,t){var n=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/fargroundBrush.png",x:t,y:e.style.height-250,opacity:.6,width:1024,height:212});return n.style.width}}),this.parallaxView.addLayer({distance:10,populate:function(e,t){var n=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/midgroundBrush.png",x:t,y:e.style.height-200,width:1024,height:212});return n.style.width}}),this.gameLayer=this.parallaxView.addLayer({distance:7,populate:function(e,t){return this.populateGameLayer(e,t)}.bind(this)}),this.parallaxView.addLayer({distance:5,populate:function(e,t){var n=util.choice([1,2,3,4,5]),r=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/cloud"+n+".png",x:t,y:e.style.height-util.randInt(100,300),opacity:Math.random(),autoSize:!0});return util.randInt(200,500)}}),this.parallaxView.addLayer({distance:4,populate:function(e,t){var n=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/waterFast.png",x:t,y:e.style.height-50,width:1024,height:111});return n.style.width}}),this.parallaxView.addLayer({distance:6,populate:function(e,t){var n=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/waterSlow.png",x:t,y:e.style.height-600,width:1024,height:30});return n.style.width}})},this.onJump=function(){if(!this.isFinished){if(this.player.jumpingLevel==0&&this.player.velocity.y<150||this.player.jumpingLevel==1)this.player.jumpingLevel++,this.player.velocity.y=-1*i,this.player.startAnimation(this.player.jumpingLevel==1?"jump":"float",{loop:this.player.jumpingLevel==2,callback:function(){this.player.startAnimation("glider",{loop:!0})}.bind(this)})}else this._touchedWhenFinished=!0},this.onJumpDone=function(){this._touchedWhenFinished&&this.isFinished?(this._touchedWhenFinished=!1,this.startGame()):this.player.jumpingLevel>0&&this.player.startAnimation("land",{loop:!0})},this.setupInput=function(){this.gestureView=new GestureView({superview:this,width:this.style.width,height:this.style.height,zIndex:1e4}),this._touchedWhenFinished=!1,this.gestureView.on("InputStart",this.onJump.bind(this)),this.gestureView.on("InputSelect",this.onJumpDone.bind(this)),this.gestureView.on("Drag",function(e){if(Math.abs(e.dx)>100)return;e.dy>100&&e.duration<500&&(this.player.rolling||(this.player.rolling=!0,this.player.velocity.y=s),this.player.startAnimation("roll",{loop:!0}),animate(this.player).now({r:Math.PI*2},500,animate.linear),e.cancel())}.bind(this))},this.setupPlayer=function(){this.player=new ui.SpriteView({zIndex:1,x:0,y:0,anchorX:50,anchorY:50,autoSize:!0,url:"resources/images/avatarKiwiAce/kiwiAce",defaultAnimation:"run",autoStart:!0}),this.player.jumpingLevel=1,Physics.addToView(this.player,{hitbox:{x:0,y:20,width:80,height:80}})},this.setupUILayer=function(){this.scoreView=new ScoreView({superview:this,zIndex:1e4,x:0,y:28,width:this.style.width,height:70,anchorX:this.style.width/2,anchorY:35,charWidth:50,charHeight:70,text:"0",url:"resources/images/numbers/char-{}.png"}),this.bottleView=new ui.ImageView({superview:this.view,image:"resources/images/star.png",x:300,y:0,width:100,height:100,autoSize:!1})},this.loadSound=function(){this.sound=new AudioManager({path:"resources/audio/",files:{background:{volume:.6,background:!0},win:{volume:1,background:!0},lose:{volume:1,path:"effects"},bottle1:{volume:.2,path:"effects"},bottle2:{volume:.2,path:"effects"},bottle3:{volume:.2,path:"effects"},bottle4:{volume:.2,path:"effects"},bottle5:{volume:.2,path:"effects"}}})},this.populateGameLayer=function(e,t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,n=e.style.height/2;this.lastPlatformHeight==null&&(this.lastPlatformHeight=100);r=Math.min(n,Math.max(0,util.randInt(this.lastPlatformHeight-n/2,this.lastPlatformHeight+n/2)));this.lastPlatformHeight=r;i=util.choice([256,512,768,1024]),s=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/level/platform"+i+".png",x:t,y:e.style.height-100-r,width:i,autoSize:!0});Physics.addToView(s,{group:"ground"});o=util.randInt(50,200),u=75,a=i/u-2,f=s.style.width/u|0,l=util.choice(starGrids),c=util.randInt(0,Math.max(0,f-l[0].length))*u;for(h=0;h<l.length;h++){p=l[h],d=Math.min(p.length,f);for(v=0;v<d;v++){if(l[h][v]==0)continue;m=e.obtainView(ui.ImageView,{superview:e,image:"resources/images/star.png",x:t+c+v*u,y:s.style.y-o-u*h,anchorX:u/2,anchorY:u/2,width:u,height:u,scale:1},{poolSize:40,group:"star"});Physics.addToView(m,{group:"star"})}}g=0;this.t>5&&(g=util.randInt(100,100+this.t*20));if(Math.random()<3.5&&this.t>5&&s.style.width>=512)y=e.obtainView(EnemyBeeView,{superview:e,x:t+util.randInt(0,s.style.width-50),y:s.style.y-util.choice([100,300]),width:50,height:100},{poolSize:15,group:"bee"});return s.style.width+g|0},this.resetState=function(){this.isFinished&&(animate(this.scoreView).commit(),animate(this.parallaxView).commit()),this.t=0,this.isFinished=!1,this.score=0},this.startGame=function(){setTimeout(function(){this.sound.play("background")}.bind(this)),this.resetState(),this.parallaxView.scrollTo(0,0),this.parallaxView.clear(),this.gameLayer.addSubview(this.player),this.player.jumpingLevel=1,this.player.setCollisionEnabled(!0),this.player.style.r=0,this.player.startAnimation("land",{loop:!0}),this.player.setPosition(50,0).setVelocity(o,-400).setAcceleration(u,n)},this.finishGame=function(){var e;if(!this.isFinished){this.isFinished=!0,this.sound.play("lose"),this.player.acceleration.x=-200,animate(this.parallaxView).now({opacity:.2},1e3).wait(1e7).then({opacity:1});e=this.scoreView.style.y;animate(this.scoreView).now({dy:(this.style.height-this.scoreView.style.height)/2},1e3,animate.easeIn).then({scale:2},400,animate.easeIn).then({scale:1.5},400,animate.easeOut).wait(1e7).then({y:e,scale:1},400,animate.easeOut)}},this.tick=function(e){var t,i,s,o,u,a;if(!this.loaded)return;t=Math.min(e/1e3,1/30);this.t+=t,this.isFinished?this.player.velocity.x<0&&(this.player.stopAllMovement(),this.sound.play("win")):this.gestureView.isPressed()?this.player.acceleration.y=r:this.player.acceleration.y=n,this.scoreView.setText(this.score|0),this.gameLayer.scrollTo(this.player.getLeft()-50,Math.min(0,this.player.getTop()-this.gameLayer.style.height/4));i=this.player.getCollisions("ground");for(s=0;s<i.length;s++){o=i[s];if(this.player.getPrevBottom()<=o.view.getTop()+10&&this.player.velocity.y>=0){if(this.player.jumpingLevel>0||this.player.rolling)this.player.jumpingLevel=0,this.player.rolling=!1,animate(this.player).clear(),this.player.setRotation(0),this.player.resetAnimation();this.player.position.y-=o.intersection.height,this.player.velocity.y=0}}i=this.player.getCollisions("star");for(s=0;s<i.length;s++){o=i[s],u=o.view;this.score+=f,u.setCollisionEnabled(!1),animate(u).now({scale:0,dx:util.randInt(-100,100),dy:util.randInt(-100,100)},200).then(function(){u.removeFromSuperview()})}i.length&&this.sound.play("bottle"+util.randInt(1,5));i=this.player.getCollisions("bee");for(s=0;s<i.length;s++){o=i[s],a=o.view;a.setCollisionEnabled(!1),a.stopAllMovement(),a.velocity.x=this.player.velocity.x,a.acceleration.y=n,a.die(),this.player.setCollisionEnabled(!1),animate(this.player).now({dr:Math.PI*-2},2e3),this.finishGame()}this.player.getY()>=this.gameLayer.style.height&&this.finishGame()}});EnemyBeeView=new Class([ui.View,Physics],function(e){this.init=function(t){function r(){animate(n).clear().now({dy:50},400).then({dy:-50},400).then(r)}t.group="bee",t.hitbox={x:10,y:10,width:30,height:30},e(this,"init",arguments),Physics.prototype.init.apply(this,arguments);var n=this.sprite=new ui.SpriteView({superview:this,x:0,y:0,width:50,height:50,url:"resources/images/enemies/bee",defaultAnimation:"flying",autoStart:!0});r()},this.tick=function(){this.hitbox.y=this.sprite.style.y+10},this.die=function(){animate(this.sprite,"rotation").now({r:Math.PI*1.5},1e3)}})'),jsio.setCachedSrc("./src/platformer/ParallaxView.js",'var MAX_ZINDEX,src_platformer_ParallaxView,ParallaxView;jsio("import ui.ImageView"),jsio("import ui.View"),jsio("import ui.ViewPool"),jsio("import animate");MAX_ZINDEX=1e6,src_platformer_ParallaxView=__class__,ParallaxView=exports=src_platformer_ParallaxView(function(){return this.init&&this.init.apply(this,arguments)},ui.View,function(e){var t={};this.init=function(n){this._opts=n=merge(n,t),this.layers=[],this._y=this._x=0,e(this,"init",arguments)},this.addBackgroundView=function(e){e.style.width=this.style.width,e.style.height=this.style.height,this.addSubview(e)},this.addLayer=function(e){if(1>e._distance)throw new Exception("Layer distance must be >= 1.");return e instanceof ParallaxView.Layer||(e=new ParallaxView.Layer(e)),e._parallaxView=this,this.addSubview(e),this.layers.push(e),e.style.height=this.style.height,e.style.zIndex=MAX_ZINDEX-e._distance,e.scrollTo(this._x/e._distance,this._y/e._distance),e},this.clear=function(){for(var e=0;e<this.layers.length;e++)this.layers[e].clear()},this.scrollBy=function(e,t,n){null==e&&(e=0),null==t&&(t=0),n=n||1,e*=n,t*=n,this.scrollTo(null!=e?this._x+e:null,null!=t?this._y+t:null)},this.scrollTo=function(e,t,n){null==e&&(e=0),null==t&&(t=0),n=n||1,e*=n,t*=n,this._x=e,this._y=t;for(n=0;n<this.layers.length;n++){var r=this.layers[n];r._scrollTo(e/(r._distance||1),t/(r._distance||1))}}});ParallaxView.Layer=__class__,ParallaxView.Layer=ParallaxView.Layer(function(){return this.init&&this.init.apply(this,arguments)},ui.View,function(e){var t={distance:1};this.init=function(n){this._opts=n=merge(n,t),e(this,"init",arguments),this._distance=n.distance||1,this._pools={},this._populatedX=-this.style.x,this.setHandleEvents(!1,!1)},this.scrollTo=function(e,t){this._parallaxView.scrollTo(e,t,this._distance)},this.scrollBy=function(e,t){this._parallaxView.scrollBy(e,t,this._distance)},this.setDistance=function(e){this._distance=e},this.clear=function(){var e;for(e=this.getSubviews();e.length;)e.pop().removeFromSuperview();this._populatedX=-this.style.x,this._populate()},this.obtainView=function(e,t,n){var i,s,n=n||{},r=e.name+(n.group||"");(i=this._pools[r])||(i=this._pools[r]=new ui.ViewPool({ctor:e,initOpts:t,initCount:n.poolSize||15}));s=i.obtainView();return s.updateOpts(t),s.style.visible=!0,s instanceof ui.ImageView&&"image"in t&&s.setImage(t.image,t),s._pool||(s._pool=i,s.on("ViewRemoved",function(){s._pool&&s._pool.releaseView(s)}.bind(this))),s},this.populate=function(e){if(this._opts.populate)return this._opts.populate.call(this,this,e)},this._scrollTo=function(e,t){this.style.x=-e|0,this.style.y=-t|0,this._populate()},this._populate=function(){var e,t,n,r;for(e=this._populatedX,t=-this.style.x+this.getSuperview().style.width;e<t;){n=this.populate(e);if(!n||isNaN(n))break;e+=n}this._populatedX=Math.max(e,t),e=0,t=this.getSubviews();for(n=t.length;e<n;e++){r=t[e];r.style.x+r.style.width<-this.style.x&&r.removeFromSuperview()}}})'),jsio.setCachedSrc("sdk/timestep/ui/ViewPool.js",'var sdk_timestep_ui_ViewPool=__class__;exports=sdk_timestep_ui_ViewPool(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(e){this._views=[],this._opts=e;for(e=e.initCount||0;e;)this._createNewView({}),e--;this._freshViewIndex=0},this._createNewView=function(){var n,e={},t=this._opts.initOpts;for(n in t)e[n]=t[n];return e=new this._opts.ctor(e),e.style.visible=!1,e._poolIndex=this._views.length,this._views.push(e),e},this.obtainView=function(){var e;return this._freshViewIndex<this._views.length?e=this._views[this._freshViewIndex]:(console.log("MAKING NEW VIEW FOR: "+(this._opts.tag||this._opts.ctor)),e=this._createNewView()),e.onObtain&&e.onObtain(),this._freshViewIndex++,e._obtainedFromPool=!0,e},this.releaseView=function(e){var t,n;if(e._obtainedFromPool){e.onRelease&&e.onRelease(),e.stopAnimation&&e.stopAnimation();t=this._views[this._freshViewIndex-1];this._views[this._freshViewIndex-1]=e,this._views[e._poolIndex]=t;n=t._poolIndex;return t._poolIndex=e._poolIndex,e._poolIndex=n,e._obtainedFromPool=!1,e.style.visible=!1,this._freshViewIndex--,!0}return!1},this.releaseAllViews=function(){var e,t,n;for(e=this._views,t=e.length;t;){n=e[--t];n._obtainedFromPool=!1,n.style.visible=!1}this._freshViewIndex=0}})'),jsio.setCachedSrc("./src/platformer/GestureView.js",'var src_platformer_GestureView;jsio("import ui.View");src_platformer_GestureView=__class__;exports=src_platformer_GestureView(function(){return this.init&&this.init.apply(this,arguments)},ui.View,function(e){var t={};this.init=function(n){this._opts=n=merge(n,t),e(this,"init",arguments)},this.isPressed=function(){return!!this._startEvent},this.onInputStart=function(e){this._startEvent=e},this.onInputMove=function(e){var t=this._startEvent;t&&this.emit("Drag",{duration:e.when-t.when,dx:e.srcPoint.x-t.srcPoint.x,dy:e.srcPoint.y-t.srcPoint.y,cancel:function(){this._startEvent=null}.bind(this)})},this.onInputSelect=function(e){var t=this._startEvent;t&&(this._startEvent=null,this.emit("Swipe",{duration:e.when-t.when,dx:e.srcPoint.x-t.srcPoint.x,dy:e.srcPoint.y-t.srcPoint.y}))}})'),jsio.setCachedSrc("./src/platformer/Physics.js",'var groups,allPhysicsViews,src_platformer_Physics,Physics;function addViewToCollisionGroup(e,t){groups[e]||(groups[e]={}),groups[e][t.uid]=t}function removeViewFromCollisionGroup(e,t){groups[e]&&groups[e][t.uid]&&delete groups[e][t.uid]}function setterHelper(e,t,n,r){2==t.length?(e.x=t[0]+(n||0),e.y=t[1]+(r||0)):(e.x=t[0].x+(n||0),e.y=t[0].y+(r||0))}jsio("import math.geom.intersect as intersect"),jsio("import math.geom.Rect as Rect"),jsio("import math.geom.Point as Point");groups={},allPhysicsViews={},src_platformer_Physics=__class__,Physics=exports=src_platformer_Physics(function(){return this.init&&this.init.apply(this,arguments)},function(){var e={physics:!0,collision:!0,group:null,groups:[],hitbox:null};this.init=function(t){t=merge(t,e),this._collisionGroups=[],this._physicsEnabled=t.physics,this._collisionEnabled=t.collision,this.hitbox=t.hitbox,this.on("ViewAdded",function(){allPhysicsViews[this.uid]=this;for(var e=0;e<this._collisionGroups.length;e++)addViewToCollisionGroup(this._collisionGroups[e],this)}.bind(this)),this.on("ViewRemoved",function(){delete allPhysicsViews[this.uid];for(var e=0;e<this._collisionGroups.length;e++)removeViewFromCollisionGroup(this._collisionGroups[e],this)}.bind(this)),this._updatePhysicsOpts(t),this.position=this.style;for(var n in Point.prototype)n in this.position||(this.position[n]=Point.prototype[n]);this.velocity=new Point,this.acceleration=new Point,this.prevPosition=new Point(this.position);if(this.__root){allPhysicsViews[this.uid]=this;for(t=0;t<this._collisionGroups.length;t++)addViewToCollisionGroup(this._collisionGroups[t],this)}},this.getX=function(){return this.style.x},this.getY=function(){return this.style.y},this.getWidth=function(){return this.style.width},this.getHeight=function(){return this.style.height},this.getRect=function(){return new Rect(this.style)},this.getTop=function(){return this.style.y},this.getBottom=function(){return this.style.y+this.style.height},this.getLeft=function(){return this.style.x},this.getRight=function(){return this.style.x+this.style.width},this.setWidth=function(e){return this.style.width=e,this},this.setHeight=function(e){return this.style.height=e,this},this.setTop=this.setY=function(e){return this.style.y=e,this},this.setBottom=function(e){return this.style.y=e-this.style.height,this},this.setLeft=this.setX=function(e){return this.style.x=e,this},this.setRight=function(e){return this.style.x=e-this.style.width,this},this.setRect=function(e){return this.style.update(e),this},this.getCenter=function(){return Rect.prototype.getCenter.call(this.style)},this.getTopLeft=function(){return new Point(this.style.x,this.style.y)},this.getTopRight=function(){return new Point(this.style.x+this.style.width,this.style.y)},this.getBottomLeft=function(){return new Point(this.style.x,this.style.y+this.style.height)},this.getBottomRight=function(){return new Point(this.style.x+this.style.width,this.style.y+this.style.height)},this.setCenter=function(){return setterHelper(this.style,arguments,-this.getWidth()/2,-this.getHeight()/2),this},this.setTopLeft=function(){return setterHelper(this.style,arguments,0,0),this},this.setTopRight=function(){return setterHelper(this.style,arguments,-this.style.width,0),this},this.setBottomLeft=function(){return setterHelper(this.style,arguments,0,-this.style.height),this},this.setBottomRight=function(){return setterHelper(this.style,arguments,-this.style.width,-this.style.height),this},this.setRotation=function(e){return this.style.r=e,this},this.getRotation=function(){return this.style.r},this.rotate=function(e){return this.style.r+=e,this},this.getPrevPosition=function(){return this.prevPosition},this.getPrevTop=function(){return this.prevPosition.x},this.getPrevBottom=function(){return this.prevPosition.y+this.style.height},this.getPrevLeft=function(){return this.prevPosition.y},this.getPrevRight=function(){return this.prevPosition.x+this.style.width},this.getPrevTopLeft=function(){return new Point(this.prevPosition.x,this.prevPosition.y)},this.getPrevTopRight=function(){return new Point(this.prevPosition.x+this.style.width,this.prevPosition.y)},this.getPrevBottomLeft=function(){return new Point(this.prevPosition.x,this.prevPosition.y+this.style.height)},this.getPrevBottomRight=function(){return new Point(this.prevPosition.x+this.style.width,this.prevPosition.y+this.style.height)},this.getPrevRect=function(){return new Rect({x:this.prevPosition.x,y:this.prevPosition.y,width:this.style.width,height:this.style.height})},this.setPosition=this.setTopLeft,this.setVelocity=function(){return setterHelper(this.velocity,arguments,0,0),this},this.setAcceleration=function(){return setterHelper(this.acceleration,arguments,0,0),this},this.getPosition=this.getTopLeft,this.getVelocity=function(){return this.velocity},this.getAcceleration=function(){return this.acceleration},this.stopAllMovement=function(){this.setVelocity(0,0),this.setAcceleration(0,0)},this.setPhysicsEnabled=function(e){this._physicsEnabled=e},this.setCollisionEnabled=function(e){this._collisionsEnabled=e},this.setCollisionGroups=function(e){e?Array.isArray(e)||(e=[e]):e=[];for(var t=0;t<this._collisionGroups.length;t++)removeViewFromCollisionGroup(this._collisionGroups[t],this);this._collisionGroups=e;if(this.__root)for(t=0;t<this._collisionGroups.length;t++)addViewToCollisionGroup(this._collisionGroups[t],this)},this.inCollisionGroup=function(e){return-1!=this._collisionGroups.indexOf(e)},this._computedHitBox=null,this.getHitBox=function(){return this._computedHitBox||(this._computedHitBox={}),this._computedHitBox.x=this.style.x+(this.hitbox?this.hitbox.x:0),this._computedHitBox.y=this.style.y+(this.hitbox?this.hitbox.y:0),this._computedHitBox.width=this.hitbox?this.hitbox.width:this.style.width,this._computedHitBox.height=this.hitbox?this.hitbox.height:this.style.height,this._computedHitBox},this.getCollisions=function(e){var t=[];if(!this._collisionsEnabled)return t;if(e=groups[e])for(var n in e)if(n!=this.uid){var r=e[n],i=intersect.rectAndRect(this.getHitBox(),r.getHitBox());i&&t.push({intersection:i,view:r})}return t},this._updatePhysicsOpts=function(e){this.setCollisionGroups(e.group||e.groups),e.position&&(this.position.x=e.position.x,this.position.y=e.position.y),e.velocity&&(this.velocity.x=e.velocity.x,this.velocity.y=e.velocity.y),e.acceleration&&(this.acceleration.x=e.acceleration.x,this.acceleration.y=e.acceleration.y)}});Physics.addToView=function(e,t){var n;if(e.__hasPhysics)e._updatePhysicsOpts(t);else{e.__hasPhysics=!0;for(n in Physics.prototype)n in e||(e[n]=Physics.prototype[n]);Physics.prototype.init.call(e,t)}return e},Physics.running=!1,Physics.start=function(){Physics.running||(Physics.running=!0,GC.app.engine.on("Tick",Physics.tick))},Physics.stop=function(){Physics.running&&(Physics.running=!1,GC.app.engine.unsubscribe("Tick",Physics.tick))},Physics.tick=function(e){var t,n;if(Physics.running){0<e&&(e/=1e3);for(t in allPhysicsViews){n=allPhysicsViews[t];n._physicsEnabled&&(n.prevPosition.x=n.position.x,n.prevPosition.y=n.position.y,n.velocity.x+=n.acceleration.x*e,n.velocity.y+=n.acceleration.y*e,n.position.x+=n.velocity.x*e,n.position.y+=n.velocity.y*e)}}}'),jsio.setCachedSrc("./src/platformer/ScoreView.js",'var emptyFunc,src_platformer_ScoreView;jsio("import ui.View as View"),jsio("import ui.ImageView as ImageView"),jsio("import ui.resource.Image as Image");emptyFunc=function(){},src_platformer_ScoreView=__class__;exports=src_platformer_ScoreView(function(){return this.init&&this.init.apply(this,arguments)},View,function(e){this.init=function(t){t.blockEvents=!0,t.canHandleEvents=!1,e(this,"init",arguments),this._charHeight=t.charHeight,this._charWidth=t.charWidth,this._charImages={},this._chars=t.chars||{},this._url=t.url,this.textAlign=t.textAlign||"center",this.spacing=t.spacing||1,this._activeCharacters=[],this._imageViews=[],t.text&&this.setText(t.text)},this.setText=function(e){var e,t,n,r,i,s,o,u,a,f;for(e=e+"",t=0,n=this.style,r=n.height/this._charHeight,i=this._activeCharacters,s=this._imageViews,o=0;o<e.length;o++){u=e.charAt(o);i[o]=this._imageForChar(u),t+=(this._charWidth+this.spacing)*r}t>n.width&&(n.scale=n.width/t);for(o="center"===this.textAlign?(n.width-t)/2:"right"===this.textAlign?n.width-t:0;e.length>s.length;)t=new ImageView({superview:this,x:0,y:0,width:1,height:1,canHandleEvents:!1}),t.needsReflow=emptyFunc,s.push(t);i.length=e.length,e=o,o=0;for(j=i.length;o<j;o++){t=i[o],u=s[o],a=u.style,f=this._charWidth*r;a.x=e,a.y=0,a.width=f,a.height=n.height,a.visible=!0,u.setImage(t),e+=f+this.spacing*r}for(;o<s.length;)s[o++].style.visible=!1},this._imageForChar=function(e){return this._charImages[e]||(this._charImages[e]=new Image({url:this._url.replace("{}",this._chars[e]||e)})),this._charImages[e]},this.needsReflow=emptyFunc})'),jsio.setCachedSrc("./src/platformer/util.js",'jsio("import device"),jsio("import ui.View"),exports.randFloat=function(e,t){return null==t&&(t=e,e=0),e+(t-e)*Math.random()},exports.randInt=function(e,t){return exports.randFloat(e,t)|0},exports.choice=function(e){return e[e.length*Math.random()|0]},exports.scaleRootView=function(e,t,n){var r=e.view,i=Math.min(r.style.width/t,r.style.height/n);e.view=new ui.View({superview:r,scale:i,width:t,height:n,x:(device.screen.width-t*i)/2,y:(device.screen.height-n*i)/2,clip:!0})}'),jsio.setCachedSrc("./resources/starGrids.js","exports=[[[0,1,0]],[[1,1,1,1,1,1]],[[1,0,1,0,1,0,1,0,1]],[[1,1,1,1,1,1,1,1,1]],[[0,0,0,1,0,0,0],[0,0,1,0,1,0,0],[0,1,0,0,0,1,0],[1,0,0,0,0,0,1]],[[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]],[[0,0,1,0,0],[0,1,1,1,0],[1,1,1,1,1]],[[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]],[[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]],[[1,0,1,0,1,0,1,0,1],[0,1,0,1,0,1,0,1,0],[1,0,1,0,1,0,1,0,1],[0,1,0,1,0,1,0,1,0]],[[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1]]]"),jsio.setCachedSrc("sdk/plugins/googleanalytics/googleAnalytics.js",'var hasNativeEvents,GoogleAnalytics;jsio("import device");hasNativeEvents=NATIVE&&NATIVE.plugins&&NATIVE.plugins.sendEvent,GoogleAnalytics=__class__,GoogleAnalytics=GoogleAnalytics(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._globalProperties={},device.isMobileBrowser&&!device.isSimulator&&!window.weebyGoogleAnalyticsLoaded&&(window.weebyGoogleAnalyticsLoaded=!0,this._loadTrackingForWeb())},this.track=function(e,t){merge(t,this._globalProperties),!1,hasNativeEvents&&NATIVE.plugins.sendEvent("GoogleAnalyticsPlugin","track",JSON.stringify({eventName:e,params:t}))},this.setGlobalProperty=function(e,t){this._globalProperties[e]=t},this._loadTrackingForWeb=function(){try{(function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),console.log("googleAnalytics addon [info]: create - "+CONFIG.addons.googleanalytics.trackingId+" - "+CONFIG.addons.googleanalytics.url),ga("create",CONFIG.addons.googleanalytics.trackingId,CONFIG.addons.googleanalytics.url),ga("send","pageview")}catch(e){console.log("googleAnalytics addon [error]: "+e.message)}},this.trackPage=function(e,t){window.ga?ga("send",{hitType:"pageview",page:"/"+e,title:t}):console.log("googleAnalytics addon [warn]: googleAnalytics object is not defined. Not tracking page: "+e)},this.trackEvent=function(e,t,n,r){window.ga?ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:n,value:r||0}):console.log("googleAnalytics addon [warn]: googleAnalytics object is not defined. Not tracking event: "+[e,t,n].join(":"))}});exports=new GoogleAnalytics'); jsio("import gc.browser.launchClient");